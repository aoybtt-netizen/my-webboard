<!DOCTYPE html>
<html lang="th">
<head>
	
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GedGoZone</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            margin: 0;
            
            /* ‡πÉ‡∏™‡πà Overlay ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏à‡∏≤‡∏á‡πÜ (rgba(255, 255, 255, 0.7)) ‡∏ó‡∏±‡∏ö‡∏£‡∏π‡∏õ */
            background-image: linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)), url('https://sv1.img.in.th/7jQo93.png');
            background-size: cover;         
            background-position: center;    
            background-attachment: fixed;   
            background-repeat: no-repeat;   
            background-color: #f0f2f5; /* ‡∏™‡∏µ‡∏™‡∏≥‡∏£‡∏≠‡∏á */
        }
        
        .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100vh; background: white; z-index: 1000; transition: left 0.3s ease; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; box-shadow: 2px 0 10px rgba(0,0,0,0.1); overflow-y: auto;}
        .sidebar.active { left: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900; display: none; }
        .overlay.active { display: block; }
        .menu-btn { position: fixed; top: 20px; left: 20px; z-index: 800; background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 20px; }

        .sidebar-btn { background: #f8f9fa; border: none; padding: 15px; width: 100%; text-align: left; margin-bottom: 10px; border-radius: 8px; cursor: pointer; font-size: 16px; color: #333; }
        .sidebar-btn:hover { background: #e2e6ea; }
        .create-btn { background: #007bff; color: white; font-weight: bold; text-align: center; }
        .create-btn:hover { background: #0056b3; }
        .admin-btn { background: #ffc107; color: #333; font-weight: bold; }
		
		.my-active-posts-btn {
		background: #007bff; 
		color: white; 
		font-weight: bold; 
		text-align: left;
		}
		.my-active-posts-btn:hover { 
		background: #0056b3; 
		}

        .content-area { padding: 80px 20px 20px 20px; max-width: 800px; margin: 0 auto; position: relative; }
        
        .header-tools { position: absolute; top: 20px; right: 20px; display: flex; gap: 15px; align-items: center; z-index: 800; }
        .coin-badge { background: white; padding: 8px 15px; border-radius: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-weight: bold; color: #333; border: 2px solid #e67e22; display: flex; align-items: center; width: auto; cursor: pointer; transition: transform 0.2s; position: relative; }
        .coin-badge:hover { transform: scale(1.05); }
        
        #coin-notif-dot { top: -2px; right: 0px; }
        
        .mail-btn { background: white; width: 45px; height: 45px; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; font-size: 1.5em; position: relative; transition: transform 0.2s; }
        .mail-btn:hover { transform: scale(1.1); background: #f0f2f5; }
        
        .notif-dot { position: absolute; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; justify-content: center; align-items: center; border: 2px solid white; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-3px); } }

        .post-card { background: white; padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background 0.2s; }
        .post-card:first-child { border-top-left-radius: 10px; border-top-right-radius: 10px; }
        .post-card:last-child { border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; border-bottom: none; }
        .post-card.occupied { background: #fff3cd; border-left: 5px solid #ffc107 !important; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-box { background: white; width: 90%; max-width: 500px; padding: 30px; border-radius: 15px; max-height: 80vh; overflow-y: auto; }
        .hidden { display: none !important; }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: 'Kanit'; }

        #user-search-input { margin-bottom: 20px; padding: 10px; border: 2px solid #007bff; border-radius: 8px; font-size: 1em; }
        .user-list-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .user-list-item:hover { background: #f0f2f5; }
        .unread-indicator { width: 20px; height: 20px; background: red; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 0.75em; margin-left: 10px; }

        #private-chat-modal { z-index: 3000; }
        .chat-window { display: flex; flex-direction: column; height: 400px; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 10px; background: #f9f9f9; border: 1px solid #eee; margin-bottom: 10px; border-radius: 8px;}
        .chat-input-area { display: flex; gap: 5px; }
        
        .give-coin-btn { background: #ffc107; border: none; padding: 0 15px; border-radius: 8px; cursor: pointer; font-size: 1.2em; transition: 0.2s; }
        .give-coin-btn:hover { background: #e0a800; }
        .deduct-coin-btn { background: #dc3545; color: white; border: none; padding: 0 15px; border-radius: 8px; cursor: pointer; font-size: 1.2em; transition: 0.2s; }
        .deduct-coin-btn:hover { background: #c82333; }

        .msg { margin-bottom: 5px; font-size: 0.9em; padding: 5px 10px; border-radius: 10px; max-width: 80%; display: block; clear: both;}
        .my-msg { float: right; background: #007bff; color: white; }
        .other-msg { float: left; background: #e4e6eb; color: #333; }
        
        .system-msg { text-align: center; font-size: 0.8em; color: gray; margin: 10px 0; clear: both; float: none;}
        .system-link { cursor: pointer; color: #007bff; text-decoration: underline; background: #e9ecef; padding: 5px 10px; border-radius: 15px; display: inline-block; transition: background 0.2s; }
        .system-link:hover { background: #dde2e6; }

        .sidebar-btn.active-menu { background-color: #e2e6ea; border-left: 5px solid #007bff; font-weight: bold; }
        
        .version-display { position: fixed; bottom: 10px; right: 10px; font-size: 0.75em; color: #6c757d; background: #f8f9fa; padding: 3px 8px; border-radius: 5px; z-index: 9999; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .transaction-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .tx-plus { color: #28a745; font-weight: bold; } 
        .tx-minus { color: #dc3545; font-weight: bold; } 
        
        .location-btn { background: white; border: 1px solid #28a745; color: #28a745; padding: 8px; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9em; width: 100%; justify-content: center; margin-bottom: 10px; }
        .location-btn:hover { background: #e9f7ef; }
        .location-btn.active { background: #28a745; color: white; }
		
		.marquee-box {
    overflow: hidden;
    white-space: nowrap;
    background: #ffc107; /* Yellow/Orange background */
    color: #333;
    padding: 1px 10px;
    border-radius: 8px;
    border: 1px solid #e0a800;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 10px; /* Space above page title/filter */
    font-weight: bold;
}
	@keyframes marquee-scroll {
    0% { transform: translateX(0%); }
    100% { transform: translateX(-100%); }
}

	.marquee-content-css {
    display: inline-block;
    padding-left: 100%; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏ö */
    white-space: nowrap;
    animation: marquee-scroll 10s linear infinite; /* 25s ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô */
	padding-right: 20px;
}


	.sticky-create-btn {
    position: fixed;
    top: 50%;             /* ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    right: 0;             /* ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤ */
    transform: translateY(-50%); /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πä‡∏∞ */
    
    width: 60px;          /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
    height: 60px;         /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡∏¥‡πâ‡∏ô‡∏ä‡∏±‡∏Å) */
    
    background: linear-gradient(135deg, #6c5ce7, #a29bfe); /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• ‡∏î‡∏π‡πÄ‡∏î‡πà‡∏ô‡πÅ‡∏ï‡πà‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤ */
    color: white;
    border: none;
    
    /* ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏≥‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏î‡∏ô‡∏î‡∏π‡∏î) */
    border-top-left-radius: 30px;
    border-bottom-left-radius: 30px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    
    box-shadow: -4px 4px 15px rgba(0,0,0,0.2); /* ‡πÄ‡∏á‡∏≤‡∏õ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
    z-index: 800;        /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏ï‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ Modal */
    
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* ‡πÄ‡∏î‡πâ‡∏á‡∏î‡∏∂‡πã‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Hover */
    font-size: 24px;
}

/* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ */
.sticky-create-btn:hover {
    width: 60px; /* ‡∏¢‡∏∑‡πà‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô */
    padding-right: 10px;
    background: linear-gradient(135deg, #5f27cd, #6c5ce7);
}

.sticky-create-btn:active {
    transform: translateY(-50%) scale(0.9); /* ‡∏¢‡∏∏‡∏ö‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏ï‡∏≠‡∏ô‡∏Å‡∏î */
}

/* (Optional) ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ä‡∏µ‡∏û‡∏à‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à */
@keyframes pulse-purple {
    0% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(108, 92, 231, 0); }
    100% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); }
}
.sticky-create-btn {
    animation: pulse-purple 2s infinite;
}



/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ) */
.sticky-filter-btn {
    position: fixed;
    top: calc(50% - 80px); /* ‡∏ß‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ (‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà 50%) */
    right: 0;
    transform: translateY(-50%);
    
    width: 60px;
    height: 60px;
    
    /* ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡∏ü‡πâ‡∏≤ (Blue Gradient) ‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á */
    background: linear-gradient(135deg, #3498db, #85c1e9);
    color: white;
    border: none;
    
    /* ‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
    border-top-left-radius: 30px;
    border-bottom-left-radius: 30px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    
    box-shadow: -4px 4px 15px rgba(0,0,0,0.2);
    z-index: 800;
    
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    font-size: 24px;
	animation: rdis-sig 3s infinite;
}

.sticky-filter-btn:hover {
    width: 60px; /* ‡∏¢‡∏∑‡πà‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ */
    padding-right: 10px;
    background: linear-gradient(135deg, #2980b9, #3498db);
}

.sticky-filter-btn:active {
    transform: translateY(-50%) scale(0.9);
}

@keyframes rdis-sig {
    0% { box-shadow: 0 0 0 0 rgba(39, 142, 211, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(108, 92, 231, 0); }
    100% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); }
}



/* 1. ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏ß‡∏°: ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å ‡∏ö‡∏ô‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á (Column) */
.sticky-wrapper {
    position: fixed;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    z-index: 2000;
    
    display: flex;
    flex-direction: column; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÉ‡∏´‡πâ‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á */
    align-items: center;    /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô */
    pointer-events: none;
}

/* 2. ‡∏ï‡∏±‡∏ß‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
#filter-showds {
	position: fixed;
    right: 0;
    top: 28%;         
    
    width: 50px;
    height: 25px;
	line-height: 25px;
    padding-top: 0;
    padding-bottom: 0;
    
    background: transparent;
    color: white;
    border: none;
    
    border-top-left-radius: 30px;
    border-bottom-left-radius: 30px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    
    box-shadow: -4px 4px 15px rgba(0,0,0,0.2);
    z-index: 2000;
    padding-left: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    font-size: 14px;
	font-family: 'Kanit', sans-serif;
}





/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô (‡∏ï‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏à‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á) */
.sticky-bottom-btn {
    position: fixed;
    bottom: -5px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2500;
    
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    font-size: 20px;
    font-weight: bold;
    border: none;
    padding: 20px 45px;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    
    box-shadow: 0 -4px 15px rgba(245, 87, 108, 0.4);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    font-family: 'Kanit', sans-serif;
    white-space: nowrap;
}

.sticky-bottom-btn:hover {
    bottom: 0px;
    padding-bottom: 15px;
    filter: brightness(1.1);
}

.sticky-bottom-btn:active {
    transform: translateX(-50%) scale(0.95);
}



.sticky-shop-btn {
    position: fixed;
    bottom: 20%;             /* ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    right: 0;             /* ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤ */
    transform: translateY(-50%); /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πä‡∏∞ */
    
    width: 60px;          /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
    height: 60px;         /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏•‡∏¥‡πâ‡∏ô‡∏ä‡∏±‡∏Å) */
    
    background: linear-gradient(135deg, #6c5ce7, #a29bfe); /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• ‡∏î‡∏π‡πÄ‡∏î‡πà‡∏ô‡πÅ‡∏ï‡πà‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤ */
    color: white;
    border: none;
    
    /* ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏≥‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏î‡∏ô‡∏î‡∏π‡∏î) */
    border-top-left-radius: 30px;
    border-bottom-left-radius: 30px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    
    box-shadow: -4px 4px 15px rgba(0,0,0,0.2); /* ‡πÄ‡∏á‡∏≤‡∏õ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
    z-index: 800;        /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏ï‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ Modal */
    
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* ‡πÄ‡∏î‡πâ‡∏á‡∏î‡∏∂‡πã‡∏á‡πÄ‡∏ß‡∏•‡∏≤ Hover */
    font-size: 24px;
}




    </style>
</head>
<body>

    <button class="menu-btn" onclick="toggleSidebar()">‚ò∞ Menu</button>
    <div class="overlay" onclick="toggleSidebar()"></div>

    <div class="sidebar" id="sidebar">
    <h2 id="sidebar-app-title" style="text-align:center; margin-top:0;">Webboard</h2>
    
	
    <div onclick="window.location.href='usergedgo.html'" 
     style="text-align:center; margin-bottom:20px; background: #fdfdfd; padding: 15px; border-radius: 15px; cursor: pointer; border: 1px solid #eee; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.05);"
     onmouseover="this.style.background='#f0f0f0'; this.style.transform='translateY(-2px)';" 
     onmouseout="this.style.background='#fdfdfd'; this.style.transform='translateY(0)';" >
    
    <div style="font-size:50px; margin-bottom: 5px;" id="user-avatar-display">üë§</div>
    <div id="user-display" style="font-weight: bold; font-size: 1.1em; color: #333;">Guest</div>
    
    <div style="color:black; font-weight:bold; margin-top:5px; font-size: 0.9em;">
        ‚≠ê <span id="sidebar-rating" style="color:black;">5.0</span> / 5.0
    </div>

    <div style="font-size: 0.75em; color: #666; margin-top: 8px; display: flex; justify-content: center; gap: 10px; border-top: 1px solid #eee; pt: 8px;">
        <span><i class="fas fa-edit"></i> <span id="sidebar-total-posts">0</span></span>
        <span><i class="fas fa-check-double"></i> <span id="sidebar-completed-jobs">0</span></span>
    </div>

    <div style="color:#28a745; font-weight:bold; margin-top:10px; line-height: 1.1; background: #e8f5e9; padding: 8px; border-radius: 10px;">
        <div id="sidebar-coins">
		
            <div id="sidebar-converted-display" style="font-size: 1em;">0.00 USDT</div> 
		
        </div>
    </div>
    
    <div data-i18n-key="click_user_detail" style="font-size: 10px; color: #aaa; margin-top: 5px;">
    ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å <i class="fas fa-chevron-right"></i>
</div>
</div>

    

<div style="margin: 0 15px 15px 15px; display: flex; align-items: center; gap: 10px;">
    <label for="lang-select" style="font-size: 0.85em; color: #6c757d; margin-bottom:0;" data-i18n-key="label_language">‡∏†‡∏≤‡∏©‡∏≤:</label>
    <select id="lang-select" onchange="setLanguage(this.value)" style="flex-grow: 1; padding: 8px; border-radius: 5px; border:1px solid #ddd; font-family: 'Kanit';">
        <option value="th">üáπüá≠ ‡πÑ‡∏ó‡∏¢</option>
        <option value="en">üá∫üá∏ English</option>
		<option value="pt">üáßüá∑ Portugu√™s (Brasil)</option>
    </select>
</div>
    
    <button class="sidebar-btn" id="home-btn" onclick="switchView('home')" data-i18n-key="home">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    <button class="sidebar-btn create-btn" onclick="openCreateModal()" data-i18n-key="create_post">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô</button>
	<button data-i18n-key="btn_merchant_mode" class="sidebar-btn" onclick="window.location.href='merchant.html'" style="background: linear-gradient(135deg, #11998e, #38ef7d); color: white; font-weight: bold; border: none;">
    üè™ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
</button>
	
	<button class="sidebar-btn my-active-posts-btn" onclick="showMyActivePosts()">
    <span data-i18n-key="my_active_posts">‡∏á‡∏≤‡∏ô‡∏â‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î</span>
    <span id="active-post-count" style="margin-left:5px; padding: 2px 7px; border-radius: 50%; background:#dc3545; color:white; font-size:0.8em; line-height:1;">0</span>
</button>
	<button class="sidebar-btn my-closed-posts-btn" onclick="showMyClosedPosts()" data-i18n-key="my_closed_posts">
‡∏á‡∏≤‡∏ô‡∏â‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß
</button>
	
    
    <div id="admin-panel" class="hidden">
    <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">
    <div style="font-size:0.8em; color:gray; margin-bottom:5px;" data-i18n-key="admin_section">‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
    <button class="sidebar-btn admin-btn" onclick="openAdminAnnouncementModal()" id="admin-announcement-btn" data-i18n-key="admin_set_announcement">üì¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
	<button data-i18n-key="btn_admin_panel" class="sidebar-btn admin-btn" onclick="adminpanel()">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
	<button class="sidebar-btn admin-btn" onclick="switchView('closed')" data-i18n-key="admin_closed_posts">üóÑÔ∏è ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß</button>
    <button class="sidebar-btn admin-btn" onclick="openAdminTopicModal()" data-i18n-key="admin_manage_topics">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
    <button class="sidebar-btn admin-btn" onclick="openAdminZoneModal()" data-i18n-key="admin_manage_zones">üó∫Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô</button>
    <button class="sidebar-btn admin-btn" onclick="setPostCost()" data-i18n-key="admin_set_cost">üè∑Ô∏è ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</button>
    <button class="sidebar-btn admin-btn" onclick="openAllUserList()" data-i18n-key="admin_user_list">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

    <button class="sidebar-btn" style="margin-top:auto;" onclick="logout()" data-i18n-key="logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

    <div class="content-area">
    <div class="header-tools">
        <div class="coin-badge" onclick="contactAdmin()" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô">
            <div id="header-coins-container" style="text-align: right; line-height: 1.1;">
			
			<div id="header-converted-display" style="font-size:1.0em; color:#e67e22; font-weight: bold;">0.00 USDT</div>

</div>
            <div id="coin-notif-dot" class="notif-dot hidden">!</div>
        </div>
        
        <div class="mail-btn" onclick="openInbox()" title="‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° / ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
            üì©
            <div id="notif-badge" class="notif-dot hidden">!</div>
        </div>
    </div>

    <h2 style="margin-top:0;" id="page-title" data-i18n-key="page_title">üìå ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
    
    <div id="post-list-scroll-container" style="max-height: 70vh; overflow-y: auto;">
	
	<div id="announcement-display" class="marquee-box" style="display: none;">
    <div id="announcement-text" class="marquee-content-css"></div>
</div>
	
		

            <div id="post-list">
                </div>
				
        <div id="post-list" style="background:white; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.05);"></div>
    </div>
    
    <div id="post-pagination" style="text-align: center; margin-top: 20px; display: none;">
    <button class="sidebar-btn" id="post-prev-btn" onclick="changePostPage(-1)" style="width:auto; padding: 5px 15px; font-size: 0.9em; display:inline-block;" data-i18n-key="post_btn_prev"></button>
    <span id="post-page-info" style="margin: 0 10px; font-size: 0.9em; font-weight: bold;"></span>
    <button class="sidebar-btn" id="post-next-btn" onclick="changePostPage(1)" style="width:auto; padding: 5px 15px; font-size: 0.9em; display:inline-block;" data-i18n-key="post_btn_next"></button>
</div>
</div>



    <div id="login-modal" class="modal-overlay">
    <div class="modal-box" style="text-align:center;">
        <h2 data-i18n-key="login_title">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
        
        <input type="text" id="username-input" data-i18n-placeholder="placeholder_username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡∏î‡∏µ..." autofocus style="margin-bottom: 10px;">
		<input type="password" id="password-input" data-i18n-placeholder="placeholder_password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô..." style="margin-bottom: 10px;">
        
        <div style="display: flex; gap: 10px;">
            <button data-i18n-key="btn_login" class="sidebar-btn" onclick="login()" style="flex: 1; background: #11998e; color: white;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
			<button data-i18n-key="btn_register" class="sidebar-btn" onclick="register()" style="flex: 1; background: #f39c12; color: white;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </div>

        <div style="margin: 25px 0; border-top: 1px solid #eee; position: relative;">
            <span data-i18n-key="or_google" style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 15px; color: #999; font-size: 0.85em;">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Google</span>
        </div>

        <div id="g_id_onload"
             data-client_id="588474601862-hjtk1iu27cer2114si2947divbvd8v4c.apps.googleusercontent.com"
             data-callback="onGoogleLoginSuccess">
        </div>
        <div class="g_id_signin" data-type="standard" data-shape="rectangular"></div>
    </div>
</div>

<div id="set-password-modal" class="modal-overlay hidden">
    <div class="modal-box">
        <h3 data-i18n-key="modal_set_pw_title">üîí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
        <p data-i18n-key="modal_set_pw_desc">‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
        <input type="password" id="new-password-input" data-i18n-placeholder="placeholder_new_pw" placeholder="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà...">
        <button class="sidebar-btn create-btn" data-i18n-key="btn_confirm_pw" onclick="submitNewPassword()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    </div>
</div>

<div id="google-setup-modal" class="modal-overlay hidden">
    <div class="modal-box">
        <h3 data-i18n-key="modal_google_title">üë§ ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
        <p data-i18n-key="modal_google_desc">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Google! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥)</p>
        <input type="text" id="google-username-input" data-i18n-placeholder="placeholder_google_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£...">
        <button class="sidebar-btn create-btn" data-i18n-key="btn_start_usage" onclick="submitGoogleSetup()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
    </div>
</div>



    <div id="create-modal" class="modal-overlay hidden">
    <div class="modal-box">
        <h2 id="create-modal-title" data-i18n-key="title_create">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô</h2>
        
        <p style="color:#e67e22;" id="modal-cost-row"> 
            <span data-i18n-key="cost_fee">‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:</span> <span id="modal-cost-display">0 </span>
        </p>
        
        <input type="text" id="title-input" class="hidden" placeholder="‚≠ê ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏û‡∏¥‡πÄ‡∏®‡∏© (Admin)" style="margin-bottom: 15px;" data-i18n-key="placeholder_title_admin">
        
        <select id="category-select" required style="margin-bottom: 15px;"></select>
        
        <button type="button" class="location-btn" id="geo-btn" onclick="getLocation()" data-i18n-key="geo_btn">
            üìç ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)
        </button>
        <div id="location-display" style="font-size:0.8em; color:gray; margin-bottom:15px; text-align:center;"></div>
        
        <div class="input-group" style="margin-top: 15px;">
            <label for="post-image" data-i18n-key="label_image_max">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5MB):</label>
            <input type="file" id="post-image" name="image" accept="image/*" style="padding: 8px 0;">
        </div>
		
		<div style="position: relative; margin-bottom: 15px;">
            <textarea id="content" rows="5" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." required data-i18n-key="placeholder_content" style="margin-bottom: 5px;"></textarea>
           
            
            
        </div>
        
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="sidebar-btn" onclick="closeCreateModal()" style="width:auto;" data-i18n-key="cancel_btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="sidebar-btn create-btn" onclick="createPost()" style="width:auto;" data-i18n-key="post_btn">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
        </div>
        <div style="font-size:0.8em; color:gray; margin-top:10px;" data-i18n-key="create_note">
				* ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà Admin ‡∏Å‡∏≥‡∏´‡∏ô‡∏î
			</div>
    </div>
</div>

    <div id="user-list-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 id="user-list-title" data-i18n-key="modal_user_list_title">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h2>
                <button onclick="document.getElementById('user-list-modal').classList.add('hidden')" style="border:none; background:none; font-size:1.5em; cursor:pointer;">√ó</button>
            </div>
            <p id="user-list-desc" style="font-size:0.9em; color:gray;" data-i18n-key="modal_user_list_desc"></p>

            <input type="text" id="user-search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠..." onkeyup="openAllUserList(this.value)" style="width:100%;" data-i18n-key="search_placeholder">

            <div id="pagination-controls" style="text-align: center; margin-top: 15px; margin-bottom: 10px; display: none;">
    <button class="sidebar-btn" id="list-prev-btn" onclick="changeListPage(-1)" style="width:auto; padding: 5px 15px; font-size: 0.9em;" data-i18n-key="btn_prev">‚¨ÖÔ∏è ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <span id="page-info" style="margin: 0 10px; font-size: 0.9em; font-weight: bold;"></span>
    <button class="sidebar-btn" id="list-next-btn" onclick="changeListPage(1)" style="width:auto; padding: 5px 15px; font-size: 0.9em;" data-i18n-key="btn_next">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚û°Ô∏è</button>
</div>


		<div id="user-detail-modal" class="modal-overlay hidden" style="z-index: 2500;">
    <div class="modal-box" style="text-align: center;">
        <div style="display:flex; justify-content:flex-end;">
            <button onclick="document.getElementById('user-detail-modal').classList.add('hidden')" style="border:none; background:none; font-size:1.5em; cursor:pointer;">√ó</button>
        </div>
        
        <h2 id="detail-name" style="margin-top:0; color:#007bff;">User Name</h2>
        <div id="detail-badges" style="margin-bottom: 15px;"></div>
        
        <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px;">
            üíµ <span id="detail-coins" style="color:#28a745;">0.00</span> 
        </div>
        <div style="color:gray; font-size: 0.9em; margin-bottom: 10px;">
            ‚≠ê Rating: <span id="detail-rating">0.00</span> / 5.0
        </div>

        <div style="display: flex; justify-content: center; gap: 20px; font-size: 0.9em; color: #555; background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
            <div><i class="fas fa-edit"></i> Post: <strong id="detail-total-posts">0</strong></div>
            <div><i class="fas fa-check-double"></i> Job: <strong id="detail-completed-jobs">0</strong></div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <div id="detail-actions" style="display: flex; flex-direction: column; gap: 10px;">
        </div>
    </div>
</div>


		<div id="ban-selection-modal" class="modal-overlay hidden" style="z-index: 3000;">
    <div class="modal-box" style="text-align: center; border-top: 5px solid #dc3545;">
        <h3 style="color: #c53030;">‚è±Ô∏è Ban duration</h3>
        <p>Specify the desired ban duration for the member.: <strong id="ban-target-name"></strong></p>
        
        <select id="ban-days-select-new" onchange="toggleCustomBanInputNew()" style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <option value="1">1 Day</option>
            <option value="2">2 Day</option>
            <option value="3">3 Day</option>
            <option value="7">7 Day</option>
            <option value="15">15 Day</option>
            <option value="30">30 Day</option>
            <option value="0">indefinite</option>
            <option value="custom">Set Day</option>
        </select>
        
        <input type="number" id="custom-ban-days-new" placeholder="Specify the number of days..." style="display: none; width: 100%; margin-bottom: 15px;">
        
        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
            <button class="sidebar-btn" onclick="document.getElementById('ban-selection-modal').classList.add('hidden')" style="background: #6c757d; color: white; width: auto;">Cancel</button>
            <button class="sidebar-btn" onclick="confirmAndSendBan()" style="background: #dc3545; color: white; width: auto; font-weight: bold;">Confirm ban.</button>
        </div>
    </div>
</div>




            <div id="user-list-container">Loading...</div>
        </div>
    </div>

    <div id="private-chat-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="margin:0;"><span data-i18n-key="chat_with">üí¨ ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö:</span> <span id="chat-partner-name">...</span></h3>
                <button onclick="closePrivateChat()" style="border:none; background:none; font-size:1.5em; cursor:pointer;">√ó</button>
            </div>
            <div class="chat-window">
                <div id="private-chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <div id="admin-chat-tools" class="hidden" style="display:flex; gap:5px;">
                        <button class="give-coin-btn" title="‡πÇ‡∏≠‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" onclick="sendCoinInChat()">üí∏</button>
                        <button class="deduct-coin-btn" title="‡∏î‡∏∂‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å" onclick="deductCoinInChat()">üß≤</button>
                    </div>
                    
                    <input type="text" id="private-chat-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." style="margin-bottom:0;" autocomplete="off" data-i18n-key="chat_placeholder">
                    <button class="sidebar-btn create-btn" style="width:auto; margin-bottom:0;" onclick="sendPrivateMessage()" data-i18n-key="chat_send">‡∏™‡πà‡∏á</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="admin-topic-modal" class="modal-overlay hidden">
        <div class="modal-box" style="width: 90%; max-width: 600px;">
            <h2 style="text-align: center;" data-i18n-key="admin_topic_title">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
            <div style="max-height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; margin-bottom: 20px; border-radius: 8px;">
                <table id="admin-topic-table" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="border-bottom: 2px solid #333; padding: 8px; text-align: left;" data-i18n-key="th_topic_name">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (ID)</th>
                            <th style="border-bottom: 2px solid #333; padding: 8px; width: 100px;" data-i18n-key="th_action">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <h3 style="margin-top: 30px;" data-i18n-key="header_add_topic">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà</h3>
            <input type="text" id="new-topic-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏µ‡∏¨‡∏≤, ‡∏≠‡∏≤‡∏´‡∏≤‡∏£)" style="width: 100%; margin-bottom: 10px;" data-i18n-key="placeholder_new_topic">
            <button class="sidebar-btn create-btn" onclick="addTopic()" style="margin-bottom: 10px;" data-i18n-key="btn_add_topic">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
            <button class="sidebar-btn" onclick="document.getElementById('admin-topic-modal').classList.add('hidden');" data-i18n-key="btn_close">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
	
	<div id="deduct-confirm-modal" class="modal-overlay hidden" style="z-index: 4000;">
    <div class="modal-box" style="text-align: center; border: 2px solid #dc3545;">
        <h2 style="color: #dc3545;">‚ö†Ô∏è ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏î‡∏∂‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô</h2>
        <p style="font-size: 1.1em; margin-bottom: 20px;">
            Admin <strong><span id="deduct-requester-name">...</span></strong><br>
            ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:
        </p>
        <div style="font-size: 2em; font-weight: bold; color: #dc3545; margin-bottom: 20px;">
            <span id="deduct-amount-display">0</span> USD
        </div>
        <p style="color: gray; font-size: 0.9em;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
        
        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
            <button class="sidebar-btn" onclick="replyDeduct(false)" style="background: #6c757d; color: white; width: auto;">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
            <button class="sidebar-btn" onclick="replyDeduct(true)" style="background: #dc3545; color: white; width: auto; font-weight: bold;">‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö / ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
    </div>
</div>
    
    <div class="version-display">Alpha:1.1.2</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myUsername = "";
		let myAdminLevel = 0;
		let myZoneId = null;
		let filterLocation = null;
        let filterMaxDistance = null; 
		let userPrimaryLocation = null;
		let currentDeductRequest = null;
		let targetUserForLocation = null;
		let geoLookupTimeout = null;
		let currentAddressName = ''; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏≤‡πÄ‡∏à‡∏≠
		let currentLat = null;       // ‡πÄ‡∏Å‡πá‡∏ö Lat ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
		let currentLng = null;
		let currentZoneIdForRef = null;
		let currentUserPage = 1;
		let currentBanTarget = "";
		let currentReviewUser = "";
		// Cooldown Refresh (7 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
		const REFRESH_COOLDOWN_MS = 7000;
		
		//  Cooldown state Distance Filter
		let lastFilterTime = 0; 
		const FILTER_COOLDOWN_MS = 20000; // 20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
		
		let userSearchTimeout = null;
		
		let tempGoogleData = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google ‡πÑ‡∏ß‡πâ‡∏£‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠
		let tempUsername = null;   // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏ß‡πâ‡∏£‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™
		
		
		
		function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            const R = 6371; // ‡∏£‡∏±‡∏®‡∏°‡∏µ‡πÇ‡∏•‡∏Å (‡∏Å‡∏°.)
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }
		
		

// 2. Login ‡πÅ‡∏ö‡∏ö Google
function onGoogleLoginSuccess(response) {
    fetch('/api/auth/google', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: response.credential })
    })
    .then(res => res.json())
    .then(data => {
        if (data.isNewUser) {
            // ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Google ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠
            tempGoogleData = data.googleData;
            document.getElementById('google-setup-modal').classList.remove('hidden');
        } else if (data.success) {
            localStorage.setItem('myUsername', data.user.username);
            startApp(data.user.username);
        }
    });
}

		
		let currentZoneToAssign = null;
		// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Admin
	async function openAdminAssignModal(zoneId, zoneName, lat, lng) {
    if (myAdminLevel < 2) {
			return alert(translations[currentLang].alert_no_permission);
		}
	if (myAdminLevel === 2) {
		document.getElementById('assign-zone-name-display').innerText = `Zone: ${zoneName} (${lat.toFixed(6)}, ${lng.toFixed(6)})`;
		const res = await fetch(`/api/admin/admins-list?requestBy=${myUsername}`);
		const data = await res.json();
		}
    currentZoneToAssign = zoneId;
    
    document.getElementById('assign-zone-name-display').innerText = `Zone: ${zoneName}`;
    document.getElementById('admin-assign-modal').classList.remove('hidden');
    
    const adminListEl = document.getElementById('admin-list-for-assign');
    const t = translations[currentLang];
    adminListEl.innerHTML = `<p style="text-align:center;">${t['handover_status_loading_msg']}</p>`;

    try {
        // Fetch Admin list from the new API endpoint
        const res = await fetch(`/api/admin/admins-list?requestBy=${myUsername}`);
        const data = await res.json();
        
        if (data && data.length > 0) {
            adminListEl.innerHTML = data.map(admin => {
                // Filter out banned admins
                if (admin.isBanned) return ''; 
                
                const levelDisplay = admin.level > 0 ? `L${admin.level}` : '';
                return `
                    <div style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; cursor: pointer;"
                         onclick="assignAdminToZone('${zoneId}', '${admin.name}', '${zoneName}')">
                        <span>üë®‚Äçüíº <b>${admin.name}</b> <span style="color:#007bff; font-size:0.8em;">${levelDisplay}</span></span>
                        <button class="sidebar-btn create-btn" style="padding: 5px 10px; font-size: 0.8em; width: auto;" data-i18n-key="btn_select">
                            ${t['btn_select']}
                        </button>
                    </div>
                `;
            }).join('');
        } else {
            adminListEl.innerHTML = `<p style="text-align:center; color:#e0a800;">${t['admin_no_admins_found']}</p>`;
        }
    } catch (e) {
        adminListEl.innerHTML = `<p style="text-align:center; color:#dc3545;">${t['admin_error_fetch_admins']}</p>`;
        console.error('Error fetching admins for assignment:', e);
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Admin ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
async function assignAdminToZone(zoneId, adminUsername, zoneName) {
    if (myAdminLevel < 2) return;
    
    const t = translations[currentLang];
    
    if (!confirm(`${t['confirm_assign_admin'].replace('[ADMIN]', adminUsername).replace('[ZONE]', zoneName)}`)) {
        return;
    }

    try {
        const res = await fetch('/api/admin/assign-zone', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                zoneId: zoneId, 
                adminUsername: adminUsername,
                requestBy: myUsername 
            })
        });

        const data = await res.json();
        
        if (data.success) {
            alert(t['alert_admin_assign_success'].replace('[ADMIN]', adminUsername).replace('[ZONE]', zoneName));
            document.getElementById('admin-assign-modal').classList.add('hidden');
            openAdminZoneModal(); // Refresh the main zone list
        } else {
            alert(`‚ùå Error: ${data.error || '‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}`);
        }
    } catch (e) {
        alert(translations[currentLang].alert_server_error);
        console.error('Error assigning admin:', e);
    }
}

window.openAdminAssignModal = openAdminAssignModal;
window.assignAdminToZone = assignAdminToZone;

// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
async function openZoneRefSelectModal(zoneId) {
    currentZoneIdForRef = zoneId;
    document.getElementById('zone-ref-select-modal').classList.remove('hidden');
    
    const listDiv = document.getElementById('zone-ref-admin-list');
    listDiv.innerHTML = '<p style="text-align:center;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...</p>';

    try {
        const res = await fetch('/api/admin/admins-with-location');
        const data = await res.json();

        if (data.success && data.admins.length > 0) {
            listDiv.innerHTML = data.admins.map(admin => {
                // ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ undefined: ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ name ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ username
                const displayName = admin.name || admin.username || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
                
                const locName = admin.assignedLocation.addressName || 
                               `${admin.assignedLocation.lat}, ${admin.assignedLocation.lng}`;
                
                return `
                    <div class="user-list-item" onclick="saveZoneRefFromAdmin('${displayName}')" 
                         style="border-bottom:1px solid #eee; padding:10px; cursor:pointer;">
                        <div style="font-weight:bold;">
                            üë§ ${displayName} 
                            <span style="font-size:0.8em; background:#007bff; color:white; padding:2px 5px; border-radius:4px;">
                                L${admin.adminLevel}
                            </span>
                        </div>
                        <div style="font-size:0.85em; color:gray;">üìç ${locName}</div>
                    </div>
                `;
            }).join('');
        } else {
            listDiv.innerHTML = '<p style="text-align:center; color:red;">‡πÑ‡∏°‡πà‡∏û‡∏ö Admin ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</p>';
        }
    } catch (e) {
        console.error(e);
        listDiv.innerHTML = '<p style="text-align:center; color:red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î</p>';
    }
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Admin
async function saveZoneRefFromAdmin(targetAdmin) {
    if (!currentZoneIdForRef) return;
    
    if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á "${targetAdmin}" ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ?`)) return;

    try {
        const res = await fetch('/api/admin/set-zone-ref-from-user', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                zoneId: currentZoneIdForRef,
                targetAdmin: targetAdmin,
                requestBy: myUsername
            })
        });

        const data = await res.json();
        if (data.success) {
            alert(data.message);
            document.getElementById('zone-ref-select-modal').classList.add('hidden');
            fetchAndRenderAllZones(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏ã‡∏ô
        } else {
            alert('‚ùå Error: ' + data.error);
        }
    } catch (e) {
        alert('‚ùå Connection Error');
    }
}

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)
    function setDistanceFilter() {
    const now = Date.now();
    
    // [COOLDOWN CHECK]
    if (now - lastFilterTime < FILTER_COOLDOWN_MS) {
        const remainingSeconds = Math.ceil((FILTER_COOLDOWN_MS - (now - lastFilterTime)) / 1000);
        alert(translations[currentLang].alert_cooldown(remainingSeconds));
        return;
    }

    // [UPDATE TIMESTAMP]
    lastFilterTime = now;

    const t = translations[currentLang];
    
    // 1. ‡∏ñ‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
    // ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ Default ‡πÄ‡∏õ‡πá‡∏ô 10 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å
    const input = prompt(t.prompt_distance, "10"); 
    
    // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
    if (input === null) return;
    
    const dist = parseFloat(input);
    if (isNaN(dist) || dist <= 0) {
        alert(t.alert_invalid_num);
        return;
    }

    // --- ‚ú® [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à] ‚ú® ---
    const statusElem = document.getElementById('filter-status');
    const containerElem = document.getElementById('filter-showds');
    const kmText = currentLang === 'th' ? 'km.' : 'km';

    if (statusElem && containerElem) {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤
        containerElem.style.display = 'block'; 
        // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ‡πÄ‡∏ä‡πà‡∏ô "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ 10 ‡∏Å‡∏°..."
        statusElem.innerText = ` ${dist} ${kmText}`; 
    }
    // -----------------------------------------------------

    // 2. ‡∏Ç‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS
    if (!navigator.geolocation) {
        alert(t.error_geo_not_supported);
        return;
    }
   
    navigator.geolocation.getCurrentPosition(
        (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const tempLocation = { lat, lng, name: `Filtered Location` };
            
            userPrimaryLocation = tempLocation;
            localStorage.setItem('userPrimaryLocation', JSON.stringify(tempLocation));
            
            filterLocation = tempLocation;
            filterMaxDistance = dist;
            
            // --- ‚ú® [‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß] ‚ú® ---
            if (statusElem) {
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                containerElem.style.background = "#00bcd4"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
                statusElem.innerText = ` ${dist} ${kmText}`; // ‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà‡∏°‡∏≤
            }
            // ------------------------------------------------

            fetchAndRenderAnnouncement(tempLocation);
            loadPosts(); 
        },
        (error) => {
            console.error(error);
            alert(`${t.error_geo_failed}: ${error.message}`);
            
            // ‡∏Å‡∏£‡∏ì‡∏µ Error ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢
            if (statusElem) {
                 containerElem.style.background = "#00bcd4"; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á #000000
                 statusElem.innerText = `‚ùå Error`;
            }
        },
        { enableHighAccuracy: true }
    );
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
async function updateZoneBackground(lat, lng) {
    try {
        const res = await fetch(`/api/zone-check-bg?lat=${lat}&lng=${lng}`);
        const data = await res.json();
        
        const sidebarTitle = document.getElementById('sidebar-app-title');
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ Element ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÑ‡∏´‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        if (sidebarTitle) {
            sidebarTitle.innerText = data.zoneName || "Webboard";
        }

        const defaultBg = "linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)), url('https://sv1.img.in.th/7fB1Jg.png')";
        
        if (data.bgImage) {
            document.body.style.backgroundImage = `linear-gradient(rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.3)), url('${data.bgImage}')`;
        } else {
            document.body.style.backgroundImage = defaultBg;
        }
    } catch (e) {
        // ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á error ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏î‡∏π‡πÉ‡∏ô Console ‡∏Ç‡∏≠‡∏á Browser (F12) 
        // ‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏ü‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö
        console.error("Error updating background:", e); 
    }
}
	
        
        // --- NEW: Global Configuration ---
		const DEFAULT_CURRENCY = 'THB'; // ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á
        // ---------------------------------
		let currentCurrency = DEFAULT_CURRENCY;
		let currentLang = 'th';
		
		// Translation Data Structure (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI ‡πÅ‡∏•‡∏∞ System Message Keys)
		const translations = {
    'th': {
        'app_title': 'Webboard',
        'label_currency': '‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô:',
        'label_language': '‡∏†‡∏≤‡∏©‡∏≤:',
        'menu': '‚ò∞ Menu',
        'home': 'üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',
        'create_post': '+ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô',
        'my_active_posts': '‡∏á‡∏≤‡∏ô‡∏â‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î',
        'my_closed_posts': '‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß',
        'logout': '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
        'admin_section': '‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô',
        'admin_set_announcement': 'üì¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®',
        'admin_closed_posts': 'üóÑÔ∏è ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß',
        'admin_manage_topics': '‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠',
		'admin_manage_zones': 'üó∫Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô',
        'admin_set_cost': 'üè∑Ô∏è ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°',
        'admin_user_list': 'üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        'page_title': 'üìå ‡∏á‡∏≤‡∏ô',
        'title_create': '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô',
        'cost_fee': '‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:',
        'placeholder_title_admin': '‚≠ê ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏û‡∏¥‡πÄ‡∏®‡∏© (Admin)',
        'placeholder_content': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ...',
        'geo_btn': 'üìç ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô)',
        'label_image_max': '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5MB):',
        'post_btn': '‡πÇ‡∏û‡∏™‡∏ï‡πå',
        'cancel_btn': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        'notif_currency_change': '‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô [CURRENCY] ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
        
        'geo_not_supported': '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
        'geo_searching': '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...',
        'geo_success_name': '‚úÖ ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
        'geo_success_coord': '‚úÖ ‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
        'geo_display_name': 'üìç',
        'geo_display_coord': 'üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î:',
        'geo_error_permission': 'üö´ ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: (GPS)‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
        'geo_error_general': 'üö® ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ',
        'prompt_fee': '‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (USD):',
        
        'btn_prev': '‚¨ÖÔ∏è',
        'btn_next': '‚û°Ô∏è',
        'post_btn_prev': '‚¨ÖÔ∏è',
        'post_btn_next': '‚û°Ô∏è',
        'login_title': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö',
        'login_placeholder': '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô...',
        'login_btn': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
        'create_note': '* ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏à‡∏∞‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà Admin ‡∏Å‡∏≥‡∏´‡∏ô‡∏î',
        'modal_user_list_title': 'üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠',
        'modal_user_list_desc': '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠)',
        'search_placeholder': 'üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠...',
        'chat_with': 'üí¨ ‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö:',
        'chat_placeholder': '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...',
        'chat_send': '‡∏™‡πà‡∏á',
        
        'prompt_transfer_admin': '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô USD ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡πÉ‡∏´‡πâ',
        'prompt_deduct_admin': '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô USD ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≤‡∏Å',
        
        'admin_topic_title': '‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏ß‡πá‡∏ö‡∏ö‡∏≠‡∏£‡πå‡∏î',
        'th_topic_name': '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (ID)',
        'th_action': '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
        'header_add_topic': '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà',
        'placeholder_new_topic': '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏µ‡∏¨‡∏≤, ‡∏≠‡∏≤‡∏´‡∏≤‡∏£)',
        'btn_add_topic': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠',
        'btn_close': '‡∏õ‡∏¥‡∏î',
		
        'admin_zone_title': 'üó∫Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà',
        'admin_zone_desc': '‡πÉ‡∏™‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î Lat/Lng ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô (‡πÉ‡∏ä‡πâ Admin Level 3 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)',
        'admin_existing_zones': '‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà',
        'admin_add_new_zone': '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡∏°‡πà',
        'btn_add_zone': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô',
        'alert_invalid_zone': '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Latitude ‡πÅ‡∏•‡∏∞ Longitude ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
        'alert_zone_add_success': '‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
		'admin_no_zones_found': '‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ã‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà',
        'admin_error_fetch_zones': '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô‡πÑ‡∏î‡πâ',
        'admin_error_connection': '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ',
		'assigned_map_title': 'üó∫Ô∏è ‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
        'assigned_no_zones': '‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÇ‡∏ã‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏î‡πÜ',
		
        'post_not_found': '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ',
        'closed_or_finished': '‚õî ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô/‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
        'room_occupied': '‚ö†Ô∏è ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
        
        'prompt_confirm_ban': '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞ ‡πÅ‡∏ö‡∏ô (‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå) ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: [USERNAME] ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'prompt_confirm_unban': '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞ ‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: [USERNAME] ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'notif_user_banned': '‚ùå ‡πÅ‡∏ö‡∏ô [USERNAME] ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
        'notif_user_unbanned': '‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô [USERNAME] ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
        
        'tx_paid': '‡∏à‡πà‡∏≤‡∏¢',
        'tx_received': '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö',
        'tx_from': '‡∏à‡∏≤‡∏Å',
        'tx_to': '‡πÉ‡∏´‡πâ',
        'tx_post_fee_prefix': '‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ',
        'tx_handover_success': '‚úÖ ‡∏õ‡∏¥‡∏î‡∏î‡∏µ‡∏•/‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        
        'admin_tx_title': '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ',
        'admin_tx_desc': '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)',
        'admin_tx_revenue': 'üí∏ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°)',
        'admin_tx_deduct': 'üß≤ ‡∏î‡∏∂‡∏á‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ñ‡∏∑‡∏ô',
        'admin_tx_transfer_out': '‚û°Ô∏è ‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å',
        'member_tx_title': '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° ',
        'member_tx_desc': '‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)',

        'SYS_FEE': (data) => `üí∏ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î "${data.topicName}" ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å ${data.cost} USD`,
        'SYS_TRANSFER': (data) => `üí∞ Admin ‡πÑ‡∏î‡πâ‡πÇ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${data.amount} USD`,
        'SYS_DEDUCT': (data) => `üí∏ Admin ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á USD ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${data.amount} USD`,
        'SYS_NEW_COMMENT': (data) => `üí¨ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ "${data.postTitle}"`,
        'tx_detail_create_post': '‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ: [TITLE]',
        'tx_detail_admin_give': '‡πÇ‡∏≠‡∏ô‡πÉ‡∏´‡πâ [USER]',
        'tx_detail_admin_deduct': '‡∏î‡∏∂‡∏á‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≤‡∏Å [USER]',
        'tx_detail_handover': '‡∏õ‡∏¥‡∏î‡∏î‡∏µ‡∏•/‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô: [TITLE]',
        'admin_warn_empty_topic': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà',
        'admin_confirm_delete_topic': '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ "[NAME]"?',
        'admin_success_add_topic': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        'admin_success_delete_topic': '‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        'admin_error_topic': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ',
        'confirm_delete_post': '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ô‡∏µ‡πâ?',

        'btn_checkin': 'üìç ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á',
        'status_all': '(‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)',
        'prompt_distance': '‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ (‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£):',
        'alert_invalid_num': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
        'status_locating': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...',
        //'status_dist_prefix': '(‡∏£‡∏∞‡∏¢‡∏∞',
        'msg_no_post_range': '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞',
        'btn_show_all': '‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        'error_geo_not_supported': 'Browser ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á',
        'error_geo_failed': '‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß',
		'admin_success_set_cost': '‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
        'admin_error_set_cost': '‚ùå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
		
		'admin_assigned_to': '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
        'btn_assign_admin': '‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•',
        'modal_assign_title': 'üë®‚Äçüíº ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô',
        'btn_select': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å',
        'admin_no_admins_found': '‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Admin Level 1 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ',
        'admin_error_fetch_admins': '‚ùå ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Admin ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        'confirm_assign_admin': '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡πâ [ADMIN] ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô [ZONE] ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'alert_admin_assign_success': '‚úÖ ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ [ADMIN] ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô [ZONE] ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
		
		'admin_set_cost_title': 'üè∑Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ',
        'label_system_fee': '‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏Ç‡πâ‡∏≤ Admin L3):',
        'label_admin_fee': '‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (‡πÄ‡∏Ç‡πâ‡∏≤ Admin L1/L2):',
        'total_fee_display': '‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:',
        'btn_save': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        'alert_invalid_fee': '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö',
		'announcement_prefix': 'üì¢',
		'modal_announcement_desc': '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ö‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ',
		'label_announcement_text': '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®:',
		'placeholder_announcement_input': '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®)',
		'label_zone_name': '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á):',
		'placeholder_zone_name': '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏ã‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏°‡∏∑‡∏≠‡∏á A',
		'alert_invalid_zone_name': '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô',
		
		'inbox_title': "üí¨ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß",
        'inbox_desc_recent': "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
        'inbox_no_history': "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤",
        'admin_label': "(‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•)",
        'admin_searching': "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...",
        'admin_recommended_label': "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì",
        'admin_start_chat': "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ä‡∏ó‡πÄ‡∏•‡∏¢!",
		'msg_user_not_found': '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ä‡∏∑‡πà‡∏≠ "[NAME]"',
        'msg_no_members': '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
        'label_banned': '(‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö)',
		'click_user_detail': '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
        'btn_merchant_mode': 'üè™ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤',
        'btn_admin_panel': '‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô',
		'placeholder_username': '‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡∏î‡∏µ...',
        'placeholder_password': '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô...',
        'btn_login': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
        'btn_register': '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
        'or_google': '‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Google',
		'modal_set_pw_title': 'üîí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
        'modal_set_pw_desc': '‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
        'placeholder_new_pw': '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà...',
        'btn_confirm_pw': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
        
        'modal_google_title': 'üë§ ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
        'modal_google_desc': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Google! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥)',
        'placeholder_google_name': '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£...',
        'btn_start_usage': '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
		'alert_no_permission': '‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ',
		'alert_assign_fail': '‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        'alert_server_error': '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå',
		'alert_cooldown': (s) => `‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠ ${s} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥`,
		'prompt_set_primary_location': '‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà',
        'alert_location_denied': '‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á',
		'alert_password_short': (min) => `‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${min} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`,
		'alert_password_set_success': '‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
		'alert_enter_username': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
		'alert_fill_all': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
        'alert_username_short': (min) => `‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${min} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£`,
        'alert_register_success': '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...',
		'alert_login_empty': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
        'alert_save_success': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
		'btn_topup': '‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô - ‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
		'no_active_posts': '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà',
        'error_fetch_posts': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ',
		'no_closed_posts': '‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î',
		'alert_empty_content': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
    },
    'en': {
        'app_title': 'Webboard',
        'label_currency': 'Currency:',
        'label_language': 'Language:',
        'menu': '‚ò∞ Menu',
        'home': 'üè† Home',
        'create_post': '+ Create Post',
        'my_active_posts': 'My Active Posts',
        'my_closed_posts': 'My Closed Posts',
        'logout': 'Logout',
        'admin_section': 'Admin Section',
        'admin_set_announcement': 'üì¢ Set Announcement',
        'admin_closed_posts': 'üóÑÔ∏è Closed Posts',
        'admin_manage_topics': '‚öôÔ∏è Manage Topics',
		'admin_manage_zones': 'üó∫Ô∏è Manage Zones',
        'admin_set_cost': 'üè∑Ô∏è Set Fee',
        'admin_user_list': 'üë• All Members List',
		'btn_add_topic': 'Add Topic',
        'btn_close': 'Close',
		
        'admin_zone_title': 'üó∫Ô∏è Manage Coverage Zones',
        'admin_zone_desc': 'Enter Lat/Lng coordinates to add a zone center (Admin Level 3 only).',
        'admin_existing_zones': 'Existing Zones',
        'admin_add_new_zone': '+ Add New Zone',
        'btn_add_zone': 'Add Zone',
        'alert_invalid_zone': '‚ùå Please enter valid numerical values for Latitude and Longitude.', 
        'alert_zone_add_success': '‚úÖ Zone added successfully!',
        'admin_no_zones_found': '‚ö†Ô∏è No coverage zones set yet',
        'admin_error_fetch_zones': '‚ùå Failed to fetch zone list',
        'admin_error_connection': '‚ùå Connection error',
		'assigned_map_title': 'üó∫Ô∏è Your Assigned Zones',
        'assigned_no_zones': '‚ö†Ô∏è You are not assigned to any zones yet.',
		
        'page_title': 'üìå Job',
        'title_create': 'Create New Post',
        'cost_fee': 'Fee:',
        'placeholder_title_admin': '‚≠ê Pinned Post Title (Admin)',
        'placeholder_content': 'Post details...',
        'geo_btn': 'üìç Get Current Location (Check In)',
        'label_image_max': 'Image (Max 5MB):',
        'post_btn': 'Post',
        'cancel_btn': 'Cancel',
        'notif_currency_change': '‚úÖ Currency changed to [CURRENCY]',
        
        'geo_not_supported': 'Your browser does not support geolocation.',
        'geo_searching': '‚è≥ Searching location...',
        'geo_success_name': '‚úÖ Location found',
        'geo_success_coord': '‚úÖ Coordinates retrieved',
        'geo_display_name': 'üìç',
        'geo_display_coord': 'üìç Coordinates:',
        'geo_error_permission': 'üö´ Permission denied: (GPS)Please allow access to location in browser settings.',
        'geo_error_general': 'üö® Cannot retrieve location',
        'prompt_fee': 'Fee ():',

        'btn_prev': '‚¨ÖÔ∏è',
        'btn_next': '‚û°Ô∏è',
        'post_btn_prev': '‚¨ÖÔ∏è',
        'post_btn_next': '‚û°Ô∏è',
        'login_title': 'Welcome',
        'login_placeholder': 'Nickname...',
        'login_btn': 'Login',
        'create_note': '* Creating a post incurs a fee set by Admin.',
        'modal_user_list_title': 'üë• Members',
        'modal_user_list_desc': 'List of all members in the system (and remaining balance)',
        'search_placeholder': 'üîç Search user...',
        'chat_with': 'üí¨ Chat with:',
        'chat_placeholder': 'Type a message...',
        'chat_send': 'Send',
        
        'prompt_transfer_admin': 'Enter USD amount to transfer to',
        'prompt_deduct_admin': 'Enter USD amount to deduct from',

        'admin_topic_title': '‚öôÔ∏è Manage Topics',
        'th_topic_name': 'Topic Name (ID)',
        'th_action': 'Action',
        'header_add_topic': '+ Add New Topic',
        'placeholder_new_topic': 'New Topic Name...',
        'btn_add_topic': 'Add Topic',
        'btn_close': 'Close',
        
        'post_not_found': 'Post not found',
        'closed_or_finished': '‚õî This post is closed/finished.',
        'room_occupied': '‚ö†Ô∏è This post is currently occupied. Please wait...',
        
        'prompt_confirm_ban': 'Are you sure you want to BAN (suspend) member: [USERNAME]?',
        'prompt_confirm_unban': 'Are you sure you want to UNBAN member: [USERNAME]?',
        'notif_user_banned': '‚ùå [USERNAME] has been banned',
        'notif_user_unbanned': '‚úÖ [USERNAME] has been unbanned',
        
        'tx_paid': 'Paid',
        'tx_received': 'Received',
        'tx_from': 'From',
        'tx_to': 'To',
        'tx_post_fee_prefix': 'Post Creation Fee',
        'tx_handover_success': '‚úÖ Deal Closed/Handover Success',
        
        'admin_tx_title': 'History of All USD Transactions',
        'admin_tx_desc': 'All income and transfers (newest first)',
        'admin_tx_revenue': 'üí∏ Revenue (Post Fee)',
        'admin_tx_deduct': 'üß≤ Coins Deducted',
        'admin_tx_transfer_out': '‚û°Ô∏è Coins Transferred Out',
        'member_tx_title': 'USD Transaction History',
        'member_tx_desc': 'Your complete coin history (newest first)',

        'SYS_FEE': (data) => `üí∏ You created a post in category "${data.topicName}" and were charged ${data.cost} USD`,
        'SYS_TRANSFER': (data) => `üí∞ Admin transferred ${data.amount} USD to you`,
        'SYS_DEDUCT': (data) => `üí∏ Admin deducted ${data.amount} USD from your account`,
        'SYS_NEW_COMMENT': (data) => `üí¨ New comment in post "${data.postTitle}"`,
        'tx_detail_create_post': 'Post Creation Fee: [TITLE]',
        'tx_detail_admin_give': 'Transfer to [USER]',
        'tx_detail_admin_deduct': 'Deduct from [USER]',
        'tx_detail_handover': 'Job Handover: [TITLE]',
        'admin_warn_empty_topic': 'Please enter a new topic name.',
        'admin_confirm_delete_topic': 'Are you sure you want to delete the topic "[NAME]"?',
        'admin_success_add_topic': 'Topic added successfully.',
        'admin_success_delete_topic': 'Topic deleted successfully.',
        'admin_error_topic': 'Error occurred: ',
        'confirm_delete_post': 'Are you sure you want to delete this post?',

        // ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô
        'btn_checkin': 'üìç Set Distance Filter',
        'status_all': '(Show All)',
        'prompt_distance': 'Enter distance radius (km):',
        'alert_invalid_num': 'Please enter a valid number.',
        'status_locating': 'Locating...',
        //'status_dist_prefix': '(Radius',
        'msg_no_post_range': '‚ùå No posts found within',
        'btn_show_all': 'Show All',
        'error_geo_not_supported': 'Browser does not support Geolocation',
        'error_geo_failed': 'Location failed',
		'admin_success_set_cost': '‚úÖ Fee set successfully!', 
        'admin_error_set_cost': '‚ùå Failed to set fee',
		
		'admin_assigned_to': 'Assigned Admin',
        'btn_assign_admin': 'Assign Admin',
        'modal_assign_title': 'üë®‚Äçüíº Select Zone Admin',
        'btn_select': 'Select',
        'admin_no_admins_found': '‚ö†Ô∏è No Admins (Level 1+) found',
        'admin_error_fetch_admins': '‚ùå Failed to fetch Admin list',
        'confirm_assign_admin': 'Are you sure you want to assign [ADMIN] to Zone [ZONE]?',
        'alert_admin_assign_success': '‚úÖ Assigned [ADMIN] to Zone [ZONE] successfully!',
		
		'admin_set_cost_title': 'üè∑Ô∏è Set Post Fees',
        'label_system_fee': 'System Fee (to Admin L3):',
        'label_admin_fee': 'Admin Fee (to Admin L1/L2):',
        'total_fee_display': 'Total Fee:',
        'btn_save': 'Save',
        'alert_invalid_fee': '‚ùå Please enter valid non-negative fee values.',
		'announcement_prefix': 'üì¢',
		'modal_announcement_desc': 'This announcement will be displayed as a marquee above the post list.',
		'label_announcement_text': 'Announcement Text:',
		'placeholder_announcement_input': 'Message to announce (leave blank to delete)',
		'label_zone_name': 'Zone Name (for owner):',
		'placeholder_zone_name': 'Zone name, e.g., City A',
		'alert_invalid_zone_name': '‚ùå Please enter a zone name.',
		
		'inbox_title': "üí¨ Private Chat Inbox",
        'inbox_desc_recent': "Recent contacts list",
        'inbox_no_history': "No conversation history yet",
        'admin_label': "(Admin)",
        'admin_searching': "‚è≥ Searching for your zone administrator...",
        'admin_recommended_label': "Recommended administrator near you",
        'admin_start_chat': "Start Chat Now!",
		'msg_user_not_found': '‚ùå User "[NAME]" not found',
        'msg_no_members': 'No members found',
        'label_banned': '(BANNED)',
		'click_user_detail': 'Click to view member details',
        'btn_merchant_mode': 'üè™ For Merchant',
        'btn_admin_panel': 'Admin Panel',
		'placeholder_username': 'Username...',
        'placeholder_password': 'Password...',
        'btn_login': 'Login',
        'btn_register': 'Register',
        'or_google': 'or use Google Account',
		'modal_set_pw_title': 'üîí Set Your Password',
        'modal_set_pw_desc': 'Since this is your first time using a password, please set one for security.',
        'placeholder_new_pw': 'Enter new password...',
        'btn_confirm_pw': 'Confirm Password',
        
        'modal_google_title': 'üë§ Set Your Username',
        'modal_google_desc': 'Welcome from Google! Please choose a nickname (must be unique).',
        'placeholder_google_name': 'Desired nickname...',
        'btn_start_usage': 'Start Now',
		'alert_no_permission': '‚ùå You do not have permission to access this section',
		'alert_assign_fail': 'Assignment failed',
        'alert_server_error': '‚ùå Server connection error',
		'alert_cooldown': (s) => `‚ùå Please wait ${s} seconds before clicking again`,
		'prompt_set_primary_location': 'First time login? Please set your current location to view local information.',
        'alert_location_denied': 'Location sharing declined. Showing global information.',
		'alert_password_short': (min) => `Password must be at least ${min} characters long`,
		'alert_password_set_success': 'Password set successfully! Please log in again.',
		'alert_enter_username': 'Please enter a username',
		'alert_fill_all': 'Please enter both username and password to register',
        'alert_username_short': (min) => `Username must be at least ${min} characters long`,
        'alert_register_success': 'Registration successful! Logging in...',
		'alert_login_empty': 'Please enter both username and password',
        'alert_save_success': 'Information saved successfully!',
		'btn_topup': 'Deposit - Withdraw',
		'no_active_posts': 'You currently have no active posts.',
        'error_fetch_posts': 'Error fetching post list',
		'no_closed_posts': 'You have no closed posts yet.',
		'alert_empty_content': 'Please enter the details',
    },'pt': {//==============================================PT
        'app_title': 'Webboard',
        'label_currency': 'Moeda:',
        'label_language': 'Idioma:',
        'menu': '‚ò∞ Menu',
        'home': 'üè† In√≠cio',
        'create_post': '+ Criar Trabalho',
        'my_active_posts': 'Meus Trabalhos Ativos',
        'my_closed_posts': 'Meus Trabalhos Encerrados',
        'logout': 'Sair',
        'admin_section': 'Se√ß√£o do Administrador',
        'admin_set_announcement': 'üì¢ Definir An√∫ncio',
        'admin_closed_posts': 'üóÑÔ∏è Postagens Encerradas',
        'admin_manage_topics': '‚öôÔ∏è Gerenciar T√≥picos',
        'admin_manage_zones': 'üó∫Ô∏è Gerenciar Zonas',
        'admin_set_cost': 'üè∑Ô∏è Definir Taxas',
        'admin_user_list': 'üë• Lista de Membros',
        'btn_add_topic': 'Adicionar T√≥pico',
        'btn_close': 'Fechar',
        
        'admin_zone_title': 'üó∫Ô∏è Gerenciar Zonas de Cobertura',
        'admin_zone_desc': 'Insira as coordenadas Lat/Lng para adicionar um centro de zona (Apenas Admin N√≠vel 3).',
        'admin_existing_zones': 'Zonas Existentes',
        'admin_add_new_zone': '+ Adicionar Nova Zona',
        'btn_add_zone': 'Adicionar Zona',
        'alert_invalid_zone': '‚ùå Por favor, insira valores num√©ricos v√°lidos para Latitude e Longitude.', 
        'alert_zone_add_success': '‚úÖ Zona adicionada com sucesso!',
        'admin_no_zones_found': '‚ö†Ô∏è Nenhuma zona de cobertura definida ainda',
        'admin_error_fetch_zones': '‚ùå Falha ao buscar lista de zonas',
        'admin_error_connection': '‚ùå Erro de conex√£o',
        'assigned_map_title': 'üó∫Ô∏è Suas Zonas Atribu√≠das',
        'assigned_no_zones': '‚ö†Ô∏è Voc√™ ainda n√£o tem zonas atribu√≠das.',
        
        'page_title': 'üìå Trabalho',
        'title_create': 'Criar Nova Postagem',
        'cost_fee': 'Taxa:',
        'placeholder_title_admin': '‚≠ê T√≠tulo Especial (Admin)',
        'placeholder_content': 'Detalhes da postagem...',
        'geo_btn': 'üìç Obter Localiza√ß√£o Atual (Check In)',
        'label_image_max': 'Imagem (M√°x 5MB):',
        'post_btn': 'Postar',
        'cancel_btn': 'Cancelar',
        'notif_currency_change': '‚úÖ Moeda alterada para [CURRENCY]',
        
        'geo_not_supported': 'Seu navegador n√£o suporta geolocaliza√ß√£o.',
        'geo_searching': '‚è≥ Buscando localiza√ß√£o...',
        'geo_success_name': '‚úÖ Localiza√ß√£o encontrada',
        'geo_success_coord': '‚úÖ Coordenadas recuperadas',
        'geo_display_name': 'üìç',
        'geo_display_coord': 'üìç Coordenadas:',
        'geo_error_permission': 'üö´ Permiss√£o negada: Por favor, permita o acesso √† localiza√ß√£o nas configura√ß√µes do navegador.',
        'geo_error_general': 'üö® N√£o foi poss√≠vel recuperar a localiza√ß√£o',
        'prompt_fee': 'Taxa (USD):',

        'btn_prev': '‚¨ÖÔ∏è',
        'btn_next': '‚û°Ô∏è',
        'post_btn_prev': '‚¨ÖÔ∏è',
        'post_btn_next': '‚û°Ô∏è',
        'login_title': 'Bem-vindo',
        'login_placeholder': 'Apelido...',
        'login_btn': 'Entrar',
        'create_note': '* A cria√ß√£o de uma postagem incorre em uma taxa definida pelo Admin.',
        'modal_user_list_title': 'üë• Membros',
        'modal_user_list_desc': 'Lista de todos os membros no sistema (e saldo restante)',
        'search_placeholder': 'üîç Buscar usu√°rio...',
        'chat_with': 'üí¨ Conversar com:',
        'chat_placeholder': 'Digite uma mensagem...',
        'chat_send': 'Enviar',
        
        'prompt_transfer_admin': 'Digite a quantidade em  para transferir para',
        'prompt_deduct_admin': 'Digite a quantidade em  para deduzir de',

        'admin_topic_title': '‚öôÔ∏è Gerenciar T√≥picos',
        'th_topic_name': 'Nome do T√≥pico (ID)',
        'th_action': 'A√ß√£o',
        'header_add_topic': '+ Adicionar Novo T√≥pico',
        'placeholder_new_topic': 'Nome do novo t√≥pico...',
        
        'post_not_found': 'Postagem n√£o encontrada',
        'closed_or_finished': '‚õî Esta postagem est√° encerrada/conclu√≠da.',
        'room_occupied': '‚ö†Ô∏è Esta postagem est√° sendo visualizada. Por favor, aguarde...',
        
        'prompt_confirm_ban': 'Tem certeza que deseja BANIR o membro: [USERNAME]?',
        'prompt_confirm_unban': 'Tem certeza que deseja DESBANIR o membro: [USERNAME]?',
        'notif_user_banned': '‚ùå [USERNAME] foi banido',
        'notif_user_unbanned': '‚úÖ [USERNAME] foi desbanido',
        
        'tx_paid': 'Pago',
        'tx_received': 'Recebido',
        'tx_from': 'De',
        'tx_to': 'Para',
        'tx_post_fee_prefix': 'Taxa de Cria√ß√£o de Postagem',
        'tx_handover_success': '‚úÖ Acordo Encerrado/Entrega Conclu√≠da',
        
        'admin_tx_title': 'Hist√≥rico de Transa√ß√µes ',
        'admin_tx_desc': 'Todas as receitas e transfer√™ncias (mais recentes primeiro)',
        'admin_tx_revenue': 'üí∏ Receita (Taxa de Postagem)',
        'admin_tx_deduct': 'üß≤ Moedas Deduzidas',
        'admin_tx_transfer_out': '‚û°Ô∏è Moedas Transferidas',
        'member_tx_title': 'Hist√≥rico de Transa√ß√µes ',
        'member_tx_desc': 'Seu hist√≥rico completo de moedas (mais recentes primeiro)',

        'SYS_FEE': (data) => `üí∏ Voc√™ criou uma postagem na categoria "${data.topicName}" e foi cobrado em ${data.cost} USD`,
        'SYS_TRANSFER': (data) => `üí∞ O Admin transferiu ${data.amount} USD para voc√™`,
        'SYS_DEDUCT': (data) => `üí∏ O Admin deduziu ${data.amount} USD da sua conta`,
        'SYS_NEW_COMMENT': (data) => `üí¨ Novo coment√°rio na postagem "${data.postTitle}"`,
        'tx_detail_create_post': 'Taxa de Cria√ß√£o: [TITLE]',
        'tx_detail_admin_give': 'Transferir para [USER]',
        'tx_detail_admin_deduct': 'Deduzir de [USER]',
        'tx_detail_handover': 'Entrega de Trabalho: [TITLE]',
        'admin_warn_empty_topic': 'Por favor, insira o nome do t√≥pico.',
        'admin_confirm_delete_topic': 'Tem certeza que deseja excluir o t√≥pico "[NAME]"?',
        'admin_success_add_topic': 'T√≥pico adicionado com sucesso.',
        'admin_success_delete_topic': 'T√≥pico exclu√≠do com sucesso.',
        'admin_error_topic': 'Ocorreu um erro: ',
        'confirm_delete_post': 'Tem certeza que deseja excluir esta postagem?',

        'btn_checkin': 'üìç Definir Dist√¢ncia',
        'status_all': '(Mostrar Tudo)',
        'prompt_distance': 'Digite o raio de dist√¢ncia (km):',
        'alert_invalid_num': 'Por favor, insira um n√∫mero v√°lido.',
        'status_locating': 'Localizando...',
        'msg_no_post_range': '‚ùå Nenhuma postagem encontrada dentro de',
        'btn_show_all': 'Mostrar Tudo',
        'error_geo_not_supported': 'Navegador n√£o suporta Geolocaliza√ß√£o',
        'error_geo_failed': 'Falha na localiza√ß√£o',
        'admin_success_set_cost': '‚úÖ Taxa definida com sucesso!', 
        'admin_error_set_cost': '‚ùå Falha ao definir taxa',
        
        'admin_assigned_to': 'Admin Respons√°vel',
        'btn_assign_admin': 'Atribuir Admin',
        'modal_assign_title': 'üë®‚Äçüíº Selecionar Admin da Zona',
        'btn_select': 'Selecionar',
        'admin_no_admins_found': '‚ö†Ô∏è Nenhum Admin (N√≠vel 1+) encontrado',
        'admin_error_fetch_admins': '‚ùå Falha ao buscar lista de Admins',
        'confirm_assign_admin': 'Deseja atribuir [ADMIN] √† Zona [ZONE]?',
        'alert_admin_assign_success': '‚úÖ [ADMIN] atribu√≠do √† Zona [ZONE] com sucesso!',
        
        'admin_set_cost_title': 'üè∑Ô∏è Definir Taxas de Postagem',
        'label_system_fee': 'Taxa do Sistema (para Admin N3):',
        'label_admin_fee': 'Taxa do Administrador (para Admin N1/N2):',
        'total_fee_display': 'Taxa Total:',
        'btn_save': 'Salvar',
        'alert_invalid_fee': '‚ùå Por favor, insira valores de taxa v√°lidos.',
        'announcement_prefix': 'üì¢',
        'modal_announcement_desc': 'Este an√∫ncio ser√° exibido acima da lista de postagens.',
        'label_announcement_text': 'Texto do An√∫ncio:',
        'placeholder_announcement_input': 'Mensagem para anunciar (deixe em branco para remover)',
        'label_zone_name': 'Nome da Zona (para o propriet√°rio):',
        'placeholder_zone_name': 'Ex: Cidade A',
        'alert_invalid_zone_name': '‚ùå Por favor, insira um nome para a zona.',
        
        'inbox_title': "üí¨ Mensagens Privadas",
        'inbox_desc_recent': "Contatos recentes",
        'inbox_no_history': "Nenhum hist√≥rico de conversa",
        'admin_label': "(Admin)",
        'admin_searching': "‚è≥ Procurando o administrador da sua zona...",
        'admin_recommended_label': "Administrador recomendado perto de voc√™",
        'admin_start_chat': "Come√ßar Chat Agora!",
        'msg_user_not_found': '‚ùå Usu√°rio "[NAME]" n√£o encontrado',
        'msg_no_members': 'Nenhum membro encontrado',
        'label_banned': '(BANIDO)',
		'click_user_detail': 'Clique para ver detalhes do membro',
        'btn_merchant_mode': 'üè™ Para Comerciante',
        'btn_admin_panel': 'Painel do Administrador',
		'placeholder_username': 'Usu√°rio...',
        'placeholder_password': 'Senha...',
        'btn_login': 'Entrar',
        'btn_register': 'Registrar',
        'or_google': 'ou use a conta do Google',
		'modal_set_pw_title': 'üîí Defina sua Senha',
        'modal_set_pw_desc': 'Como √© a sua primeira vez usando uma senha, defina uma para sua seguran√ßa.',
        'placeholder_new_pw': 'Definir nova senha...',
        'btn_confirm_pw': 'Confirmar Senha',
        
        'modal_google_title': 'üë§ Defina seu Nome de Usu√°rio',
        'modal_google_desc': 'Bem-vindo pelo Google! Por favor, escolha um apelido (deve ser √∫nico).',
        'placeholder_google_name': 'Apelido desejado...',
        'btn_start_usage': 'Come√ßar',
		'alert_no_permission': '‚ùå Voc√™ n√£o tem permiss√£o para acessar esta se√ß√£o',
		'alert_assign_fail': 'Falha na atribui√ß√£o',
        'alert_server_error': '‚ùå Erro de conex√£o com o servidor',
		'alert_cooldown': (s) => `‚ùå Por favor, aguarde ${s} segundos antes de clicar novamente`,
		'prompt_set_primary_location': 'Primeiro acesso? Por favor, defina sua localiza√ß√£o atual para ver informa√ß√µes locais.',
        'alert_location_denied': 'Compartilhamento de localiza√ß√£o recusado. Mostrando informa√ß√µes globais.',
		'alert_password_short': (min) => `A senha deve ter pelo menos ${min} caracteres`,
		'alert_password_set_success': 'Senha definida com sucesso! Por favor, fa√ßa login novamente.',
		'alert_enter_username': 'Por favor, insira um nome de usu√°rio',
		'alert_fill_all': 'Por favor, insira o usu√°rio e a senha para se registrar',
        'alert_username_short': (min) => `O apelido deve ter pelo menos ${min} caracteres`,
        'alert_register_success': 'Registro bem-sucedido! Entrando no sistema...',
		'alert_login_empty': 'Por favor, insira o usu√°rio e a senha',
        'alert_save_success': 'Informa√ß√µes salvas com sucesso!',
		'btn_topup': 'Depositar - Sacar',
		'no_active_posts': 'Voc√™ n√£o tem postagens ativas no momento.',
        'error_fetch_posts': 'Erro ao buscar a lista de postagens',
		'no_closed_posts': 'Voc√™ ainda n√£o tem postagens encerradas.',
		'alert_empty_content': 'Por favor, insira os detalhes',
    }
};

		// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô startApp)
	function setLanguage(lang) {
        if (!translations[lang]) return;
        currentLang = lang;
        localStorage.setItem('preferredLanguage', lang);
		let msg = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤...";
		if (lang === 'en') msg = "Changing language...";
		if (lang === 'pt') msg = "Alterando o idioma...";
        
        // 1. ‡πÅ‡∏õ‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ data-i18n-key
        document.querySelectorAll('[data-i18n-key]').forEach(element => {
            const key = element.getAttribute('data-i18n-key');
            const translatedText = translations[lang][key];

            if (translatedText) {
                if (element.placeholder) {
                    element.placeholder = translatedText;
                } else {
                    // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ icon/emoji ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°
                    const textOnly = element.innerText.replace(/(<i[^>]*><\/i>|[\u2600-\u26FF\u2700-\u27BF\u1F600-\u1F64F\u1F300-\u1F5FF\u2B06-\u2B07\u2B50\u23F3\u231B\u23E9-\u23EC\u23F0\u23F8-\u23FA\u23CF\u21AA\u21A9\u2190-\u21FF\u25AA-\u25FE\u2B1B\u2B1C\u2B55\u23E3\u2705\u274C\u274E\u2714\u2716\u2728\u2733\u2734\u2753\u2754\u2755\u2795-\u2797\u27A1\u27B0\u27BF\u27C0-\u27FF\u1F000-\u1F6FF\u1F900-\u1F9FF]+)/g, '').trim();
                    const icon = element.innerHTML.substring(0, element.innerHTML.indexOf(textOnly));
                    
                    if(icon.trim() !== '') {
                        element.innerHTML = `${icon} ${translatedText}`;
                    } else {
                        element.innerHTML = translatedText;
                    }
                }
            }
        });
        
        document.getElementById('post-prev-btn').innerText = translations[currentLang]['post_btn_prev'];
		document.getElementById('post-next-btn').innerText = translations[currentLang]['post_btn_next'];
		const homeBtn = document.getElementById('home-btn');
if (homeBtn) {
    homeBtn.style.backgroundColor = '#0056b3'; // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°
    homeBtn.style.color = 'white'; // ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß
    homeBtn.style.fontWeight = 'bold'; // ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤
    homeBtn.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.2)'; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤
}

        // 3. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        updateUserInfo(); 
        renderPostList();

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Modal ‡πÑ‡∏´‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏ô
        const modal = document.getElementById('user-list-modal');
        if (!modal.classList.contains('hidden')) {
            const listType = document.getElementById('pagination-controls').dataset.type;
            
            if (listType === 'adminTx') {
                 // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏ß‡∏° (Admin)" ‡∏≠‡∏¢‡∏π‡πà
                 openTransactionModal(adminTxPage); 
            } else if (listType === 'memberTx') {
                 // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß" ‡∏≠‡∏¢‡∏π‡πà
                 openMemberLedger(memberTxPage);
            }
        }
    }
        
        let currentCost = 0;
        let currentChatPartner = ""; 
        let unreadUsers = new Set();
        let currentView = 'home'; 
        let hasNewTransaction = false; 
		let currentRating = 5.0; 
        
        let currentLocationData = null;
        let postStatusMap = {}; 
		let currentAnnouncementText = '';

        // Pagination States
        let adminTxPage = 1;
        let memberTxPage = 1;
        let inboxPage = 1;
        
        let currentPostPage = 1;
        const POST_LIMIT = 20; 
        const PAGE_LIMIT = 20;

        const notificationSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3');
        const ADMIN_USERNAME = 'Admin'; 

    window.onload = () => {
    
    // Cooldown Check for Rapid Refresh
    const lastRefreshTime = parseInt(localStorage.getItem('lastRefreshTime') || '0');
    const now = Date.now();
    
    // ‡∏´‡∏≤‡∏Å‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ REFRESH_COOLDOWN_MS)
    if (now - lastRefreshTime < REFRESH_COOLDOWN_MS) {
        const remainingSeconds = Math.ceil((REFRESH_COOLDOWN_MS - (now - lastRefreshTime)) / 1000);
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î App
        document.body.innerHTML = `
            <div style="text-align:center; padding: 50px; color:red; font-family:'Kanit', sans-serif;">
                <h1>‚ùå Refreshing too fast <b>${remainingSeconds} sec</b></h1>
            </div>
        `;
        
        // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö Cooldown
        setTimeout(() => {
            window.location.reload();
        }, remainingSeconds * 1000 + 500); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
        return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
    }
    
    // ‡∏´‡∏≤‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    localStorage.setItem('lastRefreshTime', now);


    const savedName = localStorage.getItem('myUsername');
    // ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    const savedLang = localStorage.getItem('preferredLanguage') || 'th';
    currentLang = savedLang;
    
    const langSelect = document.getElementById('lang-select');
    if (langSelect) {
        langSelect.value = savedLang;
        setLanguage(savedLang); // ‡πÅ‡∏õ‡∏• UI ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    } else {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ Selector ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        setLanguage(currentLang);
    }
    
    if (savedName) startApp(savedName);
    else document.getElementById('login-modal').classList.remove('hidden');
};

	async function checkPrimaryLocationAndLoad(callback) {
    // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å LocalStorage
    const savedLocation = localStorage.getItem('userPrimaryLocation');
    if (savedLocation) {
        userPrimaryLocation = JSON.parse(savedLocation);
    }
    const statusElem = document.getElementById('filter-status');
    const t = translations[currentLang]; // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ t ‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô

    // 2. ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏•‡∏¢
    if (userPrimaryLocation || myUsername === 'Admin') {
        // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏≤‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏•‡∏±‡∏Å
        fetchAndRenderAnnouncement(userPrimaryLocation);
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô filterLocation ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
        if (userPrimaryLocation) {
			updateZoneBackground(userPrimaryLocation.lat, userPrimaryLocation.lng);
            filterLocation = userPrimaryLocation;
            const DEFAULT_DISTANCE_KM = 10;
            filterMaxDistance = DEFAULT_DISTANCE_KM;
            
            const kmText = currentLang === 'th' ? 'km.)' : 'km)'; 
            //const statusPrefix = t['status_dist_prefix'] || '';

            if (statusElem) {
                //statusElem.innerText = ` ${t['geo_display_name'] || '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å'} ${statusPrefix} ${DEFAULT_DISTANCE_KM} ${kmText}`;
                statusElem.style.color = "#212121"; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á/‡∏™‡πâ‡∏° ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà
            }
        } else {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡∏´‡∏£‡∏∑‡∏≠ userPrimaryLocation ‡∏´‡∏≤‡∏¢)
            filterLocation = null;
            filterMaxDistance = null;
            if (statusElem) {
                statusElem.innerText = t.status_all;
                statusElem.style.color = "#007bff";
            }
        }
        
        loadPosts();
        if (callback) callback();
        return; // ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠ 2
    }

    // 3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å) ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Admin -> ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô
    // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á confirm
    setTimeout(() => {
        const confirmMsg = translations[currentLang].prompt_set_primary_location;
		const deniedMsg = translations[currentLang].alert_location_denied;

		if (confirm(confirmMsg)) {
		// ‡πÉ‡∏ä‡πâ getLocation (‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ callback) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å loadPosts ‡πÉ‡∏´‡πâ
			getLocation(true); // true = isPrimaryCheckin
		} else {
		// ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î)
		alert(deniedMsg);
    
		if (typeof fetchAndRenderAnnouncement === 'function') {
        fetchAndRenderAnnouncement(null);
		}
    
    loadPosts();
    if (callback) callback();
}
    }, 500);
}

document.getElementById('private-chat-input')?.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') sendPrivateMessage();
});


// --- 1. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ---
async function submitNewPassword() {
    const password = document.getElementById('new-password-input').value;
    const username = document.getElementById('username-input').value.trim();

    if (password.length < 4) {
		return alert(translations[currentLang].alert_password_short(4));
	}

    const res = await fetch('/api/auth/set-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    });
    const data = await res.json();

    if (data.success) {
        alert(translations[currentLang].alert_password_set_success);       
        document.getElementById('set-password-modal').classList.add('hidden');
        location.reload();
    } else {
        alert(data.error);
    }
}

// --- 2. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå Google ‡πÉ‡∏´‡∏°‡πà: ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ---
async function submitGoogleSetup() {
    const username = document.getElementById('google-username-input').value.trim();
    if (!username) {
        return alert(translations[currentLang].alert_enter_username);
    }

    const res = await fetch('/api/auth/google-register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            username: username, 
            googleData: tempGoogleData 
        })
    });
    const data = await res.json();

    if (data.success) {
        localStorage.setItem('myUsername', data.user.username);
        startApp(data.user.username);
        document.getElementById('google-setup-modal').classList.add('hidden');
    } else {
        alert(data.error); // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥
    }
}


async function register() {
    const username = document.getElementById('username-input').value.trim();
    const password = document.getElementById('password-input').value;

    if (!username || !password) {
		return alert(translations[currentLang].alert_fill_all);
	}
    if (username.length < 3) {
		return alert(translations[currentLang].alert_username_short(3));
	}

    const res = await fetch('/api/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    });
    
    const data = await res.json();

    if (data.success) {
        alert(translations[currentLang].alert_register_success);
        localStorage.setItem('myUsername', data.user.username);
        startApp(data.user.username);
    } else {
        alert(data.error); // ‡πÄ‡∏ä‡πà‡∏ô "‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"
    }
}


    // 1. Login ‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ä‡∏∑‡πà‡∏≠ + ‡∏£‡∏´‡∏±‡∏™)
async function login() {
    const username = document.getElementById('username-input').value.trim();
    const password = document.getElementById('password-input').value;

    if (!username || !password) {
		return alert(translations[currentLang].alert_login_empty);
	}

    const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
    });
    const data = await res.json();

    if (data.success) {
        localStorage.setItem('myUsername', data.user.username);
        startApp(data.user.username);
    } else if (data.needPasswordSetup) {
        // ‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™
        document.getElementById('set-password-modal').classList.remove('hidden');
    } else {
        alert(data.error);
    }
}


async function saveNewAccount(name, pwd) {
    const res = await fetch('/api/auth/set-password', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username: name, password: pwd })
    });
    const data = await res.json();
    if (data.success) {
        alert(translations[currentLang].alert_save_success);
        login(); // ‡∏•‡∏≠‡∏á Login ‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    } else {
        alert(data.error);
    }
}
		
		
		// Announcement Functions ---
		// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
function renderAnnouncement(text) {
    const display = document.getElementById('announcement-display');
    const textElement = document.getElementById('announcement-text'); // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á Marquee
	currentAnnouncementText = text || '';
    if (!text || text.trim() === '') {
        textElement.innerHTML = '';
        display.style.display = 'none'; 
        return;
    }
	
    const prefix = translations[currentLang]['announcement_prefix'] || 'üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®:';
    
    textElement.innerHTML = `${prefix} ${text.trim()}`; // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á‡πÉ‡∏ô Marquee
    display.style.display = 'block';
}

async function fetchAndRenderAnnouncement(locationData = null) {
    let url = '/api/admin/get-announcement';
    let timeoutId;
    if (currentAnnouncementText) {
        renderAnnouncement(currentAnnouncementText);
    }
    if (locationData && locationData.lat && locationData.lng) {
        url += `?lat=${locationData.lat}&lng=${locationData.lng}`;
    }

    try {
        const res = await fetch(url);
        if (res.status === 200) {
            const data = await res.json();
            renderAnnouncement(data.announcement); 
        }
    } catch (e) {
        console.error('Fetch announcement failed:', e);
    }
}

async function openAdminAnnouncementModal() {
    if (myAdminLevel < 1) return alert('‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin Level 1 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
    
    let currentText = '';
    try {
        const res = await fetch(`/api/admin/get-announcement?requestBy=${myUsername}`);
        const data = await res.json();
        currentText = data.announcement || '';
    } catch (e) {
        console.error('Failed to fetch my announcement:', e);
    }
    
    document.getElementById('announcement-input').value = currentText;
    document.getElementById('admin-announcement-modal').classList.remove('hidden');
    
    if(document.getElementById('sidebar').classList.contains('active')) toggleSidebar();
}
window.openAdminAnnouncementModal = openAdminAnnouncementModal; // ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Window

async function saveAdminAnnouncement() {
    if (myAdminLevel < 1) return;
    
    const announcementText = document.getElementById('announcement-input').value.trim();
    
    try {
        const res = await fetch('/api/admin/set-announcement', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ announcementText, requestBy: myUsername })
        });

        const data = await res.json();
        
        if (data.success) {
            alert('‚úÖ success');
            document.getElementById('admin-announcement-modal').classList.add('hidden');
            renderAnnouncement(announcementText);
        } else {
            alert(`‚ùå Error Announcement: ${data.error}`);
        }
    } catch (e) {
        alert('‚ùå A connection error occurred Server');
    }
}
window.saveAdminAnnouncement = saveAdminAnnouncement;



async function startApp(name) {
    myUsername = name;
	
	document.getElementById('geo-filter-btn').classList.remove('hidden');
    document.getElementById('sticky-create-btn').classList.remove('hidden');
	
	const userDisplay = document.getElementById('user-display');
    if(userDisplay) userDisplay.innerText = name;

    document.getElementById('login-modal').classList.add('hidden');
    socket.emit('register', myUsername);
    
    const preferred = localStorage.getItem('preferredCurrency');
    if (preferred) {
        currentCurrency = preferred;
        const selectElement = document.getElementById('currency-select');
        if (selectElement) selectElement.value = preferred;
    }

    if (name !== 'Admin') { 
        checkAndRedirectActiveJob(name);
    }

    const adminPanelDiv = document.getElementById('admin-panel');
    
    checkNewTransaction();
    loadUnreadStatus(); 

    await updateUserInfo(); 
	checkPrimaryLocationAndLoad();
	fetchAndRenderAnnouncement();
    
    loadPosts(); 
    
    updateActivePostCount();
}
    

     

	// ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
async function checkAndRedirectActiveJob(username) {
    if (!username) return;

    try {
        const res = await fetch(`/api/rider/check-working-status?username=${encodeURIComponent(username)}`);
        const data = await res.json();
        
        if (data.success) {
            if (data.isOwner && data.mercNum > 0) {
                window.location.replace('merchant.html');
                return;
            }

            if (data.workingJobId) {
                const jobId = data.workingJobId.toString();
                const type = data.jobType;

                if (type === 'handover') {
                    window.location.replace(`post.html?id=${jobId}`);
                    return;
                }

                if (type === 'merchant' && !data.isOwner) {
                    window.location.replace(`riderjobmerchant.html?view_id=${jobId}`);
                    return;
                }
            }
        }
        
    } catch (err) {
        console.error("üö® Error:", err);
    }
}

        function logout() {
			document.getElementById('geo-filter-btn').classList.add('hidden');
			document.getElementById('sticky-create-btn').classList.add('hidden');
            localStorage.removeItem('myUsername'); 
            location.reload();
        }
            
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.querySelector('.overlay').classList.toggle('active'); }

    
async function updateUserInfo() {
    if (!myUsername) return;

    try {
        let locationQuery = '';
        const savedLoc = localStorage.getItem('userPrimaryLocation');
        if (savedLoc) {
             locationQuery = `&location=${encodeURIComponent(savedLoc)}`;
        }
        
        const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        let myCountry = 'TH';

        if (!userTimeZone.includes('Bangkok') && !userTimeZone.includes('Asia/Phnom_Penh')) {
             myCountry = 'OTHER'; 
        }

        const response = await fetch(`/api/user-info?username=${myUsername}&currency=${currentCurrency}${locationQuery}&country=${myCountry}&lang=${currentLang}`);
        
        const data = await response.json();

        if (response.status === 403) {
            alert(data.error);
            localStorage.removeItem('myUsername');
            window.location.reload();
            return;
        }

        if (data.error) {
            console.error(data.error);
            return;
        }
        
        myAdminLevel = data.adminLevel || 0;
        myZoneId = data.userZoneId || null;

        const userDisplay = document.getElementById('user-display');
        if (userDisplay) {
            userDisplay.innerText = myUsername;
            if (myAdminLevel > 0) {
                userDisplay.style.color = "#0033FF";
                userDisplay.style.fontWeight = "bold";
            } else {
                userDisplay.style.color = "#000000";
                userDisplay.style.fontWeight = "normal";
            }
        }
                
        const avatarEl = document.getElementById('user-avatar-display');
        if (avatarEl) {
            let stars = '';
            if (myAdminLevel === 1) stars = '<div style="font-size:14px; margin-top:-5px; color:#ffc107; text-shadow: 1px 1px 2px black;">üëë</div>';
            if (myAdminLevel === 2) stars = '<div style="font-size:14px; margin-top:-5px; color:#ffc107; text-shadow: 1px 1px 2px black;">üëëüëë</div>';
            if (myAdminLevel === 3) stars = '<div style="font-size:14px; margin-top:-5px; color:#ffc107; text-shadow: 1px 1px 2px black;">üëëüëëüëë</div>';
            
            avatarEl.innerHTML = `üê±${stars}`;
        }
		
                        
        const adminPanelDiv = document.getElementById('admin-panel');
        if (myAdminLevel >= 1) {
            adminPanelDiv.classList.remove('hidden');
        } else {
            adminPanelDiv.classList.add('hidden');
        }
        
        const setCostBtn = document.querySelector('button[onclick="setPostCost()"]');
        if (setCostBtn) {
            setCostBtn.style.display = (myAdminLevel >= 3) ? 'block' : 'none';
        }
                        
        const giveCoinBtn = document.querySelector('.give-coin-btn');
        const deductCoinBtn = document.querySelector('.deduct-coin-btn');
        
        if (giveCoinBtn) {
              giveCoinBtn.style.display = (myAdminLevel >= 1) ? 'inline-block' : 'none';
        }
        if (deductCoinBtn) { 
              deductCoinBtn.style.display = (myAdminLevel >= 1) ? 'inline-block' : 'none'; 
        }

        const formattedConvertedCoins = parseFloat(data.convertedCoins).toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        const formattedUSD = parseFloat(data.coins).toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        const convertedDisplay = `${formattedConvertedCoins} ${data.currencySymbol}`;

        const headerUsd = document.getElementById('header-usd-display');
        const headerConverted = document.getElementById('header-converted-display');

        if (headerUsd) {
            headerUsd.innerText = `${formattedUSD} USD`;
            headerUsd.style.fontSize = "1.0em"; 
        }
        if (headerConverted) {
            headerConverted.innerText = convertedDisplay;
        }

        const sidebarUsd = document.getElementById('sidebar-usd-display');
        const sidebarConverted = document.getElementById('sidebar-converted-display');

        if (sidebarUsd) {
            sidebarUsd.innerText = `${formattedUSD} USD`;
            sidebarUsd.style.fontSize = "1.0em"; 
        }
        if (sidebarConverted) {
            sidebarConverted.innerText = convertedDisplay;
        }

        const modalCostDisplay = document.getElementById('modal-cost-display');
        const postCostUSD = data.postCost.totalCost;
        currentCost = postCostUSD; 
       
        let impliedRate = 1;
        const balanceUSD = parseFloat(data.coins);
        const balanceConverted = parseFloat(String(data.convertedCoins).replace(/,/g, ''));

        if (balanceUSD > 0) {
            impliedRate = balanceConverted / balanceUSD;
        } else {
            impliedRate = (data.currencySymbol === 'USD') ? 1 : 0;
        }

        const convertedCostVal = postCostUSD * impliedRate;
        const formattedConvertedCost = convertedCostVal.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
        
        if (modalCostDisplay) {
			const systemZone = (data.postCost?.systemZone || 0).toFixed(2); 
			const adminFee = (data.postCost?.adminFee || 0).toFixed(2);
			const totalCostUSDT = (data.postCost?.totalCost || 0).toFixed(2);

		modalCostDisplay.innerHTML = 
        `<span style="font-size:1.0em; color:#2364cc; font-weight:normal;">(${systemZone} + ${adminFee} ${data.currencySymbol})</span>`;
		}
        
        const sidebarRating = document.getElementById('sidebar-rating');
        if (sidebarRating) {
			sidebarRating.innerText = (data.rating || 0).toFixed(2);
			}

        const sidebarTotalPosts = document.getElementById('sidebar-total-posts');
        if (sidebarTotalPosts) {
            sidebarTotalPosts.innerText = data.totalPosts || 0;
        }

        const sidebarCompletedJobs = document.getElementById('sidebar-completed-jobs');
        if (sidebarCompletedJobs) {
            sidebarCompletedJobs.innerText = data.completedJobs || 0;
        }
        
        
        if (locationQuery) {
                const locData = JSON.parse(decodeURIComponent(locationQuery.split('=')[1]));
                updateZoneBackground(locData.lat, locData.lng);
                fetchAndRenderAnnouncement(locData);
            }

        loadPosts();

    } catch (e) {
        console.error('Error fetching user info:', e);
    }
}
		
        function toggleCustomBanInput() {
    const select = document.getElementById('ban-days-select');
    const customInput = document.getElementById('custom-ban-days');
    customInput.style.display = (select.value === 'custom') ? 'block' : 'none';
}

async function toggleBanUser(targetUser, currentStatus) {
    if (myAdminLevel < 1) return;

    if (currentStatus === true) {
        if (!confirm(`Are you sure you want to unban the member?: ${targetUser} `)) return;
        executeBanStatus(targetUser, false, 0);
        return;
    }

    currentBanTarget = targetUser;
    document.getElementById('ban-target-name').innerText = targetUser;
    document.getElementById('user-detail-modal').classList.add('hidden');    
    document.getElementById('ban-selection-modal').classList.remove('hidden');
}


function toggleCustomBanInputNew() {
    const val = document.getElementById('ban-days-select-new').value;
    document.getElementById('custom-ban-days-new').style.display = (val === 'custom') ? 'block' : 'none';
}


async function confirmAndSendBan() {
    const select = document.getElementById('ban-days-select-new');
    let banDays = 0;

    if (select.value === 'custom') {
        banDays = parseInt(document.getElementById('custom-ban-days-new').value);
    } else {
        banDays = parseInt(select.value);
    }

    if (select.value === 'custom' && (isNaN(banDays) || banDays <= 0)) {
        alert("‚ùå Specify the correct number of days.");
        return;
    }

    const dayText = banDays === 0 ? "-" : banDays + " Day";
    if (!confirm(`Ban Confirm ${currentBanTarget} Time ${dayText}?`)) return;

    executeBanStatus(currentBanTarget, true, banDays);
}


async function executeBanStatus(targetUser, shouldBan, banDays) {
    try {
        const res = await fetch('/api/admin/toggle-ban', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                targetUser: targetUser,
                shouldBan: shouldBan,
                banDays: banDays,
                requestBy: myUsername,
                lang: currentLang
            })
        });

        const data = await res.json();
        if (data.success) {
            document.getElementById('ban-selection-modal').classList.add('hidden');
            openAllUserList(document.getElementById('user-search-input').value, currentUserPage);
        } else {
            alert(`‚ùå Error: ${data.error}`);
        }
    } catch (e) {
        console.error(e);
        alert("‚ùå A connection error occurred.");
    }
}

function toggleCustomBanInput() {
    const select = document.getElementById('ban-days-select');
    const customInput = document.getElementById('custom-ban-days');
    customInput.style.display = (select.value === 'custom') ? 'block' : 'none';
}

        function setMemberRating(targetUser) {
            let newRating = prompt(`‚≠ê Set Rating (1.0 - 5.0) User: ${targetUser}:`);
            if (newRating === null || newRating.trim() === "") return;
            newRating = parseFloat(newRating);

            if (isNaN(newRating) || newRating < 1 || newRating > 5) {
                alert('‚ùå Incorrect rating! Please specify between 1.0 - 5.0');
                return;
            }
            
            fetch('/api/admin/set-rating', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ targetUser, rating: newRating, requestBy: myUsername })
            })
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    alert(`‚ùå Failed to set rating: ${data.error}`);
                } else {
                    alert(`‚úÖ SetRating ${targetUser} To ${data.newRating} Success`);
                    openAllUserList(); 
                    updateUserInfo(); 
                }
            })
            .catch(err => alert('‚ùå Error: Unable to connect to server to set score.'));
        }
		
		// setAdminLevel
async function setAdminLevel(targetUser, newLevel) {
    const levelName = newLevel === 0 ? 'User ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' : `Admin Level ${newLevel}`;
    const action = newLevel === 0 ? '‡∏ñ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (Demote)' : '‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á (Promote)';
    
    if (!confirm(`Are you sure you want to? ${action} ${targetUser} Let it be ${levelName} Or not?`)) return;

    try {
        const res = await fetch('/api/admin/set-level', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ targetUser, newLevel, requestBy: myUsername })
        });

        const data = await res.json();
        if (data.success) {
            alert(`‚úÖ Successfully completed: ${targetUser} Promote ${levelName} `);
            allUsersCache = [];
            openAllUserList();
        } else {
            alert(`‚ùå Failed: ${data.error}`);
        }
    } catch (error) {
        console.error(error);
        alert('‚ùå Error connecting to server');
    }
}

        function changeListPage(delta) {
            const listType = document.getElementById('pagination-controls').dataset.type;
            if (listType === 'adminTx') {
                adminTxPage += delta;
                openTransactionModal(adminTxPage);
            } else if (listType === 'memberTx') {
                memberTxPage += delta;
                openMemberLedger(memberTxPage);
            } else if (listType === 'inbox') {
                inboxPage += delta;
                openInbox(inboxPage);
            }
        }
        
        function changePostPage(delta) {
            currentPostPage += delta;
            renderPostList();
            document.querySelector('.content-area').scrollIntoView({ behavior: 'smooth' });
        }

        function updatePaginationUI(data, listType) {
            const controls = document.getElementById('pagination-controls');
            const pageInfo = document.getElementById('page-info');
            const prevBtn = document.getElementById('list-prev-btn');
            const nextBtn = document.getElementById('list-next-btn');

            controls.style.display = 'block'; 
            controls.dataset.type = listType;

            if (data.totalItems === 0) {
                controls.style.display = 'none';
                return;
            }

            pageInfo.innerText = `${data.currentPage} / ${data.totalPages} (${data.totalItems})`;
            
            prevBtn.disabled = data.currentPage === 1;
            nextBtn.disabled = data.currentPage === data.totalPages;
        }
		

function getTransactionDetail(t) {
    const lang = currentLang;
    const tr = translations[lang];
    let detail = t.note;

    if (t.type === 'POST_REVENUE' && t.postTitle) {
        detail = tr['tx_detail_create_post'].replace('[TITLE]', t.postTitle);
    } else if (t.type === 'ADMIN_GIVE') {
        detail = tr['tx_detail_admin_give'].replace('[USER]', t.toUser);
    } else if (t.type === 'ADMIN_DEDUCT') {
        detail = tr['tx_detail_admin_deduct'].replace('[USER]', t.fromUser);
    } else if (t.type === 'HANDOVER') {
        
        let title = t.postTitle;
        if (!title && t.note.includes(':')) {
            title = t.note.split(':').pop().trim();
        }
        detail = tr['tx_detail_handover'].replace('[TITLE]', title || '???');
    }
    
    return `(${detail})`;
}
        // --- TRANSACTION LOGIC ---
        
        async function openTransactionModal(page = 1) {
            if (myUsername !== 'Admin') return openPrivateChat('Admin');
            
            document.getElementById('user-list-modal').classList.remove('hidden');
            
            document.getElementById('user-list-title').innerText = translations[currentLang]['admin_tx_title'];
            document.getElementById('user-list-desc').innerText = translations[currentLang]['admin_tx_desc'];
            
            const container = document.getElementById('user-list-container');
            container.innerHTML = "Loading...";
            
            document.getElementById('user-search-input').style.display = 'none';
            document.getElementById('pagination-controls').style.display = 'none';

            const res = await fetch(`/api/admin/transactions?requestBy=${myUsername}&page=${page}&limit=${PAGE_LIMIT}`);
            
            if (res.status !== 200) {
                 container.innerHTML = "<p style='color:red;'>Error loading transactions</p>";
                 return;
            }

            const data = await res.json();
            const transactions = data.transactions;

            if (transactions.length === 0 && data.currentPage > 1) {
                return openTransactionModal(1);
            } else if (transactions.length === 0) {
                container.innerHTML = "<p style='text-align:center;color:gray;margin-top:20px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</p>";
                updatePaginationUI(data, 'adminTx');
                return;
            }

            container.innerHTML = transactions.map(t => {
                const isRevenue = t.type === 'POST_REVENUE' || t.type === 'ADMIN_DEDUCT'; 
                
                let typeText;
                if (t.type === 'POST_REVENUE') {
                    typeText = translations[currentLang]['admin_tx_revenue']; 
                } else if (t.type === 'ADMIN_DEDUCT') {
                    typeText = translations[currentLang]['admin_tx_deduct']; 
                } else {
                    typeText = translations[currentLang]['admin_tx_transfer_out']; 
                }

                const styleClass = isRevenue ? 'tx-plus' : 'tx-minus';
                const amountSign = isRevenue ? '+' : '';
                const relatedUser = isRevenue ? t.fromUser : t.toUser;
                
                const fromToPrefix = isRevenue 
                    ? translations[currentLang]['tx_from'] 
                    : translations[currentLang]['tx_to'];
                
                const detail = getTransactionDetail(t);
                
                return `
                    <div class="transaction-item" style="border-left: 5px solid ${isRevenue ? '#28a745' : '#dc3545'}; margin-bottom:5px;">
                        <div>
                            <strong>${typeText}</strong> (${detail})<br>
                            <small style="color:gray;">${new Date(t.timestamp).toLocaleString()} | ${fromToPrefix}: ${relatedUser}</small>
                        </div>
                        <span class="${styleClass}">${amountSign}${t.amount} USD</span>
                    </div>
                `;
            }).join('');
            
            updatePaginationUI(data, 'adminTx');
            adminTxPage = data.currentPage;
            
            document.getElementById('list-prev-btn').innerText = translations[currentLang]['btn_prev'];
            document.getElementById('list-next-btn').innerText = translations[currentLang]['btn_next'];
        }
        
        async function openMemberLedger(page = 1) {
    document.getElementById('user-list-modal').classList.remove('hidden');
    document.getElementById('user-list-title').innerText = translations[currentLang]['member_tx_title'];
    document.getElementById('user-list-desc').innerText = translations[currentLang]['member_tx_desc'];
    
    localStorage.setItem(`hasNewTransaction_${myUsername}`, 'false');
    document.getElementById('coin-notif-dot').classList.add('hidden'); 
    
    const container = document.getElementById('user-list-container');
    container.innerHTML = "Loading...";
    
    document.getElementById('user-search-input').style.display = 'none';
    document.getElementById('pagination-controls').style.display = 'none';

    const res = await fetch(`/api/member/transactions?username=${myUsername}&page=${page}&limit=${PAGE_LIMIT}`);
    
    if(res.status !== 200) {
        container.innerHTML = "<p style='color:red;'>Unable to load history.</p>";
        return;
    }
    
    const data = await res.json();
    const transactions = data.transactions;

    const topUpBtnHtml = `
    <div style="padding: 10px 0; margin-bottom: 10px; border-bottom: 2px solid #f0f0f0;">
        <button onclick="window.location.href='userTopupGedgo.html'" 
                style="width: 100%; padding: 12px; background: linear-gradient(135deg, #11998e, #38ef7d); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(17,153,142,0.2);">
            <i class="fas fa-plus-circle"></i> ${translations[currentLang]['btn_topup']}
        </button>
    </div>
`;

    if (transactions.length === 0 && data.currentPage > 1) {
        return openMemberLedger(1);
    } else if (transactions.length === 0) {
        container.innerHTML = topUpBtnHtml + "<p style='text-align:center;color:gray;margin-top:20px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</p>";
        updatePaginationUI(data, 'memberTx');
        return;
    }

    // ‡∏£‡∏ß‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°
    container.innerHTML = topUpBtnHtml + transactions.map(t => {
        const isIncome = t.toUser === myUsername; 
        const typeText = isIncome 
            ? `‚úÖ ${translations[currentLang]['tx_received']}`
            : `‚ùå ${translations[currentLang]['tx_paid']}`;
        const styleClass = isIncome ? 'tx-plus' : 'tx-minus';
        const amountSign = isIncome ? '+' : '-';
        
        const detail = getTransactionDetail(t);
        const relatedUser = isIncome ? t.fromUser : t.toUser;
        const fromToPrefix = isIncome 
            ? translations[currentLang]['tx_from'] 
            : translations[currentLang]['tx_to'];

        return `
            <div class="transaction-item" style="border-left: 5px solid ${isIncome ? '#28a745' : '#dc3545'}; margin-bottom:5px;">
                <div>
                    <strong>${typeText}</strong> ${detail}<br>
                    <small style="color:gray;">${new Date(t.timestamp).toLocaleString()} | ${fromToPrefix}: ${relatedUser}</small>
                </div>
                <span class="${styleClass}">${amountSign}${(t.amount || 0).toFixed(2)} USD</span>
            </div>
        `;
    }).join('');
    
    updatePaginationUI(data, 'memberTx');
    memberTxPage = data.currentPage;
    document.getElementById('list-prev-btn').innerText = translations[currentLang]['btn_prev'];
    document.getElementById('list-next-btn').innerText = translations[currentLang]['btn_next'];
}

        function contactAdmin() {
            if (myUsername === 'Admin') openTransactionModal(); 
            else openMemberLedger(); 
        }

        function checkNewTransaction() {
            const status = localStorage.getItem(`hasNewTransaction_${myUsername}`);
            if (status === 'true') {
                document.getElementById('coin-notif-dot').classList.remove('hidden');
                hasNewTransaction = true;
            }
        }
        
        function saveUnreadStatus() {
            localStorage.setItem(`unreadUsers_${myUsername}`, JSON.stringify(Array.from(unreadUsers)));
            if (unreadUsers.size > 0) {
                document.getElementById('notif-badge').innerText = unreadUsers.size;
                document.getElementById('notif-badge').classList.remove('hidden');
            } else {
                document.getElementById('notif-badge').classList.add('hidden');
                document.title = "GedGoZone";
            }
        }

        function loadUnreadStatus() {
            const savedUnread = localStorage.getItem(`unreadUsers_${myUsername}`);
            if (savedUnread) {
                unreadUsers = new Set(JSON.parse(savedUnread));
                saveUnreadStatus(); 
            }
        }
	
	async function adminpanel() {    
        window.location.href = 'adminzoneGedgo.html';
		toggleSidebar();
	}
        
        async function switchView(view) {
    currentView = view;
    currentPostPage = 1; 
    
    const title = document.getElementById('page-title');
    const filterContainer = document.getElementById('filter-container');
    
    if (filterContainer) {
        filterContainer.style.display = (view === 'home') ? 'block' : 'none';
    }

    if (view === 'home') {
        title.innerText = translations[currentLang]['page_title'];
        loadPosts(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏õ‡∏Å‡∏ï‡∏¥

    } else if (view === 'my_closed') {
        title.innerText = translations[currentLang]['my_closed_posts'];
        // üí° ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏¢‡∏Å ‡πÄ‡∏£‡∏≤‡∏™‡∏±‡πà‡∏á fetch ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö URL ‡πÑ‡∏î‡πâ
        loadMyZoneClosedPosts(1); 
    } else if (view === 'closed') {
    filterMaxDistance = null; // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏á‡∏≤‡∏ô‡πÇ‡∏ã‡∏ô
    const statusElem = document.getElementById('filter-status');
    if (statusElem) statusElem.innerText = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    
    loadMyZoneClosedPosts(1); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
}
    
    toggleSidebar();
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏´‡∏•‡∏î (‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ loadPosts ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL)
async function loadMyZoneClosedPosts(page) {
    currentPostPage = page;
    const response = await fetch(`/api/myzone-closed-posts?username=${myUsername}&page=${page}&limit=${POST_LIMIT}`);
    const data = await response.json();
    
    const postListDiv = document.getElementById('post-list');
    postListDiv.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠

    if (data.posts.length === 0) {
        postListDiv.innerHTML = '<div style="text-align:center; padding:20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
    } else {
        data.posts.forEach(post => addPostToDOM(post)); // ‡∏ß‡∏≤‡∏î‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    }
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° Pagination ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    renderPagination(data.currentPage, data.totalPages, (p) => loadMyZoneClosedPosts(p));
}

        async function loadPosts() {
            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ (Limit 1000 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Admin)
                const res = await fetch('/api/posts?limit=1000');
                const responseData = await res.json();
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö Array ‡πÅ‡∏•‡∏∞ Object)
                let postsArray = [];
                if (Array.isArray(responseData)) {
                    postsArray = responseData;
                } else if (responseData.posts && Array.isArray(responseData.posts)) {
                    postsArray = responseData.posts;
                }

                // ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ postStatusMap ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ renderPostList ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
                postsArray.forEach(p => {
                    if (postStatusMap[p.id]) {
                        postStatusMap[p.id].data = p; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                    } else {
                        postStatusMap[p.id] = { data: p, isOccupied: false }; // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                    }
                });

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
                renderPostList(); 
                
            } catch (err) {
                console.error("Error loading posts:", err);
            }
        }
		
		// ‡∏î‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î
	async function showMyActivePosts(page = 1) {
    if (!myUsername) return;
    try {
        currentView = 'my_active'; // üëà [NEW] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ currentView
        currentPostPage = page;

        const response = await fetch(`/api/my-active-posts?username=${myUsername}&page=${page}&limit=${POST_LIMIT}`);
        const data = await response.json();
        const postListDiv = document.getElementById('post-list');
        const pageTitle = document.getElementById('page-title');
        const paginationDiv = document.getElementById('post-pagination');

        postListDiv.innerHTML = '';
        
        // ‚≠ê [FIXED] ‡πÉ‡∏ä‡πâ translations key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
        pageTitle.innerText = `üìù ${translations[currentLang]['my_active_posts']}`;
        
        postListDiv.innerHTML = `
    <div style="text-align:center; padding: 50px; color:#6c757d; font-size:1.2em;">
        ${translations[currentLang].no_active_posts}
    </div>`;

        data.posts.forEach((post) => {
            const statusInfo = postStatusMap[post.id];
            const isOccupied = statusInfo ? statusInfo.isOccupied : false;
            addPostToDOM(post, isOccupied);
        });

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Pagination UI
        if (data.totalItems > POST_LIMIT) {
            paginationDiv.style.display = 'block';
            document.getElementById('post-page-info').innerText = `${data.currentPage} / ${data.totalPages} (${data.totalItems})`;
            
            document.getElementById('post-prev-btn').onclick = () => showMyActivePosts(data.currentPage - 1);
            document.getElementById('post-next-btn').onclick = () => showMyActivePosts(data.currentPage + 1);
            
            document.getElementById('post-prev-btn').disabled = (data.currentPage === 1);
            document.getElementById('post-next-btn').disabled = (data.currentPage === data.totalPages);
        } else {
            paginationDiv.style.display = 'none';
        }
        
    } catch (e) {
        console.error('Error fetching my active posts:', e);
        showNotification(
    translations[currentLang].error_fetch_posts, 
    'fas fa-exclamation-triangle', 
    3000, 
    '#dc3545'
);
    }
}

		// [NEW FUNCTION] ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
		async function updateActivePostCount() {
		if (!myUsername || myUsername === 'Admin') return;
    
		try {
        const response = await fetch(`/api/my-active-count?username=${myUsername}`);
        const data = await response.json();
        
        const countSpan = document.getElementById('active-post-count');
        if (countSpan) {
            countSpan.innerText = data.count;
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            countSpan.style.background = data.count > 0 ? '#dc3545' : '#6c757d';
        }
    } catch(e) {
        console.error('Error fetching active post count:', e);
    }
}

		// [NEW FUNCTION] ‡∏î‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß
async function showMyClosedPosts(page = 1) { 
    if (!myUsername) return;
    try {
        currentView = 'my_closed'; // üëà ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ currentView ‡πÉ‡∏´‡∏°‡πà
        currentPostPage = page;
        
        // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á page ‡πÅ‡∏•‡∏∞ limit
        const response = await fetch(`/api/my-closed-posts?username=${myUsername}&page=${page}&limit=${POST_LIMIT}`);
        const data = await response.json();
        const postListDiv = document.getElementById('post-list');
        const pageTitle = document.getElementById('page-title');
        const paginationDiv = document.getElementById('post-pagination');
        
        // 2. ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡πÄ‡∏î‡∏¥‡∏°
        postListDiv.innerHTML = '';
        
        // ‚≠ê [FIXED] ‡πÉ‡∏ä‡πâ translations key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' / 'items'
        const itemText = currentLang === 'th' ? 'List' : 'items';
        pageTitle.innerText = `üóÑÔ∏è ${translations[currentLang]['my_closed_posts']} (${data.totalItems} ${itemText})`;
        
        if (data.totalItems === 0) {
            postListDiv.innerHTML = `
    <div style="text-align:center; padding: 50px; color:#bbb;">
        <i class="fas fa-folder-open" style="font-size: 3em; margin-bottom: 15px; display: block;"></i>
        <span style="font-size: 1.1em;">${translations[currentLang].no_closed_posts}</span>
    </div>`;
            paginationDiv.style.display = 'none';
            return;
        }

        // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ
        data.posts.forEach((post) => {
            const statusInfo = postStatusMap[post.id];
            const isOccupied = statusInfo ? statusInfo.isOccupied : false;
            addPostToDOM(post, isOccupied);
        });

        // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Pagination UI
        if (data.totalItems > POST_LIMIT) {
            paginationDiv.style.display = 'block';
            document.getElementById('post-page-info').innerText = `${data.currentPage} / ${data.totalPages} (${data.totalItems})`;
            
            document.getElementById('post-prev-btn').onclick = () => showMyClosedPosts(data.currentPage - 1);
            document.getElementById('post-next-btn').onclick = () => showMyClosedPosts(data.currentPage + 1);
            
            document.getElementById('post-prev-btn').disabled = (data.currentPage === 1);
            document.getElementById('post-next-btn').disabled = (data.currentPage === data.totalPages);
        } else {
            paginationDiv.style.display = 'none';
        }

    } catch (e) {
        console.error('Error fetching my closed posts:', e);
        showNotification(
    translations[currentLang].error_fetch_posts, 
    'fas fa-exclamation-triangle', 
    3000, 
    '#dc3545'
);
    }
	toggleSidebar();
}

    function renderPostList() {
    const list = document.getElementById('post-list');
    const paginationDiv = document.getElementById('post-pagination');
    list.innerHTML = '';
    
    let postsArray = Object.values(postStatusMap).map(item => item);
    let filteredPosts = postsArray;

    if (currentView === 'closed') {
        filteredPosts = postsArray.filter(item => item.data.isClosed);
    } else {
        // üö© ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ: ‡∏Å‡∏£‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö" (acceptedBy ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á)
        filteredPosts = postsArray.filter(item => {
            const p = item.data;
            const isNotClosed = !p.isClosed;
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (MerchantTask) ‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö (!p.acceptedBy)
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏Å‡πá‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
            const isVacant = p.isMerchantTask ? !p.acceptedBy : true;

            return isNotClosed && isVacant;
        });
        currentView = 'home'; 
    }

    // --- Zone Lock Filter ---
    if (myZoneId) {
        filteredPosts = filteredPosts.filter(item => {
            const p = item.data;
            if (p.zoneId && p.zoneId !== myZoneId) return false;
            return true;
        });
    }

    // --- Location Filter ---
    if (filterLocation && filterMaxDistance) {
        filteredPosts = filteredPosts.filter(item => {
            const post = item.data;
            if (!post.location || !post.location.lat || !post.location.lng) return false;
            const dist = getDistanceFromLatLonInKm(
                filterLocation.lat, filterLocation.lng,
                post.location.lat, post.location.lng
            );
            return dist <= filterMaxDistance;
        });
    }

    // --- Sorting Logic ---
    filteredPosts.sort((a, b) => {
        const postA = a.data; const postB = b.data;
        const aIsPinned = postA.isPinned && !postA.isClosed;
        const bIsPinned = postB.isPinned && !postB.isClosed;
        
        if (aIsPinned && !bIsPinned) return -1;
        if (!aIsPinned && bIsPinned) return 1;

        // ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Closed ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏Å‡∏±‡∏ô‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
        const aDone = postA.status === 'finished' || postA.isClosed;
        const bDone = postB.status === 'finished' || postB.isClosed;
        if (aDone && !bDone) return 1;
        if (!aDone && bDone) return -1;

        return postB.id - postA.id;
            });

            if (filteredPosts.length === 0) {
                 list.innerHTML = `<div style="text-align:center; margin-top:50px; color:gray;"><h3>Waiting....</h3></div>`;
                 paginationDiv.style.display = 'none'; 
                 return;
            }
            
            const totalItems = filteredPosts.length;
            const totalPages = Math.ceil(totalItems / POST_LIMIT);
            
            if (currentPostPage < 1) currentPostPage = 1;
            if (currentPostPage > totalPages) currentPostPage = totalPages;

            const startIndex = (currentPostPage - 1) * POST_LIMIT;
            const endIndex = startIndex + POST_LIMIT;
            const paginatedPosts = filteredPosts.slice(startIndex, endIndex);

            paginatedPosts.forEach(item => {
                addPostToDOM(item.data, item.isOccupied);
            });

            if (totalItems > POST_LIMIT) {
                paginationDiv.style.display = 'block';
                document.getElementById('post-page-info').innerText = `${currentPostPage} / ${totalPages} (${totalItems})`;
                
                document.getElementById('post-prev-btn').disabled = (currentPostPage === 1);
                document.getElementById('post-next-btn').disabled = (currentPostPage === totalPages);
            } else {
                paginationDiv.style.display = 'none'; 
            }
        }

        // ---addPostToDOM (With Winner Display) ---
    function addPostToDOM(post, isOccupied) {
    const list = document.getElementById('post-list');

    // 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin
    let deleteBtn = myUsername === 'Admin'
        ? `<button onclick="deletePost(event,${post.id})" style="border:none;background:none;color:red;font-size:1.2em;cursor:pointer;">üóëÔ∏è</button>`
        : '';

    // 2. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢ (Occupied)
    let occupiedClass = (isOccupied && !post.isPinned) ? 'occupied' : '';
    let occupiedText = isOccupied
        ? `<span style="color:#d9534f; font-weight:bold; margin-left:10px;">(Talking... üí¨)</span>`
        : '';

    // 3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
    let ratingHtml = `<span style="color:black; font-weight:bold; font-size:0.9em; margin-left:5px;">(‚≠ê ${post.authorRating || '0.00'})</span>`;
    let winnerHtml = post.acceptedViewer ? ` <span style="color:#d9534f; font-weight:bold;">(‚úî ${post.acceptedViewer})</span>` : '';

    // 4. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Style ‡πÅ‡∏•‡∏∞ Icon ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    let baseStyle = '';
    let icon = '';

    if (post.isPinned) {
        baseStyle = 'background:#f0e2ff; color:#6a1b9a; border-left:5px solid #6a1b9a;';
        icon = 'üìå';
    } else if (post.status === 'finished' || post.status === 'closed_permanently' || post.isClosed) {
        baseStyle = 'background:#e2e3e5; color:#6c757d; border-left:5px solid #6c757d;';
        icon = 'üîí';
    } else {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
        baseStyle = post.isMerchantTask
            ? 'background:#e8f5e9; color:#1b5e20; border-left:5px solid #4caf50; border-bottom: 2px solid #c8e6c9;'
            : 'background:#d1e7dd; color:#0f5132; border-left:5px solid #198754;';
        icon = post.isMerchantTask ? 'üì¶' : '‚úÖ';
    }

    // 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å (Redirect)
    let action = '';
    if (post.isClosed && myUsername !== 'Admin' && myUsername !== post.author) {
        action = "alert('‚õî Closed')";
    } else {
        if (post.isMerchantTask) {
            action = `location.href='riderjobmerchant.html?view_id=${post.id}'`;
        } else {
            action = `location.href='post.html?id=${post.id}'`;
        }
    }

    // 6. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    const displayName = post.isMerchantTask ? (post.storeName || post.author) : post.author;

    // 7. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
    let locationHtml = '';
    if (post.location && post.location.lat && post.location.lng) {
        let displayText = post.isMerchantTask ? "Location" : (post.location.name || "Location");

        if (typeof filterLocation !== 'undefined' && filterLocation && !post.isClosed) {
            const dist = getDistanceFromLatLonInKm(
                filterLocation.lat, filterLocation.lng,
                post.location.lat, post.location.lng
            );
            displayText = `${dist.toFixed(1)} km`;
        }

        locationHtml = `
            <span onclick="event.stopPropagation()" style="color:#666; font-size:0.85em; margin-left:10px; cursor:default;">
                üìç ${displayText}
            </span>
        `;
    }

    // 8. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
    let budgetHtml = post.isMerchantTask ? `<b style="color:#e67e22; margin-left:10px;">‡∏ø${post.budget}</b>` : '';

    // 9. ‡∏û‡πà‡∏ô HTML ‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    list.insertAdjacentHTML('beforeend', `
        <div class="post-card ${occupiedClass}" id="post-${post.id}" onclick="${action}" 
             style="${baseStyle} padding:15px; margin-bottom:10px; border-radius:12px; display:flex; justify-content:space-between; cursor:pointer;">
            
            <div style="flex-grow: 1;">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <b>${icon} ${post.title}${winnerHtml}</b>
                    ${budgetHtml}
                </div>
                <div style="margin-top:5px;">
                    <small>
                        <i class="fas ${post.isMerchantTask ? 'fa-store' : 'fa-user'}" style="width:16px;"></i> 
                        ${displayName} ${ratingHtml} ‚Ä¢ ${new Date(post.id).toLocaleTimeString()}
                    </small>
                    ${locationHtml}
                    ${occupiedText}
                </div>
            </div>

            <div style="display:flex; align-items:center; margin-left:10px;">
                ${deleteBtn}
            </div>

        </div>
    `);
}
		
		// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ã‡∏ô (‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
async function openAdminZoneModal() {
    if (myAdminLevel === 1) {
        return openAssignedZoneMap();
    }
	if (myAdminLevel === 2) {
        return document.getElementById('zone-management-choice-modal').classList.remove('hidden');
    }
    if (myAdminLevel < 3) {
        const msg = currentLang === 'th' ? '‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin Level 3 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô' : '‚ùå Admin Level 3 Required';
        return alert(msg);
    }

    const listContainer = document.getElementById('zone-list-container');
    const t = translations[currentLang] || translations['th'];

    document.getElementById('admin-zone-modal').classList.remove('hidden');
    backToZoneMenu(); 
    
    if (!listContainer) return;

    listContainer.innerHTML = `<p style="text-align:center;">${t['handover_status_loading_msg'] || 'Loading...'}</p>`;

    try {
        const res = await fetch(`/api/admin/get-zones?requestBy=${myUsername}`);
        if (res.status === 200) {
            const data = await res.json();
            
            if (data.zones && data.zones.length > 0) {
                listContainer.innerHTML = data.zones.map(zone => {
                    const lat = parseFloat(zone.lat).toFixed(4);
                    const lng = parseFloat(zone.lng).toFixed(4);
                    const name = zone.name || `Zone ID: ${zone.id}`;
                    const safeName = name.replace(/'/g, "\\'");
                    const assignedAdmin = zone.assignedAdmin || '-';
                    
                    const canEdit = myAdminLevel >= 3 || (myAdminLevel >= 1 && zone.assignedAdmin === myUsername);

                    let nameInputHtml = '';
                    if (canEdit) {
                        const currentName = name.includes('Zone ID:') ? '' : name;
                        nameInputHtml = `
                            <div style="flex-basis: 100%; margin-top: 10px; background: white; padding: 10px; border-radius: 5px; border: 1px solid #007bff; display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
                                <label style="font-size: 0.9em; white-space: nowrap; font-weight: bold;">${t['label_zone_name'] || '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô'}:</label>
                                <input type="text" id="name-input-${zone.id}" value="${currentName}" placeholder="${t['placeholder_zone_name'] || ''}" style="flex-grow: 1; padding: 5px; margin-bottom: 0;">
                                <button class="sidebar-btn create-btn" onclick="setZoneName(event, '${zone.id}')" style="padding: 5px 10px; font-size: 0.8em; width: auto; margin-bottom: 0; background: #28a745;">
                                    ${t['btn_save'] || 'Save'}
                                </button>
                            </div>
                        `;
                    }

                    const refBtnHtml = (myAdminLevel >= 3) ? `
                        <button onclick="openZoneRefSelectModal('${zone.id}')" style="background:#6f42c1; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.8em; margin-top:5px;">
                            üìç ‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
                        </button>
                    ` : '';

                    return `
                        <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px dashed #eee; font-size: 0.9em; background: #f9f9f9; margin-bottom: 5px; border-radius: 5px;">
                            <div style="flex-basis: 100%; margin-bottom: 5px;">
                                üó∫Ô∏è <b>${name}</b> <br>
                                <small>${t['admin_assigned_to'] || '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•'}: <span style="color:#007bff; font-weight:bold;">${assignedAdmin}</span></small>
                                <br>${refBtnHtml}
                            </div>
                            ${nameInputHtml}
                        </div>
                    `;
                }).join('');
            } else {
                listContainer.innerHTML = `<p style="text-align:center; color:#e0a800;">${t['admin_no_zones_found'] || 'No Zones'}</p>`;
            }
        } else {
            listContainer.innerHTML = `<p style="text-align:center; color:#dc3545;">${t['admin_error_fetch_zones'] || 'Error'}</p>`;
        }
    } catch (e) {
        console.error('Error fetching zone config:', e);
        listContainer.innerHTML = `<p style="text-align:center; color:#dc3545;">${t['admin_error_connection'] || 'Connection Error'}</p>`;
    }
}

function openAllZoneManagement() {
        document.getElementById('zone-management-choice-modal').classList.add('hidden');
        
        document.getElementById('assigned-zone-modal').classList.remove('hidden');
        document.getElementById('assigned-zone-list').innerHTML = '';
        document.getElementById('assigned-zone-loading').style.display = 'block';
        document.getElementById('display-ref-location').innerText = 'Loading...';
        socket.emit('get-assigned-zones');
    }
	

    socket.on('receive-assigned-zones', (data) => {
        const listContainer = document.getElementById('assigned-zone-list');
		const loadingElem = document.getElementById('assigned-zone-loading');
		if (loadingElem) loadingElem.style.display = 'none';

		if (!data.success) {
        alert(data.message);
        return;
		}

		document.getElementById('display-ref-location').innerText = `‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•: ${data.adminName}`;
		listContainer.innerHTML = '';

		if (data.zones.length === 0) {
        listContainer.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</td></tr>';
        return;
		}

		data.zones.forEach(zone => {
    const tr = document.createElement('tr');
    tr.style.borderBottom = '1px solid #eee';
    
    const displayLat = zone.lat || (zone.refLocation ? zone.refLocation.lat : null);
    const displayLng = zone.lng || (zone.refLocation ? zone.refLocation.lng : null);
	
	const ownerName = zone.assignedAdmin || '-';
    
    const latText = (displayLat !== null) ? displayLat.toFixed(6) : 'N/A';
    const lngText = (displayLng !== null) ? displayLng.toFixed(6) : 'N/A';
    const zoneName = zone.name || '-';

    tr.innerHTML = `
        <td style="padding:12px; vertical-align: middle;">
            <div style="display: flex; flex-direction: column;">
                <span style="font-size: 0.8em; color: #6c757d; margin-bottom: 2px;">
                    <i class="fas fa-user-circle"></i> ${ownerName}
                </span>
                <span style="font-weight: bold; color: #333; font-size: 1.05em;">
                    <i class="fas fa-map-marker-alt" style="color: #e74c3c; width: 15px;"></i> ${zoneName}
                </span>
            </div>
        </td>
        <td style="padding:12px; font-family: monospace; font-size: 0.85em; color: #555; vertical-align: middle;">
            ${latText}, ${lngText}
        </td>
        <td style="padding:12px; text-align: right; vertical-align: middle;">
			<button onclick="document.getElementById('assigned-zone-modal').classList.add('hidden'); openAdminAssignModal('${zone._id}', '${zoneName}', ${displayLat}, ${displayLng})" 
        style="padding:6px 10px; background: #ffc107; color: #000; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8em; margin-right:5px;">
    <i class="fas fa-user-plus"></i> Appoint Admin
</button>

            <button onclick="zoomToZone(${displayLat}, ${displayLng})" 
                    style="padding:8px 15px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; transition: 0.2s;">
                <i class="fas fa-location-arrow"></i> Map
            </button>
        </td>
    `;
    listContainer.appendChild(tr);
        });
    });
	
	function zoomToZone(lat, lng) {
    if (lat === 'N/A' || lng === 'N/A') return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î');
    
    if (typeof map !== 'undefined') {
        map.setView([lat, lng], 15);
        document.getElementById('assigned-zone-modal').classList.add('hidden');
        toggleSidebar();
    } else {
        window.open(`https://www.google.com/maps?q=${lat},${lng}`, '_blank');
    }
}

function closeZoneChoiceModal() {
    document.getElementById('zone-management-choice-modal').classList.add('hidden');
}

function closeAdminZoneModal() {
    document.getElementById('admin-zone-modal').classList.add('hidden');
}

function backToZoneMenu() {
    document.getElementById('view-zone-menu').classList.remove('hidden');
    document.getElementById('view-zone-add').classList.add('hidden');
    document.getElementById('view-zone-list').classList.add('hidden');
}

function goToAddZone() {
    document.getElementById('view-zone-menu').classList.add('hidden');
    document.getElementById('view-zone-add').classList.remove('hidden');
    
    document.getElementById('zone-lat-input-new').value = '';
    document.getElementById('zone-lng-input-new').value = '';
    document.getElementById('zone-name-input-new').value = '';
}

function goToManageZone() {
    document.getElementById('view-zone-menu').classList.add('hidden');
    document.getElementById('view-zone-list').classList.remove('hidden');
    fetchAndRenderAllZones(); 
}

async function addZoneConfigNew() {
    if (myAdminLevel < 3) return;
    
    const lat = document.getElementById('zone-lat-input-new').value.trim();
    const lng = document.getElementById('zone-lng-input-new').value.trim();
    const name = document.getElementById('zone-name-input-new').value.trim();

    if (!lat || !lng) return alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ Latitude ‡πÅ‡∏•‡∏∞ Longitude');

    try {
        const res = await fetch('/api/admin/add-zone', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                lat: parseFloat(lat), 
                lng: parseFloat(lng), 
                name: name,
                requestBy: myUsername 
            })
        });

        const data = await res.json();
        if (data.success) {
            alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            backToZoneMenu();
        } else {
            alert(`‚ùå Error: ${data.error}`);
        }
    } catch (e) {
        alert('‚ùå Error connection');
    }
}

// 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô
async function fetchAndRenderAllZones() {
    const listContainer = document.getElementById('zone-list-container');
    listContainer.innerHTML = '<p style="text-align:center;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';

    try {
        const res = await fetch(`/api/admin/get-zones?requestBy=${myUsername}`);
        const data = await res.json();
        
        if (data.zones && data.zones.length > 0) {
            listContainer.innerHTML = data.zones.map(zone => {
                const name = zone.name || `Zone ID: ${zone.id}`;
                const safeName = name.replace(/'/g, "\\'");
                const assignedAdmin = zone.assignedAdmin || '-';
                
                // --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Reference Location ---
                let refLocHtml = '';
                if (zone.refLocation && zone.refLocation.lat) {
                    refLocHtml = `
                        <div style="margin-top:5px; font-size:0.85em; background:#e8f5e9; padding:5px; border-radius:4px; border:1px solid #c3e6cb;">
                            <strong style="color:#155724;">üìç ‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:</strong> 
                            <span title="${zone.refLocation.lat}, ${zone.refLocation.lng}">
                                ${zone.refLocation.addressName || '‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß'}
                            </span>
                            <div style="font-size:0.8em; color:gray;">(‡∏à‡∏≤‡∏Å: ${zone.refLocation.sourceUser || 'Unknown'})</div>
                        </div>
                    `;
                } else {
                    refLocHtml = `
                        <div style="margin-top:5px; font-size:0.85em; color:#856404; background:#fff3cd; padding:5px; border-radius:4px; border:1px solid #ffeeba;">
                            ‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
                        </div>
                    `;
                }

                // Input ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô
                let nameInputHtml = `
                    <div style="margin-top:5px; display:flex; gap:5px;">
                        <input type="text" id="name-input-${zone.id}" value="${name.includes('Zone ID:')?'':name}" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô" style="width:100px; padding:2px;">
                        <button onclick="setZoneName(event, '${zone.id}')" class="sidebar-btn" style="padding:2px 5px; width:auto; font-size:0.8em; background:#17a2b8; color:white;">Save Name</button>
                    </div>
                `;

                return `
                <div style="background:#f9f9f9; border-bottom:1px solid #ddd; padding:10px; margin-bottom:5px; border-radius:5px;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div style="flex: 1;">
                            <b>${name}</b><br>
                            <small>üéØ ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á: ${parseFloat(zone.lat).toFixed(4)}, ${parseFloat(zone.lng).toFixed(4)}</small><br>
                            <small style="color:#007bff;">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•: ${assignedAdmin}</small>
                            ${nameInputHtml}
                            ${refLocHtml} </div>
                        <div style="display:flex; flex-direction:column; gap:5px; margin-left:10px;">
                            <button onclick="deleteZone(${zone.id}, '${safeName}')" style="background:#dc3545; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.8em;">‡∏•‡∏ö‡πÇ‡∏ã‡∏ô</button>
                            <button onclick="openAdminAssignModal('${zone.id}', '${safeName}')" style="background:#ffc107; color:black; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.8em;">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</button>
                            <button onclick="openCurrencySelectModal('${zone.id}', '${safeName}')" style="background:#17a2b8; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.8em;">
							üí∞ ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
							</button>
                            <button onclick="openZoneRefSelectModal('${zone.id}')" style="background:#6f42c1; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.8em;">
                                üìç ‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        } else {
            listContainer.innerHTML = '<p style="text-align:center; color:gray;">- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ã‡∏ô -</p>';
        }
    } catch (e) {
        listContainer.innerHTML = '<p style="text-align:center; color:red;">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>';
    }
}

		// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà Admin L1/L2 ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
	async function openAssignedZoneMap() {
    if (myAdminLevel < 1 || myAdminLevel >= 3) return; 
    if (myAdminLevel === 2) closeZoneChoiceModal();

    document.getElementById('assigned-zone-map-modal').classList.remove('hidden');
    const listDisplay = document.getElementById('assigned-zone-list-display');
    const infoDisplay = document.getElementById('assigned-user-display');
    const t = translations[currentLang];

    infoDisplay.innerText = `${myUsername} (Level ${myAdminLevel})`;
    listDisplay.innerHTML = `<p style="text-align:center;">Loading...</p>`;

    try {
        const res = await fetch(`/api/admin/get-assigned-zones?requestBy=${myUsername}`);
        const data = await res.json();

        if (data.zones && data.zones.length > 0) {
            listDisplay.innerHTML = data.zones.map(zone => {
                const lat = parseFloat(zone.lat).toFixed(4);
                const lng = parseFloat(zone.lng).toFixed(4);
                const name = zone.name || `Zone ID: ${zone.id}`;
                const mapLink = `https://www.google.com/maps?q=${zone.lat},${zone.lng}`;
                
                const currentFeeVal = (zone.zoneFee !== undefined && zone.zoneFee !== null) ? zone.zoneFee : '';
                const placeholder = (zone.zoneFee !== undefined && zone.zoneFee !== null) ? '' : '‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏≤‡∏á';
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ü‡∏£‡∏µ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ
                const isFreeChecked = zone.isFree === true ? 'checked' : '';
                const freeZoneHtml = `
                    <div style="margin-top: 10px; background: #e8f5e9; padding: 10px; border-radius: 5px; border: 1px dashed #28a745; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="is-free-input-${zone.id}" ${isFreeChecked} style="width: 18px; height: 18px; cursor: pointer;">
                        <label for="is-free-input-${zone.id}" style="font-size: 0.9em; font-weight: bold; color: #155724; cursor: pointer;">‚ú® Enable the free posting zone. (Zone Free)</label>
                    </div>
                `;

                const bgPreview = zone.bgImage 
                    ? `<div style="margin-top:5px;"><img src="${zone.bgImage}" style="max-height:100px; border-radius:5px; border:1px solid #ddd;"></div>` 
                    : '<div style="margin-top:5px; color:gray; font-size:0.8em;">(There is no background image yet.)</div>';

                const currentName = name.includes('Zone ID:') ? '' : name;
                const nameInputHtml = `
                    <div style="flex-basis: 100%; margin-top: 10px; background: white; padding: 10px; border-radius: 5px; border: 1px solid #007bff; display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
                        <label style="font-size: 0.9em; white-space: nowrap; font-weight: bold;">${t['label_zone_name']}:</label>
                        <input type="text" id="name-input-${zone.id}" value="${currentName}" placeholder="${t['placeholder_zone_name']}" style="flex-grow: 1; padding: 5px; margin-bottom: 0;">
                        <button class="sidebar-btn create-btn" onclick="setZoneName(event, '${zone.id}')" style="padding: 5px 10px; font-size: 0.8em; width: auto; margin-bottom: 0; background: #28a745;">
                            ${t['btn_save']}
                        </button>
                    </div>
                `;

                const bgUploadHtml = `
                    <div style="margin-top: 10px; background: #fff3cd; padding: 10px; border-radius: 5px; border: 1px solid #ffc107;">
                        <label style="font-size: 0.9em; font-weight: bold; display:block;">üñºÔ∏è Zone background image:</label>
                        ${bgPreview}
                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <input type="file" id="bg-file-${zone.id}" accept="image/*" style="font-size:0.8em; width:100%;">
                            <button class="sidebar-btn create-btn" onclick="uploadZoneBg('${zone.id}')" style="padding: 5px 10px; font-size: 0.8em; width: auto; margin-bottom:0;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
                        </div>
                    </div>
                `;

                return `
                    <div style="padding: 15px; border-bottom: 1px solid #eee; background: #f9f9f9; margin-bottom: 5px; border-radius: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-weight: bold;">üó∫Ô∏è ${name}</span>
                            <a href="${mapLink}" target="_blank" style="color:#007bff; text-decoration:none;">üìç ${lat}, ${lng}</a>
                        </div>
                        ${nameInputHtml}
                        ${bgUploadHtml}
                        
                        ${freeZoneHtml} <div style="display: flex; align-items: center; gap: 10px; background: white; padding: 10px; border-radius: 5px; border: 1px solid #ddd; margin-top: 10px;">
                            <label style="font-size: 0.9em; white-space: nowrap;">Zone fee(USD):</label>
                            <span id="fee-display-${zone.id}" style="font-weight: bold; color: var(--primary);">
							${currentFeeVal || '0.00'}
							</span>     
      
                        </div>
                    </div>
                `;
            }).join('');
        } else {
            listDisplay.innerHTML = `<p style="text-align:center; color:#e0a800;">${t['assigned_no_zones']}</p>`;
        }
    } catch (e) {
        listDisplay.innerHTML = `<p style="text-align:center; color:#dc3545;">Error</p>`;
        console.error(e);
    }
}

window.openAssignedZoneMap = openAssignedZoneMap;

	async function setZoneName(e, zoneId) {
    e.stopPropagation(); 
    const t = translations[currentLang] || translations['th'];
    const input = document.getElementById(`name-input-${zoneId}`);
    const newName = input.value.trim();

    if (!newName) {
        alert(t['alert_invalid_zone_name'] || '‚ùå Please enter the zone name.');
        return;
    }
    
    e.target.disabled = true;

    try {
        const res = await fetch('/api/admin/set-zone-name', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                zoneId: zoneId, 
                newZoneName: newName,
                requestBy: myUsername 
            })
        });

        const data = await res.json();
        
        if (data.success) {
            alert(`‚úÖ Change zone name. ID ${zoneId} to ${newName} success!`);
            openAdminZoneModal();
        } else {
            alert(`‚ùå Error: ${data.error || 'Changing the zone name failed.'}`);
        }
    } catch (e) {
        alert('‚ùå An error occurred while connecting to the server.');
        console.error('Error setting zone name:', e);
    } finally {
        e.target.disabled = false;
    }
}
window.setZoneName = setZoneName;

async function saveZoneFee(zoneId) {
    const input = document.getElementById(`fee-input-${zoneId}`);
    const feeValue = input.value.trim();
    
    const isFree = document.getElementById(`is-free-input-${zoneId}`).checked;
    
    try {
        const res = await fetch('/api/admin/set-zone-fee', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                zoneId: zoneId, 
                fee: feeValue === '' ? null : feeValue, 
                isFree: isFree,
                requestBy: myUsername 
            })
        });

        const data = await res.json();
        
        if (data.success) {
            alert('‚úÖ Fees and zone status have been successfully.');
            openAssignedZoneMap();
        } else {
            alert(`‚ùå Error: ${data.error}`);
        }
    } catch (e) {
        alert('‚ùå Connection Error');
    }
}
window.saveZoneFee = saveZoneFee;

async function uploadZoneBg(zoneId) {
    const fileInput = document.getElementById(`bg-file-${zoneId}`);
    const file = fileInput.files[0];
    
    if (!file) {
        alert('‚ùå Please select an image file first.');
        return;
    }

    const formData = new FormData();
    formData.append('zoneId', zoneId);
    formData.append('requestBy', myUsername);
    formData.append('image', file);

    try {
        const btn = event.target;
        const originalText = btn.innerText;
        btn.innerText = '‚è≥...';
        btn.disabled = true;

        const res = await fetch('/api/admin/upload-zone-bg', {
            method: 'POST',
            body: formData
        });

        const data = await res.json();

        if (data.success) {
            alert('‚úÖ Background image uploaded successfully!');
            openAssignedZoneMap();
        } else {
            alert(`‚ùå Error: ${data.error}`);
        }
        
        btn.innerText = originalText;
        btn.disabled = false;

    } catch (e) {
        console.error(e);
        alert('‚ùå An error occurred during the upload.');
    }
}
window.uploadZoneBg = uploadZoneBg;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡πÇ‡∏ã‡∏ô
async function deleteZone(zoneId, zoneName) {
    if (myAdminLevel < 3) return;

    if (!confirm(`‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡πÇ‡∏ã‡∏ô "${zoneName}"?\n‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ`)) {
        return;
    }

    try {
        const res = await fetch('/api/admin/delete-zone', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                zoneId: zoneId, 
                requestBy: myUsername 
            })
        });

        const data = await res.json();
        if (data.success) {
            alert('‚úÖ ‡∏•‡∏ö‡πÇ‡∏ã‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            openAdminZoneModal(); 
        } else {
            alert(`‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${data.error}`);
        }
    } catch (e) {
        alert('‚ùå Error connecting to server');
    }
}

window.deleteZone = deleteZone;

		async function addZoneConfig() {
    if (myAdminLevel < 3) return;
    
    const latInput = document.getElementById('zone-lat-input').value.trim();
    const lngInput = document.getElementById('zone-lng-input').value.trim();
    const nameInput = document.getElementById('zone-name-input').value.trim();
    const t = translations[currentLang];
    
    const lat = parseFloat(latInput);
    const lng = parseFloat(lngInput);

    if (isNaN(lat) || isNaN(lng) || lat < -90 || lat > 90 || lng < -180 || lng > 180) {
        return alert(t['alert_invalid_zone']);
    }

    try {
        const res = await fetch('/api/admin/add-zone', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                lat: lat, 
                lng: lng, 
                name: nameInput,
                requestBy: myUsername 
            })
        });

        const data = await res.json();
        
        if (data.success) {
            alert(t['alert_zone_add_success']);
            
            document.getElementById('zone-lat-input').value = '';
            document.getElementById('zone-lng-input').value = '';
            document.getElementById('zone-name-input').value = '';

            openAdminZoneModal();
        } else {
            alert(`‚ùå Error: ${data.error || '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}`);
        }
    } catch (e) {
        alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå');
        console.error('Error adding zone config:', e);
    }
}
window.addZoneConfig = addZoneConfig;

	function replyDeduct(accepted) {
    if (!currentDeductRequest) return;
    
    socket.emit('reply-deduct-confirm', {
        requester: currentDeductRequest.requester,
        amount: currentDeductRequest.amount,
        accepted: accepted,
        fromUser: myUsername
    });

    document.getElementById('deduct-confirm-modal').classList.add('hidden');
    currentDeductRequest = null;
}

	async function deductCoinInChat() {
    if (myAdminLevel < 1) return alert('‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
    const promptText = translations[currentLang]['prompt_deduct_admin'] || '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ñ‡∏∑‡∏ô (USD):';
    const amount = prompt(`üî¥ ${promptText} ${currentChatPartner}:`);
    
    if(!amount || isNaN(amount) || parseFloat(amount) <= 0) return;
    const parsedAmount = parseFloat(amount);

    try {
        const res = await fetch('/api/admin/deduct-coins', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ targetUser: currentChatPartner, amount: parsedAmount, requestBy: myUsername })
        });
        
        const data = await res.json();
        
        if (data.success) {
            if (data.waitConfirm) {
                alert(`‚è≥ ${data.message}`);
            } else {
                alert(`‚úÖ ${data.message}`);
            }
        } else {
            alert(`‚ùå Error: ${data.error}`);
        }
    } catch (e) {
        console.error(e);
        alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
    }
}
window.deductCoinInChat = deductCoinInChat;

	




        
    // --- SOCKET LOGIC ---
	socket.on('announcement-update', (data) => {
			const locationToSend = currentLocationData || null;
			fetchAndRenderAnnouncement(locationToSend); 
		});

		socket.on('force-logout', (msg) => {
            alert(msg);
            localStorage.removeItem('myUsername');
            window.location.replace('/');
        });

        socket.on('catch-up-post-status', (occupiedList) => { 
            occupiedList.forEach(item => {
                const postId = item.postId;
                if (postStatusMap[postId]) {
                    postStatusMap[postId].isOccupied = item.isOccupied; 
                }
            });
            renderPostList(); 
        });

        socket.on('post-list-update', (data) => { 
            const postId = data.postId;
            if (postStatusMap[postId]) {
                if (data.status) postStatusMap[postId].data.status = data.status; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï status (finished)
                if (data.isOccupied !== undefined) postStatusMap[postId].isOccupied = data.isOccupied;
                
                if (data.post) postStatusMap[postId].data = data.post;
                
                loadPosts(); 
            } else {
                 loadPosts(); 
            }
        });
        
        socket.on('admin-new-transaction', () => {
             if (myUsername === 'Admin') {
                notificationSound.play().catch(()=>{});
                localStorage.setItem(`hasNewTransaction_${myUsername}`, 'true');
                hasNewTransaction = true;
                document.getElementById('coin-notif-dot').classList.remove('hidden');
             }
        });
		
	socket.on('request-deduct-confirm', (data) => {
    currentDeductRequest = data;
    document.getElementById('deduct-requester-name').innerText = data.requester;
    document.getElementById('deduct-amount-display').innerText = data.amount;
    document.getElementById('deduct-confirm-modal').classList.remove('hidden');
    notificationSound.play().catch(()=>{});
});

	socket.on('deduct-result', (data) => {
    if (data.success) {
        alert(data.message);
    } else {
        alert(data.message);
    }
});
        
        // Socket Balance Update ---
        socket.on('balance-update', (data) => {
    if (data.user === myUsername) {
        updateUserInfo();
        

        if (data.coins) {
             const formattedUSD = parseFloat(data.coins).toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
             });
             showNotification(`Update Balance: You have a balance. ${formattedUSD} USD`, 'fas fa-coins', 4000);
        }
    }
});
        
        // --- Notification Helper ---
        function showNotification(message, iconClass = 'fas fa-info-circle', duration = 3000) {
             const modal = document.getElementById('comment-notif-modal');
             if(!modal) return;
             document.getElementById('notif-content').innerText = message;
             modal.classList.remove('hidden');
             setTimeout(() => modal.classList.add('hidden'), duration);
        }
		
		// ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Admin
        socket.on('config-update', (data) => {
    const totalCost = (data.systemFee || 0) + (data.adminFee || 0);

    const costDisplay = document.getElementById('cost-display');
    if (costDisplay) {
        costDisplay.innerText = totalCost.toFixed(2); 
    }
    
    const modalCostDisplay = document.getElementById('modal-cost-display');
    if (modalCostDisplay) {
        modalCostDisplay.innerHTML = `${totalCost.toFixed(2)} <span style="font-size:0.75em; color:#6c757d;">(‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...)</span>`; 
    }
    updateUserInfo(); 
    
    if (myUsername === 'Admin') {
        //alert(`üîî Fee changed to ${totalCost.toFixed(2)} USD`);
    }
});
		
		socket.on('rating-update', (data) => {
            if (data.user === myUsername) {
                const sidebarRating = document.getElementById('sidebar-rating');
                if(sidebarRating) sidebarRating.innerText = data.rating;
                currentRating = parseFloat(data.rating);
            }
            if (!document.getElementById('user-list-modal').classList.contains('hidden')) {
                const title = document.getElementById('user-list-title').innerText;
                if (title.includes('All Member List')) {
                    const searchInput = document.getElementById('user-search-input');
                    openAllUserList(searchInput ? searchInput.value : '');
                }
            }
        });

        function showCommentNotification(message, postId) {
            const modal = document.getElementById('comment-notif-modal');
            const content = document.getElementById('notif-content');
            
            content.innerText = message;
            modal.classList.remove('hidden');
            
            modal.onclick = () => {
                window.location.href = `/post.html?id=${postId}`;
            };
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 5000);
        }
		
	async function fetchTopicsForCreate(lat = null, lng = null) {
        const select = document.getElementById('category-select');
        select.innerHTML = '<option>‚è≥ Loading...</option>';
        select.disabled = true;

        try {
            let url = '/api/topics';
            if (lat && lng) {
                url += `?lat=${lat}&lng=${lng}`;
            }

            const res = await fetch(url);
            const topics = await res.json();

            select.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
            
            if (topics.length === 0) {
                const opt = document.createElement('option');
                opt.text = "No category";
                select.add(opt);
            } else {
                topics.forEach(t => {
                    const opt = document.createElement('option');
                    opt.value = t.id; // ‡∏™‡πà‡∏á ID ‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    opt.text = t.name;
                    select.add(opt);
                });
            }
        } catch (err) {
            console.error('Error loading topics:', err);
            select.innerHTML = '<option>‚ùå Load failed.</option>';
        } finally {
            select.disabled = false;
        }
    }

        // --- CRUD and ADMIN FUNCTIONS ---
    function openCreateModal() {
    if (!myUsername) return document.getElementById('login-modal').classList.remove('hidden');
    
    document.getElementById('title-input').value = '';
    document.getElementById('content').value = '';
    document.getElementById('post-image').value = '';
    document.getElementById('location-display').innerHTML = '';
    
    const btn = document.getElementById('geo-btn');
    btn.classList.remove('active');
    btn.innerHTML = translations[currentLang]['geo_btn'];
    
    const modalCostDisplay = document.getElementById('modal-cost-display');
    if (modalCostDisplay) {
        modalCostDisplay.innerHTML = '<span style="color:#e67e22; font-size:0.9em;">‚è≥ Searching for areas and calculating fees...</span>';
    }

    fetchTopicsForCreate(null, null);

    document.getElementById('create-modal').classList.remove('hidden');
    
    if(document.getElementById('sidebar').classList.contains('active')) toggleSidebar();

    getLocation(); 
}

// ----------------------------------------------------

function openAdminPinnedModal() {
    if (myUsername !== 'Admin') return alert('‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Admin');   
    document.getElementById('modal-cost-row').classList.add('hidden');
    document.getElementById('create-modal-title').innerText = translations[currentLang]['admin_create_pinned'];
    const titleInput = document.getElementById('title-input');
    titleInput.classList.remove('hidden'); 
    titleInput.value = ''; 
    titleInput.placeholder = translations[currentLang]['placeholder_title_admin']; 
    
    setLanguage(currentLang); 
    
    currentLocationData = null;
¬† ¬† document.getElementById('geo-btn').classList.remove('active');
¬† ¬† document.getElementById('geo-btn').innerHTML = `üìç ${translations[currentLang]['geo_btn'].replace('üìç', '').trim()}`;
¬† ¬† document.getElementById('location-display').innerHTML = '';
¬† ¬†¬†
¬† ¬† refreshModalPostCost(null);
¬† ¬†¬†
¬† ¬† // ‡πÅ‡∏™‡∏î‡∏á Modal
¬† ¬† document.getElementById('create-modal').classList.remove('hidden');¬†
¬† ¬† toggleSidebar();
}

        function closeCreateModal() { document.getElementById('create-modal').classList.add('hidden'); } 
        
function getLocation(isPrimaryCheckin = false) {
    const btn = document.getElementById('geo-btn');
    const display = document.getElementById('location-display');
    const t = translations[currentLang];

    if (!navigator.geolocation) {
        alert(t['geo_not_supported']); 
        return;
    }

    btn.classList.remove('active');
    btn.innerHTML = t['geo_searching'];
    display.innerHTML = '';
    
    navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î
        updateZoneBackground(lat, lng);
        
        // 2. ‡∏î‡∏∂‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
        await fetchTopicsForCreate(lat, lng);

        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=${currentLang}`); 
            const data = await res.json();
            
            let placeName = data.address.city || data.address.town || data.address.village || data.address.state || (currentLang === 'th' ? 'Unknown location name' : 'Unknown location name');
            if(data.address.road) placeName = `${data.address.road}, ${placeName}`;

            currentLocationData = { lat, lng, name: placeName };

            // -----------------------------------------------------
            // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Primary Check-in (‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏Å)
            // -----------------------------------------------------
            if (isPrimaryCheckin) {
                userPrimaryLocation = currentLocationData;
                localStorage.setItem('userPrimaryLocation', JSON.stringify(currentLocationData));
                filterLocation = userPrimaryLocation;
                
                updateUserInfo(); 
            } else {
                loadPosts(); 
            }
            // -----------------------------------------------------

            fetchAndRenderAnnouncement(currentLocationData);
            refreshModalPostCost(currentLocationData);
            
            btn.innerHTML = t['geo_success_name']; 
            btn.classList.add('active');
            display.innerHTML = `${t['geo_display_name']} <b>${placeName}</b>`; 
            
        } catch (e) {
            console.error("Geocoding error:", e);
            currentLocationData = { lat, lng, name: `${lat.toFixed(4)}, ${lng.toFixed(4)}` };

           
            if (isPrimaryCheckin) {
                userPrimaryLocation = currentLocationData;
                localStorage.setItem('userPrimaryLocation', JSON.stringify(currentLocationData));
                filterLocation = userPrimaryLocation;
                updateUserInfo();
            } else {
                loadPosts();
            }

            fetchAndRenderAnnouncement(currentLocationData);
            refreshModalPostCost(currentLocationData);

            btn.innerHTML = t['geo_success_coord']; 
            btn.classList.add('active');
            display.innerHTML = `${t['geo_display_coord']} ${lat.toFixed(4)}, ${lng.toFixed(4)}`; 
        }

    }, (error) => {
        let errorMessage = t['geo_error_general']; 
        if (error.code === 1) {
            errorMessage = t['geo_error_permission']; 
        }
        
        alert(errorMessage);
        btn.innerHTML = `üìç ${translations[currentLang]['geo_btn'].replace('üìç', '').trim()}`; 
    });
}


    function insertAtCursor(myField, myValue) {
        if (myField.selectionStart || myField.selectionStart == '0') {
            var startPos = myField.selectionStart;
            var endPos = myField.selectionEnd;
            myField.value = myField.value.substring(0, startPos)
                + myValue
                + myField.value.substring(endPos, myField.value.length);
            myField.selectionStart = startPos + myValue.length;
            myField.selectionEnd = startPos + myValue.length;
        } else {
            myField.value += myValue;
        }
        myField.focus();
    }
	

	async function createPost() {
    // --- 1. ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏¥‡∏î Cooldown ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ---
    const createBtn = document.querySelector('.create-btn'); 
    if (createBtn && createBtn.disabled) return;

    const titleInput = document.getElementById('title-input');
    const content = document.getElementById('content').value.trim();
    const imageFile = document.getElementById('post-image').files[0];
    const category = document.getElementById('category-select').value;
	
	if (myUsername !== 'Admin' && !currentLocationData) {
        alert("‚õî Please click 'üìç Specify current location' before creating a post.");
        document.getElementById('geo-btn').scrollIntoView({ behavior: 'smooth' });
        document.getElementById('geo-btn').style.border = "2px solid red";
        setTimeout(() => document.getElementById('geo-btn').style.border = "1px solid #28a745", 2000);
        return;
    }
    
    let titleVal = "";
    
    if (myUsername === 'Admin') {
        titleVal = titleInput.value.trim();
        if (!titleVal) return alert("Admin ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏û‡∏¥‡πÄ‡∏®‡∏©");
    } else {
        titleVal = ""; 
        if (!content) {
			return alert(translations[currentLang].alert_empty_content);
		}
    }

    // --- 2. ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏¢‡πâ‡∏≥ ---
    if (createBtn) {
        createBtn.disabled = true;
        createBtn.style.opacity = '0.5';
        createBtn.style.cursor = 'not-allowed';
    }

    try {
        const formData = new FormData();
        formData.append('title', titleVal);
        formData.append('category', category);
        formData.append('content', content);
        formData.append('author', myUsername);

        if (imageFile) formData.append('image', imageFile); 
        if (currentLocationData) formData.append('location', JSON.stringify(currentLocationData));
        if (typeof myZoneId !== 'undefined' && myZoneId) {
            formData.append('zoneId', myZoneId); 
        }

        const res = await fetch('/api/posts', {
            method: 'POST',
            body: formData 
        }); 

        if (res.status !== 200) { 
            const d = await res.json(); 
            alert(d.error); 
        } else { 
            closeCreateModal(); 
            titleInput.value = ''; 
            document.getElementById('content').value = ''; 
            document.getElementById('post-image').value = '';
            
            currentView = 'home';
            loadPosts(); 
            showNotification('‚úÖ Create post!', 'fas fa-check-circle', 3000);
        } 
    } catch (error) {
        console.error("Create post error:", error);
    } finally {
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
        setTimeout(() => {
            if (createBtn) {
                createBtn.disabled = false;
                createBtn.style.opacity = '1';
                createBtn.style.cursor = 'pointer';
            }
        }, 15000); // 15000 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ = 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    }
}

        socket.on('new-post', loadPosts); 
        socket.on('delete-post', (id)=>{ 
            delete postStatusMap[id];
            renderPostList();
        }); 
        socket.on('update-post-status', (data) => {
    if (currentView === 'my_active') {
        showMyActivePosts(currentPostPage);
    } else if (currentView === 'my_closed') {
        showMyClosedPosts(currentPostPage);
    } else if (currentView === 'closed') {
        
        loadPosts(); 
    } else {
        loadPosts();
    }
}); 
        
        async function loadTopics(){ 
            const res = await fetch('/api/topics'); 
            if (res.status !== 200) return;
            const c = await res.json(); 
            document.getElementById('category-select').innerHTML = c.map(x => `<option value="${x.id}">${x.name}</option>`).join(''); 
        }

        async function setPostCost(){ 
    if (myAdminLevel < 3) return alert('‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin Level 3 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
    
    const res = await fetch('/api/user-info?username=Admin&currency=USD');
    const data = await res.json();
    const { systemFee, adminFee } = data.postCost;
    
    const systemInput = document.getElementById('system-fee-input');
    const adminInput = document.getElementById('admin-fee-input');
    const totalDisplay = document.getElementById('total-fee-display');
    
    systemInput.value = systemFee;
    adminInput.value = adminFee;
    totalDisplay.innerText = (systemFee + adminFee).toFixed(2) + ' USD';

    const updateTotal = () => {
        const s = parseFloat(systemInput.value) || 0;
        const a = parseFloat(adminInput.value) || 0;
        totalDisplay.innerText = (s + a).toFixed(2) + ' USD';
    };

    systemInput.oninput = updateTotal;
    adminInput.oninput = updateTotal;

    document.getElementById('set-cost-modal').classList.remove('hidden');
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°
async function savePostCost() {
    if (myAdminLevel < 3) return;
    
    const systemFee = parseFloat(document.getElementById('system-fee-input').value);
    const adminFee = parseFloat(document.getElementById('admin-fee-input').value);
    const isFree = document.getElementById('is-free-zone-input').checked; 
    
    const targetZoneId = myZoneId; 

    const t = translations[currentLang];
    
    if (isNaN(systemFee) || isNaN(adminFee) || systemFee < 0 || adminFee < 0) {
        alert(t['alert_invalid_fee']);
        return;
    }

    if (!targetZoneId) {
        alert("Zone ID not found. Please try again.");
        return;
    }
    
    const res = await fetch('/api/admin/set-cost', {
        method: 'POST', 
        headers: { 'Content-Type': 'application/json' }, 
        body: JSON.stringify({ 
            systemFee,
            adminFee,
            isFree, 
            zoneId: targetZoneId,
            requestBy: myUsername 
        })
    });
    
    if (res.status === 200) {
        updateUserInfo(); 
        alert(t['admin_success_set_cost']);
        document.getElementById('set-cost-modal').classList.add('hidden');
    } else {
        const d = await res.json();
        alert(`${t['admin_error_set_cost']}: ${d.error}`);
    }
}

// ‡∏ú‡∏π‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô savePostCost
window.savePostCost = savePostCost;
        
        async function openAdminTopicModal() {
            if (myAdminLevel < 1) { 
				alert('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏™‡πà‡∏ß‡∏ô Admin (Level 1+)');
				return;
			}
            document.getElementById('admin-topic-modal').classList.remove('hidden');
            await fetchAndRenderAdminTopics();
        }

        async function fetchAndRenderAdminTopics() {
    const tableBody = document.querySelector('#admin-topic-table tbody');
    tableBody.innerHTML = '<tr><td colspan="2" style="text-align:center; color:gray;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
    try {
        const response = await fetch(`/api/admin/topics?requestBy=${myUsername}`);
        if (response.status !== 200) {
            tableBody.innerHTML = '<tr><td colspan="2" style="color:red; text-align:center;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÑ‡∏î‡πâ</td></tr>';
            return;
        }
        const topics = await response.json();
        tableBody.innerHTML = '';
        topics.forEach(topic => {
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td style="padding: 8px; border-bottom: 1px solid #eee;">${topic.name} (ID: ${topic.id})</td>
                <td style="padding: 8px; border-bottom: 1px solid #eee;">
                    <button onclick="deleteTopic('${topic.id}', '${topic.name}')" style="
                        background-color: #f44336; 
                        color: white; 
                        border: none; 
                        padding: 5px 10px; 
                        cursor: pointer; 
                        border-radius: 5px;
                        font-size: 1.1em; 
                        line-height: 1; 
                    ">
                        üóëÔ∏è
                    </button>
                </td>
            `;
        });
    } catch (error) {
        console.error('Error fetching admin topics:', error);
    }
}

        async function addTopic() {
    const nameInput = document.getElementById('new-topic-name');
    const name = nameInput.value.trim();
    
    // 1. ‡∏î‡∏∂‡∏á‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•
    const t = translations[currentLang] || translations['th'];

    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•)
    if (!name) {
        alert(t['admin_warn_empty_topic']);
        return;
    }

    try {
        const response = await fetch('/api/admin/topics/manage', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
        action: 'add', 
        name: name,
        requestBy: myUsername // ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
    })
});

        const result = await response.json();
        
        if (result.success) {
            // 3. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏£‡∏≤ ‡πÅ‡∏ó‡∏ô message ‡∏à‡∏≤‡∏Å Server)
            alert(t['admin_success_add_topic']);
            nameInput.value = ''; 
            await fetchAndRenderAdminTopics(); 
            loadTopics(); 
        } else {
            // ‡∏Å‡∏£‡∏ì‡∏µ Error ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Server (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏ä‡πâ t['admin_error_topic'] ‡∏Å‡πá‡πÑ‡∏î‡πâ)
            alert(`${t['admin_error_topic']} ${result.message}`);
        }
    } catch (error) {
        alert('An error occurred while connecting to the server.');
    }
}

        async function deleteTopic(id, name) {
    // 1. ‡∏î‡∏∂‡∏á‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•
    const t = translations[currentLang] || translations['th'];
    
    // 2. ‡πÅ‡∏™‡∏î‡∏á Confirm Box (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏• + ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠)
    const confirmMsg = t['admin_confirm_delete_topic'].replace('[NAME]', name);
    if (!confirm(confirmMsg)) return;

    try {
        const response = await fetch('/api/admin/topics/manage', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
        action: 'delete', 
        id: id,
        requestBy: myUsername // ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
    })
});

        const result = await response.json();
        
        if (result.success) {
            // 3. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏£‡∏≤)
            alert(t['admin_success_delete_topic']);
            await fetchAndRenderAdminTopics(); 
            loadTopics(); 
        } else {
             alert(`${t['admin_error_topic']} ${result.message}`);
        }
    } catch (error) {
        alert('An error occurred while connecting to the server.');
    }
}

        async function deletePost(e, id) {
    e.stopPropagation();
    
    const t = translations[currentLang] || translations['th'];
    
    if (confirm(t['confirm_delete_post'])) { 
        fetch(`/api/posts/${id}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ requestBy: myUsername })
        });
    }
}
    
    // --- PRIVATE CHAT/INBOX FUNCTIONS ---

    function closePrivateChat() {
        document.getElementById('private-chat-modal').classList.add('hidden');
        currentChatPartner = "";
        if (!document.getElementById('user-list-modal').classList.contains('hidden')) {
            openInbox();
        }
    }

    function sendPrivateMessage() {
        const input = document.getElementById('private-chat-input');
        const msg = input.value.trim();
        if(!msg || !currentChatPartner) return; 
        
        socket.emit('private-message', { sender: myUsername, target: currentChatPartner, msg: msg });
        input.value = '';
    }

    async function sendCoinInChat() {
        if (myAdminLevel < 1) return alert('‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ'); 
        const promptText = translations[currentLang]['prompt_transfer_admin'];
        const amount = prompt(`${promptText} ${currentChatPartner}:`);
        if(!amount || isNaN(amount) || parseInt(amount) <= 0) return;
        const parsedAmount = parseInt(amount);

        const res = await fetch('/api/admin/give-coins', { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify({ targetUser: currentChatPartner, amount: parsedAmount, requestBy: myUsername }) 
        });
        
        if (res.status === 200) {
            alert(`‚úÖ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç ${parsedAmount} ‡πÉ‡∏´‡πâ ${currentChatPartner} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        } else {
            const d = await res.json();
            alert(`‚ùå ‡πÇ‡∏≠‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${d.error || res.statusText}`);
        }
    }
    
    async function deductCoinInChat() {
        if (myAdminLevel < 1) return alert('‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ'); 
        const promptText = translations[currentLang]['prompt_deduct_admin'];
        const amount = prompt(`üî¥ ${promptText} ${currentChatPartner}:`);
        if(!amount || isNaN(amount) || parseInt(amount) <= 0) return;
        const parsedAmount = parseInt(amount);

        const res = await fetch('/api/admin/deduct-coins', { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify({ targetUser: currentChatPartner, amount: parsedAmount, requestBy: myUsername, lang: currentLang }) 
        });
        
        if (res.status === 200) {
            alert(`Awaiting confirmation....`);
        } else {
            const d = await res.json();
            alert(`‚ùå : ${d.error || res.statusText}`);
        }
    }

    async function checkAndGo(postId) {
        const res = await fetch(`/api/posts/${postId}`);
        if (res.status === 404) { alert('‚ùå This thread was not found (it may have been deleted).'); return; }
        const post = await res.json();
        
        if (post.isClosed) {
            if (myUsername === 'Admin') {
                if(confirm('üîí This thread is closed (you can access it because you are an admin). Do you want to continue?')) { location.href = `post.html?id=${post.id}`; }
            } else { alert('‚õî This thread has been disabled.'); }
        } else { location.href = `post.html?id=${post.id}`; }
    }
	
	async function refreshModalPostCost(locationData) {
    let locationQuery = '';
    if (locationData && locationData.lat && locationData.lng) {
        locationQuery = `&location=${encodeURIComponent(JSON.stringify(locationData))}`;
    }

    try {
        const response = await fetch(`/api/user-info?username=${myUsername}&currency=${currentCurrency}${locationQuery}`);
        const data = await response.json();
        
        if (data.error || !data.postCost) {
            console.error("Error fetching post cost:", data.error || 'No postCost returned');
            return;
        }

        const modalCostDisplay = document.getElementById('modal-cost-display');
        const modalCostRow = document.getElementById('modal-cost-row'); // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÅ‡∏ñ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ

        // ‚≠ê NEW LOGIC: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ‡∏ü‡∏£‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏à‡∏≤‡∏Å API
        if (data.postCost.isFree === true) {
            if (modalCostDisplay) {
                modalCostDisplay.innerHTML = `<b style="color: #28a745; font-size: 1.2em;">FREE! (This zone is for free posting.)</b>`;
                if (modalCostRow) modalCostRow.style.color = "#28a745"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ñ‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
            }
            return; // ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡πà‡∏≠
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏á‡∏¥‡∏ô) ---
        if (modalCostRow) modalCostRow.style.color = "#e67e22"; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ü‡∏£‡∏µ
        const postCostUSDT = data.postCost.totalCost;
        const systemZone = data.postCost.systemZone !== undefined ? data.postCost.systemZone : 0;
        const adminFee = data.postCost.adminFee !== undefined ? data.postCost.adminFee : 0;
        
        let impliedRate = 1;
        const balanceUSD = parseFloat(data.coins);
        const balanceConverted = parseFloat(String(data.convertedCoins).replace(/,/g, ''));

        if (balanceUSD > 0) {
            impliedRate = balanceConverted / balanceUSD;
        } else {
            impliedRate = (data.currencySymbol === 'USD' || data.currencySymbol === 'USDT') ? 1 : 0;
        }

        const convertedCostVal = postCostUSDT * impliedRate;
        const formattedConvertedCost = convertedCostVal.toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        if (modalCostDisplay) {
            // üö© [‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô USD -> USDT, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô System -> System Zone ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏≤‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å
            modalCostDisplay.innerHTML = 
                `<span style="font-size:1.0em; color:#2364cc; font-weight:normal;">(${systemZone.toFixed(2)} + ${adminFee.toFixed(2)} ${data.currencySymbol})</span>`;
        }

    } catch(e) {
        console.error('Failed to update post cost display:', e);
    }
}

    socket.on('private-history', (history) => {
        const box = document.getElementById('private-chat-messages');
        box.innerHTML = ''; 
        if (history.length === 0) box.innerHTML = '<div class="system-msg">Start a new conversation.</div>';
        else history.forEach(data => appendMessage(data));
        box.scrollTop = box.scrollHeight;
    });

    socket.on('private-message', (data) => {
    // 1. ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏´‡∏°‡πà"
    if (data.target === myUsername && data.sender === 'System' && data.msg.includes('New comment')) {
        showCommentNotification(data.msg, data.postId);
        return;
    }

    // 2. ‡πÄ‡∏£‡∏¥‡πà‡∏° Logic ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó
    const modal = document.getElementById('private-chat-modal');
    const isChatOpen = !modal.classList.contains('hidden');
    
    const sender = String(data.sender || '');
    const target = String(data.target || '');
    const currentPartner = String(currentChatPartner || '');
    const me = String(myUsername || '');

    let isRelevant = false;
    if (sender === currentPartner) isRelevant = true;
    if (sender === me && target === currentPartner) isRelevant = true;
    if (sender === 'System' && currentPartner === 'Admin') isRelevant = true;

    // ‡∏Å‡∏£‡∏ì‡∏µ D: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô Verify
    const isVerifyNotif = (data.sender === 'System' && (data.msgKey === 'VERIFY_PAYMENT_CHAT' || data.msg.includes('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô')));
    if (isVerifyNotif) isRelevant = true;

    // 3. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    if (isChatOpen && isRelevant) {
        // üî• ‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÑ‡∏´‡∏°
        if (data.sender === 'System' && data.msg.includes('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô')) {
            const box = document.getElementById('private-chat-messages');
            const centerHtml = `
                <div style="display: flex; justify-content: center; margin: 15px 0; width: 100%;">
                    <div style="background: rgba(255, 193, 7, 0.1); color: #856404; border: 1px dashed #ffeeba; padding: 5px 15px; border-radius: 15px; font-size: 12px; text-align: center; max-width: 80%;">
                        ${data.msg}
                    </div>
                </div>
            `;
            box.insertAdjacentHTML('beforeend', centerHtml);
        } else {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏ä‡∏ó‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å appendMessage ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
            appendMessage(data);
        }
        
        // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô Scrollbar ‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
        const box = document.getElementById('private-chat-messages');
        if(box) box.scrollTop = box.scrollHeight;

        // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≤
        if (sender !== me) {
            notificationSound.play().catch(()=>{});
        }
        
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Unread
        if (unreadUsers.has(sender)) {
            unreadUsers.delete(sender);
            saveUnreadStatus();
        }

    } else {
        // --- ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á ---
        if (target === me) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô/‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
            const isVerifySystem = (sender === 'System' && (data.msgKey === 'VERIFY_PAYMENT_CHAT' || data.msg.includes('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô')));
            const isFinancial = sender === 'System' && (data.msg.includes('USD') || data.msg.includes('üí∏') || data.msg.includes('Verify Member'));

            if (isVerifySystem) {
                // üî• ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á
                const actualMember = data.msgData ? data.msgData.member : null;
                if (actualMember) {
                    unreadUsers.add(actualMember);
                    notify(data);
                    saveUnreadStatus();
                }
            } else if (isFinancial) {
                localStorage.setItem(`hasNewTransaction_${me}`, 'true');
                document.getElementById('coin-notif-dot').classList.remove('hidden');
                notificationSound.play().catch(()=>{});
            } else {
                if (sender !== 'System') unreadUsers.add(sender);
                else unreadUsers.add('System');
                
                notify(data);
                saveUnreadStatus();
            }

            // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Inbox
            const inboxModal = document.getElementById('user-list-modal');
            if (!inboxModal.classList.contains('hidden')) {
                 const title = document.getElementById('user-list-title').innerText;
                 if (!title.includes('‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')) {
                    openInbox(inboxPage); 
                 }
            }
        }
    }
});




    function appendMessage(data) {
    const box = document.getElementById('private-chat-messages');
    const div = document.createElement('div');
    
    let translatedMsg = data.msg;

    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ---
    if (data.sender === 'System' && data.msgKey) {
        const lang = currentLang;
        const key = data.msgKey;
        const t = translations[lang] || translations['th'];
        const messageTemplateFunc = t[key];

        if (typeof messageTemplateFunc === 'function') {
            translatedMsg = messageTemplateFunc(data.msgData);
        }
    }
    // ----------------------------------------------------

    if (data.sender === 'System') {
        // üî• ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const isVerifyPayment = data.msgKey === 'VERIFY_PAYMENT_CHAT' || translatedMsg.includes('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô');

        if (isVerifyPayment) {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á ‡πÄ‡∏ô‡πâ‡∏ô‡∏™‡∏µ‡∏ó‡∏≠‡∏á/‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£
            div.className = 'system-msg verify-payment-msg'; 
            div.style.textAlign = 'center';
            div.style.width = '100%';
            div.style.margin = '15px 0';
            div.innerHTML = `
                <div style="background: #fff9c4; color: #827717; border: 1px dashed #fbc02d; padding: 10px; border-radius: 10px; display: inline-block; max-width: 90%; line-height: 1.5;">
                    ${translatedMsg}
                </div>
            `;
        } else if (data.postId) {
            // ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            div.className = 'system-msg'; 
            div.innerHTML = `<span class="system-link" onclick="checkAndGo(${data.postId})">${translatedMsg} <br><small>üëâ Go To Topic</small></span>`;
        } else {
            // ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
            div.className = 'system-msg'; 
            div.style.textAlign = 'center';
            div.innerHTML = `<span style="background: #eee; padding: 2px 10px; border-radius: 10px; font-size: 0.85em;">${translatedMsg}</span>`; 
        }
    } else {
        // ‡πÅ‡∏ä‡∏ó‡∏õ‡∏Å‡∏ï‡∏¥
        div.className = 'msg ' + (data.sender === myUsername ? 'my-msg' : 'other-msg');
        div.innerHTML = `<b>${data.sender}:</b> ${translatedMsg}`;
    }
    box.appendChild(div);
}

    function notify(data) {
        notificationSound.play().catch(()=>{});
        document.getElementById('notif-badge').classList.remove('hidden');
        document.title = "üî¥ ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà!";
    }
    
    function openPrivateChat(targetUser) {
        currentChatPartner = targetUser;
        document.getElementById('user-list-modal').classList.add('hidden'); 
        document.getElementById('private-chat-modal').classList.remove('hidden'); 
        document.getElementById('chat-partner-name').innerText = targetUser;
        
        unreadUsers.delete(targetUser);
        saveUnreadStatus();

        if (myAdminLevel >= 1) { 
            document.getElementById('admin-chat-tools').classList.remove('hidden');
        } else {
            document.getElementById('admin-chat-tools').classList.add('hidden');
        }
        
        document.getElementById('private-chat-messages').innerHTML = '<div class="system-msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</div>';
        socket.emit('get-private-history', { me: myUsername, partner: targetUser });
    }

    async function openInbox(page = 1) {
    if (!myUsername) return document.getElementById('login-modal').classList.remove('hidden');

    document.getElementById('user-list-modal').classList.remove('hidden');
    // ‡∏õ‡∏¥‡∏î Sidebar ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
    if(document.getElementById('sidebar').classList.contains('active')) toggleSidebar();
    
    // ‡∏î‡∏∂‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏†‡∏≤‡∏©‡∏≤
    const t = translations[currentLang];
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡∏†‡∏≤‡∏©‡∏≤
    document.getElementById('user-list-title').innerText = t['inbox_title'] || "üí¨ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß";
    document.getElementById('user-list-desc').innerText = t['inbox_desc_recent'] || "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î";
    
    const container = document.getElementById('user-list-container');
    container.innerHTML = `<p style="text-align:center;">‚è≥ ${t['loading'] || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...'}</p>`;
    
    // ‡∏ã‡πà‡∏≠‡∏ô Search Box ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÉ‡∏ô Inbox ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Search ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    document.getElementById('user-search-input').style.display = 'none'; 
    document.getElementById('pagination-controls').style.display = 'none';

    try {
        const res = await fetch(`/api/contacts?username=${myUsername}`);
        const contacts = await res.json();
        
        let html = '';
        let hasAdminContact = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Admin ‡πÑ‡∏´‡∏°

        if (contacts.length === 0) {
            html += `<div style="text-align:center; color:gray; margin-top:20px;">${t['inbox_no_history'] || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤'}</div>`;
        } else {
            html = contacts.map(c => {
                const dot = c.unreadCount > 0 ? `<span class="unread-indicator" style="animation: none;">${c.unreadCount}</span>` : '';
                const style = c.unreadCount > 0 ? 'font-weight:bold; background:#fff8e1;' : '';
                
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                let nameDisplay = `üë§ ${c.partner}`;
                if (c.isAdmin) {
                    hasAdminContact = true; // ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Admin
                    nameDisplay = `üëëÔ∏è <b>${c.partner}</b> ${t['admin_label'] || '(Admin)'}`;
                }

                return `
                    <div class="user-list-item" style="${style}" onclick="openPrivateChat('${c.partner}')">
                        <span>${nameDisplay} ${dot}</span>
                        <span style="color:#007bff; font-size:0.8em;">
                            ${c.lastMessage ? c.lastMessage.substring(0, 15) + '...' : (t['open_chat'] || 'open chat >')}
                        </span>
                    </div>
                `;
            }).join('');
        }

        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö Admin ‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡∏´‡∏≤ Admin ‡πÉ‡∏Å‡∏•‡πâ‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
        if (!hasAdminContact) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            const suggestionId = 'admin-suggestion-box';
            // ‡πÅ‡∏ó‡∏£‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î
            html = `<div id="${suggestionId}" style="margin-bottom:10px;"></div>` + html;
            
            // ‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Async ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏´‡∏≤ Nearest Admin (‡πÑ‡∏°‡πà Block UI ‡∏´‡∏•‡∏±‡∏Å)
            fetchNearestAdminForInbox(suggestionId);
        }

        container.innerHTML = html;

    } catch (e) {
        console.error("Error loading inbox:", e);
        container.innerHTML = `<p style="text-align:center; color:red;">${t['load_failed'] || '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'}</p>`;
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤ Admin ‡πÉ‡∏Å‡∏•‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Inbox (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö i18n)
async function fetchNearestAdminForInbox(elementId) {
    const el = document.getElementById(elementId);
    if (!el) return;
    
    const t = translations[currentLang]; // ‡∏î‡∏∂‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏†‡∏≤‡∏©‡∏≤
    
    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    el.innerHTML = `<div style="padding:10px; background:#f0f9ff; border:1px dashed #007bff; border-radius:8px; text-align:center; font-size:0.9em; color:#007bff;">
        ${t['admin_searching'] || '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...'}
    </div>`;

    // 1. ‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î Default)
    let lat = null, lng = null;
    if (userPrimaryLocation) {
        lat = userPrimaryLocation.lat;
        lng = userPrimaryLocation.lng;
    } else if (currentLocationData) {
        lat = currentLocationData.lat;
        lng = currentLocationData.at;
    }

    // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
    try {
        const query = (lat && lng) ? `?lat=${lat}&lng=${lng}` : '';
        const res = await fetch(`/api/nearest-admin${query}`);
        const data = await res.json();

        if (data.found && data.admin) {
            el.innerHTML = `
                <div class="user-list-item" style="background:#e3f2fd; border:1px solid #90caf9; border-radius:8px;" onclick="openPrivateChat('${data.admin}')">
                    <span>üëëÔ∏è <b>${data.admin}</b> <small style="color:gray;">(${data.zoneName || (t['admin_label'] ? t['admin_label'].replace(/[()]/g, '') : 'Administrator')})</small></span>
                    <span style="color:#007bff; font-weight:bold; font-size:0.8em;">${t['admin_start_chat'] || '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ä‡∏ó‡πÄ‡∏•‡∏¢!'}</span>
                </div>
                <div style="font-size:0.75em; color:gray; text-align:center; margin-top:2px;">${t['admin_recommended_label'] || '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì'}</div>
            `;
        } else {
            el.remove(); // ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏Å‡πá‡∏•‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏¥‡πâ‡∏á
        }
    } catch (e) {
        console.error(e);
        el.remove();
    }
}
    
    let allUsersCache = [];
    
	async function openAllUserList(searchTerm = '', page = 1) {
	currentUserPage = page;
    // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î Modal
    const modal = document.getElementById('user-list-modal');
    if (searchTerm === '' && modal.classList.contains('hidden')) {
        modal.classList.remove('hidden');
        if (document.getElementById('sidebar').classList.contains('active')) toggleSidebar();
        const input = document.getElementById('user-search-input');
        if (input) input.value = '';
    }

    // 2. ‡∏î‡∏∂‡∏á‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    const t = translations[currentLang] || translations['th'];

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ UI ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
    document.getElementById('user-list-title').innerText = t['modal_user_list_title'];
    document.getElementById('user-list-desc').innerText = t['modal_user_list_desc'];
    document.getElementById('pagination-controls').style.display = 'none';
    
    const searchInput = document.getElementById('user-search-input');
    searchInput.style.display = 'block';
    searchInput.placeholder = t['search_placeholder']; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Placeholder ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤

    const container = document.getElementById('user-list-container');

    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Internal)
    const fetchData = async (query) => {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Loading (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Hardcode ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)
        const loadingText = currentLang === 'th' ? '‚è≥ Searching...' : '‚è≥ Searching...';
        container.innerHTML = `<p style="text-align:center;">${loadingText}</p>`;
        
        try {
            // 2. ‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á page ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
            let url = `/api/users-list?requestBy=${myUsername}&page=${page}&limit=50`;
            if (query) url += `&search=${encodeURIComponent(query)}`;

            const res = await fetch(url);
            
            // 3. ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏°‡∏ï‡∏¥ API ‡∏™‡πà‡∏á { users, totalPages })
            const response = await res.json();
            const users = response.users || []; 
            const totalPages = response.totalPages || 1;
			const counts = response.counts || { owned: 0, ref: 0, other: 0 };
            
            // --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
            if (users.length === 0) {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å translations ‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà [NAME] ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                const notFoundMsg = t['msg_user_not_found'].replace('[NAME]', query);
                const noMembersMsg = t['msg_no_members'];

                container.innerHTML = query 
                    ? `<p style='text-align:center; color:#dc3545; margin-top:20px;'>${notFoundMsg}</p>`
                    : `<p style='text-align:center; color:gray;'>${noMembersMsg}</p>`;
                return;
            }
            // ------------------------------------------

            const ownedUsers = users.filter(u => u.relationType === 'OWNED');
            const refUsers = users.filter(u => u.relationType === 'REF');
            const otherUsers = users.filter(u => u.relationType !== 'OWNED' && u.relationType !== 'REF');

            // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÅ‡∏ñ‡∏ß User (‡∏¢‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
            const createRowHTML = (u) => {
                const isBanned = u.isBanned;
                const targetLevel = u.adminLevel || 0;
                const rowStyle = isBanned 
                    ? 'background: #f8d7da; border-left: 5px solid #dc3545;' 
                    : 'background: white; border-left: 5px solid #28a745;';
                
                let levelBadge = targetLevel > 0 
                    ? `<span style="background:#007bff; color:white; padding:1px 5px; border-radius:4px; font-size:0.7em; margin-left:5px;">L${targetLevel}</span>` 
                    : '';
                
                const banBadge = isBanned 
                    ? `<span style="color:red; font-size:0.8em; font-weight:bold; margin-left:5px;">${t['label_banned']}</span>` 
                    : '';
                
                const countryBadge = u.country ? `<small style="color:gray; margin-left:5px;">[${u.country}]</small>` : '';
                
                return `
                    <div class="user-list-item" style="${rowStyle} display:flex; justify-content:space-between; align-items:center; padding: 15px; cursor: pointer; margin-bottom: 5px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);" onclick="openUserDetail('${u.name}')">
                        <div style="font-weight: bold; font-size: 1.1em;">
                             üë§ ${u.name} ${levelBadge} ${banBadge} ${countryBadge}
                        </div>
                        <div style="color:#28a745; font-weight: bold;">
                             üíµ ${u.coins.toLocaleString()} USD
                        </div>
                    </div>`;
            };

            // 3. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á HTML
            let finalHTML = '';

            // --- ‡∏Å‡∏•‡∏∏‡πà‡∏° 1: ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô ---
            if (ownedUsers.length > 0) {
                finalHTML += `
                    <div style="background:#007bff; color:white; padding:8px 15px; border-radius:5px; margin:15px 0 10px 0; font-weight:bold; display:flex; justify-content:space-between; align-items:center;">
                        <span><i class="fas fa-user-shield"></i> My Zone (Direct)</span>
                        <span style="background:rgba(255,255,255,0.2); padding:2px 8px; border-radius:10px; font-size:0.9em;">${counts.owned}</span>
                    </div>`;
                finalHTML += `<div id="owned-list-content">${ownedUsers.map(createRowHTML).join('')}</div>`;
            }

            // --- ‡∏Å‡∏•‡∏∏‡πà‡∏° 2: ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î ---
            if (refUsers.length > 0) {
                finalHTML += `
                    <div class="group-header" onclick="toggleUserGroup('ref-list-content', this)" style="background:#ffc107; color:#333; padding:8px 15px; border-radius:5px; margin:15px 0 10px 0; font-weight:bold; cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                        <span><i class="fas fa-map-marker-alt"></i> üë§ (Ref Location)</span>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span style="background:rgba(0,0,0,0.1); padding:2px 8px; border-radius:10px; font-size:0.9em;">${counts.ref}</span>
                            <i class="fas fa-chevron-down toggle-icon" style="transition: transform 0.3s;"></i>
                        </div>
                    </div>`;
                finalHTML += `<div id="ref-list-content">${refUsers.map(createRowHTML).join('')}</div>`;
            }

            // --- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ) ---
            if (otherUsers.length > 0) {
                finalHTML += `
                    <div class="group-header" onclick="toggleUserGroup('other-list-content', this)" style="color:gray; padding:10px 5px; font-size:0.9em; margin-top:10px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee;">
                        <span>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span>${counts.other} üë§</span>
                            <i class="fas fa-chevron-down toggle-icon" style="transition: transform 0.3s;"></i>
                        </div>
                    </div>`;
                finalHTML += `<div id="other-list-content" style="display: block;">${otherUsers.map(createRowHTML).join('')}</div>`;
            }

            container.innerHTML = finalHTML;
            allUsersCache = users;
			renderPagination(totalPages, page, searchTerm);
        } catch (e) {
            console.error(e);
            container.innerHTML = `<p style='color:red; text-align:center;'>Connection Error</p>`;
        }
    };

    if (searchTerm) {
        clearTimeout(userSearchTimeout);
        userSearchTimeout = setTimeout(() => { fetchData(searchTerm); }, 500); 
    } else {
        fetchData(''); 
    }
}

function renderPagination(totalPages, currentPage, searchTerm) {
    const nav = document.getElementById('pagination-controls');
    if (!nav) return;
    
    nav.style.display = 'flex';
    nav.style.justifyContent = 'center';
    nav.style.padding = '15px';
    nav.style.gap = '10px';

    let navHTML = '';
    if (currentPage > 1) {
        navHTML += `<button class="btn-nav" onclick="openAllUserList('${searchTerm}', ${currentPage - 1})"></button>`;
    }
    
    navHTML += `<span style="align-self:center;">page ${currentPage} / ${totalPages}</span>`;
    
    if (currentPage < totalPages) {
        navHTML += `<button class="btn-nav" onclick="openAllUserList('${searchTerm}', ${currentPage + 1})"></button>`;
    }
    
    nav.innerHTML = navHTML;
}

function toggleUserGroup(contentId, headerElement) {
    const content = document.getElementById(contentId);
    const icon = headerElement.querySelector('.toggle-icon');

    if (!content) return;

    if (content.style.display === "none") {
        content.style.display = "block"; // ‡∏Å‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
        if (icon) icon.style.transform = "rotate(0deg)"; // ‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°
    } else {
        content.style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô
        if (icon) icon.style.transform = "rotate(-90deg)"; // ‡∏´‡∏°‡∏∏‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á
    }
}

		// ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
function openUserDetail(targetUsername) {
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ‡∏à‡∏≤‡∏Å Cache
    const u = allUsersCache.find(user => user.name === targetUsername);
    if (!u) return;

    const modal = document.getElementById('user-detail-modal');
    const isBanned = u.isBanned;
    const targetLevel = u.adminLevel || 0;

    // 1. ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    document.getElementById('detail-name').innerText = u.name;
    document.getElementById('detail-coins').innerText = u.coins.toLocaleString();
    document.getElementById('detail-rating').innerText = u.rating.toFixed(2);

    const postEl = document.getElementById('detail-total-posts');
    const jobEl = document.getElementById('detail-completed-jobs');
    if (postEl) postEl.innerText = u.totalPosts || 0;
    if (jobEl) jobEl.innerText = u.completedJobs || 0;

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Badges
    let badgesHtml = '';
    if (targetLevel > 0) badgesHtml += `<span style="background:#007bff; color:white; padding:4px 8px; border-radius:4px; margin-right:5px;">Admin Level ${targetLevel}</span>`;
    if (isBanned) badgesHtml += `<span style="background:#dc3545; color:white; padding:4px 8px; border-radius:4px;">‚õî BANNED</span>`;
    document.getElementById('detail-badges').innerHTML = badgesHtml;

    // 2. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
    const chatText = currentLang === 'th' ? 'üí¨ ‡πÅ‡∏ä‡∏ó / ‡πÇ‡∏≠‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç' : 'üí¨ Chat / Transfer';
    const ratingText = currentLang === 'th' ? '‚≠ê ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô' : '‚≠ê Set Rating';
    const banText = isBanned ? (currentLang === 'th' ? '‚úÖ ‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô' : '‚úÖ Unban') : (currentLang === 'th' ? '‚ùå ‡πÅ‡∏ö‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' : '‚ùå Ban User');
    const banBtnColor = isBanned ? '#28a745' : '#dc3545';
    
    // --- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏° Reset Status ---
    const resetText = currentLang === 'th' ? 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô' : 'üîÑ Reset Job Status';

    let buttonsHtml = '';

    // ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏ó (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)
    buttonsHtml += `
        <button class="sidebar-btn create-btn" onclick="openPrivateChat('${u.name}'); document.getElementById('user-detail-modal').classList.add('hidden');">
            ${chatText}
        </button>
    `;

    // ‡∏õ‡∏∏‡πà‡∏° Admin (Rate, Ban, Reset Status)
    if (myAdminLevel >= 1) { 
        buttonsHtml += `
            <button class="sidebar-btn admin-btn" style="background:#ffc107; color:black;" onclick="setMemberRating('${u.name}')">
                ${ratingText}
            </button>
            
            <button class="sidebar-btn" style="background:#fd7e14; color:white;" onclick="resetUserJobStatus('${u.name}'); document.getElementById('user-detail-modal').classList.add('hidden');">
                ${resetText}
            </button>

            <button class="sidebar-btn" style="background:${banBtnColor}; color:white;" onclick="toggleBanUser('${u.name}', ${isBanned}); document.getElementById('user-detail-modal').classList.add('hidden');">
                ${banText}
            </button>
        `;
    }

    // ‡∏õ‡∏∏‡πà‡∏° Promote / Demote
    if (myAdminLevel >= 2 && targetLevel < 1) {
        buttonsHtml += `<button class="sidebar-btn" style="background:#17a2b8; color:white;" onclick="setAdminLevel('${u.name}', 1)">üëÆ‚Äç‚ôÇÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin 1</button>`;
    }
    if (myAdminLevel >= 3 && targetLevel < 2) {
        buttonsHtml += `<button class="sidebar-btn" style="background:#6610f2; color:white;" onclick="setAdminLevel('${u.name}', 2)">üë®‚Äçüíº ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin 2</button>`;
    }

    if (typeof myAdminLevel !== 'undefined' && myAdminLevel >= 3 && targetLevel === 2) {
        const lat = u.assignedLocation ? u.assignedLocation.lat : '';
        const lng = u.assignedLocation ? u.assignedLocation.lng : '';
        const hasLoc = u.assignedLocation && u.assignedLocation.lat;

        const btnColor = hasLoc ? '#28a745' : '#17a2b8'; 
        const btnText = hasLoc ? 'üìç ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á' : 'üìç ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á';

        buttonsHtml += `
            <button class="sidebar-btn" 
                onclick="document.getElementById('user-detail-modal').classList.add('hidden'); openSetLocationModal('${u.name}', '${lat}', '${lng}')" 
                style="background: ${btnColor}; color: white; margin-bottom:5px;">
                ${btnText}
            </button>
         `;
    }

    if (myAdminLevel > targetLevel && targetLevel > 0) {
        buttonsHtml += `<button class="sidebar-btn" style="background:#6c757d; color:white;" onclick="setAdminLevel('${u.name}', 0)">‚¨áÔ∏è ‡∏ñ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin</button>`;
    }

    document.getElementById('detail-actions').innerHTML = buttonsHtml;

    const banOptions = document.getElementById('ban-options');
    if (banOptions) banOptions.style.display = 'none';

    modal.classList.remove('hidden');
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
function resetUserJobStatus(targetUsername) {
    if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á ${targetUsername} ‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡πà‡∏≤‡∏á/‡∏õ‡∏£‡∏Å‡∏ï‡∏¥" ?`)) {
        return;
    }
    // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Server
    socket.emit('admin_reset_user_status', { targetUsername: targetUsername });
}

// ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Server (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
socket.on('reset_status_success', (msg) => {
    alert(msg || '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
    // ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fetchUsers() ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
});

	// Google Maps NEW Tab
    function openGoogleMaps(lat, lng) {
        if (!lat || !lng) {
            alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î');
            return;
        }
        const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
        window.open(mapsUrl, '_blank');
    }

    function openSetLocationModal(username, targetLat, targetLng) {
        targetUserForLocation = username;
        document.getElementById('loc-target-user').innerText = username;
        
        const resultDiv = document.getElementById('geo-lookup-result');
        resultDiv.innerHTML = '- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î -';
        resultDiv.style.color = 'gray';
        resultDiv.onclick = null;
        currentAddressName = '';
        currentLat = null;
        currentLng = null;

        const latInput = document.getElementById('input-assign-lat');
        const lngInput = document.getElementById('input-assign-lng');

        const safeLat = (targetLat && targetLat !== 'undefined' && targetLat !== 'null') ? targetLat : '';
        const safeLng = (targetLng && targetLng !== 'undefined' && targetLng !== 'null') ? targetLng : '';
        
        latInput.value = safeLat;
        lngInput.value = safeLng;

        document.getElementById('set-location-modal').classList.remove('hidden');

        if (safeLat && safeLng) {
            triggerGeoLookup();
        }
    }

    // 2. Geo-reverse
    function triggerGeoLookup() {
        const lat = document.getElementById('input-assign-lat').value;
        const lng = document.getElementById('input-assign-lng').value;
        const resultDiv = document.getElementById('geo-lookup-result');

        if (!lat || !lng) {
            resultDiv.innerHTML = '- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö -';
            resultDiv.style.color = 'gray';
            resultDiv.onclick = null;
            return;
        }

        resultDiv.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà...';
        resultDiv.style.color = '#e0a800';
        resultDiv.onclick = null;

        clearTimeout(geoLookupTimeout);

        geoLookupTimeout = setTimeout(async () => {
            const parsedLat = parseFloat(lat);
            const parsedLng = parseFloat(lng);

            if (isNaN(parsedLat) || isNaN(parsedLng)) {
                resultDiv.innerHTML = '‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                resultDiv.style.color = '#dc3545';
                return;
            }
            
            currentLat = parsedLat;
            currentLng = parsedLng;

            try {
                const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`;
                
                const res = await fetch(url, { headers: { 'User-Agent': 'WebboardApp/1.0' } });
                const data = await res.json();

                if (data && data.display_name) {
                    currentAddressName = data.display_name;
                    resultDiv.innerHTML = `
                        <span style="color: #28a745; text-decoration: underline;">
                            ‚úÖ ${data.display_name}
                        </span>
                        <br>
                        <span style="color: #6c757d; font-size: 0.8em; text-decoration: underline;">
                            (${lat}, ${lng})
                        </span>
                    `;
                    resultDiv.style.color = 'inherit';
                } else {
                    currentAddressName = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà';
                    resultDiv.innerHTML = `
                        <span style="color: #dc3545; text-decoration: underline;">
                            ‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ô‡∏µ‡πâ
                        </span>
                        <br>
                        <span style="color: #6c757d; font-size: 0.8em; text-decoration: underline;">
                            (${lat}, ${lng})
                        </span>
                    `;
                    resultDiv.style.color = 'inherit';
                }
                
                resultDiv.onclick = () => openGoogleMaps(currentLat, currentLng);
                
            } catch (e) {
                console.error(e);
                resultDiv.innerHTML = '‚ö†Ô∏è ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ';
                resultDiv.style.color = '#dc3545';
                resultDiv.onclick = null;
            }
        }, 1000); // 1000ms
    }

    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö Server (‡πÉ‡∏ä‡πâ currentLat/Lng/AddressName)
    async function saveAssignedLocation(isDelete = false) {
        if (!targetUserForLocation) return;
        
        let latToSend = document.getElementById('input-assign-lat').value;
        let lngToSend = document.getElementById('input-assign-lng').value;
        let addressNameToSend = currentAddressName; // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏´‡∏≤‡πÄ‡∏à‡∏≠

        if (isDelete) {
            if(!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ç‡∏≠‡∏á ' + targetUserForLocation + ' ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            latToSend = null; lngToSend = null; addressNameToSend = null;
        } else {
            if (!latToSend || !lngToSend) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ Latitude ‡πÅ‡∏•‡∏∞ Longitude');
        }

        try {
            const res = await fetch('/api/admin/set-assigned-location', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    targetUser: targetUserForLocation, 
                    lat: latToSend, 
                    lng: lngToSend,
                    addressName: addressNameToSend,
                    requestBy: myUsername 
                })
            });
            
            const data = await res.json();
            if (data.success) {
                alert(data.message);
                document.getElementById('set-location-modal').classList.add('hidden');
                
                // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤ UI
                if(typeof openAllUserList === 'function') {
                    const detailModal = document.getElementById('user-detail-modal');
                    if(detailModal) detailModal.classList.add('hidden');
                    openAllUserList(document.getElementById('user-search-input').value); 
                }
            } else {
                alert('Error: ' + data.error);
            }
        } catch (e) {
            console.error(e);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
        }
    }
	
	
	
	//‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
	function openZoneOwnerModal() {
    document.getElementById('zone-owner-modal').classList.remove('hidden');
}

function closeZoneOwnerModal() {
    document.getElementById('zone-owner-modal').classList.add('hidden');
}


window.addEventListener('load', async () => {
    const myUsername = localStorage.getItem('username');
    if (!myUsername) return;

    try {
        const res = await fetch(`/api/rider/check-working-status?username=${myUsername}`);
        const data = await res.json();
        
        if (data.success && data.workingJobId) {
            const jobId = data.workingJobId.toString();

            // üö© ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ID ‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏µ‡∏î‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            if (jobId.length > 10) { 
                // ‡∏ñ‡πâ‡∏≤ ID ‡∏¢‡∏≤‡∏ß (‡πÄ‡∏ä‡πà‡∏ô 1767509775865) -> ‡∏î‡∏µ‡∏î‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                window.location.href = `post.html?id=${jobId}`;
            } else {
                // ‡∏ñ‡πâ‡∏≤ ID ‡∏™‡∏±‡πâ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏•‡∏Ç 4-5 ‡∏´‡∏•‡∏±‡∏Å) -> ‡∏î‡∏µ‡∏î‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
                window.location.href = `riderjobmerchant.html?view_id=${jobId}`;
            }
        }
    } catch (e) {
        console.log("Check working status error");
    }
});



//‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏ã‡∏ô
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
async function openCurrencySelectModal(zoneId, zoneName) {
    const { value: formValues } = await Swal.fire({
        title: `‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô: ${zoneName}`,
        html:
            `<div style="text-align:left; font-family:'Kanit',sans-serif;">` +
            `<label style="display:block; margin-bottom:5px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô:</label>` +
            `<select id="swal-currency" class="swal2-input" style="width:100%; margin:0 0 15px 0;">` +
                `<option value="THB">‡∏ø THB (‡∏ö‡∏≤‡∏ó‡πÑ‡∏ó‡∏¢)</option>` +
                `<option value="BRL">R$ BRL (‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡∏ö‡∏£‡∏≤‡∏ã‡∏¥‡∏•)</option>` +
                `<option value="USD">$ USD (‡∏î‡∏≠‡∏•‡∏•‡∏≤‡∏£‡πå)</option>` +
                `<option value="VND">‚Ç´ VND (‡∏î‡∏≠‡∏á‡πÄ‡∏ß‡∏µ‡∏¢‡∏î‡∏ô‡∏≤‡∏°)</option>` +
            `</select>` +
            `<label style="display:block; margin-bottom:5px;">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô (1 USDT = ?):</label>` +
            `<input id="swal-rate" type="number" step="0.01" class="swal2-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 35.00 ‡∏´‡∏£‡∏∑‡∏≠ 5.00" style="width:100%; margin:0;">` +
            `<p style="font-size:0.75em; color:#666; margin-top:5px;">* ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>` +
            `</div>`,
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        preConfirm: () => {
            return {
                currency: document.getElementById('swal-currency').value,
                rate: document.getElementById('swal-rate').value
            }
        }
    });

    if (formValues) {
        if (!formValues.rate || formValues.rate <= 0) {
            Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            return;
        }
        
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà Server (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á API)
        saveZoneCurrency(zoneId, formValues.currency, formValues.rate);
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
async function saveZoneCurrency(zoneId, currency, rate) {
    try {
        const response = await fetch('/api/admin/set-zone-currency', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ zoneId, currency, rate })
        });
        
        const result = await response.json();
        if (result.success) {
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏ã‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${currency} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
            // ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ reload ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ
        } else {
            Swal.fire('‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', result.message, 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ', 'error');
    }
}


/*<button id="bottom-zone-btn" class="sticky-bottom-btn" onclick="openZoneOwnerModal()">
    üöÄ ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô
</button>*/
	//‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
</script>

<div id="comment-notif-modal" class="hidden" style="
        position: fixed; 
        top: 20px; 
        right: 20px; 
        width: 300px; 
        padding: 15px; 
        background: #007bff; 
        color: white; 
        border-radius: 8px; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 3000;
        cursor: pointer;
        font-size: 14px;
        transition: opacity 0.3s ease;
    ">
        <div style="display:flex; align-items:center; gap:10px;">
            <i class="fas fa-bell" style="font-size: 1.5em;"></i>
            <div>
                <div id="notif-content" style="font-weight: 600;">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                </div>
        </div>
    </div>
	
		<div id="admin-zone-modal" class="modal-overlay hidden">
    <div class="modal-box" style="width: 90%; max-width: 500px;">
        
        <div style="display:flex; justify-content:flex-end;">
            <button onclick="closeAdminZoneModal()" style="border:none; background:none; font-size:1.5em; cursor:pointer;">√ó</button>
        </div>
        <h2 style="text-align:center; margin-top:0;">üó∫Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏ã‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (Admin)</h2>

        <div id="view-zone-menu">
            <p style="text-align:center; color:gray;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥</p>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px; margin-bottom: 20px;">
                <button class="sidebar-btn" onclick="goToAddZone()" style="background: #28a745; color: white; width: 140px; height: 100px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px;">
                    <i class="fas fa-plus-circle" style="font-size: 2em;"></i>
                    <span>1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô</span>
                </button>
                
                <button class="sidebar-btn" onclick="goToManageZone()" style="background: #17a2b8; color: white; width: 140px; height: 100px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px;">
                    <i class="fas fa-list-ul" style="font-size: 2em;"></i>
                    <span>2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô</span>
                </button>
            </div>
        </div>

        <div id="view-zone-add" class="hidden">
            <h3 style="text-align:center; color:#28a745;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            <p style="color:gray; font-size:0.9em; text-align:center;">‡πÉ‡∏™‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î Lat/Lng ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡πÇ‡∏ã‡∏ô</p>
            
            <div style="background:#f0f0f0; padding:15px; border-radius:8px; margin-bottom:15px;">
                <label>Latitude:</label>
                <input type="number" id="zone-lat-input-new" placeholder="‡πÄ‡∏ä‡πà‡∏ô 13.7563" step="any" style="width:100%; padding:8px; margin-bottom:10px;">
                
                <label>Longitude:</label>
                <input type="number" id="zone-lng-input-new" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100.5018" step="any" style="width:100%; padding:8px; margin-bottom:10px;">

                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô (Optional):</label>
                <input type="text" id="zone-name-input-new" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏ã‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" style="width:100%; padding:8px;">
            </div>
            
            <div style="display:flex; justify-content:space-between;">
                <button class="sidebar-btn" onclick="backToZoneMenu()" style="background:#6c757d; width:auto;">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π</button>
                <button class="sidebar-btn" onclick="addZoneConfigNew()" style="background:#28a745; color:white; width:auto;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ã‡∏ô</button>
            </div>
        </div>

        <div id="view-zone-list" class="hidden">
            <h3 style="text-align:center; color:#17a2b8;">‚öôÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏ã‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            
            <div id="zone-list-container" style="max-height: 300px; overflow-y: auto; border:1px solid #ddd; padding:10px; border-radius:8px; margin-bottom:15px; background:white;">
                Loading...
            </div>

            <div style="display:flex; justify-content:center;">
                <button class="sidebar-btn" onclick="backToZoneMenu()" style="background:#6c757d; width:auto;">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
            </div>
        </div>

    </div>
</div>

		<div id="admin-assign-modal" class="modal-overlay hidden" style="z-index: 2500;">
    <div class="modal-box">
        <h2 style="text-align: center;" data-i18n-key="modal_assign_title">üë®‚Äçüíº ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏ã‡∏ô</h2>
        <p id="assign-zone-name-display" style="color: #6c757d; text-align: center; margin-bottom: 15px;"></p>
        
        <div id="admin-list-for-assign" style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px;">
            <p style="text-align:center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>

        <div style="margin-top: 20px; display:flex; justify-content:flex-end; gap:10px;">
            <button class="sidebar-btn" onclick="document.getElementById('admin-assign-modal').classList.add('hidden')" style="width:auto;" data-i18n-key="cancel_btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>

		<div id="assigned-zone-map-modal" class="modal-overlay hidden" style="z-index: 2500;">
    <div class="modal-box" style="max-width: 600px;">
        <h2 style="text-align: center;" data-i18n-key="assigned_map_title">üó∫Ô∏è Managed Zones</h2>
        <p id="assigned-zone-info" style="color: #6c757d; text-align: center; font-weight: bold; margin-bottom: 10px;">Zones Under Your Supervision: <span id="assigned-user-display"></span></p>
        
        <div id="assigned-zone-list-display" style="max-height: 300px; overflow-y: auto; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            <p style="text-align:center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>

        <div style="margin-top: 20px; display:flex; justify-content:flex-end;">
            <button class="sidebar-btn" onclick="document.getElementById('assigned-zone-map-modal').classList.add('hidden')" style="width:auto;" data-i18n-key="btn_close">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

	<div id="set-cost-modal" class="modal-overlay hidden">
    <div class="modal-box">
        <h2 data-i18n-key="admin_set_cost_title">üè∑Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ</h2>
        
        <label for="system-fee-input" style="font-weight: bold;" data-i18n-key="label_system_fee">‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏Ç‡πâ‡∏≤ Admin L3):</label>
        <input type="number" step="0.01" id="system-fee-input" placeholder="USD" required>

        <label for="admin-fee-input" style="font-weight: bold;" data-i18n-key="label_admin_fee">‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (‡πÄ‡∏Ç‡πâ‡∏≤ Admin L1/L2):</label>
        <input type="number" step="0.01" id="admin-fee-input" placeholder="USD" required>
        
        <div style="margin: 15px 0; background: #f0fdf4; padding: 12px; border-radius: 8px; border: 1px dashed #22c55e;">
            <label style="display: flex; align-items: center; cursor: pointer; gap: 10px; margin: 0;">
                <input type="checkbox" id="is-free-zone-input" style="width: 20px; height: 20px; cursor: pointer;">
                <span style="font-weight: bold; color: #166534;">‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô "‡πÇ‡∏ã‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ü‡∏£‡∏µ"</span>
            </label>
            <small style="color: #4ade80; display: block; margin-top: 5px;">* ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</small>
        </div>

        <div style="font-size:0.9em; margin-bottom: 15px;">
            <span data-i18n-key="total_fee_display">‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span> <b id="total-fee-display">0.00 USD</b>
        </div>

        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="sidebar-btn" onclick="document.getElementById('set-cost-modal').classList.add('hidden')" style="width:auto;" data-i18n-key="cancel_btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="sidebar-btn create-btn" onclick="savePostCost()" style="width:auto;" data-i18n-key="btn_save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="admin-announcement-modal" class="modal-overlay hidden">
    <div class="modal-box">
        <h2 data-i18n-key="admin_set_announcement">üì¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
        <p style="color:#dc3545; margin-bottom: 15px;" data-i18n-key="modal_announcement_desc">
            ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ
        </p>

        <label for="announcement-input" style="font-weight: bold;" data-i18n-key="label_announcement_text">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®:</label>
        
        <textarea id="announcement-input" rows="3" 
            placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®)"
            data-i18n-key="placeholder_announcement_input"
            style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: 'Kanit';">
        </textarea>

        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="sidebar-btn" onclick="document.getElementById('admin-announcement-modal').classList.add('hidden')" style="width:auto;" data-i18n-key="cancel_btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="sidebar-btn create-btn" onclick="saveAdminAnnouncement()" style="width:auto;" data-i18n-key="btn_save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
        </div>
    </div>
</div>


<div id="set-location-modal" class="modal-overlay hidden" style="z-index: 5000;">
    <div class="modal-box">
        <h3>üìç ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (Geo-Lookup)</h3>
        <p>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: <strong id="loc-target-user" style="color: #007bff;">...</strong></p>
        
        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px solid #ddd;">
            <small style="color: gray;">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î Google Maps):</small>
            <div id="geo-lookup-result" style="color: gray; font-weight: bold; min-height: 20px; cursor: pointer;">
                - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î -
            </div>
        </div>

        <div style="margin-bottom: 15px;">
            <label>Latitude (‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î):</label>
            <input type="number" id="input-assign-lat" step="any" placeholder="‡πÄ‡∏ä‡πà‡∏ô 13.7563" 
                   onkeyup="triggerGeoLookup()"
                   style="width: 100%; padding: 8px; margin-top: 5px;">
        </div>
        <div style="margin-bottom: 15px;">
            <label>Longitude (‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î):</label>
            <input type="number" id="input-assign-lng" step="any" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100.5018" 
                   onkeyup="triggerGeoLookup()"
                   style="width: 100%; padding: 8px; margin-top: 5px;">
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button class="sidebar-btn" onclick="document.getElementById('set-location-modal').classList.add('hidden')" style="background: #6c757d; width: auto;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="sidebar-btn" onclick="saveAssignedLocation()" style="background: #007bff; color: white; width: auto;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î</button>
        </div>
        
        <hr>
        <button class="sidebar-btn" onclick="saveAssignedLocation(true)" style="background: #dc3545; color: white; width: 100%; margin-top: 10px;">üóëÔ∏è ‡∏•‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (Reset)</button>
    </div>
</div>

	<div id="zone-ref-select-modal" class="modal-overlay hidden" style="z-index: 3000;">
    <div class="modal-box">
        <h3 style="text-align: center;">üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å Admin</h3>
        <p style="text-align:center; color:gray; font-size:0.9em;">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Admin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡∏≤‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô<br>‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (Reference) ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏ô‡∏µ‡πâ
        </p>

        <div id="zone-ref-admin-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; margin-top:10px;">
            Loading...
        </div>

        <div style="margin-top: 15px; text-align: right;">
            <button class="sidebar-btn" onclick="document.getElementById('zone-ref-select-modal').classList.add('hidden')" style="width: auto; background: #6c757d;">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

	<div id="zone-management-choice-modal" class="modal-overlay hidden" style="z-index: 2500;">
    <div class="modal-box" style="max-width: 350px; text-align: center;">
        <h3 style="margin-bottom: 20px;"><i class="fas fa-tasks"></i> Manage Zones</h3>
        
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <button class="sidebar-btn" onclick="openAssignedZoneMap()" style="background: #28a745; color: white; padding: 15px; font-size: 1.1em;">
                <i class="fas fa-user-shield"></i> 1. My Zone
            </button>
            
            <button class="sidebar-btn" onclick="openAllZoneManagement()" style="background: #007bff; color: white; padding: 15px; font-size: 1.1em;">
                <i class="fas fa-map-marked-alt"></i> 2. Manage Zones
            </button>
        </div>

        <button class="sidebar-btn" onclick="closeZoneChoiceModal()" style="margin-top: 20px; background: #6c757d; color: white; width: 100%;">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
    </div>
</div>

	
	<div id="assigned-zone-modal" class="modal-overlay hidden" style="z-index: 2600;">
    <div class="modal-box" style="max-width: 600px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <h3 style="margin:0;"><i class="fas fa-map-marked-alt"></i> Zones Under Management</h3>
            <button onclick="document.getElementById('assigned-zone-modal').classList.add('hidden')" 
                    style="background:none; border:none; font-size:1.5em; cursor:pointer;">&times;</button>
        </div>

        <div style="background:#e9ecef; padding:10px; border-radius:8px; margin-bottom:15px; font-weight:bold; color:#495057;">
            üìç Reference Location: <span id="display-ref-location" style="color:#007bff;">-</span>
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background:#f8f9fa; text-align:left;">
                        <th style="padding:10px; border-bottom:2px solid #ddd;">Zone Name</th>
                        <th style="padding:10px; border-bottom:2px solid #ddd;">Coordinates</th>
                        <th style="padding:10px; border-bottom:2px solid #ddd;">Status</th>
                    </tr>
                </thead>
                <tbody id="assigned-zone-list">
                    </tbody>
            </table>
        </div>
        
        <div id="assigned-zone-loading" style="text-align:center; padding:20px; display:none;">
            <i class="fas fa-spinner fa-spin"></i> Loading data...
        </div>

        <div style="margin-top: 20px; text-align: right;">
            <button class="sidebar-btn" onclick="document.getElementById('assigned-zone-modal').classList.add('hidden')" 
                    style="width: auto; background: #6c757d; color: white;">Close</button>
        </div>
    </div>
</div>



	<div id="verify-info-modal" class="modal-overlay hidden">
    <div class="modal-box" style="max-width: 500px; text-align: center; border-radius: 15px;">
        <h2 style="color: #28a745; margin-bottom: 20px;">
            <i class="fas fa-shield-alt"></i> <br>
            Identity Verification / ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
        </h2>
        
        <div style="text-align: left; margin-bottom: 25px; line-height: 1.6; color: #444; font-size: 0.95em;">
            <p style="font-weight: bold; color: #28a745; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                English / ‡πÑ‡∏ó‡∏¢
            </p>
            
            <p>To increase reliability and job opportunities, we recommend verifying your identity with real information. / ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏£‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</p>
            
            <ul style="padding-left: 20px;">
                <li>Build trust with other users. / ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô</li>
                <li>Unrestricted access to all features. / ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î</li>
                <li>Use real ID card or Passport data. / ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô/‡∏û‡∏≤‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï</li>
                <li>Your data is kept strictly confidential. / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</li>
                <li>Must be within 10 meters of the admin. / ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡πÄ‡∏°‡∏ï‡∏£</li>
                <li>Fee: 50 USD (Deducted from system balance). / ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 50 USD (‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)</li>
				<li><b>The identity verification system is not yet enabled....................</b></li>
            </ul>
        </div>

        <div style="display: flex; gap: 10px;">
            <button class="sidebar-btn" onclick="closeVerifyInfo()" style="background: #6c757d; color: white; flex: 1; padding: 12px; border-radius: 8px;">
                Cancel / ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
            <button class="sidebar-btn" onclick="closeVerifyInfo()" style="background: #28a745; color: white; flex: 1; padding: 12px; border-radius: 8px;">
                OK
            </button>
        </div>
    </div>
</div>



	
	
	<div id="verify-confirm-modal" class="modal-overlay hidden">
    <div class="modal-box" style="max-width: 500px; max-height: 90vh; overflow-y: auto;">
        <h2 style="text-align: center;"><i class="fas fa-user-shield"></i> Verify Identity</h2>
        
        <div style="background: #eef6f0; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.85em; color: #28a745; border: 1px solid #c3e6cb;">
            <i class="fas fa-info-circle"></i> This information will be kept confidential and used for verification purposes only.
        </div>

        <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">
            <div>
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Full Name:</label>
                <input type="text" id="verify-fullname" placeholder="Enter full name as shown on ID" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box;">
            </div>

            <div>
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Phone Number:</label>
                <input type="tel" id="verify-phone" placeholder="e.g., +66 8X XXX XXXX" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box;">
            </div>

            <div>
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Current Address:</label>
                <textarea id="verify-address" rows="3" placeholder="House No., Street, District, Province, Postal Code..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box; font-family: inherit;"></textarea>
            </div>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">

            <div>
                <label style="display:block; margin-bottom:5px; font-weight:bold;">1. ID Card / Passport Photo:</label>
                <input type="file" id="verify-id-card" accept="image/*" style="font-size: 0.9em;">
            </div>

            <div>
                <label style="display:block; margin-bottom:5px; font-weight:bold;">2. Selfie with ID Card:</label>
                <input type="file" id="verify-selfie" accept="image/*" style="font-size: 0.9em;">
            </div>
        </div>

        <div style="display: flex; gap: 10px;">
            <button class="sidebar-btn" onclick="closeVerifyConfirm()" style="background: #6c757d; color: white; flex: 1;">Cancel</button>
            <button class="sidebar-btn" onclick="submitIdentityData(event)" style="background: #28a745; color: white; flex: 1;">Submit for Review</button>
        </div>
    </div>
</div>


		
		<div id="admin-members-verify-modal" class="modal-overlay hidden">
    <div class="modal-box" style="max-width: 450px; text-align: center;">
        <h2 style="color: #28a745;"><i class="fas fa-shield-alt"></i> Wait Member Verification</h2>
        <div style="text-align: left; margin-bottom: 20px; line-height: 1.6; color: #555;">
            <p>.......</p>
            <ul>
                <li>......</li>
                <li>......</li>
                <li>......</li>
            </ul>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="sidebar-btn" onclick="adminCloseZoneVerify()" style="background: #6c757d; color: white; flex: 1;">Cancel</button>
            <button class="sidebar-btn" onclick="adminOnGPSVerify()" style="background: #28a745; color: white; flex: 1;">Confirm</button>
        </div>
    </div>
</div>



	<div id="admin-review-modal" class="modal-overlay hidden">
    <div class="modal-box" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
        <h2 style="text-align: center; color: #007bff;"><i class="fas fa-search-location"></i> Review Verification</h2>
        
        <div id="review-content" style="display: flex; flex-direction: column; gap: 15px;">
            </div>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="sidebar-btn" onclick="processApproval('REJECT')" style="background: #dc3545; color: white; flex: 1;">Reject</button>
            <button class="sidebar-btn" onclick="processApproval('APPROVE')" style="background: #28a745; color: white; flex: 1;">Approve & Verify</button>
        </div>
        <button onclick="document.getElementById('admin-review-modal').classList.add('hidden')" style="width: 100%; margin-top: 10px; background: none; border: none; color: #666; cursor: pointer;">Close</button>
    </div>
</div>


	<div id="filter-showds">
    <span id="filter-status"></span>
</div>

<button id="geo-filter-btn" class="sticky-filter-btn hidden" onclick="setDistanceFilter()" title="‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô / ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á">
    <i class="fas fa-route"></i>
</button>

<button id="sticky-create-btn" class="sticky-create-btn hidden" onclick="openCreateModal()" title="Create New Post">
    <i class="fas fa-plus"></i>
</button>

<button id="sticky-shop-btn" onclick="openCreateModal()" title="shoping">
    <i class="fas fa-shopping-cart"></i>
</button>




	
	
	
	
	
	
	
	<div id="zone-owner-modal" class="modal-overlay hidden" style="z-index: 5000;">
    <div class="modal-box" style="max-width: 650px; width: 95%; max-height: 90vh; overflow-y: auto; padding: 0; border-radius: 20px; border: none;">
        
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 30px 20px; text-align: center; color: white;">
            <h2 style="margin: 0; font-size: 1.8em;">GedGoZone</h2>
            <p style="margin: 5px 0 0; opacity: 0.9;">‡∏™‡∏π‡πà‡∏°‡∏¥‡∏ï‡∏¥‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á "‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ñ‡∏¥‡πà‡∏ô"</p>
			<p style="margin: 5px 0 0; opacity: 0.9;">‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á GedGoZone ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì</p>
			<p style="margin: 5px 0 0; opacity: 0.9;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ó‡∏±‡πà‡∏ß‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏®‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <div style="padding: 25px; text-align: left; line-height: 1.7; color: #333;">
            <p style="font-size: 1.1em; font-weight: bold; color: #f5576c; text-align: center;">
                "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‚Äî‡πÑ‡∏£‡πâ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏ô‡∏ö‡∏ó‡∏ó‡∏µ‡πà‡∏´‡πà‡∏≤‡∏á‡πÑ‡∏Å‡∏•
				‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ó‡∏±‡πà‡∏ß‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏®‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
            </p>
            
            <div style="background: #fff5f6; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; border: 1px dashed #f5576c;">
                <b>"‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏ã‡∏ô (Exclusive Zone Ownership): 1 ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Ñ‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"</b><br>
                ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á ‡∏ö‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà "‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô" ‡πÅ‡∏•‡∏∞ "‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á"
            </div>

            <h3 style="color: #333; border-left: 4px solid #f5576c; padding-left: 10px;">üöÄ ‡∏ó‡∏≥‡πÑ‡∏° GedGoZone ‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö?</h3>
            <p>‡πÄ‡∏£‡∏≤‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏•‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î <b>"‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô"</b> ‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏à‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô:</p>
            
            <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 15px;">üìç <b>‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î ‡πÑ‡∏£‡πâ‡∏û‡∏£‡∏°‡πÅ‡∏î‡∏ô:</b> ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡πÇ‡∏ã‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏ô‡∏ö‡∏ó ‡∏Ç‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å GedGoZone ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏¥‡πâ‡∏ß</li>
                <li style="margin-bottom: 15px;">üç± <b>‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå "‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏¥‡∏à":</b> ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ù‡∏≤‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏Å‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ, ‡∏à‡πâ‡∏≤‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏Ñ‡∏¥‡∏ß‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á/‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤</li>
                <li style="margin-bottom: 15px;">üì¶ <b>‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏±‡∏ô:</b> ‡∏Ç‡∏ô‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∏‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏Å‡∏•‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</li>
                <li style="margin-bottom: 15px;">üì© <b>Messenger ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (Round-Trip):</b> ‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ö‡∏ö "‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö" (‡∏ß‡∏¥‡πà‡∏á‡∏£‡∏≠‡∏Å) ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•</li>
            </ul>

            <h3 style="color: #333; border-left: 4px solid #f5576c; padding-left: 10px;">üèóÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£‡πÉ‡∏ô‡∏ô‡∏≤‡∏° "‡∏Ñ‡∏∏‡∏ì"</h3>
            <p>‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞ Zone Owner (Admin Level 1) ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ <b>"‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à"</b> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á:</p>
            <ul style="list-style: none; padding: 0;">
                <li>üí∞ <b>‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£:</b> ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏à‡∏≤‡∏Å "‡∏ó‡∏∏‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡πâ‡∏≤‡∏á" ‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô</li>
				<li>üí∞ <b>‡∏ú‡∏•‡∏Å‡∏≥‡πÑ‡∏£:</b> ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô ‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ</li>
                <li>üì£ <b>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå:</b> ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ã‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏ô‡∏≤‡∏°‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á</li>
                <li>üõ°Ô∏è <b>‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏Å‡∏é:</b> ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à Verify ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡πÅ‡∏•‡∏∞ Ban ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</li>
				<li>üõ°Ô∏è <b>‡∏ú‡∏π‡πâ‡∏Ñ‡∏∏‡∏°‡∏Å‡∏é:</b> ‡πÇ‡∏ã‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</li>
            </ul>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-top: 20px;">
                <h4 style="margin-top: 0; color: #f5576c;">‚è≥ ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß!</h4>
                <p style="font-size: 0.9em; margin-bottom: 0;">
                    ‚Ä¢ <b>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</b> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß<br>
                    ‚Ä¢ <b>‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á:</b> ‡∏ó‡∏∏‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
					‚Ä¢ <b>‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏ã‡∏ô:</b> ‡πÄ‡∏à‡πâ‡∏≤‡πÇ‡∏ã‡∏ô‡∏≠‡∏≤‡∏à‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡πÑ‡∏î‡πâ2-3‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÅ‡∏ï‡πà‡∏ö‡∏≤‡∏á‡πÇ‡∏ã‡∏ô‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà1‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                </p>
            </div>

            <p style="text-align: center; font-weight: bold; margin-top: 25px; font-size: 1.1em;">
                "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ó‡∏±‡πà‡∏ß‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏®‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
				(‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ó‡∏ô)
            </p>
        </div>

        <div style="padding: 20px; background: #f8f9fa; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; display: flex; flex-direction: column; gap: 10px;">
            <a href="https://www.facebook.com/aoy.fostible/" target="_blank" style="text-decoration: none;">
                <button class="sidebar-btn" style="width: 100%; background: #1877f2; color: white; padding: 15px; border: none; font-size: 1.1em; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fab fa-facebook-messenger"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏£‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!
                </button>
            </a>
            <button onclick="closeZoneOwnerModal()" style="background: none; border: none; color: #888; cursor: pointer; padding: 10px;">‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏≤‡∏ß‡∏´‡∏•‡∏±‡∏á</button>
        </div>
    </div>
</div>






	


</div>
	
</body>
</html>