<!DOCTYPE html>
<html lang="th">
<head>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="GedGo">
	<meta name="mobile-web-app-capable" content="yes">
	
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GedGo! - Profile & Verification</title>
	<script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/all.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	
    <style>
        :root { --primary: #11998e; --secondary: #38ef7d; --dark: #2c3e50; --danger: #e74c3c; }
        body { font-family: 'Kanit', sans-serif; background: #f8fafc; margin: 0; padding: 0; }
        
        /* Header ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà */
        .header { 
            background: linear-gradient(135deg, var(--primary), var(--secondary)); 
            color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            border-radius: 0 0 20px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header a { color: white; text-decoration: none; font-size: 0.9em; display: flex; align-items: center; gap: 5px; }
        
        .container { padding: 15px; max-width: 450px; margin: 0 auto; }
        
        .profile-main { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .avatar { font-size: 60px; }
        .username { font-size: 1.3em; font-weight: bold; color: var(--dark); margin: 5px 0; }

        .icon-stats { display: flex; justify-content: center; gap: 30px; margin: 15px 0; padding: 10px; border-top: 1px solid #f0f0f0; }
        .stat-item i { font-size: 1.0em; color: var(--primary); display: block; margin-bottom: 5px; }
        .stat-item span { font-weight: bold; }
        .stat-label { font-size: 0.7em; color: #999; display: block; }

        .wallet-bar { 
            background: var(--dark); color: white; padding: 12px; border-radius: 12px; 
            display: flex; justify-content: space-between; align-items: center;
        }
        
        /* Menu List */
        .menu-list { margin-top: 20px; }
        .menu-item { 
            display: flex; align-items: center; padding: 14px 15px; background: white; 
            margin-bottom: 10px; border-radius: 12px; text-decoration: none; color: #444; 
            border: 1px solid #f0f0f0; font-size: 0.95em; cursor: pointer;
        }
        .menu-item i { width: 25px; color: var(--primary); font-size: 1.1em; }
        .verify-btn { background: #fff9e6; border: 1px solid #f1c40f; }
        .verify-btn i { color: #f1c40f; }

        /* Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; width: 90%; max-width: 400px; margin: 20px auto; border-radius: 20px; padding: 20px; }
        .upload-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin: 15px 0; }
        .upload-box { border: 2px dashed #ccc; padding: 15px; text-align: center; border-radius: 10px; cursor: pointer; position: relative; }
        .upload-box i { font-size: 20px; color: #999; }
        .upload-box p { font-size: 10px; margin: 5px 0 0; }
        .upload-box input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        .proximity-alert { 
            background: #fff5f5; border: 1px solid #feb2b2; color: #c53030; 
            padding: 10px; border-radius: 10px; font-size: 0.8em; margin-top: 15px; text-align: center;
        }
        .btn-submit { 
            width: 100%; padding: 12px; background: #ccc; color: white; border: none; 
            border-radius: 10px; font-weight: bold; margin-top: 15px; cursor: not-allowed; 
        }
        .btn-active { background: var(--primary); cursor: pointer; }
		
		
		
	/* Sidebar Styles */
.sidebar {
    position: fixed;
    top: 0;
    left: -280px; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
    width: 280px;
    height: 100%;
    background: white;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    z-index: 1100;
    transition: 0.3s ease;
    display: flex;
    flex-direction: column;
}

.sidebar.active {
    left: 0; /* ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ */
}

.sidebar-header {
    padding: 20px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    text-align: center;
}

.sidebar-content {
    padding: 15px;
    flex: 1;
    overflow-y: auto;
}

/* Overlay ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    z-index: 1050;
}

.sidebar-overlay.active {
    display: block;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô Header */
.menu-trigger {
    cursor: pointer;
    font-size: 1.2em;
    margin-right: 10px;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô sidebar ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô */
.sidebar .menu-item {
    margin-bottom: 8px;
    border: none;
    border-bottom: 1px solid #f0f0f0;
    border-radius: 0;
}




/* --- ‡πÅ‡∏ú‡πà‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π (Overlay) --- */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1100;
    opacity: 0;
    visibility: hidden;
    transition: 0.3s;
    backdrop-filter: blur(2px);
}
.sidebar-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* --- ‡∏ï‡∏±‡∏ß‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π (Sidebar) --- */
.sidebar {
    position: fixed;
    top: 0;
    left: -280px; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
    width: 260px;
    height: 100%;
    background: white;
    z-index: 1200;
    transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
}
.sidebar.active {
    left: 0; /* ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ */
}

/* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ Sidebar */
.sidebar-header {
    padding: 30px 20px;
    background: var(--dark);
    color: white;
    text-align: center;
}

/* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π */
.sidebar-menu {
    flex: 1;
    padding: 15px 0;
}
.nav-item {
    padding: 15px 25px;
    display: flex;
    align-items: center;
    gap: 15px;
    color: #444;
    text-decoration: none;
    cursor: pointer;
    transition: 0.2s;
    border-left: 4px solid transparent;
}
.nav-item:hover {
    background: #f0fdf4;
    color: var(--primary);
    border-left-color: var(--primary);
}
.nav-item i {
    width: 20px;
    text-align: center;
}




/* --- KYC Modal Styles --- */
.modal {
    display: none; position: fixed; z-index: 2000;
    left: 0; top: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
}
.modal-content {
    background-color: #fff; margin: 0; width: 100%; height: 100%;
    padding: 30px; box-sizing: border-box; overflow-y: auto;
    animation: slideUp 0.3s ease-out;
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

.upload-grid { display: flex; gap: 15px; margin: 15px 0; }
.upload-box {
    flex: 1; border: 2px dashed #ddd; border-radius: 15px;
    padding: 20px; text-align: center; color: #999;
    position: relative; transition: 0.3s;
}
.upload-box:hover { border-color: var(--primary); color: var(--primary); }
.upload-box input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
.upload-box i { font-size: 2em; margin-bottom: 10px; }

.proximity-alert {
    background: #fff8e1; border: 1px solid #ffe082;
    padding: 15px; border-radius: 12px; color: #856404;
    font-size: 0.9em; margin: 20px 0; text-align: center;
}
.btn-submit {
    width: 100%; padding: 15px; border: none; border-radius: 12px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white; font-weight: bold; font-size: 1.1em; cursor: pointer;
}
.btn-submit:disabled { background: #ccc; cursor: not-allowed; }



.kyc-label {
    font-size: 0.85em; 
    font-weight: bold; 
    color: #444; 
    display: block; 
    margin-top: 10px;
}
.kyc-input {
    width: 100%; 
    padding: 12px; 
    margin: 5px 0 10px; 
    border: 1px solid #ddd; 
    border-radius: 10px; 
    box-sizing: border-box;
    font-family: 'Kanit', sans-serif;
}
.kyc-input:focus { border-color: var(--primary); }
.kyc-input:disabled { background: #f1f5f9; color: #64748b; cursor: not-allowed; }

.upload-box {
    position: relative;
    width: 100%;
    border-radius: 15px;
    transition: all 0.3s ease;
    background-repeat: no-repeat;
}
.swal2-container {
    z-index: 100000 !important;
}





    </style>
</head>
<body>

<div class="header">
    <div style="display: flex; align-items: center;">
        <i class="fas fa-bars menu-trigger" onclick="toggleSidebar()"></i>
    </div>
    <span style="font-weight: bold;">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
    <a href="index.html"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
</div>

<div class="container">
    <div class="profile-main">
        <div class="avatar">üë§</div>
        <p class="username" id="display-name">Guest</p>
        
        <div class="icon-stats">
            <div class="stat-item"><i class="fas fa-clipboard-list"></i><span id="count-post"> 0</span><span class="stat-label"></span></div>
            <div class="stat-item"><i class="fas fa-check-double"></i><span id="count-job"> 0</span><span class="stat-label"></span></div>
            <div class="stat-item"><i class="fas fa-star" style="color: #f1c40f;"></i><span id="count-rating"> 5.0</span><span class="stat-label"></span></div>
        </div>

        <div class="wallet-bar" style="cursor: default;">
    <div style="display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-wallet" style="font-size: 0.9em; opacity: 0.8;"></i>
        <span style="font-size: 0.8em; opacity: 0.8;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô:</span>
        <button onclick="openRequestTopup()" 
                style="background: #38ef7d; border: none; color: #114b46; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; transition: 0.2s;"
                onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    <div style="text-align: right;">
        <span id="display-balance-usd" style="font-weight: bold; font-size: 1.1em;">0.00 USD</span>
        <span id="display-balance-thb" style="font-size: 0.7em; opacity: 0.7; margin-left: 5px;">(0.00 THB)</span>
    </div>
</div>


	<div id="zone-info-box" style="margin-top: 15px; padding: 12px; background: #fff; border: 1px solid #eee; border-radius: 15px; text-align: left; display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.02);">
    <div style="background: #e8f5e9; color: #11998e; width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">
        <i class="fas fa-map-marker-alt"></i>
    </div>
    <div style="flex: 1;">
        <div style="font-size: 0.7em; color: #999; text-transform: uppercase; letter-spacing: 0.5px;">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
        <div id="display-zone-name" style="font-weight: bold; color: var(--dark); font-size: 0.95em;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏ã‡∏ô...</div>
        <div style="font-size: 0.75em; color: #666; margin-top: 2px;">
            <i class="fas fa-user-shield" style="font-size: 0.9em; color: #f1c40f;"></i> ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô: 
            <span id="display-zone-admin" style="font-weight: bold; color: var(--primary);">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
        </div>
    </div>
</div>



<div id="topup-request-modal" class="modal">
    <div class="modal-content" style="max-width: 320px; text-align: center;">
        <div style="font-size: 40px; color: #f1c40f; margin-bottom: 10px;"><i class="fas fa-hand-holding-usd"></i></div>
        <h3 style="margin: 0 0 10px;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</h3>
        <p style="font-size: 0.8em; color: #666; margin-bottom: 15px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (USD) ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°</p>
        
        <div style="position: relative; margin-bottom: 20px;">
            <input type="number" id="request-amount-input" placeholder="0.00" 
                   style="width: 100%; padding: 12px 15px; border: 2px solid #eee; border-radius: 12px; font-size: 1.5em; text-align: center; box-sizing: border-box; outline: none; font-weight: bold; color: #2c3e50;">
            <span style="position: absolute; right: 15px; top: 15px; font-weight: bold; color: #999;">USD</span>
        </div>

        <div style="display: flex; gap: 10px;">
            <button onclick="closeRequestTopup()" style="flex: 1; padding: 12px; background: #eee; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: #666;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button onclick="submitTopupRequest()" style="flex: 1; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
        </div>
    </div>
</div>

        <div class="menu-list">
    <div id="kyc-menu-container">
        <div class="menu-item verify-btn" onclick="openKYC()">
            <i class="fas fa-id-card"></i>
            <div style="text-align: left; flex: 1;">
                <div style="font-weight: bold;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (KYC)</div>
                <div style="font-size: 0.7em; color: #b58900;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô</div>
            </div>
            <i class="fas fa-chevron-right" style="font-size: 0.8em; color: #ccc;"></i>
        </div>
    </div>

    <a href="#" class="menu-item"><i class="fas fa-envelope"></i> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: <span id="display-email" style="margin-left:5px; color:#999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</span></a>
    <a href="#" class="menu-item"><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</a>
    <a href="javascript:logout()" class="menu-item" style="color: var(--danger); border-color: #ffeaea;"><i class="fas fa-power-off"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
</div>

    </div>
</div>



<script>
	const socket = io();
	let currentZoneAdmin = null;
	let isKYCPending = false;
	let currentKYCRequestId = null;
	
	function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
}

    function closeKYC() { document.getElementById('kyc-modal').style.display = 'none'; }

    // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏à‡∏∞‡πÉ‡∏ä‡πâ Geolocation API)
    function checkProximity() {
        const isNear = false; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ 20m
        const btn = document.getElementById('btn-kyc-submit');
        if(isNear) {
            btn.disabled = false;
            btn.classList.add('btn-active');
            btn.innerText = "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô";
        }
    }

    window.onload = async () => {
    const myName = localStorage.getItem('myUsername');
    if (!myName) {
        window.location.href = 'index.html';
        return;
    }

    document.getElementById('display-name').innerText = myName;

    try {
        const savedLoc = localStorage.getItem('userPrimaryLocation');
        let locationParam = '';
        if (savedLoc) locationParam = `&location=${encodeURIComponent(savedLoc)}`;

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á
        const res = await fetch(`/api/profile-details?username=${myName}${locationParam}`);
        const data = await res.json();

        if (data.error) throw new Error(data.error);

        // 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡πÉ‡∏ä‡πâ || 0 ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error .toFixed)
        document.getElementById('count-post').innerText = data.totalPosts || 0;
        document.getElementById('count-job').innerText = data.completedJobs || 0;
		document.getElementById('count-rating').innerText = data.rating || 0;
        
        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà API ‡∏™‡πà‡∏á‡∏°‡∏≤ (BRL, THB, USD)
        const balance = data.coins || 0;
        const currency = data.currency || 'USD';
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        const balanceElem = document.getElementById('display-balance-usd');
        if (balanceElem) {
            balanceElem.innerText = `${balance.toFixed(2)} ${currency}`;
        }
        
        // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ã‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô
        document.getElementById('display-zone-name').innerText = data.zoneName;
        document.getElementById('display-zone-admin').innerText = data.zoneOwner;

        // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        document.getElementById('display-email').innerText = data.email;

    } catch (err) {
        console.error("Load Profile Error:", err);
        document.getElementById('display-zone-name').innerText = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
    }

    checkProximity();
	
	// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
async function checkKYCStatusFromServer() {
    const myName = localStorage.getItem('myUsername');
    if (!myName) return;

    try {
        const res = await fetch(`/api/kyc/my-status?username=${myName}`);
        const data = await res.json();

        if (data.status === 'pending' || data.status === 'approved') {
            // 1. ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Server ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Summary
            document.getElementById('sum-name').innerText = data.details.fullName;
            document.getElementById('sum-id').innerText = data.details.idNumber;
            document.getElementById('sum-phone').innerText = data.details.phone;
            document.getElementById('sum-address').innerText = data.details.address;
            
            if (data.details.userImg) {
                document.getElementById('summary-img-preview').style.backgroundImage = `url(${data.details.userImg})`;
            }

            document.getElementById('admin-status-text').innerHTML = 
                data.status === 'pending' 
                ? `‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà <b>${data.adminName}</b> ‡πÅ‡∏•‡πâ‡∏ß<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏û‡∏ö`
                : `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÇ‡∏î‡∏¢ <b>${data.adminName}</b>`;

            // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
            updateKYCMenuUI(data.status, data.adminName);
            
            // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏á localStorage (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ status ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Script ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ)
            localStorage.setItem('kyc_status', data.status);
            
            // 4. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢
            socket.emit('joinRequest', myName);
        } else {
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (status: 'none')
            localStorage.removeItem('kyc_status');
            updateKYCMenuUI('normal'); 
        }
    } catch (err) {
        console.error("‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ KYC ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
    }
}
checkKYCStatusFromServer();
};


    function logout() {
        if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
            localStorage.clear();
            window.location.href = 'index.html';
        }
    }
	
	
	// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ (‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
function previewImg(input) {
    if (input.files && input.files[0]) {
        const box = input.parentElement;
        box.style.borderColor = "#11998e";
        box.style.background = "#e8f5e9";
        box.querySelector('i').style.color = "#11998e";
        box.querySelector('p').innerText = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ‚úÖ";
    }
}

// ‡∏Ç‡∏¢‡∏≤‡∏¢ Logic ‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
function updateKycStatus(isNear) {
    const btn = document.getElementById('btn-kyc-submit');
    if(isNear) {
        btn.disabled = false;
        btn.classList.add('btn-active');
        btn.innerHTML = '<i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô';
    } else {
        btn.disabled = true;
        btn.classList.remove('btn-active');
        btn.innerHTML = '<i class="fas fa-lock"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á...)';
    }
}




// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î Modal
function closeRequestTopup() {
    document.getElementById('topup-request-modal').style.display = 'none';
    document.getElementById('request-amount-input').value = '';
}


//‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
function openKYC() {
    const modal = document.getElementById('kyc-modal');
    const formView = document.getElementById('kyc-form-view');
    const summaryView = document.getElementById('kyc-summary-view');
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Server
    const status = localStorage.getItem('kyc_status');

    if (status === 'pending' || status === 'approved') {
        formView.style.display = 'none';
        summaryView.style.display = 'block';
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó
        const myName = localStorage.getItem('myUsername');
        loadKYCUserChatHistory(myName);
    } else {
        formView.style.display = 'block';
        summaryView.style.display = 'none';
    }

    modal.style.display = 'block';
}

function closeKYC() {
    document.getElementById('kyc-modal').style.display = 'none';
}

function previewKYCImg(input) {
    const container = document.getElementById('preview-container');
    const text = document.getElementById('upload-text');
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            container.style.backgroundImage = `url(${e.target.result})`;
            container.style.backgroundSize = 'cover';
            container.style.backgroundPosition = 'center';
            text.style.display = 'none';
            container.querySelector('i').style.display = 'none';
            validateKYC();
        };
        reader.readAsDataURL(input.files[0]);
    }
}



function validateKYC() {
    const name = document.getElementById('full-name').value;
    const idNum = document.getElementById('id-number').value;
    const phone = document.getElementById('phone-number').value;
    const address = document.getElementById('home-address').value;
    const file = document.getElementById('kyc-file').files.length;
    const btn = document.getElementById('btn-kyc-submit');

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
    if (name.trim() !== "" && idNum.length === 13 && phone.length >= 10 && address.trim() !== "" && file > 0) {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-check-circle"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö';
    } else {
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-lock"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö';
    }
}

async function submitKYC() {
    const confirm = await Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?',
        text: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#11998e',
        cancelButtonText: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
    });

    if (confirm.isConfirmed) {
        if (!navigator.geolocation) {
            return Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS', 'error');
        }

        Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î...',
            allowOutsideClick: false,
            didOpen: () => { Swal.showLoading(); }
        });

        navigator.geolocation.getCurrentPosition(async (position) => {
            const userCoords = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            // 3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 
            const name = document.getElementById('full-name').value;
            const idNum = document.getElementById('id-number').value;
            const phone = document.getElementById('phone-number').value;
            const address = document.getElementById('home-address').value;
            
            const imgContainer = document.getElementById('preview-container');
            let userImgData = "";
            
            if (imgContainer && imgContainer.style.backgroundImage) {
                const rawBase64 = imgContainer.style.backgroundImage.slice(5, -2);
                Swal.update({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...' });
                userImgData = await resizeImage(rawBase64, 800, 0.6); 
            }
            
            const adminNameElement = document.getElementById('display-zone-admin');
            let adminName = adminNameElement ? adminNameElement.innerText : "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÇ‡∏ã‡∏ô";

            if (adminName === "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠" || adminName === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏ã‡∏ô...") {
                return Swal.fire({
                    icon: 'warning',
                    title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏ã‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠',
                    confirmButtonColor: '#11998e'
                });
            }

            // 4. ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô Socket (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ username ‡∏™‡πà‡∏á‡πÑ‡∏õ)
            socket.emit('submit-kyc', {
                username: localStorage.getItem('myUsername'), // ‚úÖ ‡∏™‡πà‡∏á username ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô null
                fullName: name,
                idNumber: idNum,
                phone: phone,
                address: address,
                coords: userCoords,
                adminName: adminName,
                userImg: userImgData
            });

            // 5. ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤
            Swal.fire({
                icon: 'success',
                title: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                text: `‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${adminName} ‡πÅ‡∏•‡πâ‡∏ß`,
                confirmButtonColor: '#11998e'
            }).then(() => {
				localStorage.setItem('kyc_status', 'pending');
				localStorage.setItem('kyc_admin', adminName);
				localStorage.setItem('kyc_name', name);
				localStorage.setItem('kyc_id', idNum);
				localStorage.setItem('kyc_phone', phone);
				localStorage.setItem('kyc_address', address);
				localStorage.setItem('kyc_img', userImgData);
                document.getElementById('kyc-form-view').style.display = 'none';
                document.getElementById('kyc-summary-view').style.display = 'block';
                
                // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ username ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                const myName = localStorage.getItem('myUsername');
                currentKYCRequestId = myName; 
                socket.emit('joinRequest', myName); // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
                loadKYCUserChatHistory(myName);    // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á

                document.getElementById('sum-name').innerText = name;
				document.getElementById('sum-id').innerText = idNum; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
				document.getElementById('sum-phone').innerText = phone;
				document.getElementById('sum-address').innerText = address; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢
				document.getElementById('summary-img-preview').style.backgroundImage = `url(${userImgData})`;
				document.getElementById('admin-status-text').innerHTML = `‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á <b>${adminName}</b> ‡πÅ‡∏•‡πâ‡∏ß (‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ñ‡∏π‡∏Å‡πÅ‡∏ô‡∏ö‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠)`;
                
                updateKYCMenuUI('pending', adminName);
            });

        }, (err) => {
            Swal.fire('‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS', 'error');
        });
    }
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
async function resizeImage(base64Str, maxWidth = 800, quality = 0.7) {
    return new Promise((resolve) => {
        const img = new Image();
        img.src = base64Str;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô maxWidth
            if (width > maxWidth) {
                height = (maxWidth / width) * height;
                width = maxWidth;
            }

            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Base64 ‡πÅ‡∏ö‡∏ö JPEG ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (0.0 - 1.0)
            const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
            resolve(compressedBase64);
        };
    });
}






function previewKYCImg(input) {
    const container = document.getElementById('preview-container');
    const placeholder = document.getElementById('upload-placeholder');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            // ‡πÉ‡∏ä‡πâ backgroundImage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ Crop ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° (Object-fit: cover)
            container.style.backgroundImage = `url('${e.target.result}')`;
            container.style.backgroundSize = 'cover';
            container.style.backgroundPosition = 'center';
            container.style.border = '2px solid var(--primary)'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏£‡∏π‡∏õ
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô placeholder
            placeholder.style.display = 'none';
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏° submit
            validateKYC();
        };
        
        reader.readAsDataURL(input.files[0]);
    }
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÄ‡∏°‡∏ô‡∏π KYC ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
function updateKYCMenuUI(status, adminName = "") {
    const container = document.getElementById('kyc-menu-container');
    if (!container) return;

    if (status === 'pending') {
        container.innerHTML = `
            <div class="menu-item" onclick="openKYC()" style="background: #fff8e1; border-color: #ffe082; display: flex; align-items: center; gap: 12px; padding: 15px; border-radius: 12px; border: 1px solid #ffe082; margin-bottom: 10px;">
                <div style="background: #f39c12; color: white; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2em;">
                    <i class="fas fa-clock"></i>
                </div>
                <div style="text-align: left; flex: 1;">
                    <div style="font-weight: bold; color: #af8600;">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                    <div style="font-size: 0.75em; color: #666;">‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á: <b>${adminName}</b></div>
                    <div style="font-size: 0.7em; color: #999;">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ</div>
                </div>
                <span style="font-size: 0.65em; background: #f39c12; color: white; padding: 2px 8px; border-radius: 10px; font-weight: bold;">Waiting</span>
            </div>
        `;
    } else if (status === 'approved') {
        container.innerHTML = `
            <div class="menu-item" onclick="openKYC()" style="background: #e8f5e9; border-color: #c8e6c9; display: flex; align-items: center; gap: 12px; padding: 15px; border-radius: 12px; border: 1px solid #c8e6c9; margin-bottom: 10px;">
                <div style="background: #2e7d32; color: white; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2em;">
                    <i class="fas fa-check-double"></i>
                </div>
                <div style="text-align: left; flex: 1;">
                    <div style="font-weight: bold; color: #2e7d32;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>
                    <div style="font-size: 0.75em; color: #4caf50;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÇ‡∏î‡∏¢: ${adminName}</div>
                    <div style="font-size: 0.7em; color: #666;">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡∏π‡∏á</div>
                </div>
                <i class="fas fa-shield-alt" style="color: #2e7d32; font-size: 1.2em;"></i>
            </div>
        `;
    }
}




//‡πÅ‡∏ä‡∏ó KYC
function sendKYCUserMessage() {
    const input = document.getElementById('kyc-user-input');
    const message = input.value.trim();
    const myName = localStorage.getItem('myUsername');
    
    if (!message || !myName) return;

    const chatData = {
        requestId: myName,
        sender: myName,
        message: message,
        type: 'text',
        category: 'kyc'
    };

    socket.emit('sendMessage', chatData);
    appendKYCUserChatMessage(chatData);
    input.value = '';
}

async function loadKYCUserChatHistory(requestId) {
    const chatBox = document.getElementById('kyc-user-chat-box');
    try {
        const res = await fetch(`/api/kyc/chat-history?requestId=${requestId}`);
        const history = await res.json();
        chatBox.innerHTML = '';
        if (Array.isArray(history)) {
            history.forEach(msg => appendKYCUserChatMessage(msg));
        }
    } catch (err) {
        console.warn("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó KYC");
    }
}

// 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
function appendKYCUserChatMessage(msg) {
    const chatBox = document.getElementById('kyc-user-chat-box');
    if (!chatBox) return;

    const myName = localStorage.getItem('myUsername');
    const isMe = msg.sender === myName;
    
    const msgHTML = `
        <div style="display: flex; flex-direction: column; align-items: ${isMe ? 'flex-end' : 'flex-start'}; margin-bottom: 5px;">
            <div style="background: ${isMe ? 'var(--primary)' : '#f1f5f9'}; 
                        color: ${isMe ? 'white' : 'var(--dark)'}; 
                        padding: 8px 12px; border-radius: 12px; 
                        max-width: 85%; font-size: 0.85em;
                        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
                        border: ${isMe ? 'none' : '1px solid #e2e8f0'};">
                ${msg.message}
            </div>
            <small style="font-size: 0.6em; color: #94a3b8; margin-top: 2px;">
                ${isMe ? '‡∏Ñ‡∏∏‡∏ì' : '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô'}
            </small>
        </div>
    `;
    chatBox.innerHTML += msgHTML;
    chatBox.scrollTop = chatBox.scrollHeight;
}

// 5. ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Real-time
socket.on('receiveMessage', (msg) => {
    const myName = localStorage.getItem('myUsername');
    if (msg.requestId === myName && msg.sender !== myName) {
        appendKYCUserChatMessage(msg);
    }
});


function updateCurrentLocation() {
    const myName = localStorage.getItem('myUsername');
    
    Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

    navigator.geolocation.getCurrentPosition((pos) => {
        const newCoords = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
        };

        // ‡∏™‡πà‡∏á Socket ‡πÑ‡∏õ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á Server ‡πÅ‡∏•‡∏∞ Admin
        socket.emit('update-kyc-location', {
            username: myName,
            coords: newCoords
        });

        Swal.fire({ icon: 'success', title: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false });
        
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß
        sendKYCUserMessage("üìç ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞");
        
    }, (err) => {
        Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS', 'error');
    });
}




</script>



<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

<nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div style="font-size: 40px;">üë§</div>
        <div id="sidebar-user" style="font-weight:bold; margin-top:5px;">Guest</div>
        <small style="opacity:0.7;">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å GedGo!</small>
    </div>

    <div class="sidebar-menu">
        <div class="nav-item" onclick="openKYC()">
			<i class="fas fa-user-check"></i> <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (KYC)</span>
			</div>
        <div class="nav-item" onclick="switchView(2)">
            <i class="fas fa-id-card"></i> <span>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 2</span>
        </div>
        <div class="nav-item" onclick="switchView(3)">
            <i class="fas fa-history"></i> <span>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 3</span>
        </div>
        <div class="nav-item" onclick="switchView(4)">
            <i class="fas fa-cog"></i> <span>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 4</span>
        </div>
    </div>

    <div style="padding: 20px; border-top: 1px solid #eee;">
        <div class="nav-item" onclick="logout()" style="color: var(--danger);">
            <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </div>
    </div>
</nav>




	<div id="kyc-modal" class="modal">
    <div class="modal-content" id="kyc-container">
        <div id="btn-close-x" onclick="closeKYC()" style="position: absolute; right: 20px; top: 20px; cursor: pointer; color: #999; font-size: 1.5em;">
            <i class="fas fa-times-circle"></i>
        </div>

        <div id="kyc-form-view">
            <div style="text-align: left; margin-bottom: 20px;">
                <h3 style="margin: 0; color: var(--dark); font-size: 1.5em;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                <p style="font-size: 0.85em; color: #666; margin-top: 5px;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏ã‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
            </div>

            <label style="font-size: 0.85em; font-weight: bold; display: block; text-align: left; margin-bottom: 8px;">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
            <div class="upload-grid" style="margin-bottom: 20px;">
                <div class="upload-box" id="preview-container" style="overflow: hidden; height: 180px; background-color: #f1f5f9; display: flex; align-items: center; justify-content: center; background-size: cover; background-position: center;">
                    <div id="upload-placeholder">
                        <i class="fas fa-camera" style="font-size: 2.5em; color: #64748b;"></i>
                        <p style="color: #64748b; font-size: 0.9em;">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</p>
                    </div>
                    <input type="file" id="kyc-file" accept="image/*" onchange="previewKYCImg(this)" style="position: absolute; width: 100%; height: 100%; opacity: 0;">
                </div>
            </div>

            <div style="text-align: left;">
                <label class="kyc-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£):</label>
                <input type="text" id="full-name" class="kyc-input" oninput="validateKYC()" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                
                <label class="kyc-label">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</label>
                <input type="number" id="id-number" class="kyc-input" oninput="validateKYC()" placeholder="‡πÄ‡∏•‡∏Ç 13 ‡∏´‡∏•‡∏±‡∏Å">
                
                <label class="kyc-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</label>
                <input type="tel" id="phone-number" class="kyc-input" oninput="validateKYC()" placeholder="08x-xxx-xxxx">
                
                <label class="kyc-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
                <textarea id="home-address" class="kyc-input" oninput="validateKYC()" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." style="height: 70px;"></textarea>
            </div>

            <div id="proximity-info" class="proximity-alert">
                <i class="fas fa-map-marker-alt"></i> <b>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:</b> ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20 ‡πÄ‡∏°‡∏ï‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </div>

            <button id="btn-kyc-submit" class="btn-submit" onclick="submitKYC()" disabled>
                <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
            </button>
        </div>

        <div id="kyc-summary-view" style="display: none; text-align: left;">
    <div style="background: #e0f2f1; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 20px; border: 1px solid #4db6ac;">
        <i class="fas fa-check-circle" style="font-size: 3em; color: #00897b;"></i>
        <h3 style="margin: 10px 0 5px; color: #00695c;">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</h3>
        <p id="admin-status-text" style="margin: 0; font-size: 0.9em; color: #00695c;"></p>
    </div>

    <div style="border: 1px solid #eee; padding: 15px; border-radius: 12px; background: #fafafa;">
        <h4 style="margin: 0 0 15px; border-bottom: 1px solid #ddd; padding-bottom: 8px;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</h4>
        <div id="summary-img-preview" style="width: 100px; height: 100px; border-radius: 10px; background-size: cover; background-position: center; margin-bottom: 15px; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"></div>
        <p style="margin: 5px 0;"><b>‡∏ä‡∏∑‡πà‡∏≠:</b> <span id="sum-name"></span></p>
        <p style="margin: 5px 0;"><b>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</b> <span id="sum-id"></span></p>
        <p style="margin: 5px 0;"><b>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</b> <span id="sum-phone"></span></p>
        <p style="margin: 5px 0;"><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> <span id="sum-address" style="font-size: 0.9em;"></span></p>
    </div>

    <div style="background: white; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 20px; border: 1px solid #e2e8f0; overflow: hidden;">
        <div style="padding: 12px 15px; background: #f8fafc; border-bottom: 1px solid #eee; font-weight: bold; color: var(--dark); display: flex; align-items: center; gap: 8px; font-size: 0.9em;">
            <i class="fas fa-comments" style="color: var(--primary);"></i> ‡πÅ‡∏ä‡∏ó‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        </div>
        <div id="kyc-user-chat-box" style="height: 180px; overflow-y: auto; padding: 15px; background: #fff; display: flex; flex-direction: column; gap: 10px;">
            <div style="text-align: center; color: #94a3b8; font-size: 0.75em;">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
        </div>
		
		<div style="padding: 5px 10px; background: #fff;">
    <button onclick="updateCurrentLocation()" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px dashed var(--primary); background: #e0f2f1; color: var(--primary); font-size: 0.8em; cursor: pointer;">
        <i class="fas fa-map-marker-alt"></i> ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
    </button>
</div>

        <div style="padding: 10px; background: #f8fafc; border-top: 1px solid #eee; display: flex; gap: 8px; align-items: center;">
            <input type="text" id="kyc-user-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." style="flex:1; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; outline: none; font-size: 0.9em; font-family: 'Kanit', sans-serif;">
            <button onclick="sendKYCUserMessage()" style="background: var(--primary); color: white; border: none; width: 38px; height: 38px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-paper-plane" style="font-size: 0.9em;"></i>
            </button>
        </div>
    </div>

    <div class="proximity-alert" style="background: #fff3e0; border-color: #ffe082; color: #e65100; margin-top: 20px;">
        <i class="fas fa-bullhorn"></i> <b>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:</b> ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ä‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏±‡∏î‡∏û‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 20 ‡πÄ‡∏°‡∏ï‡∏£
    </div>

    <button onclick="closeKYC()" style="width: 100%; padding: 15px; background: #ddd; border: none; border-radius: 12px; margin-top: 15px; cursor: pointer; font-weight: bold;">
        ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
    </button>
</div>
    </div>
</div>


</body>
</html>