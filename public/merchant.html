<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GedGoZone - Merchant Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            margin: 0; background-color: #f0f2f5; 
            padding-bottom: 50px;
        }
        .header {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            padding: 20px; color: white; text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        .card {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, textarea, select {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box;
        }
        .stop-item {
            background: #f8f9fa; padding: 15px; border-radius: 10px;
            border-left: 5px solid #11998e; margin-bottom: 10px;
            position: relative;
        }
        .remove-stop {
            position: absolute; top: 10px; right: 10px;
            color: #dc3545; cursor: pointer;
        }
        .btn-add-stop {
            background: white; border: 2px dashed #11998e;
            color: #11998e; width: 100%; padding: 10px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
            margin-bottom: 20px;
        }
        .btn-submit {
            background: #11998e; color: white; border: none;
            width: 100%; padding: 15px; border-radius: 30px;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="header">
        <div style="float: left; cursor: pointer;" onclick="window.location.href='index.html'">
            <i class="fas fa-chevron-left"></i> ‡∏Å‡∏•‡∏±‡∏ö
        </div>
        <h2 style="margin: 0; display: inline-block;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
    </div>

    <div class="container">
        <div class="card">
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á</label>
    <select id="task-category" onchange="updateTitlePreview()">
        <option value="‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£">üìÑ ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</option>
        <option value="‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">üç± ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
    </select>

    <div style="background: #e9f7ef; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #11998e;">
        <small style="color: #666;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å:</small>
        <div id="title-preview" style="font-weight: bold; color: #11998e; font-size: 1.1em;">
            ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ 0 ‡∏à‡∏∏‡∏î
        </div>
    </div>
    
    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠)</label>
    <textarea id="task-desc" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
    
    <label>‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô (USD)</label>
    <input type="number" id="task-budget" placeholder="0.00">
</div>

        <div class="card">
            <label>üìç ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</label>
            <div id="stops-container">
                </div>
            <button class="btn-add-stop" onclick="addNewStop()">
                <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô / ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô
            </button>
        </div>

        <button class="btn-submit" onclick="postMerchantTask()">
            <i class="fas fa-paper-plane"></i> ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
        </button>
    </div>

    <script>
    let stopCount = 0;
    let mySavedLocations = [];
    let currentTargetStopId = null;

    // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
    function addNewStop() {
        stopCount++;
        const container = document.getElementById('stops-container');
        const stopHtml = `
            <div class="stop-item" id="stop-${stopCount}">
                <span class="remove-stop" onclick="removeStop(${stopCount})"><i class="fas fa-times"></i></span>
                <label>‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà <span class="stop-number"></span></label>
                
                <div style="margin-bottom: 10px;">
                    <button class="btn-add-stop" style="border-color: #f39c12; color: #f39c12; width: auto; padding: 5px 15px; font-size: 0.85em;" 
                        onclick="showSavedLocationsModal(${stopCount})">
                        <i class="fas fa-bookmark"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
                    </button>
                </div>

                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏™‡∏≤‡∏Ç‡∏≤ 1)" class="stop-label" id="label-${stopCount}">
                
                <div style="display: flex; gap: 5px;">
                    <button class="btn-add-stop" style="border-color: #666; color: #666; font-size: 0.8em; flex: 1;" onclick="getStopLocation(${stopCount})">
                        <i class="fas fa-map-marker-alt"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    </button>
                    <button id="save-btn-${stopCount}" class="btn-add-stop hidden" 
                        style="border-color: #28a745; color: #28a745; font-size: 0.8em; flex: 1;" onclick="saveToMyBook(${stopCount})">
                        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î
                    </button>
                </div>

                <div id="loc-status-${stopCount}" style="font-size: 0.8em; color: gray;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î</div>
                <input type="hidden" class="stop-lat" id="lat-${stopCount}">
                <input type="hidden" class="stop-lng" id="lng-${stopCount}">
            </div>
        `;
        container.insertAdjacentHTML('beforeend', stopHtml);
        reorderStops();
    }

    // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
    function reorderStops() {
        const stops = document.querySelectorAll('.stop-item');
        stops.forEach((stop, index) => {
            stop.querySelector('.stop-number').innerText = index + 1;
        });
        updateTitlePreview();
    }

    function removeStop(id) {
        document.getElementById(`stop-${id}`).remove();
        reorderStops();
    }

    function updateTitlePreview() {
        const category = document.getElementById('task-category').value;
        const currentStops = document.querySelectorAll('.stop-item').length;
        const previewEl = document.getElementById('title-preview');
        const finalTitle = `${category} ${currentStops} ‡∏à‡∏∏‡∏î`;
        previewEl.innerText = finalTitle;
        return finalTitle;
    }

    // 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Saved Locations)
    function saveToMyBook(id) {
        const label = document.getElementById(`label-${id}`).value;
        const lat = document.getElementById(`lat-${id}`).value;
        const lng = document.getElementById(`lng-${id}`).value;
        if (!label || !lat) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô");
        
        mySavedLocations.push({ label, lat, lng });
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
    }

    function showSavedLocationsModal(stopId) {
        currentTargetStopId = stopId;
        const listContent = document.getElementById('saved-list-content');
        listContent.innerHTML = "";
        if (mySavedLocations.length === 0) {
            listContent.innerHTML = "<p style='text-align:center; color:#999;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>";
        } else {
            mySavedLocations.forEach((loc, index) => {
                listContent.innerHTML += `
                    <div onclick="selectLocation(${index})" style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer;">
                        <i class="fas fa-map-pin" style="color:#f39c12;"></i> <b>${loc.label}</b><br>
                        <small style="color:#888;">‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${parseFloat(loc.lat).toFixed(4)}, ${parseFloat(loc.lng).toFixed(4)}</small>
                    </div>`;
            });
        }
        document.getElementById('saved-locations-modal').classList.remove('hidden');
    }

    function selectLocation(index) {
        const selected = mySavedLocations[index];
        const id = currentTargetStopId;
        document.getElementById(`label-${id}`).value = selected.label;
        document.getElementById(`lat-${id}`).value = selected.lat;
        document.getElementById(`lng-${id}`).value = selected.lng;
        document.getElementById(`loc-status-${id}`).innerText = "‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
        document.getElementById(`loc-status-${id}`).style.color = "#28a745";
        closeSavedModal();
    }

    function closeSavedModal() {
        document.getElementById('saved-locations-modal').classList.add('hidden');
    }

    // 4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î (Geolocation)
    function getStopLocation(id) {
        const status = document.getElementById(`loc-status-${id}`);
        status.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î...";
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                document.getElementById(`lat-${id}`).value = position.coords.latitude;
                document.getElementById(`lng-${id}`).value = position.coords.longitude;
                status.innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
                status.style.color = "#28a745";
                document.getElementById(`save-btn-${id}`).classList.remove('hidden');
            }, () => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ"));
        }
    }

    // 5. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô
    function postMerchantTask() {
        const finalTitle = updateTitlePreview();
        const stops = [];
        const stopElements = document.querySelectorAll('.stop-item');
        if (stopElements.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏à‡∏∏‡∏î");

        stopElements.forEach((el, index) => {
            const id = el.id.split('-')[1];
            stops.push({
                step: index + 1,
                label: document.getElementById(`label-${id}`).value || `‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${index+1}`,
                lat: document.getElementById(`lat-${id}`).value,
                lng: document.getElementById(`lng-${id}`).value,
                status: 'pending'
            });
        });

        const taskData = {
            title: finalTitle,
            desc: document.getElementById('task-desc').value,
            budget: document.getElementById('task-budget').value,
            stops: stops,
            isMerchantTask: true
        };
        console.log("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤:", taskData);
        alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console)");
    }
</script>
	
	
	<div id="saved-locations-modal" class="modal-overlay hidden" style="z-index: 6000;">
    <div class="modal-box" style="max-width: 400px;">
        <h3>üîñ ‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
        <div id="saved-list-content" style="max-height: 300px; overflow-y: auto; text-align: left;">
            </div>
        <button class="sidebar-btn" onclick="closeSavedModal()" style="margin-top: 15px; background: #eee;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>


</body>
</html>