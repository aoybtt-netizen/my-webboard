<!DOCTYPE html>
<html lang="th">
<head>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="GedGo">
	<meta name="mobile-web-app-capable" content="yes">
	
	<script src="/socket.io/socket.io.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GedGoZone - Merchant Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            margin: 0; background-color: #f0f2f5; 
            padding-bottom: 50px;
        }
        .header {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            padding: 20px; color: white; text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        .card {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input, textarea, select {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box;
        }
        .stop-item {
            background: #f8f9fa; padding: 15px; border-radius: 10px;
            border-left: 5px solid #11998e; margin-bottom: 10px;
            position: relative;
        }
        .remove-stop {
            position: absolute; top: 10px; right: 10px;
            color: #dc3545; cursor: pointer;
        }
        .btn-add-stop {
            background: white; border: 2px dashed #11998e;
            color: #11998e; width: 100%; padding: 10px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
            margin-bottom: 20px;
        }
		.btn-add-stopp {
            background: rgb(241, 238, 66); border: 2px dashed #afa513;
            color: #5e5d21; width: 100%; padding: 10px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
            margin-bottom: 20px;
        }
		.btn-add-contac {
            background: rgb(22, 218, 120); border: 2px dashed #13994f;
            color: #1d5f14; width: 100%; padding: 10px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
            margin-bottom: 20px;
        }

		.btn-add-contacmap {
            background: rgb(57, 159, 218); border: 2px dashed #216ec7;
            color: #122d61; width: 100%; padding: 10px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
            margin-bottom: 20px;
        }
        .btn-submit {
            background: #11998e; color: white; border: none;
            width: 100%; padding: 15px; border-radius: 30px;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
        }
        .hidden { display: none; }
		
		
		
		/* Sidebar ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
.merchant-sidebar {
    position: fixed;
    top: 0;
    left: -280px; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
    width: 280px;
    height: 100%;
    background: white;
    z-index: 7000;
    transition: 0.3s;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
}
.merchant-sidebar.active {
    left: 0;
}
.sidebar-header {
    background: #11998e;
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.sidebar-menu {
    padding: 10px;
}
.menu-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 1.05em;
}
.menu-item:hover {
    background: #f9f9f9;
    color: #11998e;
}
.sidebar-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    z-index: 6500;
}




/* ‡∏™‡πà‡∏ß‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: flex-start; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å center ‡πÄ‡∏õ‡πá‡∏ô flex-start ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    padding-top: 20px;       /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
    z-index: 9999;
    overflow-y: auto;        /* ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß Overlay ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤ Modal ‡∏¢‡∏≤‡∏ß */
}

/* ‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á */
.modal-box {
    background: white;
    border-radius: 15px;
    width: 95%;
    max-width: 500px;
    margin-bottom: 20px;    /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏•‡πà‡∏≤‡∏á‡∏à‡∏≠ */
    box-shadow: 0 5px 25px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;       /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏∞‡∏•‡∏±‡∏Å‡∏°‡∏∏‡∏°‡∏°‡∏ô */
    display: flex;
    flex-direction: column;
}

/* Animation ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏™‡∏ß‡∏¢‡πÜ */
@keyframes modalFadeIn {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.hidden {
    display: none !important;
}




.manage-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    border-bottom: 1px solid #eee;
    transition: background 0.2s;
}
.manage-item:hover {
    background: #fcfcfc;
}
.manage-info {
    text-align: left;
    flex-grow: 1;
}
.manage-actions {
    display: flex;
    gap: 10px;
}
.btn-delete {
    color: #dc3545;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2em;
    padding: 5px;
}
.btn-delete:hover {
    transform: scale(1.1);
}



/* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ */
.summary-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border-radius: 10px;
    margin-bottom: 8px;
    border: 1px solid #eee;
}
.summary-item i {
    color: #11998e;
    font-size: 1.1em;
}
.summary-label {
    font-size: 0.85em;
    color: #888;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.summary-value {
    font-weight: 600;
    color: #333;
}


#sum-stops {
    max-height: 200px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á */
    overflow-y: auto;  /* ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏•‡∏á‡πÑ‡∏î‡πâ */
    padding-right: 5px;
    margin-bottom: 15px;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Scrollbar ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏ß‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
#sum-stops::-webkit-scrollbar {
    width: 5px;
}
#sum-stops::-webkit-scrollbar-thumb {
    background: #11998e;
    border-radius: 10px;
}



/* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà */
.add-job-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    border: 2px dashed #11998e;
    color: #11998e;
    font-size: 1.2em;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    margin-top: 10px;
}
.add-job-card:hover {
    background: #e8f5e9;
    transform: translateY(-2px);
}

/* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥ */
.active-task-card {
    background: white;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    border-left: 5px solid #f39c12; /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô In Progress */
}
.task-progress-bar {
    height: 8px;
    background: #eee;
    border-radius: 10px;
    margin: 10px 0;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: #11998e;
    transition: 0.5s;
}



.right-sidebar {
    position: fixed;
    top: 0; right: -320px; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤ */
    width: 320px; height: 100%;
    background: white; z-index: 9000;
    transition: 0.3s; box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    display: flex; flex-direction: column;
}
.right-sidebar.active { right: 0; }

.tab-menu { display: flex; background: #eee; }
.tab-item { 
    flex: 1; text-align: center; padding: 15px; 
    cursor: pointer; color: #888; border-bottom: 3px solid transparent; 
}
.tab-item.active { 
    color: #11998e; border-bottom: 3px solid #11998e; background: white; 
}

.tab-content { padding: 15px; flex-grow: 1; overflow-y: auto; }
.chat-msg { margin-bottom: 10px; padding: 8px 12px; border-radius: 15px; max-width: 80%; font-size: 0.9em; }
.msg-me { background: #11998e; color: white; align-self: flex-end; margin-left: auto; }
.msg-them { background: #eee; color: #333; }




/* ‡∏à‡∏∏‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô */
.unread-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4757;
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ Card ‡πÄ‡∏õ‡πá‡∏ô relative ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ badge ‡πÅ‡∏õ‡∏∞‡∏ñ‡∏π‡∏Å‡∏ó‡∏µ‡πà */
.active-task-card {
    position: relative;
}




/* Wrapper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô */
.notif-wrapper {
    position: absolute;
    bottom: 12px; /* ‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á */
    right: 15px;  /* ‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤ */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏∞‡∏Å‡∏∞ */
.msg-icon {
    font-size: 1.2em;
    color: #fafafa;
    transition: 0.3s;
}

.dot-on-icon {
    position: absolute;
    top: -3px;
    right: -3px;
    width: 8px;
    height: 8px;
    background: #ff4757;
    border-radius: 50%;
    border: 2px solid white;
    display: none;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (Active State) */
.has-unread .msg-icon {
    color: #11998e; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß/‡∏ü‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏ò‡∏µ‡∏° */
}
.has-unread .dot-on-icon {
    display: block; /* ‡πÇ‡∏ä‡∏ß‡πå‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á */
    animation: pulse-dot 1.5s infinite;
}

@keyframes pulse-dot {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
    70% { transform: scale(1.2); box-shadow: 0 0 0 6px rgba(255, 71, 87, 0); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
}





.notif-inline-wrapper {
    display: inline-flex;
    align-items: center;
    margin-left: 8px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå */
    vertical-align: middle;
}

.msg-icon-small {
    font-size: 1.1em;
    color: #bdc3c7;
    transition: 0.3s;
    position: relative;
}

.dot-on-icon-small {
    position: absolute;
    top: -4px;
    right: -4px;
    width: 7px;
    height: 7px;
    background: #ff4757;
    border-radius: 50%;
    border: 1.5px solid white;
    display: none;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà */
.has-unread .msg-icon-small {
    color: #11998e;
}
.has-unread .dot-on-icon-small {
    display: block;
    animation: pulse-dot 1.5s infinite;
}



.rider-profile-box {
    background: #f8f9fa;
    border: 1px solid #eee;
    border-radius: 12px;
    padding: 12px;
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 12px;
}
.stat-item {
    text-align: center;
    flex: 1;
}
.stat-value {
    display: block;
    font-weight: bold;
    color: #11998e;
    font-size: 1.1em;
}
.stat-label {
    font-size: 0.75em;
    color: #999;
}


.btn-delete-task {
    width: 100%;
    padding: 12px;
    background: #ff4d4d;
    color: white;
    border: none;
    border-radius: 8px;
    font-family: 'Kanit', sans-serif;
    cursor: pointer;
    font-weight: 600;
    transition: 0.3s;
}
.btn-delete-task:hover {
    background: #cc0000;
}





.switch { position: relative; display: inline-block; width: 44px; height: 24px; }
.switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: #28a745; }
input:checked + .slider:before { transform: translateX(20px); }




.product-modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999; /* ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î */
}
.product-modal-card {
    background: white;
    width: 90%;
    max-width: 450px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    animation: modalPop 0.3s ease-out;
}
@keyframes modalPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

.product-modal-header {
    background: #11998e;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.btn-close-modal {
    background: none; border: none;
    color: white; font-size: 28px; cursor: pointer;
}
.product-modal-body { padding: 20px; }
.product-note { font-size: 0.85em; color: #666; margin-bottom: 15px; }

.product-row-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
}
.product-row-item input[type="text"] { flex: 2; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
.product-row-item input[type="number"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 80px; }
.currency-badge {
    background: #f0f0f0;
    padding: 12px 8px;
    border-radius: 8px;
    font-weight: bold;
    min-width: 45px;
    text-align: center;
    color: #333;
}
.hidden { display: none !important; }





.order-alert-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex; justify-content: center; align-items: center;
    z-index: 10000;
}

.order-alert-card {
    background: white;
    width: 90%;
    max-width: 380px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.2);
}

.order-alert-header-compact {
    background: #e67e22; /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ */
    color: white;
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.header-left h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.pulse-small {
    font-size: 1rem;
    animation: pulse-dot 1.5s infinite;
}

.timer-badge {
    background: rgba(0, 0, 0, 0.2);
    padding: 4px 10px;
    border-radius: 8px;
    font-family: monospace;
    font-weight: bold;
    font-size: 1.1rem;
}

.order-alert-body {
    padding: 20px; /* ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö */
}

.order-info-container {
    margin-bottom: 15px;
}

.order-alert-header {
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white; padding: 25px; text-align: center;
}

.pulse-icon {
    font-size: 3rem; margin-bottom: 10px;
    animation: pulseIcon 1.5s infinite;
}

@keyframes pulseIcon {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

.order-items-box {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 12px;
    font-size: 0.85rem;
    color: #34495e;
    max-height: 80px;
    overflow-y: auto;
    border: 1px dashed #ddd;
    margin-bottom: 15px;
}

.order-price-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 10px;
    border-top: 2px solid #f1f1f1;
}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ */
.order-items-box-wrapper {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 12px;
    border: 1px solid #eee;
    margin-bottom: 10px;
}

.items-list {
    font-size: 0.9rem;
    color: #34495e;
    margin-bottom: 8px;
    line-height: 1.4;
}

/* ‡πÅ‡∏ñ‡∏ß‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
.food-price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px dashed #ccc;
    padding-top: 8px;
    font-size: 0.85rem;
    font-weight: bold;
}

/* ‡πÅ‡∏ñ‡∏ß‡∏Ñ‡πà‡∏≤‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå */
.rider-wage-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 5px;
    margin-bottom: 15px;
}

/* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏ü‡πâ‡∏≤-‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) */
.badge-price-food {
    background: #e3f2fd;
    color: #1976d2;
    padding: 2px 8px;
    border-radius: 6px;
    border: 1px solid #bbdefb;
}

/* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏°‡πà‡∏ß‡∏á) */
.badge-price-rider {
    background: #f3e5f5;
    color: #7b1fa2;
    padding: 2px 8px;
    border-radius: 6px;
    border: 1px solid #e1bee7;
}

.price-value {
    font-size: 1.3rem;
    font-weight: 800;
    color: #2c3e50; /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏Ç‡∏£‡∏∂‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏û‡∏á */
    text-shadow: 0px 1px 1px rgba(0,0,0,0.05);
}

.order-price-box {
    display: flex; justify-content: space-between;
    font-size: 1.3rem; font-weight: bold; color: #11998e;
    margin-top: 10px;
}

.order-alert-footer {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 10px;
    padding: 15px 20px 20px;
}

.btn-decline-new {
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ddd;
    background: #f8f9fa;
    color: #7f8c8d;
    font-weight: bold;
    cursor: pointer;
}

.btn-accept-new {
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: #27ae60;
    color: white;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
}

@keyframes pulse-dot {
    0% { transform: scale(0.95); opacity: 0.7; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.7; }
}

.btn-accept {
    flex: 2; padding: 15px; background: #11998e; color: white;
    border: none; border-radius: 10px; font-weight: bold; cursor: pointer;
}

.btn-decline {
    flex: 1; padding: 15px; background: #eee; color: #666;
    border: none; border-radius: 10px; cursor: pointer;
}

@keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
}



.floating-order-btn {
    position: fixed;
    right: -10px; /* ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏î‡∏π‡∏î‡∏ï‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö */
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
    padding: 15px 20px 15px 25px;
    border-radius: 30px 0 0 30px;
    box-shadow: -2px 4px 10px rgba(0,0,0,0.2);
    z-index: 9980;
    cursor: pointer;
    display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå */
    transition: all 0.3s ease;
}

.floating-order-btn:hover {
    right: 0;
    padding-left: 30px;
}

.order-badge {
    background: red;
    color: white;
    border-radius: 50%;
    padding: 2px 7px;
    font-size: 0.8rem;
    position: absolute;
    top: -5px;
    left: 10px;
    border: 2px solid white;
}

/* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (List Modal) */
#orderListModal {
    z-index: 9990 !important;
}

#orderListModal .product-modal-card {
    max-width: 350px;
}

.order-list-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.2s;
}

.order-list-item:hover {
    background: #fdf2e9;
}

.swal2-container {
    z-index: 20000 !important;
}



.order-info-group {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 0.9rem;
}

.info-label {
    color: #7f8c8d;
}

.info-value {
    font-weight: 600;
    color: #2c3e50;
}

.highlight-green {
    color: #27ae60 !important;
}
	
#orderMiniMap {
        box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        background: #eee; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î */
    }	
	


    </style>
</head>
<body>

    <div class="header" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 15px;">
    <div style="cursor: pointer; width: 30px;" onclick="toggleMerchantSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <div style="text-align: center; flex-grow: 1;">
        <h2 id="merchant-name-display" style="margin: 0; font-size: 1.2em; line-height: 1.2;">GedGo Merchant</h2>
        <div id="merchant-balance-display" style="font-size: 1.0em; color: #ffeb57; font-weight: bold; margin-top: 2px;">
            0.00 Loading...
        </div>
    </div>
	


    <div style="cursor: pointer; width: 30px; text-align: right;" onclick="safeNavigateHome()">
        <i class="fas fa-home"></i>
    </div>
</div>


    <div id="merchant-sidebar" class="merchant-sidebar">
        <div class="sidebar-header" style="flex-direction: column; align-items: flex-start; padding: 15px;">
    <div id="merchant-phone-display" style="font-size: 1.1em; font-weight: bold; color: var(--primary); margin-bottom: 5px;">
        <i class="fas fa-phone-alt"></i> <span id="shop-phone-number">-</span>
    </div>
    
    <div id="merchant-coordinate-link"></div>

    <span onclick="toggleMerchantSidebar()" style="position: absolute; right: 15px; top: 15px; cursor: pointer; font-size: 1.5em;">&times;</span>
	</div>

        <div class="sidebar-menu">
		
		<div class="menu-item" style="display: flex; justify-content: space-between; align-items: center; cursor: default;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-power-off"></i> 
            <span id="status-text" style="font-weight: bold;">CLOSED</span>
        </div>
        <label class="switch">
            <input type="checkbox" id="merchant-status-toggle" onchange="updateMerchantStatus(this.checked)">
            <span class="slider round"></span>
        </label>
    </div>
	
	<div class="menu-item" onclick="openMerchantProductsModal()">
        <i class="fas fa-utensils"></i> 
        <span data-i18n-key="menu_manage_products">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
    </div>
	
    <div class="menu-item" onclick="openSaveStoreModal()">
        <i class="fas fa-store"></i> 
        <span data-i18n-key="menu_save_store">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô (Base)</span>
    </div>
    <div class="menu-item" onclick="openAddLocationModal()">
        <i class="fas fa-map-marked-alt"></i> 
        <span data-i18n-key="menu_add_location">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</span>
    </div>
    <hr>
    <div class="menu-item" onclick="openManageLocationsModal()">
        <i class="fas fa-list"></i> 
        <span data-i18n-key="menu_all_locations">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
    </div>
    <div class="menu-item" onclick="openListOrderModal()">
        <i class="fas fa-list"></i> 
        <span data-i18n-key="menu_all_orders">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
    </div>
    <div class="menu-item" onclick="HowToVoiceCommands()">
        <i class="fas fa-microphone-alt"></i> 
        <span data-i18n-key="menu_voice_commands">‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á</span>
    </div>
    <div class="menu-item" onclick="infouse()">
        <i class="fas fa-info"></i> 
        <span data-i18n-key="menu_info_usage">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥</span>
    </div>
</div>
    </div>
    <div id="sidebar-overlay" class="sidebar-overlay hidden" onclick="toggleMerchantSidebar()"></div>

    <div class="container" style="margin-bottom: 0;">
    <div class="add-job-card" onclick="toggleTaskForm()">
        <i class="fas fa-plus-circle"></i> 
        <span data-i18n-key="btn_create_job_main">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏à‡πâ‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà</span>
    </div>
    
    <div>
        <small onclick="openListOrderModal()" style="color: #f39c12; cursor: pointer; margin-right: 15px;">
            <i class="fas fa-history"></i> 
            <span data-i18n-key="link_saved_orders">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
        </small>
    </div>
</div>
	

    <div class="container" id="active-tasks-container">
        <h4 style="color: #666; margin-left: 10px;">
    <i class="fas fa-clock"></i> 
    <span data-i18n-key="title_active_jobs">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
</h4>
        <div id="active-tasks-list">
            </div>
    </div>

    <div class="container hidden" id="task-form-container">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; color: #11998e;">
                <i class="fas fa-edit"></i> <span data-i18n-key="form_new_job_title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</span>
            </h3>
            <span onclick="toggleTaskForm()" style="cursor:pointer; font-size: 1.5em; color: #999;">&times;</span>
        </div>
        <hr>

        <label data-i18n-key="lbl_task_category">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
        <select id="task-category" onchange="updateTitlePreview()">
			<option value="general" data-i18n-key="opt_general">‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
			<option value="document" data-i18n-key="opt_document">‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</option>
			<option value="big_parcel" data-i18n-key="opt_big_parcel">‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏/‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà</option>
		</select>

        <label data-i18n-key="lbl_task_desc">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡∏Ç‡∏ô‡∏≤‡∏î)</label>
        <textarea id="task-desc" data-i18n-key="plh_task_desc" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." rows="3"></textarea>

        <label data-i18n-key="lbl_task_budget">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
        <input type="number" id="task-budget" data-i18n-key="plh_task_budget" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô..." oninput="updateTitlePreview()">

        <div id="stops-container"></div>

        <button class="btn-add-stopp" onclick="addNewStop()">
            <i class="fas fa-plus"></i> <span data-i18n-key="btn_add_stop">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</span>
        </button>

        <div style="margin-top: 15px; background: #e8f5e9; padding: 8px 12px; border-radius: 8px; border-left: 4px solid #11998e;">
            <span id="title-preview" style="font-weight: bold; color: #11998e; font-size: 0.95em;">-</span>
        </div>

        <div style="display: flex; gap: 8px; margin-top: 15px;">
            <button id="submit-btn" class="btn-submit" style="flex: 2; height: 50px; border-radius: 12px;" onclick="postMerchantTask()">
                <i class="fas fa-paper-plane"></i> <span data-i18n-key="btn_post_job">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
            </button>

            <button id="voice-btn" class="btn-submit" style="flex: 1; background: #f39c12; border-radius: 12px; height: 50px;" onclick="startVoiceCommand()">
                <i class="fas fa-microphone"></i> <span data-i18n-key="btn_voice_order">‡∏û‡∏π‡∏î‡∏™‡∏±‡πà‡∏á</span>
            </button>
        </div>
        
        <div style="text-align: right; margin-top: 10px;">
            <small onclick="openSaveTemplateModal()" style="color: #11998e; cursor: pointer;">
                <i class="fas fa-save"></i> <span data-i18n-key="link_save_order_template">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
            </small>
        </div>
    </div>
</div>

    <script>
	const socket = io();
	let shopNameApply = '';
	let currentTab = 'notif';
	let unreadPosts = {};
	const myUsername = localStorage.getItem('myUsername');
    let stopCount = 0;
    let mySavedLocations = [];
    let currentTargetStopId = null;
	let merchantMap;
	let currentMarker;
	let selectedLat, selectedLng;
	let editingLocationId = null;
	let lastVoiceAnalysis = null;
	let mapMode = 'book';
	let currentZoneCurrency = 'USD';
	let currentIncomingOrder = null;
	let pendingOrders = [];
	let activeTaskInSidebar = null;
	let myOrderTemplates = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∏‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ
	let timerInterval;
	let detailMap;
	let detailMarker;
	const currentLang = localStorage.getItem('preferredLanguage') || 'th';
	


if (myUsername) {
    socket.emit('join', myUsername);
    console.log("Joined room:", myUsername);
}

async function loadOrderTemplates() {
    const res = await fetch(`/api/merchant/templates?username=${myUsername}`);
    const data = await res.json();
    if (data.success) {
        myOrderTemplates = data.templates;
    }
}



const translations = {
    'th': {
        'menu_save_store': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô (Base)',
        'menu_add_location': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô',
        'menu_all_locations': '‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        'menu_all_orders': '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
        'menu_voice_commands': '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á',
        'menu_info_usage': '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥',
		'btn_create_job_main': '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏à‡πâ‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà',
        'link_saved_orders': '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
		'form_new_job_title': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà',
        'lbl_task_category': '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô',
        'opt_general': '‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
        'opt_document': '‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
        'opt_big_parcel': '‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏/‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà',
		'preview_format': (cat, num) => `${cat} (‡∏™‡πà‡∏á ${num} ‡∏à‡∏∏‡∏î)`,
        'lbl_task_desc': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡∏Ç‡∏ô‡∏≤‡∏î)',
        'plh_task_desc': '‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏á‡∏≤‡∏ô...',
        'lbl_task_budget': '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô',
        'plh_task_budget': '‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á...',
        'btn_add_stop': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô',
        'btn_post_job': '‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö',
        'btn_voice_order': '‡∏û‡∏π‡∏î‡∏™‡∏±‡πà‡∏á',
        'link_save_order_template': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå',
		'status_checking': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô...',
        'btn_confirm_rate': '‚úÖ ‡∏à‡∏ö‡∏á‡∏≤‡∏ô & ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô',
        'status_delivering': 'üõµ ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...',
        'status_requesting': (user) => `Rider <b>${user}</b> ‡∏Ç‡∏≠‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ...`,
        'status_waiting': '‚åõ ‡∏£‡∏≠‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô...',
		'post_time_prefix': '‡πÄ‡∏°‡∏∑‡πà‡∏≠',
        'lbl_rider': '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô:',
        'rider_none': '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ',
        'progress_prefix': '‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤:',
        'unit_stop': '‡∏à‡∏∏‡∏î',
		'no_active_tasks': '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà',
        'error_loading_tasks': '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
		'err_no_username': 'üõë ‡πÑ‡∏°‡πà‡∏û‡∏ö Username ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà',
        'lbl_store_name': '‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
        'plh_enter_name': '‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠...',
        'modal_title_base': 'üè† ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô (Base)',
        'btn_confirm_base': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô',
		'modal_title_dropoff': 'üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô',
        'btn_select_location': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ',
		'lbl_location_alias': '‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ A)',
        'modal_title_new_pin': 'üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà',
        'btn_save_to_book': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î',
        'err_min_stops': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏à‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        'err_incomplete_info': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô',
        'lbl_pickup_point': '‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô',
        'lbl_dropoff_point': (index) => `‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà ${index}`,
        'err_pin_all_points': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        'msg_save_success': '‚ú® ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
        'msg_save_failed': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
		'lbl_coords': '‡∏û‡∏¥‡∏Å‡∏±‡∏î:',
        'err_voice_unsupported': '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ',
        'msg_try_again': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
        'err_no_pin': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
        'err_no_location_name': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î',
        'msg_save_success_simple': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
		'lbl_pickup_full': 'üü¢ ‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (Pickup)',
        'lbl_dropoff_full': 'üìç ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô (Drop-off)',
        'plh_place_name': '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà...',
        'plh_phone_contact': '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)...',
        'coords_not_set': '‡∏û‡∏¥‡∏Å‡∏±‡∏î: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏',
        'btn_select_map': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà',
        'btn_from_book': '‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà',
		'lbl_pickup_only': 'üü¢ ‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (Pickup)',
        'lbl_dropoff_indexed': (index) => `üìç ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${index}`,
        'task_title_summary': (cat, count) => `${cat} (‡∏™‡πà‡∏á ${count} ‡∏à‡∏∏‡∏î)`,
        'err_label_lat_required': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô',
        'no_saved_data': '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ',
        'tag_store': '(‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤)',
        'lbl_coords_short': '‡∏û‡∏¥‡∏Å‡∏±‡∏î:',
		'btn_wait_time': (time) => ` ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà (${time}s)`,
        'err_min_stops_post': '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏à‡∏∏‡∏î',
        'lbl_pickup_simple': '‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô',
        'lbl_dropoff_indexed_simple': (index) => `‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà ${index}`,
        'err_pin_required_all': '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô',
        'msg_post_success': 'üöÄ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!',
        'err_voice_failed': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡∏Ñ‡πå',
        'btn_voice_start': ' ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô',
		'btn_voice_listening': ' ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...',
		'key_order': '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå',
        'key_doc': '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
        'key_mail': '‡∏™‡πà‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢',
        'cat_general': '‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
        'cat_doc': '‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£',
        'unit_stop_voice': '‡∏à‡∏∏‡∏î',
		'err_voice_not_supported': '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á',
        'msg_voice_retry_simple': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏û‡∏π‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
		'sum_pickup': '‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á/‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö',
        'sum_dropoff': (i) => `‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà ${i}`,
        'sum_no_coords': '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î',
		'status_pickup_ai': '‚úÖ ‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (AI)',
        'status_pickup_ai': (i) => `‚úÖ ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${i} (AI)`,
		'lbl_store_base_name': '‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô',
        'no_saved_locations': '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ',
        'no_phone': '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå',
        'confirm_delete_loc': (name) => `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        'msg_delete_success': '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
		'modal_title_edit': '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏¥‡∏Å‡∏±‡∏î',
        'btn_save_edit': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç',
        'warn_no_location': '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï',
		'sidebar_job_prefix': '‡∏á‡∏≤‡∏ô:',
        'sidebar_rider_interested': '‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏ô‡πÉ‡∏à‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ',
        'sidebar_score_unit': '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô',
        'sidebar_stat_jobs': '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö',
        'sidebar_stat_level': '‡∏£‡∏∞‡∏î‡∏±‡∏ö',
        'sidebar_level_best': '‡∏î‡∏µ‡∏°‡∏≤‡∏Å',
        'sidebar_btn_approve': '‡∏ï‡∏Å‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏á‡∏≤‡∏ô',
        'sidebar_btn_reject': '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò',
        'sidebar_assigned_msg': (name) => `‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì ${name} ‡πÅ‡∏•‡πâ‡∏ß`,
        'sidebar_track_info': '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏ó‡∏Ñ‡∏∏‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô Tab ‡∏≠‡∏∑‡πà‡∏ô',
        'status_waiting_rider': '‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô...',
		'sidebar_pickup_label': 'üè† ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á',
        'sidebar_dropoff_label': (i) => `üìç ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà ${i}`,
        'btn_delete_task': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ',
        'delete_task_note': '* ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
		'chat_loading': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...',
        'err_chat_send_failed': '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
		'swal_del_title': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô?',
        'swal_del_text': '‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì',
        'swal_del_btn': '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢',
        'swal_cancel': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        'swal_del_success_title': '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
        'swal_del_success_text': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß',
        'err_no_user_title': '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
        'err_no_user_text': '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà',
        'confirm_approve_rider': '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡∏•‡∏á‡πÉ‡∏´‡πâ Rider ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'alert_approve_success': '‚úÖ ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
        'confirm_reject_rider': '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'alert_reject_success': '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß',
        'err_generic': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
		'notif_new_request': '‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà!',
        'notif_rider_wants': (name) => `‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå <b>${name}</b> ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ`,
        'btn_confirm_assign': '‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏á‡∏≤‡∏ô',
        'prompt_rating': (name) => `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏∏‡∏ì ${name} (1-5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô):`,
        'err_rating_range': '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 1 ‡∏ñ‡∏∂‡∏á 5 ‡∏Ñ‡∏£‡∏±‡∏ö',
        'confirm_bypass': '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'msg_task_complete': '‚úÖ ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
        'msg_bypass_success': '‚úÖ ‡∏ö‡∏≤‡∏¢‡∏û‡∏≤‡∏™‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
		'confirm_delete_template': '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'msg_delete_template_success': 'üóëÔ∏è ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!',
		'no_templates_found': '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ',
        'unit_stop_short': '‡∏à‡∏∏‡∏î',
		'log_server_error': '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Server ‡πÑ‡∏î‡πâ:',
        'before_unload_msg': '‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        'modal_title_address_book': 'üîñ ‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
        'modal_title_pin_map': 'üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î',
        'btn_close': '‡∏õ‡∏¥‡∏î',
		'lbl_map_name': ' ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ A)',
        'plh_map_name': '‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà...',
        'lbl_map_phone': ' ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)',
        'plh_map_phone': '‡πÄ‡∏ä‡πà‡∏ô 081-234-5678',
        'lbl_map_voice': '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Keyword ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô)',
        'plh_map_voice': '‡∏û‡∏π‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß',
        'lbl_map_coords_waiting': '‡∏û‡∏¥‡∏Å‡∏±‡∏î: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà',
        'btn_confirm_coords': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î',
        'btn_cancel': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
		'title_manage_locations': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏Å‡∏±‡∏î',
        'btn_close_window': '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á',
        'ai_summary_success': 'AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        'ai_summary_subtitle': '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô',
        'lbl_task_and_title': '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠',
        'lbl_stops_sequence': '‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö',
        'lbl_delivery_budget': '‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)',
        'btn_confirm_this_data': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ',
        'btn_edit_new': '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà',
		'sidebar_main_title': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô',
        'sidebar_tab_notif': '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
        'sidebar_tab_details': '‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô',
        'sidebar_tab_chat': '‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå',
        'plh_chat_input': '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...',
		'tpl_title': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ',
        'tpl_label_name': '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠)',
        'tpl_plh_name': '‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢...',
        'tpl_label_voice': '‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Keyword)',
        'tpl_plh_voice': '‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠',
        'tpl_note': '* ‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
        'btn_save_template': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ',
		'tpl_list_title': '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ',
        'btn_close_window': '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á',
		'guide_title': '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á',
        'guide_method_1_title': '‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"',
        'guide_method_1_desc': '‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå" ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
        'guide_method_1_ex': '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠", "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πà‡∏≠‡∏á"',
        'guide_method_2_title': '‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô',
        'guide_method_2_desc': '‡∏û‡∏π‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô ‡∏û‡∏¥‡∏Å‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß',
        'guide_method_2_sub': '‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏°‡∏µ 3 ‡πÅ‡∏ö‡∏ö ‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£-‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤-‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        'guide_method_2_ex': '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏õ ‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠ ‡∏´‡πâ‡∏≤‡∏™‡∏¥‡∏ö‡∏ö‡∏≤‡∏ó"',
        'guide_note': '* ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Ç‡∏≠‡∏á AI',
        'btn_got_it': '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß',
		'note_title': '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥',
        'note_bypass_title': '‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ö‡∏≤‡∏¢‡∏û‡∏≤‡∏™',
        'note_bypass_desc': '‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ö‡∏≤‡∏¢‡∏û‡∏≤‡∏™‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏•‡∏∑‡∏°‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏±‡πâ‡∏ô‡πÜ',
		'swal_prevent_exit_title': '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ',
        'swal_prevent_exit_text': (num) => `‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ${num} ‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`,
		'placeholder_shop_name': '‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...',
        'msg_merchant_fee_info': '* ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ü‡∏£‡∏µ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡πÇ‡∏ã‡∏ô',
        'title_merchant_confirm': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô',
		'confirm_shop_name_label': '‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ:',
		'title_merchant_verify': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô',
		'btn_confirm': '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠',
        'title_active_jobs': '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
		'menu_manage_products': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
		'product_limit_note': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡πÄ‡∏°‡∏ô‡∏π (‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á)',
		'btn_save': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π',
		'new_order_title': '‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤!',
		'btn_accept_order': '‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå & ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå',
		'btn_decline': '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò',
		'customer_name': '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:',
		'accept_success_title': '‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
        'accept_success_text': '‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ Index ‡πÅ‡∏•‡πâ‡∏ß',
        'confirm_reject_title': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò?',
        'confirm_reject_text': '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ',
        'reject_success_text': '‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
        'btn_confirm_reject': '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò',
        'btn_cancel': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        'error_connection': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠',
        'error_generic': '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
		'customer_phone': '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:',
		'food_total': '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£:',
        'net_total': '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ:',
        'rider_wage': '‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå:',
        'order_id': '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå:',
        'customer_name': '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:',
		'sidebar_order_items_title': '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á:',
    },
    'en': {
        'menu_save_store': 'Save Store Location (Base)',
        'menu_add_location': 'Add Delivery Location',
        'menu_all_locations': 'All Saved Locations',
        'menu_all_orders': 'All Saved Orders',
        'menu_voice_commands': 'Voice Commands',
        'menu_info_usage': 'Important Notes',
		'btn_create_job_main': 'Create New Delivery Job',
        'link_saved_orders': 'Saved Orders',
		'form_new_job_title': 'New Job Details',
        'lbl_task_category': 'Task Category',
        'opt_general': 'Food / General Goods',
        'opt_document': 'Document Delivery',
        'opt_big_parcel': 'Big Parcel / Large Items',
		'preview_format': (cat, num) => `${cat} (${num} stops)`,
        'lbl_task_desc': 'Additional Details (e.g., quantity, size)',
        'plh_task_desc': 'Enter details for rider evaluation...',
        'lbl_task_budget': 'Budget',
        'plh_task_budget': 'Enter your offer price...',
        'btn_add_stop': 'Add Stop Point',
        'btn_post_job': 'Post Job',
        'btn_voice_order': 'Voice',
        'link_save_order_template': 'Save as Order Template',
		'status_checking': 'Checking task status...',
        'btn_confirm_rate': '‚úÖ Finish & Rate',
        'status_delivering': 'üõµ Delivery in progress...',
        'status_requesting': (user) => `Rider <b>${user}</b> is requesting...`,
        'status_waiting': '‚åõ Waiting for rider...',
		'post_time_prefix': 'at',
        'lbl_rider': 'Rider:',
        'rider_none': 'None',
        'progress_prefix': 'Progress:',
        'unit_stop': 'stops',
		'no_active_tasks': 'No active tasks at the moment',
        'error_loading_tasks': 'Failed to load task data',
		'err_no_username': 'üõë Username not found. Please login again.',
        'lbl_store_name': 'Enter your store or company name',
        'plh_enter_name': 'Enter name...',
        'modal_title_base': 'üè† Save Store Location (Base)',
        'btn_confirm_base': 'Confirm Base Location',
		'modal_title_dropoff': 'üìç Pin Delivery Point',
        'btn_select_location': 'Select this location',
		'lbl_location_alias': 'Set location name (e.g., Client A House)',
        'modal_title_new_pin': 'üìç Pin New Location',
        'btn_save_to_book': 'Save to Book',
        'err_min_stops': 'Please add at least 1 drop-off point before saving',
        'err_incomplete_info': 'Please fill in all information',
        'lbl_pickup_point': 'Pickup Point',
        'lbl_dropoff_point': (index) => `Drop-off Point ${index}`,
        'err_pin_all_points': 'Please pin all locations in the order before saving',
        'msg_save_success': '‚ú® Order template saved successfully!',
        'msg_save_failed': 'Save failed',
		'lbl_coords': 'Coords:',
        'err_voice_unsupported': 'Voice commands not supported on this browser',
        'msg_try_again': 'Please try again',
        'err_no_pin': 'Please pin a location on the map first',
        'err_no_location_name': 'Please specify a location name',
        'msg_save_success_simple': 'Saved successfully!',
		'lbl_pickup_full': 'üü¢ Pickup Point',
        'lbl_dropoff_full': 'üìç Drop-off Point',
        'plh_place_name': 'Location name...',
        'plh_phone_contact': 'Contact phone (Optional)...',
        'coords_not_set': 'Coords: Not specified',
        'btn_select_map': 'Select on Map',
        'btn_from_book': 'From Address Book',
		'lbl_pickup_only': 'üü¢ Pickup Point',
        'lbl_dropoff_indexed': (index) => `üìç Drop-off Point ${index}`,
        'task_title_summary': (cat, count) => `${cat} (${count} stops)`,
        'err_label_lat_required': 'Please specify location name and save coordinates first',
        'no_saved_data': 'No saved data found',
        'tag_store': '(Store)',
        'lbl_coords_short': 'Coords:',
		'btn_wait_time': (time) => `Please wait (${time}s)`,
        'err_min_stops_post': '‚ùå Please add at least 1 pickup/drop-off point',
        'lbl_pickup_simple': 'Pickup Point',
        'lbl_dropoff_indexed_simple': (index) => `Drop-off Point ${index}`,
        'err_pin_required_all': '‚ùå Please pin all locations before posting',
        'msg_post_success': 'üöÄ Job posted successfully!',
        'err_voice_failed': 'Voice recognition error or microphone permission denied',
        'btn_voice_start': 'Tap to start voice command',
		'btn_voice_listening': 'Listening...',
		'key_order': 'order',
        'key_doc': 'document',
        'key_mail': 'mail',
        'cat_general': 'General Delivery',
        'cat_doc': 'Document Delivery',
        'unit_stop_voice': 'stops',
		'err_voice_not_supported': 'This browser does not support voice',
        'msg_voice_retry_simple': 'Please try speaking again',
		'sum_pickup': 'Pickup Point',
        'sum_dropoff': (i) => `Drop-off Point ${i}`,
        'sum_no_coords': 'No coordinates found',
		'status_pickup_ai': '‚úÖ Pickup Point (AI)',
        'status_dropoff_ai': (i) => `‚úÖ Drop-off Point ${i} (AI)`,
		'lbl_store_base_name': 'My Store Location',
        'no_saved_locations': 'No saved delivery locations',
        'no_phone': 'No phone number',
        'confirm_delete_loc': (name) => `Do you want to delete "${name}"?`,
        'msg_delete_success': 'Location deleted successfully',
		'modal_title_edit': '‚úèÔ∏è Edit Location',
        'btn_save_edit': 'Save Changes',
        'warn_no_location': 'Unable to get location or permission denied',
		'sidebar_job_prefix': 'Task:',
        'sidebar_rider_interested': 'Rider is interested',
        'sidebar_score_unit': 'Points',
        'sidebar_stat_jobs': 'Jobs taken',
        'sidebar_stat_level': 'Level',
        'sidebar_level_best': 'Excellent',
        'sidebar_btn_approve': 'Approve',
        'sidebar_btn_reject': 'Reject',
        'sidebar_assigned_msg': (name) => `Assigned to ${name}`,
        'sidebar_track_info': 'You can track location and chat in other tabs',
        'status_waiting_rider': '‚åõ Waiting for riders...',
		'sidebar_pickup_label': 'üè† Pickup',
        'sidebar_dropoff_label': (i) => `üìç Drop-off ${i}`,
        'btn_delete_task': 'Cancel and Delete Task',
        'delete_task_note': '* You can only delete tasks before a rider accepts them.',
		'chat_loading': 'Loading messages...',
        'err_chat_send_failed': 'Failed to send message. Please try again.',
		'swal_del_title': 'Confirm Task Deletion?',
        'swal_del_text': 'The task will be removed and your status will be reset.',
        'swal_del_btn': 'Yes, delete it',
        'swal_cancel': 'Cancel',
        'swal_del_success_title': 'Deleted!',
        'swal_del_success_text': 'Your status has been reset.',
        'err_no_user_title': 'Error',
        'err_no_user_text': 'Username not found. Please log in again.',
        'confirm_approve_rider': 'Do you want to assign this task to this Rider?',
        'alert_approve_success': '‚úÖ Assigned successfully!',
        'confirm_reject_rider': 'Do you want to reject this rider\'s request?',
        'alert_reject_success': 'Request rejected.',
        'err_generic': 'Error occurred',
		'notif_new_request': 'New Job Request!',
        'notif_rider_wants': (name) => `Rider <b>${name}</b> wants to take this job`,
        'btn_confirm_assign': 'Confirm Assignment',
        'prompt_rating': (name) => `Please rate ${name} (1-5 points):`,
        'err_rating_range': 'Please enter a score between 1 and 5',
        'confirm_bypass': 'Do you want to confirm check-in at this point for the rider?',
        'msg_task_complete': '‚úÖ All points delivered. Job closed successfully.',
        'msg_bypass_success': '‚úÖ Point bypassed successfully',
		'confirm_delete_template': 'Are you sure you want to delete this order template?',
        'msg_delete_template_success': 'üóëÔ∏è Order template deleted successfully!',
		'no_templates_found': 'No saved templates found',
        'unit_stop_short': 'stops',
		'log_server_error': '‚ùå Cannot fetch data from server:',
        'before_unload_msg': 'You have pending tasks. Are you sure you want to leave?',
        'modal_title_address_book': 'üîñ Your Address Book',
        'modal_title_pin_map': 'üìç Pin Location',
        'btn_close': 'Close',
		'lbl_map_name': 'Name this location (e.g., Customer A House)',
        'plh_map_name': 'Enter location name...',
        'lbl_map_phone': 'Phone Number (Optional)',
        'plh_map_phone': 'e.g., 081-234-5678',
        'lbl_map_voice': 'Voice Command (Order Keyword)',
        'plh_map_voice': 'Speak or type short keyword',
        'lbl_map_coords_waiting': 'Coordinates: Please select a point on map',
        'btn_confirm_coords': 'Confirm Location',
        'btn_cancel': 'Cancel',
		'title_manage_locations': 'Manage Locations',
        'btn_close_window': 'Close Window',
        'ai_summary_success': 'AI Voice Analysis Successful',
        'ai_summary_subtitle': 'Review details before creating task',
        'lbl_task_and_title': 'Task Category & Title',
        'lbl_stops_sequence': 'Found Waypoints',
        'lbl_delivery_budget': 'Delivery Budget ',
        'btn_confirm_this_data': 'Confirm Data',
        'btn_edit_new': 'Edit',
		'sidebar_main_title': 'Manage Task',
        'sidebar_tab_notif': 'Status Updates',
        'sidebar_tab_details': 'Delivery Sequence',
        'sidebar_tab_chat': 'Chat with Rider',
        'plh_chat_input': 'Type a message...',
		'tpl_title': 'Save Order Template',
        'tpl_label_name': 'Template Name (e.g., Order A)',
        'tpl_plh_name': 'Enter easy name...',
        'tpl_label_voice': 'Voice Command (Keyword)',
        'tpl_plh_voice': 'e.g., Order A',
        'tpl_note': '* Say this keyword to automate ordering',
        'btn_save_template': 'Save Template',
		'tpl_list_title': 'Saved Orders',
        'btn_close_window': 'Close Window',
		'guide_title': 'Voice Command Guide',
        'guide_method_1_title': 'Method 1: Use "Order Name"',
        'guide_method_1_desc': 'Say "Order" followed by your saved template name. The system will auto-fill coordinates and budget.',
        'guide_method_1_ex': 'Example: "Order A", "Order Box Lunch"',
        'guide_method_2_title': 'Method 2: Detailed Command',
        'guide_method_2_desc': 'Speak task type, location, and budget in one sentence.',
        'guide_method_2_sub': 'Commands: Send Document / Send Product / Send Food + Saved Location name.',
        'guide_method_2_ex': 'Example: "Send document to Customer A fifty"',
        'guide_note': '* Note: Use short and clear names for better AI accuracy.',
        'btn_got_it': 'Got it',
		'note_title': 'Important Notes',
        'note_bypass_title': 'Bypassing Points',
        'note_bypass_desc': 'Bypassing is used to skip a delivery point in case the rider forgets to check in.',
		'swal_prevent_exit_title': 'Cannot leave this page',
        'swal_prevent_exit_text': (num) => `‚ö†Ô∏è You have ${num} pending tasks. Please complete them first.`,
		'placeholder_shop_name': 'Enter your shop name...',
        'msg_merchant_fee_info': '* First time free, subsequent changes incur zone fees',
        'title_merchant_confirm': 'Confirm Location & Shop Name',
		'confirm_shop_name_label': 'The shop name you want to use:',
		'title_merchant_verify': 'Confirm Merchant Request',
		'btn_confirm': 'Send request',
        'title_active_jobs': 'Active Tasks',
		'menu_manage_products': 'Manage Shop Menu/Products',
		'product_limit_note': 'Add up to 5 items (price excluding delivery)',
		'btn_save': 'Save Menu',
		'new_order_title': 'New Order Received!',
		'btn_accept_order': 'Accept & Call Rider',
		'btn_decline': 'Decline',
		'customer_name': 'Customer:',
		'accept_success_title': 'Order Accepted!',
        'accept_success_text': 'Task has been posted to the Index',
        'confirm_reject_title': 'Confirm Rejection?',
        'confirm_reject_text': 'System will refund customer (fees deducted) immediately',
        'reject_success_text': 'Customer refunded successfully',
        'btn_confirm_reject': 'Confirm Reject',
        'btn_cancel': 'Cancel',
        'error_connection': 'Connection Error',
        'error_generic': 'An error occurred',
		'customer_phone': 'Customer Phone:',
		'food_total': 'Food Total:',
        'net_total': 'Net Total:',
        'rider_wage': 'Rider Wage:',
        'order_id': 'Order ID:',
        'customer_name': 'Customer:',
		'sidebar_order_items_title': 'Ordered Items:',
    },
    'pt': {
        'menu_save_store': 'Salvar Local da Loja (Base)',
        'menu_add_location': 'Adicionar Local de Entrega',
        'menu_all_locations': 'Todos os Locais Salvos',
        'menu_all_orders': 'Todos os Pedidos Salvos',
        'menu_voice_commands': 'Comandos de Voz',
        'menu_info_usage': 'Notas Importantes',
		'btn_create_job_main': 'Criar Novo Trabalho',
        'link_saved_orders': 'Pedidos Salvos',
		'form_new_job_title': 'Detalhes do Novo Trabalho',
        'lbl_task_category': 'Categoria do Trabalho',
        'opt_general': 'Comida / Mercadorias em Geral',
        'opt_document': 'Entrega de Documentos',
        'opt_big_parcel': 'Pacote Grande / Itens Grandes',
		'preview_format': (cat, num) => `${cat} (${num} paradas)`,
        'lbl_task_desc': 'Detalhes Adicionais (ex: quantidade, tamanho)',
        'plh_task_desc': 'Insira detalhes para avalia√ß√£o do entregador...',
        'lbl_task_budget': 'Or√ßamento',
        'plh_task_budget': 'Insira o valor oferecido...',
        'btn_add_stop': 'Adicionar Ponto de Parada',
        'btn_post_job': 'Publicar Trabalho',
        'btn_voice_order': 'Voz',
        'link_save_order_template': 'Salvar como Modelo de Pedido',
		'status_checking': 'Verificando status...',
        'btn_confirm_rate': '‚úÖ Finalizar e Avaliar',
        'status_delivering': 'üõµ Entrega em andamento...',
        'status_requesting': (user) => `Entregador <b>${user}</b> solicitou...`,
        'status_waiting': '‚åõ Aguardando entregador...',
		'post_time_prefix': 'em',
        'lbl_rider': 'Entregador:',
        'rider_none': 'Ningu√©m',
        'progress_prefix': 'Progresso:',
        'unit_stop': 'paradas',
		'no_active_tasks': 'N√£o h√° tarefas em andamento',
        'error_loading_tasks': 'N√£o foi poss√≠vel carregar os dados',
		'err_no_username': 'üõë Usu√°rio n√£o encontrado. Por favor, fa√ßa login novamente.',
        'lbl_store_name': 'Digite o nome da sua loja ou empresa',
        'plh_enter_name': 'Digite o nome...',
        'modal_title_base': 'üè† Salvar Local da Loja (Base)',
        'btn_confirm_base': 'Confirmar Localiza√ß√£o Base',
		'modal_title_dropoff': 'üìç Marcar Ponto de Entrega',
        'btn_select_location': 'Selecionar este local',
		'lbl_location_alias': 'Nome do local (ex: Casa do Cliente A)',
        'modal_title_new_pin': 'üìç Marcar Novo Local',
        'btn_save_to_book': 'Salvar no Livro',
        'err_min_stops': 'Por favor, adicione pelo menos 1 ponto de entrega antes de salvar',
        'err_incomplete_info': 'Por favor, preencha todas as informa√ß√µes',
        'lbl_pickup_point': 'Ponto de Retirada',
        'lbl_dropoff_point': (index) => `Ponto de Entrega ${index}`,
        'err_pin_all_points': 'Por favor, marque todos os locais no pedido antes de salvar',
        'msg_save_success': '‚ú® Modelo de pedido salvo com sucesso!',
        'msg_save_failed': 'Falha ao salvar',
		'lbl_coords': 'Coords:',
        'err_voice_unsupported': 'Comandos de voz n√£o suportados neste navegador',
        'msg_try_again': 'Por favor, tente novamente',
        'err_no_pin': 'Por favor, marque um local no mapa primeiro',
        'err_no_location_name': 'Por favor, especifique um nome para o local',
        'msg_save_success_simple': 'Salvo com sucesso!',
		'lbl_pickup_full': 'üü¢ Ponto de Retirada',
        'lbl_dropoff_full': 'üìç Ponto de Entrega',
        'plh_place_name': 'Nome do local...',
        'plh_phone_contact': 'Telefone de contato (Opcional)...',
        'coords_not_set': 'Coords: N√£o especificado',
        'btn_select_map': 'Ver no Mapa',
        'btn_from_book': 'Do Livro de Endere√ßos',
		'lbl_pickup_only': 'üü¢ Ponto de Retirada',
        'lbl_dropoff_indexed': (index) => `üìç Ponto de Entrega ${index}`,
        'task_title_summary': (cat, count) => `${cat} (${count} paradas)`,
        'err_label_lat_required': 'Por favor, especifique o nome e salve as coordenadas primeiro',
        'no_saved_data': 'Nenhum dado salvo encontrado',
        'tag_store': '(Loja)',
        'lbl_coords_short': 'Coords:',
		'btn_wait_time': (time) => `Aguarde (${time}s)`,
        'err_min_stops_post': '‚ùå Por favor, adicione pelo menos 1 ponto de coleta/entrega',
        'lbl_pickup_simple': 'Ponto de Coleta',
        'lbl_dropoff_indexed_simple': (index) => `Ponto de Entrega ${index}`,
        'err_pin_required_all': '‚ùå Por favor, marque todos os locais antes de postar',
        'msg_post_success': 'üöÄ Trabalho postado com sucesso!',
        'err_voice_failed': 'Erro no reconhecimento de voz ou permiss√£o de microfone negada',
        'btn_voice_start': 'Toque para iniciar comando de voz',
		'btn_voice_listening': 'Ouvindo...',
		'key_order': 'pedido',
        'key_doc': 'documento',
        'key_mail': 'correio',
        'cat_general': 'Entrega Geral',
        'cat_doc': 'Entrega de Documentos',
        'unit_stop_voice': 'paradas',
		'err_voice_not_supported': 'Este navegador n√£o suporta voz',
        'msg_voice_retry_simple': 'Por favor, tente falar novamente',
		'sum_pickup': 'Ponto de Coleta',
        'sum_dropoff': (i) => `Ponto de Entrega ${i}`,
        'sum_no_coords': 'Coordenadas n√£o encontradas',
		'status_pickup_ai': '‚úÖ Ponto de Coleta (IA)',
        'status_dropoff_ai': (i) => `‚úÖ Ponto de Entrega ${i} (IA)`,
		'lbl_store_base_name': 'Localiza√ß√£o da Minha Loja',
        'no_saved_locations': 'Nenhum local de entrega salvo',
        'no_phone': 'Sem telefone',
        'confirm_delete_loc': (name) => `Deseja excluir "${name}"?`,
        'msg_delete_success': 'Local exclu√≠do com sucesso',
		'modal_title_edit': '‚úèÔ∏è Editar Localiza√ß√£o',
        'btn_save_edit': 'Salvar Altera√ß√µes',
        'warn_no_location': 'N√£o foi poss√≠vel obter a localiza√ß√£o ou permiss√£o negada',
		'sidebar_job_prefix': 'Tarefa:',
        'sidebar_rider_interested': 'Entregador interessado',
        'sidebar_score_unit': 'Pontos',
        'sidebar_stat_jobs': 'Trabalhos',
        'sidebar_stat_level': 'N√≠vel',
        'sidebar_level_best': 'Excelente',
        'sidebar_btn_approve': 'Aceitar',
        'sidebar_btn_reject': 'Recusar',
        'sidebar_assigned_msg': (name) => `Atribu√≠do a ${name}`,
        'sidebar_track_info': 'Pode rastrear a localiza√ß√£o e conversar em outras abas',
        'status_waiting_rider': '‚åõ Aguardando entregadores...',
		'sidebar_pickup_label': 'üè† Retirada',
        'sidebar_dropoff_label': (i) => `üìç Entrega ${i}`,
        'btn_delete_task': 'Cancelar e Excluir Trabalho',
        'delete_task_note': '* Voc√™ s√≥ pode excluir trabalhos antes que um entregador aceite.',
		'chat_loading': 'Carregando mensagens...',
        'err_chat_send_failed': 'Falha ao enviar mensagem. Tente novamente.',
		'swal_del_title': 'Confirmar exclus√£o?',
        'swal_del_text': 'O trabalho ser√° removido e seu status ser√° redefinido.',
        'swal_del_btn': 'Sim, excluir',
        'swal_cancel': 'Cancelar',
        'swal_del_success_title': 'Exclu√≠do!',
        'swal_del_success_text': 'Seu status foi redefinido.',
        'err_no_user_title': 'Erro',
        'err_no_user_text': 'Usu√°rio n√£o encontrado. Por favor, fa√ßa login novamente.',
        'confirm_approve_rider': 'Deseja atribuir este trabalho a este entregador?',
        'alert_approve_success': '‚úÖ Atribu√≠do com sucesso!',
        'confirm_reject_rider': 'Deseja rejeitar a solicita√ß√£o deste entregador?',
        'alert_reject_success': 'Solicita√ß√£o rejeitada.',
        'err_generic': 'Ocorreu um erro',
		'notif_new_request': 'Novo Pedido!',
        'notif_rider_wants': (name) => `Entregador <b>${name}</b> quer aceitar este trabalho`,
        'btn_confirm_assign': 'Confirmar Atribui√ß√£o',
        'prompt_rating': (name) => `Por favor, avalie ${name} (1-5 pontos):`,
        'err_rating_range': 'Insira uma pontua√ß√£o entre 1 e 5',
        'confirm_bypass': 'Deseja confirmar o check-in neste ponto para o entregador?',
        'msg_task_complete': '‚úÖ Todos os pontos entregues. Trabalho finalizado.',
        'msg_bypass_success': '‚úÖ Ponto ignorado com sucesso',
		'confirm_delete_template': 'Tem certeza que deseja excluir este modelo de pedido?',
        'msg_delete_template_success': 'üóëÔ∏è Modelo de pedido exclu√≠do com sucesso!',
		'no_templates_found': 'Nenhum modelo salvo encontrado',
        'unit_stop_short': 'paradas',
		'log_server_error': '‚ùå N√£o foi poss√≠vel buscar dados do servidor:',
        'before_unload_msg': 'Voc√™ tem tarefas pendentes. Tem certeza de que deseja sair?',
        'modal_title_address_book': 'üîñ Seu Livro de Endere√ßos',
        'modal_title_pin_map': 'üìç Marcar Localiza√ß√£o',
        'btn_close': 'Fechar',
		'lbl_map_name': 'Nomear este local (ex: Casa do Cliente A)',
        'plh_map_name': 'Digite o nome do local...',
        'lbl_map_phone': 'Telefone (Opcional)',
        'plh_map_phone': 'ex: 081-234-5678',
        'lbl_map_voice': 'Comando de Voz (Palavra-chave)',
        'plh_map_voice': 'Fale ou digite uma palavra curta',
        'lbl_map_coords_waiting': 'Coordenadas: Selecione um ponto no mapa',
        'btn_confirm_coords': 'Confirmar Local',
        'btn_cancel': 'Cancelar',
		'title_manage_locations': 'Gerenciar Locais',
        'btn_close_window': 'Fechar Janela',
        'ai_summary_success': 'An√°lise de Voz IA com Sucesso',
        'ai_summary_subtitle': 'Revise os detalhes antes de criar a tarefa',
        'lbl_task_and_title': 'Categoria e T√≠tulo',
        'lbl_stops_sequence': 'Pontos Encontrados',
        'lbl_delivery_budget': 'Or√ßamento de Entrega (THB)',
        'btn_confirm_this_data': 'Confirmar Dados',
        'btn_edit_new': 'Editar',
		'sidebar_main_title': 'Gerenciar Tarefa',
        'sidebar_tab_notif': 'Notifica√ß√µes',
        'sidebar_tab_details': 'Sequ√™ncia de Entrega',
        'sidebar_tab_chat': 'Chat com Entregador',
        'plh_chat_input': 'Digite uma mensagem...',
		'tpl_title': 'Salvar Modelo de Pedido',
        'tpl_label_name': 'Nome do Modelo (ex: Pedido A)',
        'tpl_plh_name': 'Digite um nome f√°cil...',
        'tpl_label_voice': 'Comando de Voz (Palavra-chave)',
        'tpl_plh_voice': 'ex: Pedido A',
        'tpl_note': '* Fale esta palavra para automatizar o pedido',
        'btn_save_template': 'Salvar Modelo',
		'tpl_list_title': 'Pedidos Salvos',
        'btn_close_window': 'Fechar Janela',
		'guide_title': 'Guia de Comando de Voz',
        'guide_method_1_title': 'M√©todo 1: Usar "Nome do Pedido"',
        'guide_method_1_desc': 'Diga "Pedido" seguido pelo nome do seu modelo salvo. O sistema preencher√° tudo automaticamente.',
        'guide_method_1_ex': 'Exemplo: "Pedido A", "Pedido Marmita"',
        'guide_method_2_title': 'M√©todo 2: Comando Detalhado',
        'guide_method_2_desc': 'Diga o tipo de tarefa, local e valor em uma √∫nica frase.',
        'guide_method_2_sub': 'Comandos: Enviar Documento / Enviar Produto / Enviar Comida + Nome do local salvo.',
        'guide_method_2_ex': 'Exemplo: "Enviar documento para Cliente A cinquenta reais"',
        'guide_note': '* Nota: Use nomes curtos e claros para melhor precis√£o da IA.',
        'btn_got_it': 'Entendi',
		'note_title': 'Lembretes Importantes',
        'note_bypass_title': 'Ignorar Pontos (Bypass)',
        'note_bypass_desc': 'O bypass √© usado para pular um ponto de entrega caso o entregador esque√ßa de fazer o check-in.',
		'swal_prevent_exit_title': 'N√£o √© poss√≠vel sair',
        'swal_prevent_exit_text': (num) => `‚ö†Ô∏è Voc√™ tem ${num} tarefas pendentes. Conclua-as primeiro.`,
		'placeholder_shop_name': 'Insira o nome da sua loja...',
        'msg_merchant_fee_info': '* Primeira vez gr√°tis, altera√ß√µes subsequentes sujeitas a taxas de zona',
        'title_merchant_confirm': 'Confirmar Localiza√ß√£o e Nome da Loja',
		'confirm_shop_name_label': 'O nome da loja que voc√™ deseja usar:',
		'title_merchant_verify': 'Confirmar solicita√ß√£o de comerciante',
		'btn_confirm': 'Enviar solicita√ß√£o',
        'title_active_jobs': 'Tarefas em Andamento',
		'menu_manage_products': 'Gerenciar Card√°pio/Produtos',
		'product_limit_note': 'Adicione at√© 5 itens (pre√ßo sem entrega)',
		'btn_save': 'Salvar Card√°pio',
		'new_order_title': 'Novo Pedido Recebido!',
		'btn_accept_order': 'Aceitar e Chamar Entregador',
		'btn_decline': 'Recusar',
		'customer_name': 'Cliente:',
		'accept_success_title': 'Pedido Aceito!',
        'accept_success_text': 'A tarefa foi postada no Index',
        'confirm_reject_title': 'Confirmar Rejei√ß√£o?',
        'confirm_reject_text': 'O sistema reembolsar√° o cliente (taxas deduzidas) imediatamente',
        'reject_success_text': 'Cliente reembolsado com sucesso',
        'btn_confirm_reject': 'Confirmar Rejei√ß√£o',
        'btn_cancel': 'Cancelar',
        'error_connection': 'Erro de Conex√£o',
        'error_generic': 'Ocorreu um erro',
		'customer_phone': 'Telefone do Cliente:',
		'food_total': 'Total da Comida:',
        'net_total': 'Total desta Tarefa:',
        'rider_wage': 'Taxa do Entregador:',
        'order_id': 'ID do Pedido:',
        'customer_name': 'Cliente:',
		'sidebar_order_items_title': 'Itens Pedidos:',
    }
};


function applyMerchantTranslations() {
    console.log(`[i18n] Applying translations for: ${currentLang}`);

    // ‡πÉ‡∏ä‡πâ data-i18n-key ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏û‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö
    document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.getAttribute('data-i18n-key');
        const translatedText = translations[currentLang]?.[key];

        if (translatedText) {
            // üö© ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Input / Textarea) ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡πà Placeholder
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                el.placeholder = translatedText;
            } 
            // üö© ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Element ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô <i> ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô
            else {
                const icon = el.querySelector('i');
                if (icon) {
                    el.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
                    el.appendChild(icon); // ‡πÉ‡∏™‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°
                    el.insertAdjacentHTML('beforeend', ' ' + translatedText); // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                } else {
                    // üö© ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
                    el.innerText = translatedText;
                }
            }
        }
    });
}

// ‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
window.addEventListener('DOMContentLoaded', () => {
    applyMerchantTranslations();
});
	
	
	
	// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Sidebar
async function toggleMerchantSidebar() {
    const sidebar = document.getElementById('merchant-sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    
    // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Sidebar
    const isActive = sidebar.classList.toggle('active');
    overlay.classList.toggle('hidden');

    // üö© ‡∏ñ‡πâ‡∏≤ Sidebar ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πâ‡∏≤‡∏ô‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏î‡πâ‡∏ß‡∏¢
    if (isActive) {
        updateSwitchFromData();
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
function updateSwitchFromData() {
    const toggle = document.getElementById('merchant-status-toggle');
    const statusText = document.getElementById('status-text');

    if (!toggle || !statusText) return;

    // üö© ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤
    const storeLoc = (typeof mySavedLocations !== 'undefined') 
        ? mySavedLocations.find(loc => loc.isStore === true) 
        : null;

    // üö© ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô Merchant ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)
    if (!storeLoc) {
        toggle.disabled = true;
        toggle.parentElement.style.opacity = "0.5";
        toggle.parentElement.style.cursor = "not-allowed";
        statusText.innerText = 'UNVERIFIED';
        toggle.checked = false;
        return;
    }

    // ‚úÖ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Merchant (‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• storeLoc)
    toggle.disabled = false;
    toggle.parentElement.style.opacity = "1";
    toggle.parentElement.style.cursor = "pointer";

    const isOpen = storeLoc.isOpen === true;
    toggle.checked = isOpen;
    statusText.innerText = isOpen ? 'OPEN' : 'CLOSED';
    statusText.style.color = isOpen ? '#28a745' : '#666';
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô
function toggleTaskForm() {
    const form = document.getElementById('task-form-container');
    const activeList = document.getElementById('active-tasks-container');
    form.classList.toggle('hidden');
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÉ‡∏´‡πâ‡∏î‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏•‡∏á‡πÑ‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ
    if(!form.classList.contains('hidden')) {
        window.scrollTo({ top: form.offsetTop, behavior: 'smooth' });
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö
async function loadActiveMerchantTasks() {
    const listContainer = document.getElementById('active-tasks-list');
    const t = translations[currentLang];

    try {
        const res = await fetch(`/api/merchant/tasks?username=${myUsername}`);
        const data = await res.json();

        if (data.success && data.posts.length > 0) {
            let finalHtml = ''; 

            data.posts.forEach(post => {
                // ‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏ó‡∏∏‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏î‡πÑ‡∏î‡πâ
                socket.emit('join-post', post.id);

                const totalStops = post.stops.length;
                const completedStops = post.stops.filter(s => s.status === 'success').length;
                const progressPercent = (completedStops / totalStops) * 100;
                const canConfirm = (completedStops === totalStops);
                const postTime = new Date(post.id).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                const refCode = post.id.toString().slice(-4);

                let actionBtnHtml = '';
                
                if (post.acceptedBy) {
        if (canConfirm) {
            actionBtnHtml = `<button onclick="event.stopPropagation(); confirmAndRate('${post.id}', '${post.acceptedBy}')" 
                style="background: #27ae60; color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.85em; cursor: pointer; font-weight:bold;">
                ${t.btn_confirm_rate}
            </button>`;
        } else {
            actionBtnHtml = `<small style="color: #11998e; font-weight: bold;">${t.status_delivering}</small>`;
        }
    } else if (post.pendingRider) {
        actionBtnHtml = `
            <div style="text-align:right;">
                <small style="display:block; margin-bottom:5px; color:#eb9123;">
                    ${t.status_requesting(post.pendingRider)}
                </small>
            </div>`;
    } else {
        actionBtnHtml = `<small style="color: #999;">${t.status_waiting}</small>`;
    }

                const borderStyle = canConfirm ? 'border-left: 6px solid #27ae60;' : 'border-left: 6px solid #f39c12;';

                // üö© ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ: ‡πÄ‡∏û‡∏¥‡πà‡∏° ID ‡πÅ‡∏•‡∏∞ Badge Container
                finalHtml += `
    <div id="card-${post.id}" class="active-task-card" onclick="openRightSidebar('${post.id}')" style="${borderStyle} padding: 15px; background: white; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor:pointer;">
        
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <span style="background: #eee; color: #666; font-size: 0.7em; padding: 2px 6px; border-radius: 4px;">#${refCode}</span>
                <small style="color: #999; margin-left: 5px;">${t.post_time_prefix} ${postTime}</small>
                <div style="font-weight: bold; font-size: 1.1em; color: #333; margin-top: 3px;">${post.title}</div>
            </div>
            <b style="color: #e67e22; font-size: 1.2em;">‡∏ø${post.budget}</b>
        </div>
        
        <div style="font-size: 0.85em; color: #666; margin: 10px 0; display: flex; align-items: center;">
        üë§ ${t.lbl_rider} <span style="color: #11998e; font-weight: 600; margin-left: 4px;">${post.acceptedBy || t.rider_none}</span>
        
        <div id="notif-box-${post.id}" class="notif-inline-wrapper">
            <i class="fas fa-comment-dots msg-icon-small"></i>
            <div class="dot-on-icon-small"></div>
        </div>
    </div>
                        
                        <div class="task-progress-bar" style="height: 6px; background: #eee; border-radius: 10px; overflow: hidden; margin-bottom: 5px;">
                            <div class="progress-fill" style="width: ${progressPercent}%; height: 100%; background: #11998e; transition: 0.5s;"></div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
        <small style="color: #888; font-weight: bold;">
            ${t.progress_prefix} ${completedStops}/${totalStops} ${t.unit_stop}
        </small>
        ${actionBtnHtml}
    </div>
                    </div>
                `;
            });

            listContainer.innerHTML = finalHtml;
        } else {
            listContainer.innerHTML = `<div style="text-align:center; padding: 30px; color: #999;">${t.no_active_tasks}</div>`;
        }
    } catch (e) {
        console.error(e);
        listContainer.innerHTML = `<p style="color:red; text-align:center;">${t.error_loading_tasks}</p>`;
    }
}



// 1. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ fetch ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ)
function updateMerchantHeaderBalance(data) {
    const balanceEl = document.getElementById('merchant-balance-display');
    const nameEl = document.getElementById('merchant-name-display');

    if (data) {
        if (nameEl) {
            nameEl.innerText = data.storeName || "GedGo Merchant";
        }

        if (balanceEl) {
            const amount = data.balance !== undefined ? data.balance : 0;
            const formattedBalance = parseFloat(amount).toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            const symbol = data.currency || 'USDT';
            balanceEl.innerHTML = `${formattedBalance} <small>${symbol}</small>`;
        }
    }
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Fetch ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
async function fetchAndRefreshMerchantBalance() {
    const username = localStorage.getItem('myUsername');
    if (!username) return;

    try {
        const res = await fetch(`/api/merchant/balance?username=${encodeURIComponent(username)}`);
        const data = await res.json();
        if (data.success) {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
            updateMerchantHeaderBalance(data);
        }
    } catch (e) {
        console.error("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:", e.message);
    }
}


// 3. ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
window.onload = async function() {
	const currentLang = localStorage.getItem('preferredLanguage') || 'th';
	const t = translations[currentLang];
    const myUsername = localStorage.getItem('myUsername');

    if (!myUsername) {
    console.error(t.err_no_username);
    // ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á Swal ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ index ‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
    window.location.href = 'index.html';
    return;
	}

    // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß Fetch (‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å updateMerchantHeaderBalance ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ)
    await fetchAndRefreshMerchantBalance();
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    if (typeof debugMerchantStatus === 'function') await debugMerchantStatus();
    if (typeof loadSavedLocations === 'function') await loadSavedLocations();   
    if (typeof loadActiveMerchantTasks === 'function') await loadActiveMerchantTasks(); 
    if (typeof loadOrderTemplates === 'function') await loadOrderTemplates();
};



// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏Ñ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô)
function openSaveStoreModal() {
	const currentLang = localStorage.getItem('preferredLanguage') || 'th';
	const t = translations[currentLang];
    toggleMerchantSidebar();
    
    // üîç 1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Flag 'isStore' ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠
    const existingStore = mySavedLocations.find(loc => loc.isStore === true);
    
    if (existingStore) {
        editingLocationId = existingStore._id;
        selectedLat = parseFloat(existingStore.lat);
        selectedLng = parseFloat(existingStore.lng);
        document.getElementById('map-loc-name').value = existingStore.label; // ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
    } else {
        editingLocationId = null;
        document.getElementById('map-loc-name').value = ""; // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏á
    }

    mapMode = 'book';
    isStoreMode = true; // üö© ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÑ‡∏ß‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î Confirm
    
    document.getElementById('map-modal').classList.remove('hidden');
    document.getElementById('map-extra-info').classList.remove('hidden');
	document.getElementById('map-label-name').innerHTML = `<i class="fas fa-store"></i> ${t.lbl_store_name}`;
    
    // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
    const nameInput = document.getElementById('map-loc-name');
	nameInput.readOnly = false;
	nameInput.placeholder = t.plh_enter_name;

    document.querySelector('#map-modal h3').innerText = t.modal_title_base;
	document.querySelector('#map-modal .btn-submit:first-child').innerText = t.btn_confirm_base;
    
    initMap();
    if (existingStore && merchantMap) {
        merchantMap.setView([selectedLat, selectedLng], 17);
        updateMarker(selectedLat, selectedLng);
    }
}

function openStopMap(id) {
    currentTargetStopId = id;
    mapMode = 'stop';
    
    document.getElementById('map-modal').classList.remove('hidden');
    document.getElementById('map-extra-info').classList.add('hidden');
    
    document.querySelector('#map-modal h3').innerText = translations[currentLang].modal_title_dropoff;
	document.querySelector('#map-modal .btn-submit:first-child').innerText = translations[currentLang].btn_select_location;
    
    initMap();
    // üö© ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
    setTimeout(() => { if(merchantMap) merchantMap.invalidateSize(); }, 300);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
function openAddLocationModal() {
    toggleMerchantSidebar(); 
    editingLocationId = null;
    mapMode = 'book';
	isStoreMode = false;
    
    document.getElementById('map-modal').classList.remove('hidden');
    document.getElementById('map-extra-info').classList.remove('hidden');
	document.getElementById('map-label-name').innerHTML = `<i class="fas fa-tag"></i> ${translations[currentLang].lbl_location_alias}`;
    
    // üö© ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
    const nameInput = document.getElementById('map-loc-name');
    nameInput.value = "";
    nameInput.readOnly = false;
    nameInput.style.background = "white";

    document.getElementById('map-loc-voice').value = "";
    document.querySelector('#map-modal h3').innerText = translations[currentLang].modal_title_new_pin;
	document.querySelector('#map-modal .btn-submit:first-child').innerText = translations[currentLang].btn_save_to_book;
    
    initMap();
}




// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
function openSaveTemplateModal() {
    const stopsCount = document.querySelectorAll('.stop-item').length;
    if (stopsCount === 0) return alert(translations[currentLang].err_min_stops);
    
    document.getElementById('save-template-modal').classList.remove('hidden');
    document.getElementById('tpl-name').value = "";
    document.getElementById('tpl-voice').value = "";
}

function closeSaveTplModal() {
    document.getElementById('save-template-modal').classList.add('hidden');
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Server)
async function confirmSaveTemplate() {
    const tplName = document.getElementById('tpl-name').value.trim();
    const voiceKey = document.getElementById('tpl-voice').value.trim();
    
    if (!tplName || !voiceKey) return alert(translations[currentLang].err_incomplete_info);

    const stops = [];
    const stopElements = document.querySelectorAll('.stop-item');
    let hasError = false;

    stopElements.forEach((el, index) => {
        const id = el.id.split('-')[1];
        const label = document.getElementById(`label-${id}`).value;
        const phone = document.getElementById(`phone-${id}`).value;
        const lat = document.getElementById(`lat-${id}`).value;
        const lng = document.getElementById(`lng-${id}`).value;

        if (!lat || !lng) hasError = true;

        stops.push({
            step: index + 1,
            label: label || (index === 0 ? translations[currentLang].lbl_pickup_point : translations[currentLang].lbl_dropoff_point(index)),
            phone: phone,
            lat: parseFloat(lat),
            lng: parseFloat(lng),
            status: 'pending'
        });
    });

    if (hasError) return alert(translations[currentLang].err_pin_all_points);

    const payload = {
        username: myUsername,
        templateName: tplName,
        voiceKeyword: voiceKey,
        category: document.getElementById('task-category').value,
        budget: document.getElementById('task-budget').value || 0,
        content: document.getElementById('task-desc').value,
        stops: stops
    };

    try {
        const res = await fetch('/api/merchant/templates', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (data.success) {
            alert(translations[currentLang].msg_save_success);
            closeSaveTplModal();
            loadOrderTemplates(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global
        }
    } catch (e) { 
    alert(translations[currentLang].msg_save_failed); 
}
}

// 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
async function openListOrderModal() {
    await loadOrderTemplates(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    renderTemplateListInModal(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    document.getElementById('list-order-modal').classList.remove('hidden');
}

function closeListOrderModal() {
    document.getElementById('list-order-modal').classList.add('hidden');
}

// 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏°‡∏≤‡πÉ‡∏ä‡πâ (‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
function selectOrderTemplate(index) {
    const tpl = myOrderTemplates[index];
    if (!tpl) return;

    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
    document.getElementById('task-category').value = tpl.category;
    document.getElementById('task-budget').value = tpl.budget;
    document.getElementById('task-desc').value = tpl.content || "";

    // ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏Å‡πà‡∏≤
    document.getElementById('stops-container').innerHTML = "";
    stopCount = 0;

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï
    tpl.stops.forEach((stop) => {
        addNewStop();
        const currentId = stopCount;
        
        // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ DOM ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤
        setTimeout(() => {
            document.getElementById(`label-${currentId}`).value = stop.label;
            document.getElementById(`phone-${currentId}`).value = stop.phone || "";
            document.getElementById(`lat-${currentId}`).value = stop.lat;
            document.getElementById(`lng-${currentId}`).value = stop.lng;
            document.getElementById(`coords-display-${currentId}`).innerText = 
    `${translations[currentLang].lbl_coords} ${parseFloat(stop.lat).toFixed(5)}, ${parseFloat(stop.lng).toFixed(5)}`;
            reorderStops();
        }, 0);
    });

    closeListOrderModal();
    // ‡∏ñ‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏î‡∏π‡∏î‡πâ‡∏ß‡∏¢
    document.getElementById('task-form-container').classList.remove('hidden');
}

// 5. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï
function startVoiceForTemplate(btn) {
    if (!SpeechRecognition) return alert(translations[currentLang].err_voice_unsupported);
    const vRec = new SpeechRecognition();
    vRec.lang = 'th-TH';
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    vRec.start();
    vRec.onresult = (e) => {
        const text = e.results[0][0].transcript;
        document.getElementById('tpl-voice').value = text.replace(/\s+/g, '');
        btn.innerHTML = '<i class="fas fa-microphone"></i>';
    };
    vRec.onerror = () => {
        btn.innerHTML = '<i class="fas fa-microphone"></i>';
        alert(translations[currentLang].msg_try_again);
    };
}




// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î
function updateMarker(lat, lng) {
    selectedLat = lat;
    selectedLng = lng;
    if (currentMarker) merchantMap.removeLayer(currentMarker);
    currentMarker = L.marker([lat, lng], { draggable: true }).addTo(merchantMap);
    document.getElementById('map-coords-display').innerText = `üìç: ${lat.toFixed(5)}, ${lng.toFixed(5)}`;
}


async function loadSavedLocations() {
    const res = await fetch(`/api/merchant/locations?username=${myUsername}`);
    const data = await res.json();
    if (data.success) {
        mySavedLocations = data.locations;
        const storeLoc = mySavedLocations.find(loc => loc.isStore === true);
        if (storeLoc) {
            displayMerchantLocation(storeLoc.lat, storeLoc.lng, storeLoc.phone);
        }
    }
}


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
let isStoreMode = false; 

async function confirmMapLocation() {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    if (!selectedLat || !selectedLng) return alert(translations[currentLang].err_no_pin);

    // 2. ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á (Stop Mode)
    if (mapMode === 'stop') {
        const id = currentTargetStopId;
        const latInput = document.getElementById(`lat-${id}`);
        const lngInput = document.getElementById(`lng-${id}`);
        const coordsDisplay = document.getElementById(`coords-display-${id}`);

        if (latInput && lngInput) {
            latInput.value = selectedLat;
            lngInput.value = selectedLng;
            if (coordsDisplay) {
                coordsDisplay.innerText = `${translations[currentLang].lbl_coords} ${selectedLat.toFixed(5)}, ${selectedLng.toFixed(5)}`;
            }
            closeMapModal();
        }
        return;
    }

    // ---------------------------------------------------------
    // 3. ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏¢‡∏Å: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (isStoreMode)
    // ---------------------------------------------------------
    if (isStoreMode) {
        const inputShopName = document.getElementById('map-loc-name').value.trim();
        
        if (!inputShopName) {
            return Swal.fire({
                icon: 'warning',
                text: translations[currentLang].err_no_location_name || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì'
            });
        }

        // üö© ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ï‡∏≤‡∏°‡πÇ‡∏ã‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î
        const feeRes = await fetch('/api/merchant/check-fee', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ lat: selectedLat, lng: selectedLng, username: myUsername })
        });
        const feeData = await feeRes.json();

        if (!feeData.success) {
            return Swal.fire('Error', translations[currentLang].err_outside_zone, 'error');
        }

        const { fee, currency, isFirstTime } = feeData;
        const feeLabel = isFirstTime 
            ? `0 ${currency} (${translations[currentLang].free_first_time || '‡∏ü‡∏£‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å'})`
            : `${fee} ${currency}`;

        closeMapModal();	

        const result = await Swal.fire({
            title: translations[currentLang].title_merchant_verify || '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô',
            html: `
                <div style="text-align: center; padding: 10px;">
                    <p style="margin-bottom: 5px;">${translations[currentLang].confirm_shop_name_label}</p>
                    <h3 style="color: var(--primary); margin-top: 0;">${inputShopName}</h3>
                </div>
            `,
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: translations[currentLang].btn_confirm || '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠',
            cancelButtonText: translations[currentLang].swal_cancel || '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            // üö© ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô Footer (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ñ‡πâ‡∏≤‡∏ü‡∏£‡∏µ / ‡πÅ‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô)
            footer: `<div style="text-align:center;"><small style="color: ${fee > 0 ? 'red' : 'green'}; font-weight:bold;">${translations[currentLang]['msg_merchant_fee_info']}: ${feeLabel}</small></div>`,
            didOpen: () => {
                Swal.getPopup().style.zIndex = '10000';
            }
        });

        if (result.isConfirmed) {
            try {
                const res = await fetch('/api/merchant/apply', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: myUsername,
                        shopName: inputShopName,
                        lat: selectedLat,
                        lng: selectedLng,
                        phone: document.getElementById('map-loc-phone')?.value || "",
                        description: document.getElementById('map-loc-voice')?.value || "",
                        lang: currentLang
                    })
                });

                const data = await res.json();
                if (data.success) {
                    Swal.fire(translations[currentLang].swal_success, data.message, 'success');
                    isStoreMode = false;
                    closeMapModal();
                    await loadSavedLocations();
                } else {
                    Swal.fire(translations[currentLang].swal_error, data.message, 'error');
                }
            } catch (err) {
                Swal.fire('Error', 'Unable to connect to server.', 'error');
            }
        } else {
            document.getElementById('map-modal').classList.remove('hidden');
        }
        
        return;
    }

    // ---------------------------------------------------------
    // 4. ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏î‡∏¥‡∏°: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Book Mode)
    // ---------------------------------------------------------
    const nameInput = document.getElementById('map-loc-name');
    const name = nameInput ? nameInput.value.trim() : "";
    
    if (!name) return alert(translations[currentLang].err_no_location_name);

    const payload = {
        username: myUsername,
        label: name,
        phone: document.getElementById('map-loc-phone').value,
        voiceKeyword: document.getElementById('map-loc-voice').value || name,
        lat: selectedLat,
        lng: selectedLng,
        isStore: false
    };

    let url = '/api/merchant/locations';
    let method = 'POST';
    if (editingLocationId) {
        url = `/api/merchant/locations/${editingLocationId}`;
        method = 'PUT';
    }

    const res = await fetch(url, {
        method: method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });

    const data = await res.json();
    if (data.success) {
        alert(translations[currentLang].msg_save_success_simple);
        isStoreMode = false; 
        await loadSavedLocations();
        closeMapModal();
    }
}

function closeMapModal() {
    document.getElementById('map-modal').classList.add('hidden');
}


    // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
    function addNewStop() {
    stopCount++;
    const container = document.getElementById('stops-container');
    const isPickup = (document.querySelectorAll('.stop-item').length === 0);
    const themeColor = isPickup ? "#27ae60" : "#11998e";
    const bgColor = isPickup ? "#b5f7b8" : "#baffff";
    const labelTitle = isPickup 
    ? translations[currentLang].lbl_pickup_full 
    : translations[currentLang].lbl_dropoff_full;

    const stopHtml = `
        <div class="stop-item" id="stop-${stopCount}" style="border-left: 6px solid ${themeColor}; background-color: ${bgColor}; padding: 15px; border-radius: 12px; margin-bottom: 12px; position: relative;">
            <span class="remove-stop" onclick="removeStop(${stopCount})"><i class="fas fa-times-circle"></i></span>
            
            <label style="color: ${themeColor}; font-weight: bold;">${labelTitle} <span class="stop-display-number"></span></label>

            <input type="text" 
            placeholder="${translations[currentLang].plh_place_name}" 
            class="stop-label" id="label-${stopCount}" 
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 8px;">
            
            <input type="tel" 
            placeholder="${translations[currentLang].plh_phone_contact}" 
            id="phone-${stopCount}" 
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 5px;">

            <div id="coords-display-${stopCount}" style="font-size: 0.7em; color: #999; margin-bottom: 10px;">
            ${translations[currentLang].coords_not_set}
        </div>
            
            <div style="display: flex; gap: 6px;">
            <button class="btn-add-contacmap" onclick="openStopMap(${stopCount})">
                <i class="fas fa-map"></i> ${translations[currentLang].btn_select_map}
            </button>
            <button class="btn-add-contac" onclick="showSavedLocationsModal(${stopCount})">
                <i class="fas fa-bookmark"></i> ${translations[currentLang].btn_from_book}
            </button>
        </div>

            <input type="hidden" id="lat-${stopCount}">
            <input type="hidden" id="lng-${stopCount}">
        </div>
    `;
    container.insertAdjacentHTML('beforeend', stopHtml);
    reorderStops();
}

function reorderStops() {
    const stops = document.querySelectorAll('.stop-item');
    stops.forEach((stop, index) => {
        const isPickup = (index === 0);
        
        // üö© ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å .stop-number ‡πÄ‡∏õ‡πá‡∏ô .stop-display-number ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö HTML
        const displayNum = stop.querySelector('.stop-display-number'); 
        const label = stop.querySelector('label');
        
        if (isPickup) {
            if (displayNum) displayNum.innerText = ""; 
            label.innerHTML = translations[currentLang].lbl_pickup_only;
            label.style.color = "#27ae60";
            stop.style.borderLeftColor = "#27ae60";
        } else {
            if (displayNum) displayNum.innerText = index; // ‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà 1, 2, 3...
            label.innerHTML = translations[currentLang].lbl_dropoff_indexed(index);
            label.style.color = "#11998e";
            stop.style.borderLeftColor = "#11998e";
        }
    });

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ Preview ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
    updateTitlePreview();
}

    function removeStop(id) {
        document.getElementById(`stop-${id}`).remove();
        reorderStops();
    }

function updateTitlePreview() {
    const currentLang = localStorage.getItem('preferredLanguage') || 'th';
    const categoryKey = document.getElementById('task-category').value;
    
    // ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô
    const categoryName = translations[currentLang][`opt_${categoryKey}`] || categoryKey;
    
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î
    const totalStops = document.querySelectorAll('.stop-item').length;
    const deliveryStops = totalStops > 1 ? totalStops - 1 : 0;
    
    let finalTitle = "";
    
    // üö© ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ preview_format ‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°
    if (typeof translations[currentLang].preview_format === 'function') {
        finalTitle = translations[currentLang].preview_format(categoryName, deliveryStops);
    } else {
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏∑‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô) ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡∏±‡∏ô Error
        finalTitle = `${categoryName} (${deliveryStops})`;
    }
    
    const previewEl = document.getElementById('title-preview');
    if (previewEl) {
        previewEl.innerText = finalTitle;
    }

    return finalTitle;
}

    // 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Saved Locations)
    function saveToMyBook(id) {
        const label = document.getElementById(`label-${id}`).value;
        const lat = document.getElementById(`lat-${id}`).value;
        const lng = document.getElementById(`lng-${id}`).value;
        if (!label || !lat) return alert(translations[currentLang].err_label_lat_required);
        
        mySavedLocations.push({ label, lat, lng });
        alert(translations[currentLang].msg_save_success_simple);
    }

    function showSavedLocationsModal(stopId) {
    currentTargetStopId = stopId;
    const listContent = document.getElementById('saved-list-content');
    listContent.innerHTML = "";

    // üö© ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢
    // (‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£ loc.isStore !== true ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ)
    const selectableLocations = mySavedLocations; 

    if (selectableLocations.length === 0) {
        listContent.innerHTML = `<p style='text-align:center; color:#999;'>${translations[currentLang].no_saved_data}</p>`;
    } else {
        selectableLocations.forEach((loc) => {
            const originalIndex = mySavedLocations.findIndex(l => l._id === loc._id);
            
            // üö© ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡∏°‡∏∏‡∏î)
            const iconClass = loc.isStore ? 'fa-store' : 'fa-map-pin';
            const iconColor = loc.isStore ? '#11998e' : '#f39c12';
			const storeTagText = translations[currentLang].tag_store;
            const storeTag = loc.isStore ? ` <span style="font-size:0.7em; background:#e8f5e9; color:#11998e; padding:2px 6px; border-radius:10px; font-weight:normal;">${storeTagText}</span>` : '';

            listContent.innerHTML += `
                <div onclick="selectLocation(${originalIndex})" style="padding: 12px; border-bottom: 1px solid #eee; cursor: pointer;">
                    <i class="fas ${iconClass}" style="color:${iconColor}; width: 20px;"></i> 
                    <b>${loc.label}</b> ${storeTag}<br>
                    <small style="color:#888;">${translations[currentLang].lbl_coords_short} ${parseFloat(loc.lat).toFixed(4)}, ${parseFloat(loc.lng).toFixed(4)}</small>
                </div>`;
        });
    }
    document.getElementById('saved-locations-modal').classList.remove('hidden');
}

    function selectLocation(index) {
    const selected = mySavedLocations[index];
    const id = currentTargetStopId;
    document.getElementById(`label-${id}`).value = selected.label;
    document.getElementById(`phone-${id}`).value = selected.phone || ""; // üö© ‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    document.getElementById(`lat-${id}`).value = selected.lat;
    document.getElementById(`lng-${id}`).value = selected.lng;
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏ó‡∏≤‡πÜ
    document.getElementById(`coords-display-${id}`).innerText = 
    `${translations[currentLang].lbl_coords_short} ${parseFloat(selected.lat).toFixed(5)}, ${parseFloat(selected.lng).toFixed(5)}`;
    closeSavedModal();
}

    function closeSavedModal() {
        document.getElementById('saved-locations-modal').classList.add('hidden');
    }


    // 4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô
    async function postMerchantTask() {
    const btn = document.getElementById('submit-btn');
    
    // üö© 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    btn.disabled = true;
    btn.style.opacity = "0.6";
    btn.style.cursor = "not-allowed";
    
    let timeLeft = 10;
    const originalContent = btn.innerHTML; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
    
    const timer = setInterval(() => {
        if (timeLeft <= 0) {
            clearInterval(timer);
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.style.cursor = "pointer";
            btn.innerHTML = originalContent; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°
        } else {
            btn.innerHTML = translations[currentLang].btn_wait_time(timeLeft);
            timeLeft--;
        }
    }, 1000);

    // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Logic ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ---
    const finalTitle = updateTitlePreview();
    const stops = [];
    const stopElements = document.querySelectorAll('.stop-item');

    if (stopElements.length === 0) {
        // ‡∏´‡∏≤‡∏Å error ‡πÉ‡∏´‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        clearInterval(timer);
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.innerHTML = originalContent;
        return alert(translations[currentLang].err_min_stops_post);
    }

    let hasError = false;
    stopElements.forEach((el, index) => {
        const id = el.id.split('-')[1];
        const label = document.getElementById(`label-${id}`).value;
        const phone = document.getElementById(`phone-${id}`).value;
        const lat = document.getElementById(`lat-${id}`).value;
        const lng = document.getElementById(`lng-${id}`).value;

        if (!lat || !lng) {
            hasError = true;
            return;
        }

        stops.push({
            step: index + 1,
            label: label || (index === 0 
			? translations[currentLang].lbl_pickup_simple 
			: translations[currentLang].lbl_dropoff_indexed_simple(index)),
            phone: phone,
            lat: parseFloat(lat),
            lng: parseFloat(lng),
            status: 'pending'
        });
    });

    if (hasError) {
        clearInterval(timer);
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.innerHTML = originalContent;
        return alert(translations[currentLang].err_pin_required_all);
    }

    const formData = new FormData();
    formData.append('author', myUsername);
    formData.append('category', 'task');
    formData.append('title', finalTitle);
    formData.append('content', document.getElementById('task-desc').value);
    formData.append('budget', document.getElementById('task-budget').value || 0);
    formData.append('isMerchantTask', true);
    formData.append('stops', JSON.stringify(stops));
    const mainLocation = { lat: stops[0].lat, lng: stops[0].lng };
    formData.append('location', JSON.stringify(mainLocation));

    try {
        const res = await fetch('/api/posts', {
            method: 'POST',
            body: formData
        });

        const data = await res.json();

        if (data.success) {
            alert(translations[currentLang].msg_post_success);
			await fetchAndRefreshMerchantBalance();
            toggleTaskForm(); 
            await loadActiveMerchantTasks(); 
            document.getElementById('task-desc').value = '';
            document.getElementById('task-budget').value = '';
            document.getElementById('stops-container').innerHTML = '';
            stopCount = 0;
            updateTitlePreview();
            
            clearInterval(timer);
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.innerHTML = originalContent; 
        } else {
            alert("‚ùå An error occurred.: " + data.error);
            // ‡∏Å‡∏£‡∏ì‡∏µ error ‡∏à‡∏≤‡∏Å server ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
            clearInterval(timer);
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.innerHTML = originalContent;
        }
    } catch (error) {
        console.error("Post Error:", error);
        alert("‚ùå Unable to connect to the server.");
        clearInterval(timer);
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.innerHTML = originalContent;
    }
}
	
	
	
	// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡πà‡∏≤‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏´‡∏°
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.interimResults = false;

    function startVoiceCommand() {

        if (currentLang === 'pt') {
            recognition.lang = 'pt-BR'; // ‡∏†‡∏≤‡∏©‡∏≤‡πÇ‡∏õ‡∏£‡∏ï‡∏∏‡πÄ‡∏Å‡∏™ (‡∏ö‡∏£‡∏≤‡∏ã‡∏¥‡∏•)
        } else if (currentLang === 'en') {
            recognition.lang = 'en-US'; // ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
        } else {
            recognition.lang = 'th-TH'; // ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        }

        recognition.start();

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏õ‡∏∏‡πà‡∏°
        document.getElementById('voice-btn').innerHTML = translations[currentLang].btn_voice_listening;
        document.getElementById('voice-btn').style.background = "#e67e22";
    }

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        processVoiceOrder(text);
        resetVoiceBtn();
    };

    recognition.onerror = () => {
        alert(translations[currentLang].err_voice_failed);
        resetVoiceBtn();
    };

    function resetVoiceBtn() {
        document.getElementById('voice-btn').innerHTML = translations[currentLang].btn_voice_start;
        document.getElementById('voice-btn').style.background = "#f39c12";
    }
}

// --- ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö: ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á ---
function processVoiceOrder(speechText) {
    
    lastVoiceAnalysis = null;

    const cleanSpeech = (currentLang === 'th') 
        ? speechText.replace(/\s+/g, '') 
        : speechText.toLowerCase().replace(/\s+/g, '');

    if (cleanSpeech.includes(translations[currentLang].key_order)) {
        const parts = cleanSpeech.split(translations[currentLang].key_order);
        const orderKeyword = parts[1];

        if (orderKeyword) {
            const foundTemplate = myOrderTemplates.find(t => orderKeyword.includes(t.voiceKeyword));

            if (foundTemplate) {
                lastVoiceAnalysis = {
                    category: foundTemplate.category,
                    title: foundTemplate.templateName,
                    stops: foundTemplate.stops,
                    budget: foundTemplate.budget,
                    content: foundTemplate.content,
                    isFullTemplate: true
                };
                showVoiceSummaryModal();
                return;
            }
        }
    }

    let category = translations[currentLang].cat_general; 
    if (speechText.includes(translations[currentLang].key_doc) || 
        speechText.includes(translations[currentLang].key_mail)) {
        category = translations[currentLang].cat_doc;
    }

    let budget = "0";
    const allNumbers = speechText.match(/\d+/g);
    if (allNumbers && allNumbers.length > 0) {
        budget = allNumbers[allNumbers.length - 1];
    }

    let foundStops = [];
    
    mySavedLocations.forEach(loc => {
        const keyword = (loc.voiceKeyword || loc.label).replace(/\s+/g, '').toLowerCase();
        if (cleanSpeech.includes(keyword)) {
            foundStops.push({
                ...loc,
                indexInSpeech: cleanSpeech.indexOf(keyword)
            });
        }
    });

    foundStops.sort((a, b) => a.indexInSpeech - b.indexInSpeech);

    lastVoiceAnalysis = {
        category: category,
        title: `${category} ${foundStops.length} ${translations[currentLang].unit_stop_voice}`,
        stops: foundStops,
        budget: budget
    };

    showVoiceSummaryModal();
}


function startVoiceForKeyword(btn) {

    if (!SpeechRecognition) return alert(translations[currentLang].err_voice_not_supported);
    
    const voiceRec = new SpeechRecognition();

    // 2. ‡∏õ‡∏£‡∏±‡∏ö "‡∏´‡∏π‡∏ü‡∏±‡∏á" ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    if (currentLang === 'pt') {
        voiceRec.lang = 'pt-BR'; // ‡∏†‡∏≤‡∏©‡∏≤‡πÇ‡∏õ‡∏£‡∏ï‡∏∏‡πÄ‡∏Å‡∏™ (‡∏ö‡∏£‡∏≤‡∏ã‡∏¥‡∏•)
    } else if (currentLang === 'en') {
        voiceRec.lang = 'en-US'; // ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©
    } else {
        voiceRec.lang = 'th-TH'; // ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    }
    
    const originalContent = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; 
    
    voiceRec.start();
    
    voiceRec.onresult = (event) => {
        let text = event.results[0][0].transcript;
        
        if (currentLang === 'th') {
            text = text.replace(/\s+/g, '');
        } else {
            text = text.trim();
        }

        document.getElementById('map-loc-voice').value = text;
        btn.innerHTML = originalContent;
    };
    
    voiceRec.onerror = () => {
        btn.innerHTML = originalContent;
        alert(translations[currentLang].msg_voice_retry_simple);
    };
}



function showVoiceSummaryModal() {
    const data = lastVoiceAnalysis;
    if (!data) return;

    document.getElementById('sum-title').innerText = data.title;
    document.getElementById('sum-budget').innerText = Number(data.budget).toLocaleString();

    const stopsContainer = document.getElementById('sum-stops');
    stopsContainer.innerHTML = "";

    if (data.stops.length > 0) {
        data.stops.forEach((s, i) => {
            const isPickup = (i === 0);
            const icon = isPickup ? "fa-store" : "fa-box";
            const color = isPickup ? "#27ae60" : "#11998e";
            
            // üö© ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ: ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const typeText = isPickup 
                ? translations[currentLang].sum_pickup 
                : translations[currentLang].sum_dropoff(i);

            stopsContainer.innerHTML += `
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px; padding: 12px; background: white; border-radius: 10px; border: 1px solid ${isPickup ? color : '#eee'};">
                    <div style="background: ${color}; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9em;">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div>
                        <div style="font-size: 0.75em; color: ${color}; font-weight: bold;">${typeText}</div>
                        <div style="font-weight: bold; color: #333;">${s.label}</div>
                    </div>
                </div>
            `;
        });
    } else {
        // üö© ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î
        stopsContainer.innerHTML = `<div style="color: red; text-align: center;">${translations[currentLang].sum_no_coords}</div>`;
    }

    document.getElementById('voice-summary-modal').classList.remove('hidden');
}


function confirmVoiceSummary() {
    const data = lastVoiceAnalysis;
    if (!data) return;

    // 1. ‡πÄ‡∏ï‡∏¥‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
    document.getElementById('task-category').value = data.category;
    document.getElementById('task-budget').value = data.budget;

    // 2. ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
    const container = document.getElementById('stops-container');
    container.innerHTML = "";
    stopCount = 0; 

    // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà AI ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö
    if (data.stops && data.stops.length > 0) {
        data.stops.forEach((stop, index) => {
            addNewStop(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á HTML
            
            const currentId = stopCount; 
            
            // üö© ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡πÉ‡∏´‡πâ DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Element
            setTimeout(() => {
                const labelInput = document.getElementById(`label-${currentId}`);
                const latInput = document.getElementById(`lat-${currentId}`);
                const lngInput = document.getElementById(`lng-${currentId}`);
                const phoneInput = document.getElementById(`phone-${currentId}`);
                const statusLabel = document.getElementById(`loc-status-${currentId}`);
                const coordsDisplay = document.getElementById(`coords-display-${currentId}`);

                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                if (labelInput) labelInput.value = stop.label;
                if (latInput) latInput.value = stop.lat;
                if (lngInput) lngInput.value = stop.lng;
                if (phoneInput) phoneInput.value = stop.phone || "";

                // üö© ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏û‡∏¥‡∏Å‡∏±‡∏î"
                if (coordsDisplay) {
                    coordsDisplay.innerText = `${translations[currentLang].lbl_coords_short} ${parseFloat(stop.lat).toFixed(5)}, ${parseFloat(stop.lng).toFixed(5)}`;
                }
                
                // üö© ‡πÅ‡∏õ‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AI (‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö/‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á)
                if (statusLabel) {
                    if (index === 0) {
                        statusLabel.innerText = translations[currentLang].status_pickup_ai;
                        statusLabel.style.color = "#27ae60";
                    } else {
                        statusLabel.innerText = translations[currentLang].status_dropoff_ai(index);
                        statusLabel.style.color = "#11998e";
                    }
                }
            }, 0);
        });
    } else {
        addNewStop();
    }

    // 4. ‡∏™‡∏±‡πà‡∏á‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö Loop)
    setTimeout(() => reorderStops(), 50); 
    
    closeVoiceSummary();
}

function closeVoiceSummary() {
    document.getElementById('voice-summary-modal').classList.add('hidden');
}




// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
function openManageLocationsModal() {
    toggleMerchantSidebar(); // ‡∏õ‡∏¥‡∏î Sidebar
    renderManageList();
    document.getElementById('manage-locations-modal').classList.remove('hidden');
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Render)
function renderManageList() {
    const container = document.getElementById('manage-list-container');
    container.innerHTML = "";

    // üö© ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡πâ‡∏≤‡∏ô) ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°
    const filteredList = mySavedLocations.filter(loc => 
		loc.isStore !== true && loc.label.trim() !== translations[currentLang].lbl_store_base_name
	);

    if (filteredList.length === 0) {
		container.innerHTML = `<div style="text-align:center; padding: 20px; color: #999;">${translations[currentLang].no_saved_locations}</div>`;
		return;
    }

    filteredList.forEach((loc) => {
        const actualIndex = mySavedLocations.findIndex(l => l._id === loc._id);
        container.innerHTML += `
            <div class="manage-item" style="cursor: pointer;" onclick="editLocation(${actualIndex})">
                <div class="manage-info">
                    <strong style="color: #11998e;">${loc.label}</strong><br>
                    <small><i class="fas fa-phone"></i> ${loc.phone || translations[currentLang].no_phone}</small>
                </div>
                <div class="manage-actions">
                    <button class="btn-delete" onclick="event.stopPropagation(); deleteLocation(${actualIndex})">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>`;
    });
}

// 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î
async function deleteLocation(index) {
    const loc = mySavedLocations[index];
    if (confirm(translations[currentLang].confirm_delete_loc(loc.label))) {
        const res = await fetch(`/api/merchant/locations/${loc._id}`, {
            method: 'DELETE'
        });
        const data = await res.json();
        if (data.success) {
            mySavedLocations.splice(index, 1);
            renderManageList();
            alert(translations[currentLang].msg_delete_success);
        }
    }
}

function editLocation(index) {
    const loc = mySavedLocations[index];
    if (!loc) return;
    
    editingLocationId = loc._id; // üö© ‡πÄ‡∏Å‡πá‡∏ö ID ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≠‡∏ô PUT (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï)
    
    // ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    closeManageModal();
    document.getElementById('map-modal').classList.remove('hidden');
    
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°
    document.querySelector('#map-modal h3').innerText = translations[currentLang].modal_title_edit;
	document.querySelector('#map-modal .btn-submit').innerText = translations[currentLang].btn_save_edit;

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    initMap();

    // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
    document.getElementById('map-loc-name').value = loc.label;
    document.getElementById('map-loc-voice').value = loc.voiceKeyword || "";

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
    const lat = parseFloat(loc.lat);
    const lng = parseFloat(loc.lng);
    
    merchantMap.setView([lat, lng], 17);
    updateMarker(lat, lng);
    
    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î Modal
    setTimeout(() => {
        merchantMap.invalidateSize();
    }, 300);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
function initMap() {
    if (merchantMap) {
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏Ñ‡πà‡∏™‡∏±‡πà‡∏á‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
        goToCurrentLocation();
        return;
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    merchantMap = L.map('map-container').setView([13.7563, 100.5018], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
    }).addTo(merchantMap);

    merchantMap.on('click', function(e) {
        updateMarker(e.latlng.lat, e.latlng.lng);
    });

    // ‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
    goToCurrentLocation();
}

function goToCurrentLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            merchantMap.setView([lat, lng], 16);
            updateMarker(lat, lng);
            setTimeout(() => merchantMap.invalidateSize(), 200);
        }, (err) => {
            console.warn(translations[currentLang].warn_no_location);
        });
    }
}



//  ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î Modal
function closeManageModal() {
    document.getElementById('manage-locations-modal').classList.add('hidden');
}

	
	function clearUnreadBadge(postId) {
    if (!postId) return;
    const notifBox = document.getElementById(`notif-box-${postId}`);
    if (notifBox) {
        notifBox.classList.remove('has-unread');
        const card = document.getElementById(`card-${postId}`);
        if (card) card.style.backgroundColor = 'white';
    }
}


	async function openRightSidebar(postId) {
    
    try {
        const res = await fetch(`/api/posts/${postId}`);
        const data = await res.json();
        if (!data.success) return;

        activeTaskInSidebar = data.post;
        const itemsContainer = document.getElementById('sidebar-order-items-container');
        const itemsText = document.getElementById('sidebar-items-text');
        
        if (activeTaskInSidebar.isMerchantTask && activeTaskInSidebar.content) {
            itemsContainer.classList.remove('hidden');
            // ‡πÅ‡∏õ‡∏•‡∏á \n ‡πÄ‡∏õ‡πá‡∏ô <br> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
            itemsText.innerHTML = activeTaskInSidebar.content.replace(/\n/g, '<br>');
        } else {
            itemsContainer.classList.add('hidden');
        }
        document.getElementById('sidebar-task-title').innerText = `${translations[currentLang].sidebar_job_prefix} ${activeTaskInSidebar.title}`;
        
        if (typeof currentTab !== 'undefined' && currentTab === 'chat') {
            clearUnreadBadge(postId);
        }

        const notifList = document.getElementById('notif-list');
        notifList.innerHTML = ''; 
        
        if (activeTaskInSidebar.pendingRider) {
            const statsRes = await fetch(`/api/rider-stats/${activeTaskInSidebar.pendingRider}`);
            const statsData = await statsRes.json();
            const stats = statsData.stats;
            notifList.innerHTML = `
                <div style="background: #fff4e5; padding: 15px; border-radius: 15px; border-left: 5px solid #f39c12;">
                    <b style="color: #e67e22;"><i class="fas fa-user-plus"></i> ${translations[currentLang].sidebar_rider_interested}</b>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="approveRider('${postId}')" style="flex:1; background:#27ae60; color:white; border:none; padding:12px; border-radius:10px; font-weight:bold; cursor:pointer;">${translations[currentLang].sidebar_btn_approve}</button>
                        <button onclick="rejectRider('${postId}')" style="flex:1; background:#dc3545; color:white; border:none; padding:12px; border-radius:10px; font-weight:bold; cursor:pointer;">${translations[currentLang].sidebar_btn_reject}</button>
                    </div>
                </div>`;
        } else if (activeTaskInSidebar.acceptedBy) {
            notifList.innerHTML = `
                <div style="text-align:center; padding: 20px;">
                    <div style="font-size: 2em; color: #27ae60; margin-bottom: 10px;"><i class="fas fa-check-circle"></i></div>
                    <p style="color:#27ae60; font-weight:bold;">${translations[currentLang].sidebar_assigned_msg(activeTaskInSidebar.acceptedBy)}</p>
                    <small style="color:#999;">${translations[currentLang].sidebar_track_info}</small>
                </div>`;
        } else {
            notifList.innerHTML = `<p style="text-align:center; padding:30px; color:#999;">${translations[currentLang].status_waiting_rider}</p>`;
        }

        renderSidebarDetails();
        loadSidebarChat(postId);
        socket.emit('join-post', postId);
        document.getElementById('right-sidebar').classList.add('active');
        document.getElementById('right-sidebar-overlay').classList.remove('hidden');
        switchTab('notif');  
    } catch (e) {
        console.error("Sidebar Error:", e);
    }
}

function closeRightSidebar() {
    document.getElementById('right-sidebar').classList.remove('active');
    document.getElementById('right-sidebar-overlay').classList.add('hidden');
    activeTaskInSidebar = null;
}

function switchTab(tabName) {
    // üö© ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤ Tab ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
    currentTab = tabName; 

    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
    document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));

    document.getElementById(`tab-${tabName}`).classList.remove('hidden');
    
    // ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏î
    const tabs = ['notif', 'details', 'chat'];
    const activeIdx = tabs.indexOf(tabName);
    const targetTabItem = document.querySelectorAll('.tab-item')[activeIdx];
	
	if (tabName === 'chat' && activeTaskInSidebar) {
        const postId = activeTaskInSidebar.id;
        
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        delete unreadPosts[postId];
        
        // ‡∏•‡∏ö‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô
        const notifBox = document.getElementById(`notif-box-${postId}`);
        if (notifBox) {
            notifBox.classList.remove('has-unread');
        }
        
        // ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô Sidebar (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const chatTabIcon = document.querySelector('.tab-item[onclick*="chat"]');
        if (chatTabIcon) chatTabIcon.style.color = '';
    }
    
    if (targetTabItem) {
        targetTabItem.classList.add('active');
        
        // üö© ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏™‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å
        if (tabName === 'chat') {
            targetTabItem.style.color = ''; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≤‡∏° CSS
        }
    }
}

function renderSidebarDetails() {
    const container = document.getElementById('sidebar-details-content');
    let html = '';
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• activeTaskInSidebar ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (!activeTaskInSidebar || !activeTaskInSidebar.stops) return;

    // 1. ‡∏ß‡∏≤‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á (‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô)
    activeTaskInSidebar.stops.forEach((stop, i) => {
        const isDone = stop.status === 'success';
		const stopTitle = (i === 0) 
        ? translations[currentLang].sidebar_pickup_label 
        : translations[currentLang].sidebar_dropoff_label(i);
        
        const bypassBtn = !isDone ? `
            <button onclick="bypassCheckIn('${activeTaskInSidebar.id}', ${i})" 
                style="margin-left: auto; background: #f39c12; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.75em; cursor: pointer;">
                <i class="fas fa-forward"></i> Bypass
            </button>
        ` : '';

        html += `
        <div style="padding: 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; opacity: ${isDone ? 0.6 : 1}">
            <i class="fas ${isDone ? 'fa-check-circle' : 'fa-circle'}" style="color: ${isDone ? '#27ae60' : '#ccc'}"></i>
            <div style="flex-grow: 1;">
                <div style="font-weight: bold; font-size: 0.9em;">${stopTitle}</div>
                <div style="font-size: 0.85em; color: #666;">${stop.label || stop.locationName || ''}</div>
            </div>
            ${bypassBtn}
        </div>
		`;
	});

    // üö© 2. ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏á‡∏≤‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô)
    // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö (acceptedBy) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô undefined
    if (!activeTaskInSidebar.acceptedBy || activeTaskInSidebar.status === 'undefined') {
    html += `
        <div style="padding: 20px; text-align: center; background: #fff;">
            <button onclick="deleteMerchantTask('${activeTaskInSidebar.id}')" 
                style="width: 100%; background: #e74c3c; color: white; border: none; padding: 12px; border-radius: 8px; font-family: 'Kanit', sans-serif; font-weight: bold; cursor: pointer; transition: 0.3s;">
                <i class="fas fa-trash-alt"></i> ${translations[currentLang].btn_delete_task}
            </button>
            <p style="font-size: 0.75em; color: #999; margin-top: 8px;">
                ${translations[currentLang].delete_task_note}
            </p>
        </div>
    `;
    }

    container.innerHTML = html;
}


function getMerchantRoleLabel(author) {
    if (author === myUsername) {
        return `<i class="fas fa-store"></i> Merchant`; // ‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡πÄ‡∏≠‡∏á
    } else if (activeTaskInSidebar && author === activeTaskInSidebar.acceptedBy) {
        return `<i class="fas fa-motorcycle" style="color: #3498db;"></i> Rider`; // ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
    } else if (activeTaskInSidebar && author === activeTaskInSidebar.acceptedViewer) {
        return `<i class="fas fa-user-tag" style="color: #27ae60;"></i> ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤`; // ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
    } else {
        return `<i class="fas fa-user"></i> ${author}`; // ‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    }
}

// ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ó (‡πÉ‡∏ä‡πâ Logic ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö post.html)
async function loadSidebarChat(postId) {
    const chatBox = document.getElementById('chat-box');
    chatBox.innerHTML = `<small style="color:#999">${translations[currentLang].chat_loading}</small>`;
    
    const res = await fetch(`/api/posts/${postId}/comments`);
    const comments = await res.json();
    
    chatBox.innerHTML = '';
    comments.forEach(msg => {
        const isMe = msg.author === myUsername;
        appendMerchantMessage(msg.author, msg.text || msg.content, isMe, msg.imageUrl);
    });
}

async function sendSidebarChat() {
    const input = document.getElementById('chat-input');
    const text = input.value.trim();
    
    if (!text || !activeTaskInSidebar) return;

    try {
        const res = await fetch(`/api/posts/${activeTaskInSidebar.id}/comments`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ author: myUsername, text: text })
        });

        if (res.ok) {
            const data = await res.json();
            input.value = ''; 
            
            appendMerchantMessage(myUsername, text, true, null);
        }
    } catch (e) {
        console.error(translations[currentLang].err_chat_send_failed, e);
    }
}


// 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏á‡∏≤‡∏ô
async function deleteMerchantTask(postId) {
    closeRightSidebar();
    
    const currentUsername = localStorage.getItem('myUsername'); 
    
    if (!currentUsername) {
        return Swal.fire(
            translations[currentLang].err_no_user_title, 
            translations[currentLang].err_no_user_text, 
            'error'
        );
    }

    const confirmDelete = await Swal.fire({
        title: translations[currentLang].swal_del_title,
        text: translations[currentLang].swal_del_text,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        confirmButtonText: translations[currentLang].swal_del_btn,
        cancelButtonText: translations[currentLang].swal_cancel
    });

    if (confirmDelete.isConfirmed) {
        try {
            const res = await fetch(`/api/merchant/tasks/${postId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: currentUsername })
            });

            if (!res.ok) {
                const errorData = await res.json();
                throw new Error(errorData.error || 'Network response was not ok');
            }

            const data = await res.json();
            if (data.success) {
                Swal.fire(
                    translations[currentLang].swal_del_success_title, 
                    translations[currentLang].swal_del_success_text, 
                    'success'
                );
                closeRightSidebar();
                loadActiveMerchantTasks();
            }
        } catch (err) {
            console.error("Delete Error:", err);
            Swal.fire('Error', err.message, 'error');
        }
    }
}

// 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå
async function approveRider(postId) {
    if (!confirm(translations[currentLang].confirm_approve_rider)) return;
    
    try {
        const res = await fetch(`/api/posts/${postId}/approve-rider`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
            alert(translations[currentLang].alert_approve_success);
            loadActiveMerchantTasks();
        }
    } catch (e) { 
        alert(translations[currentLang].err_generic); 
    }
}

// 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå
async function rejectRider(postId) {
    if (!confirm(translations[currentLang].confirm_reject_rider)) return;
    
    try {
        const res = await fetch(`/api/posts/${postId}/reject-rider`, { method: 'POST' });
        const data = await res.json();
        if (data.success) {
            alert(translations[currentLang].alert_reject_success);
            closeRightSidebar();
            loadActiveMerchantTasks();
        }
    } catch (e) { 
        alert(translations[currentLang].err_generic); 
    }
}













// üîî ‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏î "‡∏Ç‡∏≠‡∏á‡∏≤‡∏ô"
socket.on('rider-applied', (data) => {
    // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏Å‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏á‡∏≤‡∏ô" ‡∏õ‡∏£‡∏≤‡∏Å‡∏è
    loadActiveMerchantTasks();
    
    // 2. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Sidebar ‡∏á‡∏≤‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô Tab Notif
    if (activeTaskInSidebar && activeTaskInSidebar.id === data.postId) {
        const notifList = document.getElementById('notif-list');
        notifList.innerHTML = `
            <div style="background: #fff4e5; padding: 15px; border-radius: 10px; border-left: 5px solid #f39c12; margin-bottom: 10px;">
        <b style="color: #e67e22;"><i class="fas fa-user-tag"></i> ${translations[currentLang].notif_new_request}</b><br>
        ${translations[currentLang].notif_rider_wants(data.riderName)}<br>
        <button onclick="approveRider('${data.postId}')" 
            style="margin-top:10px; background:#27ae60; color:white; border:none; padding:8px 15px; border-radius:20px; width:100%;">
            ${translations[currentLang].btn_confirm_assign}
        </button>
    </div>
        ` + notifList.innerHTML;
    }
});

// üö© 2. ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÉ‡∏ô merchant.html
socket.on('new-comment', (data) => {
    const comment = data.comment || data;
    const author = comment.author;

    if (activeTaskInSidebar && activeTaskInSidebar.id == data.postId) {
        if (author !== myUsername) {
            appendMerchantMessage(author, comment.text || comment.content, false, comment.imageUrl);
        }

        if (currentTab !== 'chat') {
            const chatIcon = document.querySelector('.tab-item[onclick*="chat"]');
            if (chatIcon) chatIcon.style.color = 'red';
        }
    }

    if (author !== myUsername) {
        if (!(activeTaskInSidebar && activeTaskInSidebar.id == data.postId && currentTab === 'chat')) {          
            const notifBox = document.getElementById(`notif-box-${data.postId}`);
            if (notifBox) {
                notifBox.classList.add('has-unread');
                const card = document.getElementById(`card-${data.postId}`);
                if (card) card.style.backgroundColor = '#fff9f9';
            }
        }
    }
});


// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô confirmAndRate ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ API ‡∏Å‡∏•‡∏≤‡∏á
async function confirmAndRate(postId, riderName) {
    // 1. ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏î‡πâ‡∏á (‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Star Rating ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ)
    const rating = prompt(translations[currentLang].prompt_rating(riderName), "5");
    
    if (rating === null) return; // ‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    const score = parseFloat(rating);
    
    if (isNaN(score) || score < 1 || score > 5) {
        alert(translations[currentLang].err_rating_range);
        return;
    }

    try {
        const res = await fetch(`/api/posts/${postId}/finish-job`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                rating: score,
                author: myUsername, 
				riderName: riderName
            })
        });

        const data = await res.json();
        
        if (data.success) {
            const taskCard = document.getElementById(`card-${postId}`);
            if (taskCard) {
                taskCard.style.opacity = '0';
                taskCard.style.transform = 'scale(0.9)';
                taskCard.style.transition = '0.3s';
                setTimeout(() => taskCard.remove(), 300); // ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏ü‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏ö
            }
            document.getElementById('right-sidebar').classList.remove('active');
            document.getElementById('right-sidebar-overlay').classList.add('hidden');
            console.log("Job finished successfully");
            loadActiveMerchantTasks(); 
            socket.emit('confirm-finish-job', { postId: postId, accepted: true });
        } else {
            alert("An error occurred: " + data.error);
        }
    } catch (e) {
        console.error(e);
        alert("Unable to connect to the server.");
    }
}


async function bypassCheckIn(postId, stopIndex) {
    if (!confirm(translations[currentLang].confirm_bypass)) return;

    try {
        const res = await fetch(`/api/posts/${postId}/bypass-stop/${stopIndex}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ author: myUsername })
        });

        const data = await res.json();
        if (data.success) {
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            const updatedRes = await fetch(`/api/posts/${postId}`);
            const updatedData = await updatedRes.json();
            
            if (updatedData.success) {
                activeTaskInSidebar = updatedData.post;
                renderSidebarDetails();
                loadActiveMerchantTasks();
            }
            
            if (data.allFinished) {
                alert(translations[currentLang].msg_task_complete);
                closeRightSidebar();
            } else {
                alert(translations[currentLang].msg_bypass_success);
            }
        } else {
            alert("An error occurred: " + data.error);
        }
    } catch (e) {
        console.error(e);
        alert("Unable to connect to the server.");
    }
}



function HowToVoiceCommands() {
    // ‡∏õ‡∏¥‡∏î Sidebar ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô Modal ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
    if (typeof toggleMerchantSidebar === 'function') {
        const sidebar = document.getElementById('merchant-sidebar');
        if (sidebar && sidebar.classList.contains('active')) {
            toggleMerchantSidebar();
        }
    }
    
    const modal = document.getElementById('how-to-voice-modal');
    if (modal) {
        modal.classList.remove('hidden');
    }
}

function infouse(){
	if (typeof toggleMerchantSidebar === 'function') {
        const sidebar = document.getElementById('merchant-sidebar');
        if (sidebar && sidebar.classList.contains('active')) {
            toggleMerchantSidebar();
        }
    }
    
    const modal = document.getElementById('info-use-modal');
    if (modal) {
        modal.classList.remove('hidden');
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î
function closeHowToVoice() {
    const modal = document.getElementById('how-to-voice-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
}

function closeInfo() {
	const modal = document.getElementById('info-use-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
}


async function deleteOrderTemplate(id, index) {
    if (!confirm(translations[currentLang].confirm_delete_template)) return;

    try {
        const res = await fetch(`/api/merchant/templates/${id}`, {
            method: 'DELETE'
        });
        const data = await res.json();

        if (data.success) {
            alert(translations[currentLang].msg_delete_template_success);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global
            myOrderTemplates.splice(index, 1);
            
            // ‡∏ß‡∏≤‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Modal ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
            renderTemplateListInModal(); 
        } else {
            alert("Cannot deleted.: " + data.error);
        }
    } catch (e) {
        console.error("Delete Error:", e);
        alert("Unable to connect to the server.");
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏≤‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ)
function renderTemplateListInModal() {
    const listContent = document.getElementById('template-list-content');
    if (!listContent) return;
    
    listContent.innerHTML = "";
    if (myOrderTemplates.length === 0) {
        // üö© ‡πÅ‡∏õ‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        listContent.innerHTML = `<div style="text-align:center; padding:30px; color:#999;">${translations[currentLang].no_templates_found}</div>`;
        return;
    }

    myOrderTemplates.forEach((tpl, index) => {
        // üö© ‡πÅ‡∏õ‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö (‡∏à‡∏∏‡∏î/stops/paradas)
        const stopUnit = translations[currentLang].unit_stop_short;

        listContent.innerHTML += `
            <div class="manage-item" style="cursor:pointer; display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee;" onclick="selectOrderTemplate(${index})">
                <div class="manage-info">
                    <strong style="color: #11998e;"><i class="fas fa-file-invoice"></i> ${tpl.templateName}</strong><br>
                    <small style="color:#888;">üéôÔ∏è "${tpl.voiceKeyword}" ‚Ä¢ ${tpl.stops.length} ${stopUnit}</small>
                </div>
                <div class="manage-actions">
                    <button class="btn-delete" onclick="event.stopPropagation(); deleteOrderTemplate('${tpl._id}', ${index})">
                        <i class="fas fa-trash-alt" style="color: #dc3545;"></i>
                    </button>
                </div>
            </div>`;
    });
}


async function safeNavigateHome() {
    const myUsername = localStorage.getItem('myUsername');
    
    if (!myUsername) {
        window.location.href = 'index.html';
        return;
    }

    try {
        const checkRes = await fetch(`/api/rider/check-working-status?username=${encodeURIComponent(myUsername)}`);
        const checkData = await checkRes.json();
        const currentMercNum = checkData.mercNum || 0;
        
        if (currentMercNum >= 1) {
            Swal.fire({
                icon: 'warning',
                title: translations[currentLang].swal_prevent_exit_title,
                text: translations[currentLang].swal_prevent_exit_text(currentMercNum),
                confirmButtonColor: '#11998e'
            });
        } 
        else {
            // üö© 1. ‡∏™‡∏±‡πà‡∏á "‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô" (Set isOpen: false) ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å
            // ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ API ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå Toggle ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
            await fetch('/api/merchant/update-status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    username: myUsername, 
                    isOpen: false 
                })
            });

            // üö© 2. ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï mercNum ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
            const resetRes = await fetch('/api/merchant/reset-mercnum', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: myUsername })
            });

            const resetData = await resetRes.json();
            
            // ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ú‡∏• reset ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ index.html
            window.location.href = 'index.html';
        }
    } catch (e) {
        console.error("üö® Navigation Error:", e);
        window.location.href = 'index.html';
    }
}


// üîî ‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á"
socket.on('update-job-status', (data) => {   
    loadActiveMerchantTasks();   
    if (activeTaskInSidebar && activeTaskInSidebar.id == data.postId) {
        updateSidebarDataOnly(data.postId);
    }
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô Sidebar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏î‡πâ‡∏á
async function updateSidebarDataOnly(postId) {
    try {
        const res = await fetch(`/api/posts/${postId}`);
        const data = await res.json();
        if (data.success) {
            activeTaskInSidebar = data.post;
            renderSidebarDetails();
        }
    } catch (e) { console.error(e); }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Debug ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
async function debugMerchantStatus() {
    
    try {
        const res = await fetch(`/api/merchant/tasks?username=${myUsername}`);
        const data = await res.json();
        
        if (data.success) {
            console.table(data.posts.map(post => ({
                ID: post.id.toString().slice(-4),
                ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: post.title,
                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: post.status,
                ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå: post.acceptedBy || post.acceptedViewer || 'do not have yet',
                ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö: post.stops.filter(s => s.status === 'success').length + "/" + post.stops.length,
                isClosed: post.isClosed || false
            })));

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà "‡∏Ñ‡πâ‡∏≤‡∏á" (‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏ö‡∏á‡∏≤‡∏ô)
            const stuckJobs = data.posts.filter(p => p.status === 'closed_permanently' && !p.isClosed);
            if (stuckJobs.length > 0) {
                console.warn(translations[currentLang].log_stuck_jobs(stuckJobs.length));
            }
        } else {
            console.error("‚ùå Unable to connect to the server:", data.error);
        }
    } catch (e) {
        console.error("‚ùå [Debug Error]:", e);
    }
}


function displayMerchantLocation(lat, lng, phone) {
    const container = document.getElementById('merchant-coordinate-link');
    const phoneSpan = document.getElementById('shop-phone-number');
    
    if (phoneSpan) {
        phoneSpan.innerText = phone || '-';
    }

    if (!container || !lat || !lng) return;

    const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
    const currentLang = localStorage.getItem('preferredLanguage') || 'th';
    const label = (currentLang === 'pt') ? 'Sua localiza√ß√£o' : (currentLang === 'en' ? 'Store' : 'Store');

    // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏ö‡∏ö Clean
    container.innerHTML = `
        <a href="${mapsUrl}" target="_blank" style="
            display: inline-flex;
            align-items: center;
            font-size: 0.8em;
            color: #666;
            text-decoration: none;
            background: rgba(0, 0, 0, 0.05);
            padding: 5px 12px;
            border-radius: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: 0.3s;
        ">
            <i class="fas fa-map-marker-alt" style="margin-right: 6px; color: #ea4335;"></i>
            ${label}: ${lat.toFixed(5)}, ${lng.toFixed(5)}
        </a>
    `;
}




async function updateMerchantStatus(isOpen) {
    const statusText = document.getElementById('status-text');
    const isMerchant = mySavedLocations && mySavedLocations.some(loc => loc.isStore === true);

    if (!isMerchant) {
        document.getElementById('merchant-status-toggle').checked = false;
        return Swal.fire({
            icon: 'warning',
            text: 'Only approved stores are allowed.'
        });
    }

    statusText.innerText = isOpen ? 'OPEN' : 'CLOSED';
    statusText.style.color = isOpen ? '#28a745' : '#666';

    try {
        const res = await fetch('/api/merchant/update-status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: myUsername, 
                isOpen: isOpen 
            })
        });
        
        const data = await res.json();
        if (data.success) {
            const store = mySavedLocations.find(loc => loc.isStore === true);
            if (store) store.isOpen = isOpen;
        } else {
            document.getElementById('merchant-status-toggle').checked = !isOpen;
            updateSwitchFromData();
        }
    } catch (e) {
        console.error("Status Update Error:", e);
    }
}

async function checkCurrentMerchantStatus() {
    const res = await fetch(`/api/merchant/locations?username=${myUsername}`);
    const data = await res.json();
    if (data.success) {
        const store = data.locations.find(l => l.isStore === true);
        if (store) {
            const toggle = document.getElementById('merchant-status-toggle');
            const statusLabel = document.getElementById('status-label');
            toggle.checked = store.isOpen === true;
            statusLabel.innerText = store.isOpen ? 'OPEN' : 'CLOSED';
            statusLabel.style.color = store.isOpen ? '#28a745' : '#666';
        }
    }
}



async function openMerchantProductsModal() {
    const modal = document.getElementById('merchantProductsModal');
    const container = document.getElementById('product-list-inputs');
    container.innerHTML = '<p style="text-align:center;">Loading...</p>';

    // 1. ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
    const storeLoc = mySavedLocations.find(loc => loc.isStore === true);
    if (!storeLoc) {
        return Swal.fire({ icon: 'error', text: 'No store information found.' });
    }

    let currency = 'USD'; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

    try {
        // üö© 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ã‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Server ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        const res = await fetch(`/api/merchant/get-zone-currency?lat=${storeLoc.lat}&lng=${storeLoc.lng}`);
        const data = await res.json();
        if (data.success) {
            currency = data.currency; // ‡πÉ‡∏ä‡πâ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡πÇ‡∏ã‡∏ô‡∏à‡∏£‡∏¥‡∏á (‡πÄ‡∏ä‡πà‡∏ô THB, KHR, LAK)
        }
    } catch (err) {
        console.error("Fetch currency error:", err);
    }

    // 3. ‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    container.innerHTML = '';
    const savedProducts = storeLoc.products || [];
    for (let i = 0; i < 5; i++) {
        const p = savedProducts[i] || { name: '', price: '' };
        container.innerHTML += `
            <div class="product-row-item">
                <input type="text" id="prod-name-${i}" placeholder="list ${i+1}" value="${p.name}">
                <input type="number" id="prod-price-${i}" placeholder="price" value="${p.price}">
                <div class="currency-badge">${currency}</div>
            </div>
        `;
    }

    modal.classList.remove('hidden');
}

// üö© ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
function closeMerchantProductsModal() {
    document.getElementById('merchantProductsModal').classList.add('hidden');
}

// ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å Modal ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ)
window.onclick = function(event) {
    const modal = document.getElementById('merchantProductsModal');
    if (event.target == modal) {
        closeMerchantProductsModal();
    }
}

async function saveMerchantProducts() {
    const products = [];
    for (let i = 0; i < 5; i++) {
        const name = document.getElementById(`prod-name-${i}`).value.trim();
        const price = document.getElementById(`prod-price-${i}`).value.trim();
        
        if (name && price) {
            products.push({ name: name, price: parseFloat(price) });
        }
    }

    try {
        const res = await fetch('/api/merchant/update-products', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: myUsername, 
                products: products 
            })
        });
        
        const data = await res.json();
        if (data.success) {
            const store = mySavedLocations.find(loc => loc.isStore === true);
            if (store) store.products = products;
            
            Swal.fire({ icon: 'success', text: 'save data' });
            closeMerchantProductsModal();
        }
    } catch (e) {
        console.error(e);
        alert("Error saving products");
    }
}



socket.on('new_order_card', (order) => {
    if (!pendingOrders.find(o => o.orderId === order.orderId)) {
        pendingOrders.push(order);
    }
    
    updateOrderUI();
    
    // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    const sound = document.getElementById('orderSound');
    if(sound) sound.play().catch(e => console.log("Sound play blocked"));
});

// üö© 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢
function updateOrderUI() {
    const btn = document.getElementById('floatingOrderBtn');
    const badge = document.getElementById('orderCountBadge');
    
    if (pendingOrders.length > 0) {
        btn.style.display = 'block';
        badge.innerText = pendingOrders.length;
    } else {
        btn.style.display = 'none';
    }
}

// üö© 3. ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
function openOrderList() {
    const container = document.getElementById('orderListContainer');
    container.innerHTML = '';

    pendingOrders.forEach((order, index) => {
        container.innerHTML += `
            <div class="order-list-item" onclick="viewOrderDetail(${index})">
                <div>
                    <div style="font-weight: bold;">#${order.orderId.slice(-5)}</div>
                    <small>${order.customer}</small>
                </div>
                <div style="color: #e67e22; font-weight: bold;">
                    ${order.totalPrice.toLocaleString()} ${order.currency}
                </div>
                <i class="fas fa-chevron-right" style="color: #ccc;"></i>
            </div>
        `;
    });
    document.getElementById('orderListModal').classList.remove('hidden');
}

// üö© 4. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏•‡∏≠‡∏¢‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏°‡∏µ)
function viewOrderDetail(index) {
    const order = pendingOrders[index];
    if (!order) return; // ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
    currentIncomingOrder = order;

    // 1. ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    document.getElementById('alertOrderId').innerText = order.orderId;
    document.getElementById('alertCustomerName').innerText = order.customer;
    document.getElementById('alertCustomerPhone').innerText = order.customerPhone || '-';
    document.getElementById('alertOrderItems').innerText = order.items;
    // üö© ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å foodPrice ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏ß‡πâ)
    document.getElementById('alertFoodPrice').innerText = 
        `${order.foodPrice.toLocaleString()} ${order.currency}`;
    
    // üö© ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å riderWage)
    document.getElementById('alertRiderWage').innerText = 
        `${order.riderWage.toLocaleString()} ${order.currency}`;

    // ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
    const netTotal = order.foodPrice + order.riderWage;
    document.getElementById('alertOrderPrice').innerText = 
        `${netTotal.toLocaleString()} ${order.currency}`;

    // üö© 2. ‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateTimer ‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    const updateTimer = () => {
        const now = new Date().getTime();
        const expireTime = new Date(order.expiresAt).getTime();
        const timeLeft = expireTime - now;

        const timerDisplay = document.getElementById('alertTimer');

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            if (timerDisplay) timerDisplay.innerText = "00:00";
            document.getElementById('orderNotificationOverlay').classList.add('hidden');
            
            // ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô
            pendingOrders = pendingOrders.filter(o => o.orderId !== order.orderId);
            updateOrderUI();
            return;
        }

        const mins = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((timeLeft % (1000 * 60)) / 1000);
        if (timerDisplay) {
            timerDisplay.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
    };

    // ‡∏•‡πâ‡∏≤‡∏á Interval ‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
    if (timerInterval) clearInterval(timerInterval);
    
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
    updateTimer(); 
    // ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    timerInterval = setInterval(updateTimer, 1000);

    // 3. ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Overlay
    closeOrderList();
    document.getElementById('orderNotificationOverlay').classList.remove('hidden');

    // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏•‡πâ‡∏ß
    setTimeout(() => {
        const lat = order.customerLocation.lat;
        const lng = order.customerLocation.lng;

        if (!detailMap) {
            detailMap = L.map('orderMiniMap').setView([lat, lng], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap'
            }).addTo(detailMap);
            detailMarker = L.marker([lat, lng]).addTo(detailMap);
        } else {
            detailMap.setView([lat, lng], 16);
            detailMarker.setLatLng([lat, lng]);
            setTimeout(() => {
                detailMap.invalidateSize();
            }, 100);
        }
    }, 300);
}

function closeOrderList() {
    document.getElementById('orderListModal').classList.add('hidden');
}



// üö© ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
async function acceptOrder() {
    if (!currentIncomingOrder) return;

    const lang = translations[currentLang];

    // 1. ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á Timer
    const sound = document.getElementById('orderSound');
    if (sound) sound.pause();
    if (timerInterval) clearInterval(timerInterval);

    try {
        const response = await fetch('/api/merchant/accept-order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                orderId: currentIncomingOrder.orderId,
                merchantUser: localStorage.getItem('myUsername')
            })
        });

        const result = await response.json();

        if (result.success) {
            // 2. ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            pendingOrders = pendingOrders.filter(o => o.orderId !== currentIncomingOrder.orderId);
            
            // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI (‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏Ç‡πâ‡∏≤‡∏á‡∏à‡∏≠)
            updateOrderUI();
            
            // 4. ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Overlay
            document.getElementById('orderNotificationOverlay').classList.add('hidden');

            // 5. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤)
            Swal.fire({ 
                icon: 'success', 
                title: lang.accept_success_title || 'Accepted!', 
                text: lang.accept_success_text || 'Order is now on the Index.',
                timer: 2000 
            });

            // 6. (Optional) ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡∏°‡πà
            if (typeof loadActiveMerchantTasks === 'function') {
                await loadActiveMerchantTasks();
            }
        } else {
            Swal.fire({ icon: 'error', text: result.message || 'Error' });
        }
    } catch (e) {
        console.error("Accept Order Error:", e);
        Swal.fire({ icon: 'error', text: lang.error_connection });
    }
}

// üö© ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
async function declineOrder() {
    if (!currentIncomingOrder) return;

    const lang = translations[currentLang];
    const detailOverlay = document.getElementById('orderNotificationOverlay');

    // üö© ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Swal ‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
    if (detailOverlay) detailOverlay.style.opacity = "0.5";

    // 1. ‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡πÉ‡∏à
    const { isConfirmed } = await Swal.fire({
        title: lang.confirm_reject_title,
        text: lang.confirm_reject_text,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#aaa',
        confirmButtonText: lang.btn_confirm_reject,
        cancelButtonText: lang.btn_cancel,
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î:
        heightAuto: false 
    });

    // üö© ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
    if (detailOverlay) detailOverlay.style.opacity = "1";

    if (isConfirmed) {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
        try {
            const sound = document.getElementById('orderSound');
            if (sound) sound.pause();

            const response = await fetch('/api/merchant/reject-order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    orderId: currentIncomingOrder.orderId,
                    merchantUser: localStorage.getItem('myUsername'),
                    reason: "Merchant Declined" 
                })
            });

            const result = await response.json();
            if (result.success) {
                pendingOrders = pendingOrders.filter(o => o.orderId !== currentIncomingOrder.orderId);
                updateOrderUI();
                detailOverlay.classList.add('hidden');
                closeOrderList();
                Swal.fire({ icon: 'success', title: 'Done', text: lang.reject_success_text, timer: 2000 });
            }
        } catch (e) {
            Swal.fire({ icon: 'error', text: lang.error_connection });
        }
    }
}



// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
function formatMerchantChatMessage(text) {
    const urlRegex = /(https?:\/\/[^\s]+)/g;
    return text.replace(urlRegex, (url) => {
        return `<a href="${url}" target="_blank" style="color: inherit; text-decoration: underline; font-weight: bold;"> üìç</a>`;
    });
}

function appendMerchantMessage(author, text, isMe, imageUrl = null) {
    const chatBox = document.getElementById('chat-box');
    const roleLabel = getMerchantRoleLabel(author);
    
    let imageHtml = '';
    if (imageUrl) {
        const fullPath = imageUrl.startsWith('http') ? imageUrl : `/${imageUrl}`;
        imageHtml = `<img src="${fullPath}" style="width:100%; border-radius:8px; margin-top:5px; cursor:pointer;" onclick="window.open(this.src)">`;
    }

    const newMsgHtml = `
        <div class="chat-msg ${isMe ? 'msg-me' : 'msg-them'}" style="margin-bottom: 8px;">
            <small style="display:block; font-size:0.7rem; font-weight:bold; opacity:0.8; margin-bottom:4px;">
                ${roleLabel}
            </small>
            <div>${formatMerchantChatMessage(text)}</div>
            ${imageHtml}
        </div>
    `;
    
    chatBox.insertAdjacentHTML('beforeend', newMsgHtml);
    chatBox.scrollTop = chatBox.scrollHeight;
}


// ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
function shareMerchantLocation() {
    if (!navigator.geolocation) return alert("Browser not supported GPS");
    navigator.geolocation.getCurrentPosition((position) => {
        const { latitude, longitude } = position.coords;
        const mapLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
        const message = `üìç: ${mapLink}`;
        sendMerchantCustomMessage(message);
    });
}

async function sendMerchantCustomMessage(text) {
    if (!activeTaskInSidebar) return;
    const res = await fetch(`/api/posts/${activeTaskInSidebar.id}/comments`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ author: myUsername, text: text })
    });
    if (res.ok) {
        appendMerchantMessage(myUsername, text, true, null);
    }
}

// ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
async function handleMerchantPhotoSelect(input) {
    const file = input.files[0];
    if (!file) return;

    Swal.fire({
        title: 'sending photo...',
        allowOutsideClick: false,
        didOpen: () => { Swal.showLoading(); }
    });

    const imageUrl = URL.createObjectURL(file);
    const resizedBlob = await compressMerchantImage(imageUrl, 1024, 0.6);
    
    const formData = new FormData();
    formData.append('image', resizedBlob, `merchant_${Date.now()}.jpg`);
    formData.append('author', myUsername);
    formData.append('text', 'üì∑ send photo');

    const res = await fetch(`/api/posts/${activeTaskInSidebar.id}/comments`, {
        method: 'POST',
        body: formData
    });
    const data = await res.json();
    
    if (data.success) {
        appendMerchantMessage(myUsername, 'üì∑ send photo', true, data.comment.imageUrl);
        URL.revokeObjectURL(imageUrl);
        Swal.close();
    }
    input.value = '';
}

function compressMerchantImage(url, maxWidth, quality) {
    return new Promise((resolve) => {
        const img = new Image();
        img.src = url;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            let w = img.width, h = img.height;
            if (w > maxWidth) { h = (maxWidth / w) * h; w = maxWidth; }
            canvas.width = w; canvas.height = h;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, w, h);
            canvas.toBlob((blob) => resolve(blob), 'image/jpeg', quality);
        };
    });
}





window.onbeforeunload = function() {
    const activeTasks = document.querySelectorAll('.active-task-card').length;
    if (activeTasks > 0) {
        return translations[currentLang].before_unload_msg;
    }
};

</script>
	
	
	<div id="saved-locations-modal" class="modal-overlay hidden" style="z-index: 6000;">
    <div class="modal-box" style="max-width: 400px;">
    <h3 data-i18n-key="modal_title_address_book">üîñ ‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
    <div id="saved-list-content" style="max-height: 300px; overflow-y: auto; text-align: left;">
        </div>
    <button class="btn-submit" onclick="closeSavedModal()" 
            style="margin-top: 15px; background: #54a896;" 
            data-i18n-key="btn_close">
        ‡∏õ‡∏¥‡∏î
    </button>
</div>
</div>




	<div id="map-modal" class="modal-overlay hidden" style="z-index: 8000;">
    <div class="modal-box" style="max-width: 500px; padding: 0; overflow: hidden;">
        <div style="background: #11998e; color: white; padding: 15px; text-align: center;">
			<h3 style="margin: 0;" data-i18n-key="modal_title_pin_map">üìç ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î</h3>
		</div>
        
        <div id="map-container" style="height: 250px; width: 100%;"></div>

        <div style="padding: 20px; padding-bottom: 30px;"> 
    <div id="map-extra-info">
        <label id="map-label-name" data-i18n-key="lbl_map_name"><i class="fas fa-tag"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ A)</label>
        <input type="text" id="map-loc-name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà..." data-i18n-key="plh_map_name">
        
        <label data-i18n-key="lbl_map_phone"><i class="fas fa-phone"></i> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input type="tel" id="map-loc-phone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 081-234-5678" data-i18n-key="plh_map_phone">

        <label data-i18n-key="lbl_map_voice"><i class="fas fa-microphone"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Keyword ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô)</label>
        <div style="display: flex; gap: 5px; margin-bottom: 15px;">
            <input type="text" id="map-loc-voice" placeholder="‡∏û‡∏π‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß" style="margin-bottom: 0;" data-i18n-key="plh_map_voice">
            <button onclick="startVoiceForKeyword(this)" style="background: #f39c12; color: white; border: none; border-radius: 8px; width: 50px; cursor: pointer;">
                <i class="fas fa-microphone"></i>
            </button>
        </div>
    </div>
    
    <p id="map-coords-display" style="font-size: 0.8em; color: #888; margin-bottom: 15px;" data-i18n-key="lbl_map_coords_waiting">
        ‡∏û‡∏¥‡∏Å‡∏±‡∏î: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    </p>

    <div style="display: flex; gap: 10px;">
        <button class="btn-submit" onclick="confirmMapLocation()" style="flex: 2; border-radius: 8px;" data-i18n-key="btn_confirm_coords">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î
        </button>
        <button class="btn-submit" onclick="closeMapModal()" style="flex: 1; background: #999; border-radius: 8px;" data-i18n-key="btn_cancel">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
    </div>
</div>
    </div>
</div>



	
	<div id="manage-locations-modal" class="modal-overlay hidden" style="z-index: 8500;">
    <div class="modal-box" style="max-width: 500px; width: 95%;">
        <div style="background: #11998e; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0;">
    <h3 style="margin: 0;" data-i18n-key="title_manage_locations">
        <i class="fas fa-list"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏Å‡∏±‡∏î
    </h3>
</div>
        
        <div id="manage-list-container" style="max-height: 400px; overflow-y: auto;">
            </div>

        <button class="btn-submit" onclick="closeManageModal()" style="background: #999; margin-top: 20px; border-radius: 8px;" data-i18n-key="btn_close_window">
    ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
</button>
    </div>
</div>




		<div id="voice-summary-modal" class="modal-overlay hidden" style="z-index: 9999;">
    <div class="modal-box" style="max-width: 450px; background: #fdfdfd;">
    <div style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 20px; text-align: center;">
        <i class="fas fa-robot" style="font-size: 2em; margin-bottom: 10px;"></i>
        <h3 style="margin: 0; font-weight: 600;" data-i18n-key="ai_summary_success">AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
        <p style="margin: 5px 0 0 0; font-size: 0.85em; opacity: 0.9;" data-i18n-key="ai_summary_subtitle">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô</p>
    </div>

    <div style="padding: 20px;">
        <div class="summary-label" data-i18n-key="lbl_task_and_title"><i class="fas fa-file-signature"></i> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</div>
        <div id="sum-title" style="background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 10px; font-weight: bold; color: #11998e; margin-bottom: 20px;">
            -
        </div>

        <div class="summary-label" data-i18n-key="lbl_stops_sequence"><i class="fas fa-map-marked-alt"></i> ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö</div>
        <div id="sum-stops" style="margin-bottom: 20px;"></div>

        <div style="background: #fff4e5; padding: 15px; border-radius: 12px; border: 1px dashed #f39c12; text-align: center; margin-bottom: 25px;">
            <div class="summary-label" style="justify-content: center;" data-i18n-key="lbl_delivery_budget"><i class="fas fa-coins"></i> ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô (‡∏ö‡∏≤‡∏ó)</div>
            <div style="font-size: 2em; color: #e67e22; font-weight: bold;">
                <small style="font-size: 0.5em; vertical-align: middle;">‡∏ø</small> <span id="sum-budget">0</span>
            </div>
        </div>

        <div style="display: flex; gap: 12px;">
            <button class="btn-submit" onclick="confirmVoiceSummary()" style="flex: 2; height: 55px; box-shadow: 0 4px 12px rgba(17,153,142,0.2);" data-i18n-key="btn_confirm_this_data">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ
            </button>
            <button class="btn-submit" onclick="closeVoiceSummary()" style="flex: 1; background: #eee; color: #666; height: 55px;" data-i18n-key="btn_edit_new">
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>
    </div>
</div>
</div>






	<div id="right-sidebar" class="right-sidebar">
    <div class="sidebar-header" style="background: #11998e;">
    <span onclick="closeRightSidebar()" style="cursor:pointer;"><i class="fas fa-times"></i></span>
    <h3 id="sidebar-task-title" style="margin: 0; font-size: 1.1em;" data-i18n-key="sidebar_main_title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h3>
</div>
    
    <div class="tab-menu">
        <div class="tab-item active" onclick="switchTab('notif')"><i class="fas fa-bell"></i></div>
        <div class="tab-item" onclick="switchTab('details')"><i class="fas fa-info-circle"></i></div>
        <div class="tab-item" onclick="switchTab('chat')"><i class="fas fa-comments"></i></div>
    </div>

    <div id="tab-notif" class="tab-content">
    <h4 data-i18n-key="sidebar_tab_notif"><i class="fas fa-bell"></i> ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h4>
    
    <div id="sidebar-order-items-container" class="hidden" style="margin-bottom: 15px; padding: 12px; background: #f0f9f8; border: 1px dashed #11998e; border-radius: 10px;">
        <b style="color: #11998e; font-size: 0.9em; display: block; margin-bottom: 5px;">
            <i class="fas fa-shopping-basket"></i> <span data-i18n-key="sidebar_order_items_title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á:</span>
        </b>
        <div id="sidebar-items-text" style="font-size: 0.85em; color: #333; line-height: 1.4;"></div>
    </div>

    <div id="notif-list"></div>
	</div>

    <div id="tab-details" class="tab-content hidden">
    <h4 data-i18n-key="sidebar_tab_details"><i class="fas fa-list-ol"></i> ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</h4>
    <div id="sidebar-details-content"></div>
	</div>

    <div id="tab-chat" class="tab-content hidden" style="display: flex; flex-direction: column; height: 100%;">
    <h4 data-i18n-key="sidebar_tab_chat"><i class="fas fa-comments"></i> ‡πÅ‡∏ä‡∏ó‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢</h4>
    <div id="chat-box" style="flex-grow: 1; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 10px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 8px;">
    </div>
    
    <div style="display: flex; gap: 5px; align-items: center; padding: 5px; background: #eee; border-radius: 10px;">
        <input type="file" id="merchant-photo-input" accept="image/*" style="display:none;" onchange="handleMerchantPhotoSelect(this)">
        <button onclick="document.getElementById('merchant-photo-input').click()" style="background:none; border:none; color:#11998e; font-size: 1.2rem; cursor:pointer; padding: 5px;">
            <i class="fas fa-camera"></i>
        </button>

        <button onclick="shareMerchantLocation()" style="background:none; border:none; color:#11998e; font-size: 1.2rem; cursor:pointer; padding: 5px;">
            <i class="fas fa-map-marker-alt"></i>
        </button>

        <input type="text" id="chat-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." style="flex:1; margin-bottom: 0; border-radius: 20px; border: 1px solid #ddd; padding: 8px 15px;" onkeypress="if(event.key==='Enter') sendSidebarChat()">
        
        <button onclick="sendSidebarChat()" style="width: 40px; height: 40px; background: #11998e; color: white; border: none; border-radius: 50%; cursor:pointer;">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>
</div>
<div id="right-sidebar-overlay" class="sidebar-overlay hidden" onclick="closeRightSidebar()"></div>


	<div id="save-template-modal" class="modal-overlay hidden" style="z-index: 9500;">
    <div class="modal-box" style="max-width: 400px;">
        <div style="background: #11998e; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0;">
            <h3 style="margin: 0;" data-i18n-key="tpl_title"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</h3>
        </div>
        <label data-i18n-key="tpl_label_name">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠)</label>
        <input type="text" id="tpl-name" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏á‡πà‡∏≤‡∏¢..." data-i18n-key="tpl_plh_name">
        
        <label data-i18n-key="tpl_label_voice">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Keyword)</label>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="tpl-voice" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠" style="margin-bottom: 0;" data-i18n-key="tpl_plh_voice">
            <button onclick="startVoiceForTemplate(this)" style="background: #f39c12; color: white; border: none; border-radius: 8px; width: 45px; cursor: pointer;">
                <i class="fas fa-microphone"></i>
            </button>
        </div>
        <p style="font-size: 0.8em; color: #888; margin-top: 5px;" data-i18n-key="tpl_note">* ‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn-submit" onclick="confirmSaveTemplate()" data-i18n-key="btn_save_template">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ</button>
            <button class="btn-submit" onclick="closeSaveTplModal()" style="background: #999;" data-i18n-key="btn_cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>

<div id="list-order-modal" class="modal-overlay hidden" style="z-index: 9000;">
    <div class="modal-box" style="max-width: 450px;">
    <div style="background: #11998e; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0;">
        <h3 style="margin: 0;" data-i18n-key="tpl_list_title">
            <i class="fas fa-bookmark"></i> ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
        </h3>
    </div>
    <div id="template-list-content" style="max-height: 400px; overflow-y: auto;">
        </div>
    <button class="btn-submit" onclick="closeListOrderModal()" 
            style="background: #999; margin-top: 20px; border-radius: 8px;" 
            data-i18n-key="btn_close_window">
        ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
    </button>
</div>
</div>


	
	
	<div id="how-to-voice-modal" class="modal-overlay hidden" style="z-index: 9999;">
    <div class="modal-box" style="max-width: 450px; text-align: left;">
    <div style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 20px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0; text-align: center;">
        <i class="fas fa-microphone-alt" style="font-size: 2.5em; margin-bottom: 10px;"></i>
        <h3 style="margin: 0;" data-i18n-key="guide_title">‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>
    </div>

    <div style="padding: 10px;">
        <p style="font-weight: bold; color: #11998e;" data-i18n-key="guide_method_1_title"><i class="fas fa-star"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"</p>
        <p style="font-size: 0.9em; color: #666; margin-left: 15px;" data-i18n-key="guide_method_1_desc">
            ‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ <b>"‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"</b> ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        </p>
        <div style="background: #fff4e5; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 20px;" data-i18n-key="guide_method_1_ex">
            <b>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</b> "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏≠", "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πà‡∏≠‡∏á"
        </div>

        <p style="font-weight: bold; color: #11998e;" data-i18n-key="guide_method_2_title"><i class="fas fa-star"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô</p>
        <p style="font-size: 0.9em; color: #666; margin-left: 15px;" data-i18n-key="guide_method_2_desc">
            ‡∏û‡∏π‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô ‡∏û‡∏¥‡∏Å‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        </p>
        <p style="font-size: 0.9em; color: #666; margin-left: 15px;" data-i18n-key="guide_method_2_sub">
            ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏°‡∏µ 3 ‡πÅ‡∏ö‡∏ö ‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£-‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤-‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </p>
        <div style="background: #e8f5e9; padding: 10px; border-radius: 8px; font-size: 0.85em; margin-bottom: 20px;" data-i18n-key="guide_method_2_ex">
            <b>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</b> "‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏õ <u>‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠</u> <u>‡∏´‡πâ‡∏≤‡∏™‡∏¥‡∏ö</u>‡∏ö‡∏≤‡∏ó", "‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏õ <u>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</u> <u>‡πÅ‡∏õ‡∏î‡∏™‡∏¥‡∏ö</u>"
        </div>

        <p style="font-size: 0.8em; color: #999; border-top: 1px solid #eee; padding-top: 10px;" data-i18n-key="guide_note">
            * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Ç‡∏≠‡∏á AI
        </p>
    </div>

    <button class="btn-submit" onclick="closeHowToVoice()" style="margin-top: 20px;" data-i18n-key="btn_got_it">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
</div>
</div>



	<div id="info-use-modal" class="modal-overlay hidden" style="z-index: 9999;">
    <div class="modal-box" style="max-width: 450px; text-align: left;">
        <div style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 20px; margin: -20px -20px 20px -20px; border-radius: 15px 15px 0 0; text-align: center;">
    <i class="fas fa-info" style="font-size: 2.5em; margin-bottom: 10px;"></i>
    <h3 style="margin: 0;" data-i18n-key="note_title">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥</h3>
</div>

        <div style="padding: 10px;">
    <p style="font-weight: bold; color: #11998e;" data-i18n-key="note_bypass_title"><i class="fas fa-star"></i> ‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ö‡∏≤‡∏¢‡∏û‡∏≤‡∏™</p>
    <p style="font-size: 0.9em; color: #666; margin-left: 15px;" data-i18n-key="note_bypass_desc">
        ‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ö‡∏≤‡∏¢‡∏û‡∏≤‡∏™‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏∏‡∏î‡∏™‡πà‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏•‡∏∑‡∏°‡∏Å‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏±‡πâ‡∏ô‡πÜ
    </p>            
</div>

        <button class="btn-submit" onclick="closeInfo()" style="margin-top: 20px;" data-i18n-key="btn_got_it">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
    </div>
</div>



<div id="merchantProductsModal" class="product-modal-overlay hidden">
    <div class="product-modal-card">
        <div class="product-modal-header">
            <h3 data-i18n-key="menu_manage_products">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <button class="btn-close-modal" onclick="closeMerchantProductsModal()">&times;</button>
        </div>
        <div class="product-modal-body">
            <p class="product-note">
                * <span data-i18n-key="product_limit_note">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡πÄ‡∏°‡∏ô‡∏π (‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á)</span>
            </p>
            <div id="product-list-inputs">
                </div>
            <button onclick="saveMerchantProducts()" class="btn-save-products">
                <i class="fas fa-save"></i> <span data-i18n-key="btn_save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π</span>
            </button>
        </div>
    </div>
</div>



<div id="orderNotificationOverlay" class="order-alert-overlay hidden">
    <div class="order-alert-card">
        <div class="order-alert-header-compact">
            <div class="header-left">
                <i class="fas fa-shopping-bag pulse-small"></i>
                <h3 data-i18n-key="new_order_title">‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà!</h3>
            </div>
            <div id="alertTimer" class="timer-badge">10:00</div>
        </div>

        <div class="order-alert-body">
            <div class="order-info-container">
                <div class="order-info-group">
                    <span class="info-label" data-i18n-key="order_id">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå:</span>
                    <span id="alertOrderId" class="info-value">#ORD12345</span>
                </div>
                <div class="order-info-group">
                    <span class="info-label" data-i18n-key="customer_name">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span>
                    <span id="alertCustomerName" class="info-value">-</span>
                </div>
                <div class="order-info-group">
                    <span class="info-label" data-i18n-key="customer_phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</span>
                    <span id="alertCustomerPhone" class="info-value highlight-green">-</span>
                </div>
            </div>

            <div id="orderMiniMap" style="width: 100%; height: 130px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #eee; background: #f0f0f0; z-index: 1;"></div>

            <div class="order-items-box-wrapper">
                <div id="alertOrderItems" class="items-list"></div>
                <div class="food-price-row">
                    <span data-i18n-key="food_total">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£:</span>
                    <span id="alertFoodPrice" class="badge-price-food">0.00</span>
                </div>
            </div>

            <div class="rider-wage-row">
                <span class="info-label" data-i18n-key="rider_wage">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå:</span>
                <span id="alertRiderWage" class="badge-price-rider">0.00</span>
            </div>

            <div class="order-price-summary">
                <span data-i18n-key="net_total" style="font-weight: bold;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ:</span>
                <span id="alertOrderPrice" class="price-value">0.00 USD</span>
            </div>
        </div>

        <div class="order-alert-footer">
            <button class="btn-decline-new" onclick="declineOrder()" data-i18n-key="btn_decline">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
            <button class="btn-accept-new" onclick="acceptOrder()" data-i18n-key="btn_accept_order">‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå & ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
        </div>
    </div>
</div>

<audio id="orderSound" loop>
    <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
</audio>




<div id="floatingOrderBtn" class="floating-order-btn" onclick="openOrderList()">
    <span class="order-badge" id="orderCountBadge">0</span>
    <i class="fas fa-shopping-cart"></i>
    <span style="margin-left: 10px; font-weight: bold;" data-i18n-key="orders_tab">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
</div>

<div id="orderListModal" class="product-modal-overlay hidden">
    <div class="product-modal-card">
        <div class="product-modal-header" style="background: #e67e22;">
            <h3 data-i18n-key="pending_orders">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</h3>
            <button class="btn-close-modal" onclick="closeOrderList()">&times;</button>
        </div>
        <div class="product-modal-body" id="orderListContainer" style="padding: 0;">
            </div>
    </div>
</div>




</body>
</html>